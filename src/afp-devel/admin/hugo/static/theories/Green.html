<div id="General_Utils">
<div class="head">
<h1>Theory General_Utils</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> General_Utils
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../../HOL/HOL-Analysis/Analysis.html">HOL-Analysis.Analysis</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="General_Utils-lambda_skolem_gen"><span class="command">lemma</span></span> lambda_skolem_gen<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">∃</span><span class="bound">f'</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">^</span> <span class="tfree">'n</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">.</span> <span class="free">P</span> <span class="bound">i</span> <span class="bound">f'</span><span class="main">)</span> <span class="main">⟷</span>
   <span class="main">(</span><span class="main">∃</span><span class="bound">f'</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">^</span> <span class="tfree">'n</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">^</span> <span class="tfree">'n</span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">P</span> <span class="bound">i</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">f'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⟷</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
  <span class="comment1">(*using choice_iff lambda_skolem*)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?rhs</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f''</span></span> <span class="keyword2"><span class="keyword">where</span></span> f''<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">P</span> <span class="bound">i</span> <span class="main">(</span><span class="skolem">f''</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> choice_iff
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">χ</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="skolem">f''</span>  <span class="bound">i</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
      <span class="keyword1"><span class="command">from</span></span> f'' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">i</span> <span class="main">(</span><span class="skolem">f''</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">i</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span><span class="main">(</span><span class="var">?x</span> <span class="bound">x</span><span class="main">)</span> <span class="main">$</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">P</span> <span class="bound">i</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span><span class="main">(</span><span class="var">?x</span> <span class="bound">x</span><span class="main">)</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span><span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="General_Utils-lambda_skolem_euclidean"><span class="command">lemma</span></span> lambda_skolem_euclidean<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">∈</span>Basis<span class="main">.</span> <span class="main">∃</span><span class="bound">f'</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>euclidean_space<span class="main">}</span><span class="main">⇒</span>real<span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">i</span> <span class="bound">f'</span><span class="main">)</span> <span class="main">⟷</span>
   <span class="main">(</span><span class="main">∃</span><span class="bound">f'</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>euclidean_space<span class="main">⇒</span><span class="tfree">'b</span><span class="main">::</span>euclidean_space<span class="main">)</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span><span class="main">∈</span>Basis<span class="main">.</span> <span class="free">P</span> <span class="bound">i</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">f'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⟷</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
  <span class="comment1">(*using choice_iff lambda_skolem*)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?rhs</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f''</span></span> <span class="keyword2"><span class="keyword">where</span></span> f''<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">::</span><span class="main">(</span><span class="tfree">'b</span><span class="main">::</span>euclidean_space<span class="main">)</span><span class="main">∈</span>Basis<span class="main">.</span> <span class="free">P</span> <span class="bound">i</span> <span class="main">(</span><span class="skolem">f''</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> choice_iff
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span>Basis<span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">f''</span>  <span class="bound">i</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'b</span><span class="main">::</span>euclidean_space"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">∈</span>Basis"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">i</span> <span class="main">(</span><span class="skolem">f''</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f''
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">i</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span><span class="main">(</span><span class="var">?x</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ass <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span>Basis<span class="main">.</span> <span class="free">P</span> <span class="bound">i</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span><span class="main">(</span><span class="var">?x</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f'6</span></span></span> <span class="main">=</span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">i</span><span class="main">∈</span>Basis<span class="main">.</span> <span class="free">P</span> <span class="bound">i</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="var">?f'6</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span><span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="General_Utils-lambda_skolem_euclidean_explicit"><span class="command">lemma</span></span> lambda_skolem_euclidean_explicit<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">∈</span>Basis<span class="main">.</span> <span class="main">∃</span><span class="bound">f'</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>euclidean_space<span class="main">}</span><span class="main">⇒</span>real<span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">i</span> <span class="bound">f'</span><span class="main">)</span> <span class="main">⟷</span>
   <span class="main">(</span><span class="main">∃</span><span class="bound">f'</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>euclidean_space<span class="main">}</span><span class="main">⇒</span><span class="tfree">'a</span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span><span class="main">∈</span>Basis<span class="main">.</span> <span class="free">P</span> <span class="bound">i</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">f'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⟷</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
  <span class="comment1">(*using choice_iff lambda_skolem*)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?rhs</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f''</span></span> <span class="keyword2"><span class="keyword">where</span></span> f''<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>euclidean_space<span class="main">)</span><span class="main">∈</span>Basis<span class="main">.</span> <span class="free">P</span> <span class="bound">i</span> <span class="main">(</span><span class="skolem">f''</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> choice_iff
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span>Basis<span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">f''</span>  <span class="bound">i</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>euclidean_space"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">∈</span>Basis"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">i</span> <span class="main">(</span><span class="skolem">f''</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f''
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">i</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span><span class="main">(</span><span class="var">?x</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ass <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span>Basis<span class="main">.</span> <span class="free">P</span> <span class="bound">i</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span><span class="main">(</span><span class="var">?x</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f'6</span></span></span> <span class="main">=</span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">i</span><span class="main">∈</span>Basis<span class="main">.</span> <span class="free">P</span> <span class="bound">i</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="var">?f'6</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span><span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="General_Utils-indic_ident"><span class="command">lemma</span></span> indic_ident<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="main">(</span><span class="bound">f</span><span class="main">::</span><span class="tfree">'a</span> <span class="main">⇒</span> real<span class="main">)</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> indicator <span class="bound">s</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">s</span> <span class="keyword1">then</span> <span class="bound">f</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> real"</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">f</span> <span class="skolem">x</span> <span class="main">*</span> indicator <span class="skolem">s</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">s</span> <span class="keyword1">then</span> <span class="skolem">f</span> <span class="skolem">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> indicator_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="General_Utils-real_pair_basis"><span class="command">lemma</span></span> real_pair_basis<span class="main">:</span> <span class="quoted"><span class="quoted">"Basis <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">,</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">,</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Basis_prod_def insert_commute<span class="main">)</span>


<span class="comment1">(*AE_measure_singleton*)</span>

<span class="keyword1" id="General_Utils-real_singleton_in_borel"><span class="command">lemma</span></span> real_singleton_in_borel<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">::</span>real<span class="main">}</span> <span class="main">∈</span> sets borel"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Borel_Space.cbox_borel<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="General_Utils-real_singleton_in_lborel"><span class="command">lemma</span></span> real_singleton_in_lborel<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">::</span>real<span class="main">}</span> <span class="main">∈</span> sets lborel"</span></span>
  <span class="keyword1"><span class="command">using</span></span> real_singleton_in_borel
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="General_Utils-cbox_diff"><span class="command">lemma</span></span> cbox_diff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">::</span>real<span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span> <span class="main">=</span> box <span class="main">0</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cbox_def<span class="main">)</span>

<span class="keyword1" id="General_Utils-sum_bij"><span class="command">lemma</span></span> sum_bij<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bij <span class="free">F</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">s</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span><span class="free">F</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span><span class="main">.</span> <span class="free">F</span> <span class="main">`</span> <span class="free">s</span> <span class="main">=</span>  <span class="bound">t</span> <span class="main">⟹</span> sum <span class="free">f</span> <span class="free">s</span> <span class="main">=</span> sum <span class="free">g</span> <span class="bound">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms bij_betw_def bij_betw_subset subset_UNIV sum.reindex_cong<span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">surj_on</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">surj_on</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⊆</span> range <span class="free"><span class="bound"><span class="entity">f</span></span></span>"</span></span>

<span class="keyword1" id="General_Utils-surj_on_image_vimage_eq"><span class="command">lemma</span></span> surj_on_image_vimage_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"surj_on <span class="free">s</span> <span class="free">f</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">`</span> <span class="main">(</span><span class="free">f</span> <span class="main">-`</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Derivs">
<div class="head">
<h1>Theory Derivs</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Derivs
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="General_Utils.html">General_Utils</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Derivs-field_simp_has_vector_derivative"><span class="command">lemma</span></span> field_simp_has_vector_derivative <span class="main">[</span><span class="operator">derivative_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">has_field_derivative</span> <span class="free">y</span><span class="main">)</span> <span class="free">F</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">has_vector_derivative</span> <span class="free">y</span><span class="main">)</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_field_derivative_iff_has_vector_derivative<span class="main">)</span>

<span class="keyword1" id="Derivs-continuous_on_cases_empty"><span class="command">lemma</span></span> continuous_on_cases_empty <span class="main">[</span><span class="operator">continuous_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>closed <span class="free">S</span><span class="main">;</span> continuous_on <span class="free">S</span> <span class="free">f</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">S</span><span class="main">;</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">x</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">x</span><span class="main">⟧</span> <span class="main">⟹</span>
    continuous_on <span class="free">S</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">P</span> <span class="bound">x</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> continuous_on_cases <span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Derivs-inj_on_cases"><span class="command">lemma</span></span> inj_on_cases<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="free">f</span> <span class="main">(</span>Collect <span class="free">P</span> <span class="main">∩</span> <span class="free">S</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="free">g</span> <span class="main">(</span>Collect <span class="main">(</span>Not <span class="main">∘</span> <span class="free">P</span><span class="main">)</span> <span class="main">∩</span> <span class="free">S</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="main">(</span>Collect <span class="free">P</span> <span class="main">∩</span> <span class="free">S</span><span class="main">)</span> <span class="main">∩</span> <span class="free">g</span> <span class="main">`</span> <span class="main">(</span>Collect <span class="main">(</span>Not <span class="main">∘</span> <span class="free">P</span><span class="main">)</span> <span class="main">∩</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">P</span> <span class="bound">x</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main">)</span>

<span class="keyword1" id="Derivs-inj_on_arccos"><span class="command">lemma</span></span> inj_on_arccos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">-</span><span class="main">1</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">⟹</span> inj_on arccos <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> atLeastAtMost_iff cos_arccos inj_onI subsetCE<span class="main">)</span>

<span class="keyword1" id="Derivs-has_vector_derivative_componentwise_within"><span class="command">lemma</span></span> has_vector_derivative_componentwise_within<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">has_vector_derivative</span> <span class="free">f'</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">a</span> <span class="keyword1">within</span> <span class="free">S</span><span class="main">)</span> <span class="main">⟷</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> Basis<span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> <span class="main">(</span><span class="free">f'</span> <span class="main">∙</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">a</span> <span class="keyword1">within</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_vector_derivative_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> has_derivative_componentwise_within<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Derivs-has_vector_derivative_pair_within"><span class="command">lemma</span></span> has_vector_derivative_pair_within<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>euclidean_space"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>euclidean_space"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> Basis <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">u</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> <span class="free">f'</span> <span class="main">∙</span> <span class="bound">u</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span> <span class="keyword1">within</span> <span class="free">S</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> Basis <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">u</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> <span class="free">g'</span> <span class="main">∙</span> <span class="bound">u</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span> <span class="keyword1">within</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">,</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> <span class="main">(</span><span class="free">f'</span><span class="main">,</span><span class="free">g'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span> <span class="keyword1">within</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> has_vector_derivative_componentwise_within<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> assms Basis_prod_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Derivs-piecewise_C1_differentiable_const"><span class="command">lemma</span></span> piecewise_C1_differentiable_const<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main">)</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> continuous_on_const
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> piecewise_C1_differentiable_on_def<span class="main">)</span>

<span class="keyword1"><span class="command">declare</span></span> piecewise_C1_differentiable_const <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">derivative_intros</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> piecewise_C1_differentiable_neg <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">derivative_intros</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> piecewise_C1_differentiable_add <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">derivative_intros</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> piecewise_C1_differentiable_diff <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">derivative_intros</span><span class="main">]</span>

<span class="comment1">(*move to Derivative*)</span>

<span class="keyword1" id="Derivs-piecewise_C1_differentiable_on_ident"><span class="command">lemma</span></span> piecewise_C1_differentiable_on_ident <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">derivative_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>real_normed_vector"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> piecewise_C1_differentiable_on_def <span class="keyword1"><span class="command">using</span></span> C1_differentiable_on_ident
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> continuous_on_id C1_differentiable_on_ident<span class="main">)</span>

<span class="keyword1" id="Derivs-piecewise_C1_differentiable_on_mult"><span class="command">lemma</span></span> piecewise_C1_differentiable_on_mult <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">derivative_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>real_normed_algebra"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> piecewise_C1_differentiable_on_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> A B<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">A</span> <span class="main">∪</span> <span class="improper">B</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> C1_differentiable_on_mult C1_differentiable_on_subset<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Derivs-C1_differentiable_on_cdiv"><span class="command">lemma</span></span> C1_differentiable_on_cdiv <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">derivative_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> real_normed_field"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">C1_differentiable_on</span> <span class="free">S</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="free">c</span><span class="main">)</span> <span class="keyword1">C1_differentiable_on</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divide_inverse<span class="main">)</span>

<span class="keyword1" id="Derivs-piecewise_C1_differentiable_on_cdiv"><span class="command">lemma</span></span> piecewise_C1_differentiable_on_cdiv <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">derivative_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>real_normed_field"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="free">c</span><span class="main">)</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divide_inverse piecewise_C1_differentiable_const piecewise_C1_differentiable_on_mult assms<span class="main">)</span>

<span class="keyword1" id="Derivs-sqrt_C1_differentiable"><span class="command">lemma</span></span> sqrt_C1_differentiable <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">derivative_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">C1_differentiable_on</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">S</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sqrt <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">C1_differentiable_on</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> contf<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="free">S</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C1_differentiable_imp_continuous_on f<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">unfolding</span></span> C1_differentiable_on_def has_field_derivative_iff_has_vector_derivative <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> contf <span class="dynamic"><span class="dynamic">continuous_intros</span></span> <span class="dynamic"><span class="dynamic">derivative_intros</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Derivs-sqrt_piecewise_C1_differentiable"><span class="command">lemma</span></span> sqrt_piecewise_C1_differentiable <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">derivative_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">S</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sqrt <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> piecewise_C1_differentiable_on_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span> <span class="dynamic"><span class="dynamic">derivative_intros</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>banach<span class="main">,</span>real_normed_field<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">C1_differentiable_on</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> sin_C1_differentiable <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">derivative_intros</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sin <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">C1_differentiable_on</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   cos_C1_differentiable <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">derivative_intros</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> cos <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">C1_differentiable_on</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> contf<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="free">S</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C1_differentiable_imp_continuous_on f<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> df_sin <span class="main">=</span> field_vector_diff_chain_at <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> g<span class="main"><span class="main">=</span></span><span class="quoted">sin</span><span class="main">,</span> <span class="operator">unfolded</span> o_def<span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> df_cos <span class="main">=</span> field_vector_diff_chain_at <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> g<span class="main"><span class="main">=</span></span><span class="quoted">cos</span><span class="main">,</span> <span class="operator">unfolded</span> o_def<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sin <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">C1_differentiable_on</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> cos <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">C1_differentiable_on</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">unfolding</span></span> C1_differentiable_on_def has_field_derivative_iff_has_vector_derivative <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> contf <span class="dynamic"><span class="dynamic">continuous_intros</span></span> df_sin df_cos <span class="dynamic"><span class="dynamic">derivative_intros</span></span> exI conjI ballI <span class="main"><span class="keyword3">|</span></span> <span class="operator">force</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Derivs-has_derivative_abs"><span class="command">lemma</span></span> has_derivative_abs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>abs <span class="keyword1">has_derivative</span> <span class="main">(</span><span class="main">(*)</span> <span class="main">(</span>sgn <span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"norm <span class="main">=</span> abs"</span></span>
    <span class="keyword1"><span class="command">using</span></span> real_norm_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> has_derivative_norm <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span><span class="main"><span class="main">=</span></span><span class="quoted">real</span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_commute_abs<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Derivs-abs_C1_differentiable"><span class="command">lemma</span></span> abs_C1_differentiable <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">derivative_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">C1_differentiable_on</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> <span class="free">f</span> <span class="main">`</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> abs <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">C1_differentiable_on</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> contf<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="free">S</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C1_differentiable_imp_continuous_on f<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> df <span class="main">=</span> DERIV_chain <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main">=</span></span><span class="quoted">abs</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> g<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">f</span></span><span class="main">,</span> <span class="operator">unfolded</span> o_def<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">unfolding</span></span> C1_differentiable_on_def has_field_derivative_iff_has_vector_derivative <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> df exI conjI ballI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> has_field_derivative_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> has_derivative_abs <span class="dynamic"><span class="dynamic">continuous_intros</span></span> contf<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Derivs-C1_differentiable_on_pair"><span class="command">lemma</span></span> C1_differentiable_on_pair <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">derivative_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>euclidean_space"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>euclidean_space"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">C1_differentiable_on</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">C1_differentiable_on</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">,</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">C1_differentiable_on</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> C1_differentiable_on_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> A B<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> exI ballI conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> f'<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">A</span> <span class="improper">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> g'<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">B</span> <span class="improper">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> has_vector_derivative_pair_within<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span>  has_vector_derivative_componentwise_within
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> continuous_on_Pair<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="Derivs-piecewise_C1_differentiable_on_pair"><span class="command">lemma</span></span> piecewise_C1_differentiable_on_pair <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">derivative_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>euclidean_space"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>euclidean_space"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">,</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> piecewise_C1_differentiable_on_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span> C1_differentiable_on_pair <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> continuous_on_discrete
      <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> C1_differentiable_on_subset<span class="main">)</span>

<span class="keyword1" id="Derivs-test2"><span class="command">lemma</span></span> test2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="free">s</span> <span class="main">⟹</span> <span class="free">g</span> <span class="keyword1">differentiable</span> <span class="keyword1">at</span> <span class="bound">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> fs<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> uv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≤</span> <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="free">v</span><span class="main">-</span><span class="free">u</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">t</span> <span class="main">+</span> <span class="free">u</span><span class="main">)</span> <span class="main">-`</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="main">(</span><span class="main">(</span><span class="free">v</span><span class="main">-</span><span class="free">u</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">u</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">v</span><span class="main">-</span><span class="free">u</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> vector_derivative <span class="free">g</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="main">(</span><span class="free">v</span><span class="main">-</span><span class="free">u</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="free">u</span><span class="main">)</span> <span class="keyword1">within</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="keyword1">has_vector_derivative</span> vector_derivative <span class="free">g</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="main">(</span><span class="free">v</span> <span class="main">-</span> <span class="free">u</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="free">u</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="main">(</span><span class="free">v</span><span class="main">-</span><span class="free">u</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="free">u</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms s <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span> <span class="main">-</span> <span class="free">u</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="free">u</span>"</span></span><span class="main">]</span> uv mult_left_le <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">-</span><span class="free">u</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>  vector_derivative_works<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="main">(</span><span class="main">(</span><span class="free">v</span> <span class="main">-</span> <span class="free">u</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">u</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> <span class="main">(</span><span class="free">v</span> <span class="main">-</span> <span class="free">u</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> vector_derivative <span class="free">g</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="main">(</span><span class="free">v</span> <span class="main">-</span> <span class="free">u</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="free">u</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> vector_diff_chain_at <span class="main"><span class="main">[</span></span><span class="operator">simplified</span> o_def<span class="main"><span class="main">]</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> <span class="main"><span class="keyword3">|</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">(</span><span class="free">v</span> <span class="main">-</span> <span class="free">u</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="free">u</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms uv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span> <span class="main">-</span> <span class="free">u</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="free">u</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms uv
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> add.commute atLeastAtMost_iff atLeastatMost_empty_iff diff_ge_0_iff_ge empty_iff le_diff_eq mult_left_le<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> iii<span class="main">:</span> <span class="quoted"><span class="quoted">"vector_derivative <span class="free">g</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="main">(</span><span class="free">v</span> <span class="main">-</span> <span class="free">u</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="free">u</span><span class="main">)</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> vector_derivative <span class="free">g</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="main">(</span><span class="free">v</span> <span class="main">-</span> <span class="free">u</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="free">u</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Derivative.vector_derivative_at_within_ivl<span class="main">[</span><span class="operator">OF</span> i<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> 0 1<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> iv<span class="main">:</span> <span class="quoted"><span class="quoted">"vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="main">(</span><span class="main">(</span><span class="free">v</span> <span class="main">-</span> <span class="free">u</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">u</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">v</span> <span class="main">-</span> <span class="free">u</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> vector_derivative <span class="free">g</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="main">(</span><span class="free">v</span> <span class="main">-</span> <span class="free">u</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="free">u</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Derivative.vector_derivative_at_within_ivl<span class="main">[</span><span class="operator">OF</span> ii<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span><span class="main">]</span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> iii iv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Derivs-C1_differentiable_on_components"><span class="command">lemma</span></span> C1_differentiable_on_components<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> Basis <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">C1_differentiable_on</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">C1_differentiable_on</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C1_differentiable_on_def has_vector_derivative_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span> <span class="bound">i</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="bound">f</span> <span class="main">∙</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">f</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f'</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span><span class="main">∈</span>Basis<span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">s</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">has_derivative</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">f'</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> continuous_on <span class="free">s</span> <span class="bound">f'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms lambda_skolem_euclidean<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span> <span class="bound">D</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">s</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">has_derivative</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">D</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> continuous_on <span class="free">s</span> <span class="bound">D</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> C1_differentiable_on_def has_vector_derivative_def *<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> continuous_on_componentwise<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">s</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f'</span></span> <span class="keyword2"><span class="keyword">where</span></span> f'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span>Basis<span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">s</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">has_derivative</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">f'</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> continuous_on <span class="free">s</span> <span class="skolem">f'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">s</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">has_derivative</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">f'</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> continuous_on <span class="free">s</span> <span class="skolem">f'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f' has_derivative_componentwise_within<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">f</span>"</span></span><span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> S<span class="main"><span class="main">=</span></span> <span class="quoted">UNIV</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">D</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">s</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">has_derivative</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">D</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> continuous_on <span class="free">s</span> <span class="bound">D</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Derivs-piecewise_C1_differentiable_on_components"><span class="command">lemma</span></span> piecewise_C1_differentiable_on_components<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">t</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> Basis <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">C1_differentiable_on</span> <span class="free">s</span> <span class="main">-</span> <span class="free">t</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> Basis <span class="main">⟹</span> continuous_on <span class="free">s</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> C1_differentiable_on_components assms continuous_on_componentwise piecewise_C1_differentiable_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Derivs-all_components_smooth_one_pw_smooth_is_pw_smooth"><span class="command">lemma</span></span> all_components_smooth_one_pw_smooth_is_pw_smooth<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> Basis <span class="main">-</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">C1_differentiable_on</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> is_cont<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span>Basis<span class="main">.</span> continuous_on <span class="free">s</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms C1_differentiable_imp_continuous_on piecewise_C1_differentiable_on_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> t<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>finite <span class="skolem">t</span> <span class="main">∧</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="keyword1">C1_differentiable_on</span> <span class="free">s</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> piecewise_C1_differentiable_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> piecewise_C1_differentiable_on_components<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?f</span> <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> piecewise_C1_differentiable_on_def
      C1_differentiable_on_subset<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Diff_subset<span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?B1</span> <span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">t</span>"</span></span><span class="main">]</span> t is_cont
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Derivs-derivative_component_fun_component"><span class="command">lemma</span></span> derivative_component_fun_component<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">i</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>euclidean_space"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">differentiable</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>vector_derivative <span class="free">f</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> vector_derivative <span class="free">f</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> bounded_linear.has_vector_derivative<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vector_derivative <span class="free">f</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
      bounded_linear_inner_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">i</span>"</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> vector_derivative_works<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>vector_derivative <span class="free">f</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> vector_derivative_works<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
      differentiableI_vector<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vector_derivative <span class="free">f</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
      Derivative.vector_derivative_at
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Derivs-gamma_deriv_at_within"><span class="command">lemma</span></span> gamma_deriv_at_within<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a_leq_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span>
    x_within_bounds<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    gamma_differentiable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span> <span class="main">..</span> <span class="free">b</span><span class="main">}</span><span class="main">.</span> <span class="free">γ</span> <span class="keyword1">differentiable</span> <span class="keyword1">at</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span>  vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Derivative.vector_derivative_at_within_ivl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">γ</span>"</span></span> <span class="quoted"><span class="quoted">"vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span>"</span></span><span class="main">]</span>
    gamma_differentiable x_within_bounds a_leq_b
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vector_derivative_works<span class="main">)</span>

<span class="keyword1" id="Derivs-islimpt_diff_finite"><span class="command">lemma</span></span> islimpt_diff_finite<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">t</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>t1_space set<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">islimpt</span> <span class="free">s</span> <span class="main">-</span> <span class="free">t</span> <span class="main">=</span> <span class="free">x</span> <span class="keyword1">islimpt</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> iii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">-</span> <span class="free">t</span> <span class="main">=</span> <span class="free">s</span> <span class="main">-</span> <span class="main">(</span><span class="free">t</span> <span class="main">∩</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span> <span class="main">∩</span> <span class="free">s</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span><span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">t</span> <span class="main">∩</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span> <span class="main">∩</span> <span class="free">s</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="free">s</span> <span class="main">-</span> <span class="main">(</span><span class="free">t</span> <span class="main">∩</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">islimpt</span> <span class="free">s</span> <span class="main">-</span> <span class="main">(</span><span class="free">t</span> <span class="main">∩</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="keyword1">islimpt</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> islimpt_Un_finite<span class="main">[</span><span class="operator">OF</span> ii<span class="main">,</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?t</span> <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">-</span> <span class="main">(</span><span class="free">t</span> <span class="main">∩</span> <span class="free">s</span><span class="main">)</span>"</span></span><span class="main">]</span> i assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> iii <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Derivs-ivl_limpt_diff"><span class="command">lemma</span></span> ivl_limpt_diff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">::</span>real<span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">islimpt</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">islimpt</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span><span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ii<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span><span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> islimpt_Un_finite<span class="main">[</span><span class="operator">OF</span> i<span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?t</span><span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="free">b</span><span class="main">}</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> empty_iff ii insert_iff islimpt_greaterThanLessThan1 islimpt_greaterThanLessThan2<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span><span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">islimpt</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">islimpt</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> islimpt_diff_finite<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Derivs-ivl_closure_diff_del"><span class="command">lemma</span></span> ivl_closure_diff_del<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">::</span>real<span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> closure <span class="main">(</span><span class="main">(</span><span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ivl_limpt_diff islimpt_in_closure assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Derivs-ivl_not_trivial_limit_within"><span class="command">lemma</span></span> ivl_not_trivial_limit_within<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">s</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">::</span>real<span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">at</span> <span class="free">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="free">s</span> <span class="main">≠</span> bot"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms ivl_closure_diff_del not_trivial_limit_within
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Derivs-vector_derivative_at_within_non_trivial_limit"><span class="command">lemma</span></span> vector_derivative_at_within_non_trivial_limit<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">at</span> <span class="free">x</span> <span class="keyword1">within</span> <span class="free">s</span> <span class="main">≠</span> bot <span class="main">∧</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">has_vector_derivative</span> <span class="free">f'</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span> <span class="main">⟹</span>
     vector_derivative <span class="free">f</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span> <span class="keyword1">within</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="free">f'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> has_vector_derivative_at_within vector_derivative_within <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Derivs-vector_derivative_at_within_ivl_diff"><span class="command">lemma</span></span> vector_derivative_at_within_ivl_diff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">s</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">∧</span> <span class="main">(</span><span class="free">x</span><span class="main">::</span>real<span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="free">s</span> <span class="main">∧</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">has_vector_derivative</span> <span class="free">f'</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span> <span class="main">⟹</span>
     vector_derivative <span class="free">f</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="free">f'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> vector_derivative_at_within_non_trivial_limit ivl_not_trivial_limit_within <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Derivs-gamma_deriv_at_within_diff"><span class="command">lemma</span></span> gamma_deriv_at_within_diff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a_leq_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span>
    x_within_bounds<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    gamma_differentiable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span> <span class="main">..</span> <span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="free">s</span><span class="main">.</span> <span class="free">γ</span> <span class="keyword1">differentiable</span> <span class="keyword1">at</span> <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    s_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    finite_s<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span>
                           <span class="main">=</span>  vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> vector_derivative_at_within_ivl_diff <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span>"</span></span> <span class="quoted"><span class="quoted">"vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span>"</span></span><span class="main">]</span>
    gamma_differentiable
    x_within_bounds a_leq_b s_subset finite_s
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vector_derivative_works<span class="main">)</span>

<span class="keyword1" id="Derivs-gamma_deriv_at_within_gen"><span class="command">lemma</span></span> gamma_deriv_at_within_gen<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a_leq_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span>
    x_within_bounds<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    s_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    gamma_differentiable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">s</span><span class="main">.</span> <span class="free">γ</span> <span class="keyword1">differentiable</span> <span class="keyword1">at</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span> <span class="keyword1">within</span> <span class="main">(</span><span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>  vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Derivative.vector_derivative_at_within_ivl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">γ</span>"</span></span> <span class="quoted"><span class="quoted">"vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span>"</span></span><span class="main">]</span>
    gamma_differentiable  x_within_bounds a_leq_b s_subset
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vector_derivative_works<span class="main">)</span>

<span class="keyword1" id="Derivs-derivative_component_fun_component_at_within_gen"><span class="command">lemma</span></span> derivative_component_fun_component_at_within_gen<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> gamma_differentiable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">s</span><span class="main">.</span> <span class="free">γ</span> <span class="keyword1">differentiable</span> <span class="keyword1">at</span> <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> s_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">s</span><span class="main">.</span> vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="main">(</span><span class="free">i</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span> euclidean_space<span class="main">)</span>
           <span class="main">=</span>  vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> gamma_i_component_smooth<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">s</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="keyword1">differentiable</span> <span class="keyword1">at</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> gamma_differentiable
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">s</span><span class="main">.</span> vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span>
                                  <span class="main">=</span>  vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted">real</span>
    <span class="keyword3"><span class="command">assume</span></span> x_within_bounds<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> gamma_deriv_at_within<span class="main">:</span>
        <span class="quoted"><span class="quoted">"vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> gamma_deriv_at_within_gen<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span><span class="main">]</span> x_within_bounds
        gamma_differentiable s_subset
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vector_derivative_works<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> gamma_component_deriv_at_within<span class="main">:</span>
      <span class="quoted"><span class="quoted">"vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>
       <span class="main">=</span> vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> gamma_deriv_at_within_gen<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span><span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> γ <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span>"</span></span><span class="main">]</span> x_within_bounds
        gamma_i_component_smooth s_subset
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vector_derivative_works<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> gamma_component_deriv_eq_gamma_deriv_component<span class="main">:</span>
      <span class="quoted"><span class="quoted">"vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> derivative_component_fun_component<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">γ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span>"</span></span><span class="main">]</span> gamma_differentiable x_within_bounds
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span> <span class="main">=</span> vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> gamma_component_deriv_eq_gamma_deriv_component gamma_component_deriv_at_within gamma_deriv_at_within
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Derivs-derivative_component_fun_component_at_within"><span class="command">lemma</span></span> derivative_component_fun_component_at_within<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> gamma_differentiable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="free">γ</span> <span class="keyword1">differentiable</span> <span class="keyword1">at</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="main">(</span><span class="free">i</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span> euclidean_space<span class="main">)</span>
                                       <span class="main">=</span>  vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> gamma_i_component_smooth<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="keyword1">differentiable</span> <span class="keyword1">at</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> gamma_differentiable <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span>
                                  <span class="main">=</span>  vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted">real</span>
    <span class="keyword3"><span class="command">assume</span></span> x_within_bounds<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> gamma_deriv_at_within<span class="main">:</span>
      <span class="quoted"><span class="quoted">"vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span>  vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> gamma_deriv_at_within<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span><span class="main">]</span> x_within_bounds
        gamma_differentiable
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vector_derivative_works<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> gamma_component_deriv_at_within<span class="main">:</span>
      <span class="quoted"><span class="quoted">"vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Derivative.vector_derivative_at_within_ivl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">γ</span> <span class="bound">x</span><span class="main">)</span>  <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span><span class="main">]</span>
        has_vector_derivative_at_within<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span><span class="main">]</span>
        gamma_i_component_smooth x_within_bounds
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vector_derivative_works<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> gamma_component_deriv_eq_gamma_deriv_component<span class="main">:</span>
      <span class="quoted"><span class="quoted">"vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> derivative_component_fun_component<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">γ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span>"</span></span><span class="main">]</span> gamma_differentiable x_within_bounds
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span> <span class="main">=</span> vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> gamma_component_deriv_eq_gamma_deriv_component gamma_component_deriv_at_within gamma_deriv_at_within
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Derivs-straight_path_diffrentiable_x"><span class="command">lemma</span></span> straight_path_diffrentiable_x<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">y1</span> <span class="main">::</span><span class="quoted"><span class="quoted">"real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> gamma_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">b</span><span class="main">,</span> <span class="free">y2</span> <span class="main">+</span> <span class="free">y1</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="keyword1">differentiable</span> <span class="keyword1">at</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> gamma_def differentiable_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_intros</span></span><span class="main">)</span>

<span class="keyword1" id="Derivs-straight_path_diffrentiable_y"><span class="command">lemma</span></span> straight_path_diffrentiable_y<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">y1</span> <span class="free">y2</span> <span class="main">::</span><span class="quoted"><span class="quoted">"real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> gamma_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">y2</span> <span class="main">+</span> <span class="free">y1</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">,</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="keyword1">differentiable</span> <span class="keyword1">at</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> gamma_def differentiable_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_intros</span></span><span class="main">)</span>

<span class="keyword1" id="Derivs-piecewise_C1_differentiable_on_imp_continuous_on"><span class="command">lemma</span></span> piecewise_C1_differentiable_on_imp_continuous_on<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="free">s</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> piecewise_C1_differentiable_on_def<span class="main">)</span>

<span class="keyword1" id="Derivs-boring_lemma1"><span class="command">lemma</span></span> boring_lemma1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real<span class="main">⇒</span>real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">has_vector_derivative</span> <span class="free">D</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> <span class="main">(</span><span class="main">(</span><span class="free">D</span><span class="main">,</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> <span class="main">(</span><span class="free">D</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bounded_linear.has_vector_derivative<span class="main">[</span><span class="operator">OF</span> Real_Vector_Spaces.bounded_linear_scaleR_left assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span>
        <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> <span class="main">(</span><span class="free">D</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">D</span><span class="main">,</span> <span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">=</span> <span class="free">D</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> *<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Derivs-boring_lemma2"><span class="command">lemma</span></span> boring_lemma2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real<span class="main">⇒</span>real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">has_vector_derivative</span> <span class="free">D</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">D</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> <span class="main">(</span><span class="free">D</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bounded_linear.has_vector_derivative<span class="main">[</span><span class="operator">OF</span> Real_Vector_Spaces.bounded_linear_scaleR_left assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span>
        <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> <span class="main">(</span><span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">D</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> scaleR_Pair Real_Vector_Spaces.real_scaleR_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'b</span><span class="main">,</span> <span class="free">D</span><span class="main">)</span> <span class="main">=</span> <span class="free">D</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> *<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Derivs-pair_prod_smooth_pw_smooth"><span class="command">lemma</span></span> pair_prod_smooth_pw_smooth<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span><span class="main">::</span>real<span class="main">⇒</span>real<span class="main">)</span> <span class="keyword1">C1_differentiable_on</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span><span class="main">::</span>real<span class="main">⇒</span>real<span class="main">)</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">,</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> f_cont<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="free">s</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> C1_differentiable_imp_continuous_on
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> g_cont<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="free">s</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> piecewise_C1_differentiable_on_def<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> t<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>finite <span class="skolem">t</span> <span class="main">∧</span> <span class="free">g</span> <span class="keyword1">C1_differentiable_on</span> <span class="free">s</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> piecewise_C1_differentiable_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> piecewise_C1_differentiable_on_components<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?f</span> <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">,</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_pair_basis<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> piecewise_C1_differentiable_on_def
      C1_differentiable_on_subset<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Diff_subset<span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?B1</span> <span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">t</span>"</span></span><span class="main">]</span> t
      f_cont g_cont
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Derivs-scale_shift_smooth"><span class="command">lemma</span></span> scale_shift_smooth<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">C1_differentiable_on</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">C1_differentiable_on</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> C1_differentiable_on_mult C1_differentiable_on_add C1_differentiable_on_const
          C1_differentiable_on_ident <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Derivs-open_diff"><span class="command">lemma</span></span> open_diff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">t</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>t1_space set<span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"open <span class="main">(</span><span class="free">s</span><span class="main">::</span><span class="tfree">'a</span> set<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"open <span class="main">(</span><span class="free">s</span> <span class="main">-</span><span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="free">t</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"open <span class="free">s</span> <span class="main">⟹</span> open <span class="main">(</span><span class="free">s</span> <span class="main">-</span> <span class="main">{}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>t1_space"</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">F</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>t1_space set"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> step<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">F</span> "</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">x</span> <span class="main">∉</span> <span class="skolem">F</span>"</span></span> <span class="quoted"><span class="quoted">"open <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">-</span> insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span> <span class="main">-</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">assume</span></span> ind_hyp<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">(</span>open <span class="free">s</span> <span class="main">⟹</span> open <span class="main">(</span><span class="free">s</span> <span class="main">-</span> <span class="skolem">F</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"open <span class="main">(</span><span class="free">s</span> <span class="main">-</span> insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> i<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> open_delete<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">-</span><span class="skolem">F</span>"</span></span><span class="main">]</span> ind_hyp<span class="main">[</span><span class="operator">OF</span> step<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Derivs-has_derivative_transform_within"><span class="command">lemma</span></span> has_derivative_transform_within<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">d</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">s</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x'</span><span class="main">∈</span><span class="free">s</span><span class="main">.</span> dist <span class="bound">x'</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free">d</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">x'</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">x'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">has_derivative</span> <span class="free">f'</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span> <span class="keyword1">within</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="keyword1">has_derivative</span> <span class="free">f'</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span> <span class="keyword1">within</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> has_derivative_within
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Lim_transform_within<span class="main">)</span>

<span class="keyword1" id="Derivs-has_derivative_transform_within_ivl"><span class="command">lemma</span></span> has_derivative_transform_within_ivl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span><span class="free">s</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span><span class="free">s</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">has_derivative</span> <span class="free">f'</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="keyword1">has_derivative</span> <span class="free">f'</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> has_derivative_transform_within<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="free">s</span>"</span></span><span class="main">]</span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Derivs-has_vector_derivative_transform_within_ivl"><span class="command">lemma</span></span> has_vector_derivative_transform_within_ivl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span><span class="free">s</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="free">s</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">has_vector_derivative</span> <span class="free">f'</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="keyword1">has_vector_derivative</span> <span class="free">f'</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms has_derivative_transform_within_ivl
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_vector_derivative_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Derivs-has_derivative_transform_at"><span class="command">lemma</span></span> has_derivative_transform_at<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">d</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x'</span><span class="main">.</span> dist <span class="bound">x'</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free">d</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">x'</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">x'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">has_derivative</span> <span class="free">f'</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="keyword1">has_derivative</span> <span class="free">f'</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> has_derivative_transform_within <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">d</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted">UNIV</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">f'</span></span><span class="main">]</span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Derivs-has_vector_derivative_transform_at"><span class="command">lemma</span></span> has_vector_derivative_transform_at<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">d</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x'</span><span class="main">.</span> dist <span class="bound">x'</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free">d</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">x'</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">x'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">has_vector_derivative</span> <span class="free">f'</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="keyword1">has_vector_derivative</span> <span class="free">f'</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> has_vector_derivative_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> has_derivative_transform_at<span class="main">)</span>

<span class="keyword1" id="Derivs-C1_diff_components_2"><span class="command">lemma</span></span> C1_diff_components_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> Basis"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">C1_differentiable_on</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span> <span class="keyword1">C1_differentiable_on</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="keyword2"><span class="keyword">where</span></span> D<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">s</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">has_derivative</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">D</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="free">s</span> <span class="skolem">D</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C1_differentiable_on_def has_vector_derivative_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C1_differentiable_on_def has_vector_derivative_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> exI conjI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="free">s</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">D</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> D continuous_on_componentwise assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">s</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span> <span class="keyword1">has_derivative</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">*</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">D</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> has_derivative_inner_left D<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Derivs-eq_smooth"><span class="command">lemma</span></span> eq_smooth<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">d</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">s</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">.</span> dist <span class="bound">x</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="free">d</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">y</span>"</span></span> <span class="comment1">(*This crappy condition cannot be loosened :( *)</span>
    <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">C1_differentiable_on</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">C1_differentiable_on</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C1_differentiable_on_def<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="keyword2"><span class="keyword">where</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">s</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">has_vector_derivative</span> <span class="skolem">D</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> continuous_on <span class="free">s</span> <span class="skolem">D</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C1_differentiable_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">s</span><span class="main">.</span> <span class="main">(</span><span class="free">g</span> <span class="keyword1">has_vector_derivative</span> <span class="skolem">D</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1-2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dist_commute has_vector_derivative_transform_at<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">s</span><span class="main">.</span> <span class="main">(</span><span class="free">g</span> <span class="keyword1">has_vector_derivative</span> <span class="skolem">D</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> continuous_on <span class="free">s</span> <span class="skolem">D</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> D f <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">D</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">s</span><span class="main">.</span> <span class="main">(</span><span class="free">g</span> <span class="keyword1">has_vector_derivative</span> <span class="bound">D</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> continuous_on <span class="free">s</span> <span class="bound">D</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Derivs-eq_pw_smooth"><span class="command">lemma</span></span> eq_pw_smooth<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">d</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">s</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">.</span> dist <span class="bound">x</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="free">d</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">y</span>"</span></span> <span class="comment1">(*This crappy condition cannot be loosened :( *)</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">s</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">x</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> piecewise_C1_differentiable_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> g_cont<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="free">s</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms piecewise_C1_differentiable_const
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> piecewise_C1_differentiable_on_def<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">t</span> <span class="main">∧</span> <span class="free">f</span> <span class="keyword1">C1_differentiable_on</span> <span class="free">s</span> <span class="main">-</span> <span class="skolem">t</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> piecewise_C1_differentiable_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">C1_differentiable_on</span> <span class="free">s</span> <span class="main">-</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms eq_smooth <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="free">s</span> <span class="free">g</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span><span class="main">.</span> finite <span class="bound">t</span> <span class="main">∧</span> <span class="free">g</span> <span class="keyword1">C1_differentiable_on</span> <span class="free">s</span> <span class="main">-</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> t g_cont <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Derivs-scale_piecewise_C1_differentiable_on"><span class="command">lemma</span></span> scale_piecewise_C1_differentiable_on<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">::</span>real<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> piecewise_C1_differentiable_on_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="free">s</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms continuous_on_mult_left
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> piecewise_C1_differentiable_on_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span><span class="main">.</span> finite <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">C1_differentiable_on</span> <span class="free">s</span> <span class="main">-</span> <span class="bound">t</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms continuous_on_mult_left
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> piecewise_C1_differentiable_on_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Derivs-eq_smooth_gen"><span class="command">lemma</span></span> eq_smooth_gen<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">C1_differentiable_on</span> <span class="free">s</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">C1_differentiable_on</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> C1_differentiable_on_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> has_vector_derivative_weaken UNIV_I top_greatest<span class="main">)</span>

<span class="keyword1" id="Derivs-subpath_compose"><span class="command">lemma</span></span> subpath_compose<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subpath <span class="free">a</span> <span class="free">b</span> <span class="free">γ</span><span class="main">)</span> <span class="main">=</span> <span class="free">γ</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span>  <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subpath_def<span class="main">)</span>

<span class="keyword1" id="Derivs-subpath_smooth"><span class="command">lemma</span></span> subpath_smooth<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="keyword1">C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>subpath <span class="free">a</span> <span class="free">b</span> <span class="free">γ</span><span class="main">)</span> <span class="keyword1">C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="keyword1">C1_differentiable_on</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> C1_differentiable_on_subset<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="keyword1">C1_differentiable_on</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>›</span></span> closed_segment_eq_real_ivl closed_segment_real_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">∩</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="main">-`</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="main">-`</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="skolem">x</span> <span class="main">-</span><span class="free">a</span><span class="main">)</span> <span class="main">/</span><span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="free">a</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subpath_compose <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> C1_differentiable_compose <span class="dynamic"><span class="dynamic">derivative_intros</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Derivs-has_vector_derivative_divide"><span class="command">lemma</span></span> has_vector_derivative_divide<span class="main">[</span><span class="operator">derivative_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>real_normed_field"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">has_vector_derivative</span> <span class="free">x</span><span class="main">)</span> <span class="free">F</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> divide_inverse <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> has_vector_derivative_mult_left<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Integrals">
<div class="head">
<h1>Theory Integrals</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Integrals
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../../HOL/HOL-Analysis/Analysis.html">HOL-Analysis.Analysis</a>"</span> <a href="General_Utils.html">General_Utils</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Integrals-gauge_integral_Fubini_universe_x"><span class="command">lemma</span></span> gauge_integral_Fubini_universe_x<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>euclidean_space <span class="main">*</span> <span class="tfree">'b</span><span class="main">::</span>euclidean_space<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'c</span><span class="main">::</span>euclidean_space"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fun_lesbegue_integrable<span class="main">:</span> <span class="quoted"><span class="quoted">"integrable lborel <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    x_axis_integral_measurable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> borel_measurable lborel"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"integral UNIV <span class="free">f</span> <span class="main">=</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">integrable_on</span> UNIV"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> f_is_measurable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> borel_measurable lborel"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fun_lesbegue_integrable <span class="keyword2"><span class="keyword">and</span></span> borel_measurable_integrable
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> fun_lborel_prod_integrable<span class="main">:</span>
    <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lborel <span class="keyword1">⨂<span class="hidden">⇩</span><sub>M</sub></span> lborel<span class="main">)</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fun_lesbegue_integrable
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lborel_prod<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> region_integral_is_one_twoD_integral<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="keyword1">LBINT</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1">LBINT</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lborel <span class="keyword1">⨂<span class="hidden">⇩</span><sub>M</sub></span> lborel<span class="main">)</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lborel_pair.integral_fst'
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> AE_one_D_integrals_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> lborel<span class="main">.</span> <span class="keyword1">LBINT</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> lborel<span class="main">.</span> integrable lborel <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lborel_pair.AE_integrable_fst' <span class="keyword2"><span class="keyword">and</span></span> fun_lborel_prod_integrable
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> integral_lborel  <span class="keyword2"><span class="keyword">and</span></span> always_eventually
        <span class="keyword2"><span class="keyword">and</span></span> AE_mp
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> one_D_integral_measurable<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">LBINT</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> borel_measurable lborel"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f_is_measurable <span class="keyword2"><span class="keyword">and</span></span> lborel.borel_measurable_lebesgue_integral
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> second_lesbegue_integral_eq<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="keyword1">LBINT</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1">LBINT</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">LBINT</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span>integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> x_axis_integral_measurable <span class="keyword2"><span class="keyword">and</span></span> integral_cong_AE <span class="keyword2"><span class="keyword">and</span></span> AE_one_D_integrals_eq
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integrable lborel <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">LBINT</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fun_lborel_prod_integrable <span class="keyword2"><span class="keyword">and</span></span> lborel_pair.integrable_fst'
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> oneD_gauge_integral_lesbegue_integrable<span class="main">:</span>
    <span class="quoted"><span class="quoted">"integrable lborel <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> x_axis_integral_measurable <span class="keyword2"><span class="keyword">and</span></span> AE_one_D_integrals_eq <span class="keyword2"><span class="keyword">and</span></span> integrable_cong_AE_imp
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> one_D_gauge_integral_integrable<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">integrable_on</span> UNIV"</span></span>
    <span class="keyword1"><span class="command">using</span></span> integrable_on_lborel
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LBINT</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span>integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> integral_lborel oneD_gauge_integral_lesbegue_integrable
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> twoD_lesbeuge_eq_twoD_gauge<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="keyword1">LBINT</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1">LBINT</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> second_lesbegue_integral_eq
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integral UNIV <span class="free">f</span> <span class="main">=</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fun_lesbegue_integrable <span class="keyword2"><span class="keyword">and</span></span> integral_lborel <span class="keyword2"><span class="keyword">and</span></span> region_integral_is_one_twoD_integral
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lborel_prod<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Integrals-gauge_integral_Fubini_universe_y"><span class="command">lemma</span></span> gauge_integral_Fubini_universe_y<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>euclidean_space <span class="main">*</span> <span class="tfree">'b</span><span class="main">::</span>euclidean_space<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'c</span><span class="main">::</span>euclidean_space"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fun_lesbegue_integrable<span class="main">:</span> <span class="quoted"><span class="quoted">"integrable lborel <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    y_axis_integral_measurable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> borel_measurable lborel"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"integral UNIV <span class="free">f</span> <span class="main">=</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">integrable_on</span> UNIV"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> f_is_measurable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> borel_measurable lborel"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fun_lesbegue_integrable <span class="keyword2"><span class="keyword">and</span></span> borel_measurable_integrable
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> fun_lborel_prod_integrable<span class="main">:</span>
    <span class="quoted"><span class="quoted">"integrable <span class="main">(</span>lborel <span class="keyword1">⨂<span class="hidden">⇩</span><sub>M</sub></span> lborel<span class="main">)</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fun_lesbegue_integrable
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lborel_prod<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> region_integral_is_one_twoD_integral<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="keyword1">LBINT</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1">LBINT</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">integral<span class="hidden">⇧</span><sup>L</sup></span> <span class="main">(</span>lborel <span class="keyword1">⨂<span class="hidden">⇩</span><sub>M</sub></span> lborel<span class="main">)</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lborel_pair.integral_fst'
      f_is_measurable lborel_pair.integrable_product_swap lborel_pair.integral_fst lborel_pair.integral_product_swap lborel_prod
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> AE_one_D_integrals_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> lborel<span class="main">.</span> <span class="keyword1">LBINT</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> lborel<span class="main">.</span> integrable lborel <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lborel_pair.AE_integrable_fst' <span class="keyword2"><span class="keyword">and</span></span> fun_lborel_prod_integrable
        lborel_pair.AE_integrable_fst lborel_pair.integrable_product_swap
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> integral_lborel  <span class="keyword2"><span class="keyword">and</span></span> always_eventually
        <span class="keyword2"><span class="keyword">and</span></span> AE_mp
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> one_D_integral_measurable<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">LBINT</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> borel_measurable lborel"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f_is_measurable <span class="keyword2"><span class="keyword">and</span></span> lborel.borel_measurable_lebesgue_integral
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> second_lesbegue_integral_eq<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="keyword1">LBINT</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1">LBINT</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">LBINT</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span>integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> y_axis_integral_measurable <span class="keyword2"><span class="keyword">and</span></span> integral_cong_AE <span class="keyword2"><span class="keyword">and</span></span> AE_one_D_integrals_eq
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integrable lborel <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">LBINT</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fun_lborel_prod_integrable <span class="keyword2"><span class="keyword">and</span></span> lborel_pair.integrable_fst'
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lborel_pair.integrable_fst lborel_pair.integrable_product_swap<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> oneD_gauge_integral_lesbegue_integrable<span class="main">:</span>
    <span class="quoted"><span class="quoted">"integrable lborel <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> y_axis_integral_measurable <span class="keyword2"><span class="keyword">and</span></span> AE_one_D_integrals_eq <span class="keyword2"><span class="keyword">and</span></span> integrable_cong_AE_imp
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> one_D_gauge_integral_integrable<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">integrable_on</span> UNIV"</span></span>
    <span class="keyword1"><span class="command">using</span></span> integrable_on_lborel
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LBINT</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span>integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> integral_lborel oneD_gauge_integral_lesbegue_integrable
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> twoD_lesbeuge_eq_twoD_gauge<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="keyword1">LBINT</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1">LBINT</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> second_lesbegue_integral_eq
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integral UNIV <span class="free">f</span> <span class="main">=</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fun_lesbegue_integrable <span class="keyword2"><span class="keyword">and</span></span> integral_lborel <span class="keyword2"><span class="keyword">and</span></span> region_integral_is_one_twoD_integral
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lborel_prod<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Integrals-gauge_integral_Fubini_curve_bounded_region_x"><span class="command">lemma</span></span> gauge_integral_Fubini_curve_bounded_region_x<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>euclidean_space <span class="main">*</span> <span class="tfree">'b</span><span class="main">::</span>euclidean_space<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'c</span><span class="main">::</span>euclidean_space"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">g1</span> <span class="free">g2</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">s</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">*</span> <span class="tfree">'b</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fun_lesbegue_integrable<span class="main">:</span> <span class="quoted"><span class="quoted">"integrable lborel <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    x_axis_gauge_integrable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">integrable_on</span> UNIV"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="comment1">(*IS THIS redundant? NO IT IS NOT*)</span>
    x_axis_integral_measurable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> borel_measurable lborel"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    f_is_g_indicator<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">s</span> <span class="keyword1">then</span> <span class="free">g</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    s_is_bounded_by_g1_and_g2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">∈</span>Basis<span class="main">.</span> <span class="free">a</span> <span class="main">∙</span> <span class="bound">i</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∙</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∧</span>
                                      <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">∈</span>Basis<span class="main">.</span> <span class="main">(</span><span class="free">g1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">i</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">∙</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∙</span> <span class="bound">i</span> <span class="main">≤</span> <span class="main">(</span><span class="free">g2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">i</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"integral <span class="free">s</span> <span class="free">g</span> <span class="main">=</span> integral <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral <span class="main">(</span>cbox <span class="main">(</span><span class="free">g1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">g2</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">g</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> two_D_integral_to_one_D<span class="main">:</span> <span class="quoted"><span class="quoted">"integral UNIV <span class="free">f</span> <span class="main">=</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> gauge_integral_Fubini_universe_x <span class="keyword2"><span class="keyword">and</span></span> fun_lesbegue_integrable <span class="keyword2"><span class="keyword">and</span></span> x_axis_integral_measurable
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> one_d_integral_integrable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">integrable_on</span> UNIV"</span></span>
    <span class="keyword1"><span class="command">using</span></span> gauge_integral_Fubini_universe_x<span class="main">(</span>2<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> case_x_in_range<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> cbox <span class="free">a</span> <span class="free">b</span><span class="main">.</span> integral <span class="main">(</span>cbox <span class="main">(</span><span class="free">g1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">g2</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">g</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
    <span class="keyword3"><span class="command">assume</span></span> within_range<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f_one_D_spec</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">y</span> <span class="main">∈</span> <span class="main">(</span>cbox <span class="main">(</span><span class="free">g1</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="free">g2</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="free">g</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> f_one_D_region<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">y</span> <span class="main">∈</span> cbox <span class="main">(</span><span class="free">g1</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="free">g2</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">then</span> <span class="free">g</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'b</span></span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="main">(</span>cbox <span class="main">(</span><span class="free">g1</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="free">g2</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_is_g_indicator s_is_bounded_by_g1_and_g2<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> within_range
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cbox_def<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">smt</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> zero_out_of_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">y</span><span class="main">.</span>  <span class="bound">y</span> <span class="main">∉</span> cbox <span class="main">(</span><span class="free">g1</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="free">g2</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f_is_g_indicator <span class="keyword2"><span class="keyword">and</span></span> s_is_bounded_by_g1_and_g2
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cbox_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">integrable_on</span> cbox <span class="main">(</span><span class="free">g1</span> <span class="skolem">x</span><span class="main">)</span>  <span class="main">(</span><span class="free">g2</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f_one_D_spec</span> <span class="keyword1">integrable_on</span> UNIV"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f_one_D_region <span class="keyword2"><span class="keyword">and</span></span> x_axis_gauge_integrable
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f_one_D_spec</span> <span class="keyword1">integrable_on</span> cbox<span class="main">(</span><span class="free">g1</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="free">g2</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> integrable_on_subcbox
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> f_one_D_region  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f_integrale_x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="main">(</span>integral <span class="main">(</span>cbox <span class="main">(</span><span class="free">g1</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="free">g2</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>cbox <span class="main">(</span><span class="free">g1</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="free">g2</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> integrable_integral <span class="keyword2"><span class="keyword">and</span></span> within_range <span class="keyword2"><span class="keyword">and</span></span> x_axis_gauge_integrable
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integral <span class="main">(</span>cbox <span class="main">(</span><span class="free">g1</span> <span class="skolem">x</span><span class="main">)</span>  <span class="main">(</span><span class="free">g2</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> has_integral_on_superset<span class="main">[</span><span class="operator">OF</span> f_integrale_x _ Set.subset_UNIV<span class="main">]</span> zero_out_of_bound
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> integral_unique<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>cbox <span class="main">(</span><span class="free">g1</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="free">g2</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f_integrale_x
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">g</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>cbox <span class="main">(</span><span class="free">g1</span> <span class="skolem">x</span><span class="main">)</span><span class="main">(</span><span class="free">g2</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span>  Henstock_Kurzweil_Integration.has_integral_restrict <span class="main">[</span><span class="operator">OF</span> subset_refl <span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
        f_one_D_region
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> has_integral_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integral <span class="main">(</span>cbox <span class="main">(</span><span class="free">g1</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="free">g2</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> case_x_not_in_range<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> cbox <span class="free">a</span>  <span class="free">b</span> <span class="main">⟶</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s_is_bounded_by_g1_and_g2 f_is_g_indicator cbox_def<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> cbox <span class="free">a</span> <span class="free">b</span> <span class="main">⟶</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> RHS<span class="main">:</span> <span class="quoted"><span class="quoted">"integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> integral <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral <span class="main">(</span>cbox <span class="main">(</span><span class="free">g1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">g2</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">g</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?first_integral</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral <span class="main">(</span>cbox <span class="main">(</span><span class="free">g1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">g2</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">g</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x_integral_cases</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> cbox <span class="free">a</span> <span class="free">b</span> <span class="keyword1">then</span>  <span class="var">?first_integral</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> x_integral_cases_integral<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="var">?x_integral_cases</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> case_x_in_range <span class="keyword2"><span class="keyword">and</span></span> case_x_not_in_range
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="main">(</span>integral UNIV <span class="free">f</span><span class="main">)</span><span class="main">)</span> UNIV"</span></span>
      <span class="keyword1"><span class="command">using</span></span> two_D_integral_to_one_D
        one_d_integral_integrable
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?x_integral_cases</span> <span class="keyword1">has_integral</span> <span class="main">(</span>integral UNIV <span class="free">f</span><span class="main">)</span><span class="main">)</span> UNIV"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x_integral_cases_integral <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?first_integral</span> <span class="keyword1">has_integral</span> <span class="main">(</span>integral UNIV <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span>  has_integral_restrict_UNIV<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"cbox <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?first_integral</span>"</span></span> <span class="quoted"><span class="quoted">"integral UNIV <span class="free">f</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> two_D_integral_to_one_D
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> integral_unique<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> f_integrable<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">integrable_on</span> UNIV"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fun_lesbegue_integrable <span class="keyword2"><span class="keyword">and</span></span> integrable_on_lborel
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> LHS<span class="main">:</span> <span class="quoted"><span class="quoted">"integral UNIV <span class="free">f</span> <span class="main">=</span> integral <span class="free">s</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_is_g_indicator<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> integrable_restrict_UNIV
      integral_restrict_UNIV
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> RHS <span class="keyword2"><span class="keyword">and</span></span> two_D_integral_to_one_D
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Integrals-gauge_integral_Fubini_curve_bounded_region_y"><span class="command">lemma</span></span> gauge_integral_Fubini_curve_bounded_region_y<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>euclidean_space <span class="main">*</span> <span class="tfree">'b</span><span class="main">::</span>euclidean_space<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'c</span><span class="main">::</span>euclidean_space"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">g1</span> <span class="free">g2</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">s</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">*</span> <span class="tfree">'b</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fun_lesbegue_integrable<span class="main">:</span> <span class="quoted"><span class="quoted">"integrable lborel <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    y_axis_gauge_integrable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">integrable_on</span> UNIV"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="comment1">(*IS THIS redundant? NO IT IS NOT*)</span>
    y_axis_integral_measurable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> borel_measurable lborel"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    f_is_g_indicator<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">s</span> <span class="keyword1">then</span> <span class="free">g</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    s_is_bounded_by_g1_and_g2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">∈</span>Basis<span class="main">.</span> <span class="free">a</span> <span class="main">∙</span> <span class="bound">i</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∙</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∧</span>
                                                   <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">∈</span>Basis<span class="main">.</span> <span class="main">(</span><span class="free">g1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">i</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">∙</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∙</span> <span class="bound">i</span> <span class="main">≤</span> <span class="main">(</span><span class="free">g2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">i</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"integral <span class="free">s</span> <span class="free">g</span> <span class="main">=</span> integral <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral <span class="main">(</span>cbox <span class="main">(</span><span class="free">g1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">g2</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">g</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> two_D_integral_to_one_D<span class="main">:</span> <span class="quoted"><span class="quoted">"integral UNIV <span class="free">f</span> <span class="main">=</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> gauge_integral_Fubini_universe_y <span class="keyword2"><span class="keyword">and</span></span> fun_lesbegue_integrable <span class="keyword2"><span class="keyword">and</span></span> y_axis_integral_measurable
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> one_d_integral_integrable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">integrable_on</span> UNIV"</span></span>
    <span class="keyword1"><span class="command">using</span></span> gauge_integral_Fubini_universe_y<span class="main">(</span>2<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> case_y_in_range<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> cbox <span class="free">a</span> <span class="free">b</span><span class="main">.</span> integral <span class="main">(</span>cbox <span class="main">(</span><span class="free">g1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">g2</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">g</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'b</span></span></span>
    <span class="keyword3"><span class="command">assume</span></span> within_range<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f_one_D_spec</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">y</span> <span class="main">∈</span> <span class="main">(</span>cbox <span class="main">(</span><span class="free">g1</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="free">g2</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="free">g</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> f_one_D_region<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">y</span> <span class="main">∈</span> cbox <span class="main">(</span><span class="free">g1</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="free">g2</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">then</span> <span class="free">g</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="main">(</span>cbox <span class="main">(</span><span class="free">g1</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="free">g2</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_is_g_indicator s_is_bounded_by_g1_and_g2<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> within_range
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cbox_def<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">smt</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> zero_out_of_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">y</span><span class="main">.</span>  <span class="bound">y</span> <span class="main">∉</span> cbox <span class="main">(</span><span class="free">g1</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="free">g2</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">f</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f_is_g_indicator <span class="keyword2"><span class="keyword">and</span></span> s_is_bounded_by_g1_and_g2
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cbox_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">integrable_on</span> cbox <span class="main">(</span><span class="free">g1</span> <span class="skolem">x</span><span class="main">)</span>  <span class="main">(</span><span class="free">g2</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f_one_D_spec</span> <span class="keyword1">integrable_on</span> UNIV"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f_one_D_region <span class="keyword2"><span class="keyword">and</span></span> y_axis_gauge_integrable
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f_one_D_spec</span> <span class="keyword1">integrable_on</span> cbox<span class="main">(</span><span class="free">g1</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="free">g2</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> integrable_on_subcbox
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> f_one_D_region  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f_integrale_y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="main">(</span>integral <span class="main">(</span>cbox <span class="main">(</span><span class="free">g1</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="free">g2</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>cbox <span class="main">(</span><span class="free">g1</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="free">g2</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> integrable_integral <span class="keyword2"><span class="keyword">and</span></span> within_range <span class="keyword2"><span class="keyword">and</span></span> y_axis_gauge_integrable
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integral <span class="main">(</span>cbox <span class="main">(</span><span class="free">g1</span> <span class="skolem">x</span><span class="main">)</span>  <span class="main">(</span><span class="free">g2</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> has_integral_on_superset<span class="main">[</span><span class="operator">OF</span> f_integrale_y _ Set.subset_UNIV<span class="main">]</span> zero_out_of_bound
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> integral_unique<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>cbox <span class="main">(</span><span class="free">g1</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="free">g2</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f_integrale_y
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">g</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>cbox <span class="main">(</span><span class="free">g1</span> <span class="skolem">x</span><span class="main">)</span><span class="main">(</span><span class="free">g2</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span>  Henstock_Kurzweil_Integration.has_integral_restrict <span class="main">[</span><span class="operator">OF</span> subset_refl <span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
        f_one_D_region
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> has_integral_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integral <span class="main">(</span>cbox <span class="main">(</span><span class="free">g1</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="free">g2</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">g</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> case_y_not_in_range<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> cbox <span class="free">a</span>  <span class="free">b</span> <span class="main">⟶</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'b</span></span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s_is_bounded_by_g1_and_g2 f_is_g_indicator cbox_def<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> cbox <span class="free">a</span> <span class="free">b</span> <span class="main">⟶</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> RHS<span class="main">:</span> <span class="quoted"><span class="quoted">"integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> integral <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral <span class="main">(</span>cbox <span class="main">(</span><span class="free">g1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">g2</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">g</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?first_integral</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral <span class="main">(</span>cbox <span class="main">(</span><span class="free">g1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">g2</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">g</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x_integral_cases</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> cbox <span class="free">a</span> <span class="free">b</span> <span class="keyword1">then</span>  <span class="var">?first_integral</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> y_integral_cases_integral<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="var">?x_integral_cases</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> case_y_in_range <span class="keyword2"><span class="keyword">and</span></span> case_y_not_in_range
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="main">(</span>integral UNIV <span class="free">f</span><span class="main">)</span><span class="main">)</span> UNIV"</span></span>
      <span class="keyword1"><span class="command">using</span></span> two_D_integral_to_one_D
        one_d_integral_integrable
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?x_integral_cases</span> <span class="keyword1">has_integral</span> <span class="main">(</span>integral UNIV <span class="free">f</span><span class="main">)</span><span class="main">)</span> UNIV"</span></span>
      <span class="keyword1"><span class="command">using</span></span> y_integral_cases_integral <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?first_integral</span> <span class="keyword1">has_integral</span> <span class="main">(</span>integral UNIV <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> has_integral_restrict_UNIV<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"cbox <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?first_integral</span>"</span></span> <span class="quoted"><span class="quoted">"integral UNIV <span class="free">f</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> two_D_integral_to_one_D
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> integral_unique<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> f_integrable<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">integrable_on</span> UNIV"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fun_lesbegue_integrable <span class="keyword2"><span class="keyword">and</span></span> integrable_on_lborel
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> LHS<span class="main">:</span> <span class="quoted"><span class="quoted">"integral UNIV <span class="free">f</span> <span class="main">=</span> integral <span class="free">s</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_is_g_indicator<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> integrable_restrict_UNIV
      integral_restrict_UNIV
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> RHS <span class="keyword2"><span class="keyword">and</span></span> two_D_integral_to_one_D
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Integrals-gauge_integral_by_substitution"><span class="command">lemma</span></span> gauge_integral_by_substitution<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real <span class="main">⇒</span> real<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">g</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real <span class="main">⇒</span> real<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">g'</span><span class="main">::</span><span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">a</span><span class="main">::</span><span class="quoted"><span class="quoted">"real"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">b</span><span class="main">::</span><span class="quoted"><span class="quoted">"real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a_le_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    ga_le_gb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="free">a</span> <span class="main">≤</span> <span class="free">g</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    g'_derivative<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="free">g</span> <span class="keyword1">has_vector_derivative</span> <span class="main">(</span><span class="free">g'</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    g'_continuous<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="free">g'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    f_continuous<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span><span class="free">g</span> <span class="main">`</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"integral <span class="main">{</span><span class="free">g</span> <span class="free">a</span><span class="main">..</span><span class="free">g</span> <span class="free">b</span><span class="main">}</span> <span class="main">(</span><span class="free">f</span><span class="main">)</span> <span class="main">=</span> integral <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">g'</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="free">g</span> <span class="keyword1">has_real_derivative</span> <span class="main">(</span><span class="free">g'</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> has_field_derivative_iff_has_vector_derivative<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">g</span>"</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> g'_derivative
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"interval_lebesgue_integral lborel <span class="main">(</span>ereal <span class="main">(</span><span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>ereal <span class="main">(</span><span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g'</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">=</span> interval_lebesgue_integral lborel <span class="main">(</span>ereal <span class="main">(</span><span class="free">g</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>ereal <span class="main">(</span><span class="free">g</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> interval_integral_substitution_finite<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span>"</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> g'_continuous <span class="keyword2"><span class="keyword">and</span></span> a_le_b <span class="keyword2"><span class="keyword">and</span></span> f_continuous
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> g_continuous<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">a</span> <span class="main">..</span> <span class="free">b</span><span class="main">}</span>  <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Derivative.differentiable_imp_continuous_on
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> differentiable_on_def differentiable_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> continuous_on_vector_derivative g'_derivative<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_integrable lborel <span class="main">{</span><span class="free">a</span> <span class="main">..</span> <span class="free">b</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g'</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">a</span> <span class="main">..</span> <span class="free">b</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g'</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">a</span> <span class="main">..</span> <span class="free">b</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> Topological_Spaces.continuous_on_compose f_continuous g_continuous
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> Limits.continuous_on_mult g'_continuous
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> borel_integrable_atLeastAtMost' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"interval_lebesgue_integral lborel <span class="main">(</span>ereal <span class="main">(</span><span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>ereal <span class="main">(</span><span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g'</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>
                      <span class="main">=</span> integral <span class="main">{</span><span class="free">a</span> <span class="main">..</span> <span class="free">b</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g'</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a_le_b <span class="keyword2"><span class="keyword">and</span></span> interval_integral_eq_integral
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_integrable lborel <span class="main">{</span><span class="free">g</span> <span class="free">a</span> <span class="main">..</span> <span class="free">g</span> <span class="free">b</span><span class="main">}</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">g</span> <span class="free">a</span> <span class="main">..</span> <span class="free">g</span> <span class="free">b</span><span class="main">}</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">g</span> <span class="free">a</span> <span class="main">..</span> <span class="free">g</span> <span class="free">b</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">g</span> <span class="main">`</span> <span class="main">{</span><span class="free">a</span> <span class="main">..</span> <span class="free">b</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> g_continuous
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_le_b atLeastAtMost_iff atLeastatMost_subset_iff continuous_image_closed_interval imageI order_refl<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">g</span> <span class="free">a</span> <span class="main">..</span> <span class="free">g</span> <span class="free">b</span><span class="main">}</span> <span class="free">f</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f_continuous continuous_on_subset
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> borel_integrable_atLeastAtMost'
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"interval_lebesgue_integral lborel <span class="main">(</span>ereal <span class="main">(</span><span class="free">g</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>ereal <span class="main">(</span><span class="free">g</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="free">f</span>
                      <span class="main">=</span> integral <span class="main">{</span><span class="free">g</span> <span class="free">a</span> <span class="main">..</span> <span class="free">g</span> <span class="free">b</span><span class="main">}</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ga_le_gb <span class="keyword2"><span class="keyword">and</span></span> interval_integral_eq_integral
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> 0 <span class="keyword2"><span class="keyword">and</span></span> 1 <span class="keyword2"><span class="keyword">and</span></span> 2
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span>  Henstock_Kurzweil_Integration.integral_cong mult.commute real_scaleR_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Integrals-frontier_ic"><span class="command">lemma</span></span> frontier_ic<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">b</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"frontier <span class="main">{</span><span class="free">a</span><span class="main">&lt;..</span><span class="free">b</span><span class="main">}</span>  <span class="main">=</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> frontier_def<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Integrals-frontier_ci"><span class="command">lemma</span></span> frontier_ci<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">b</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"frontier <span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="free">b</span><span class="main">}</span>  <span class="main">=</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> frontier_def<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Integrals-ic_not_closed"><span class="command">lemma</span></span> ic_not_closed<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">b</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> closed <span class="main">{</span><span class="free">a</span><span class="main">&lt;..</span><span class="free">b</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms frontier_subset_eq frontier_ic greaterThanAtMost_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Integrals-closure_ic_union_ci"><span class="command">lemma</span></span> closure_ic_union_ci<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">b</span><span class="main">::</span>real<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&lt;</span> <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"closure <span class="main">(</span><span class="main">{</span><span class="free">a</span><span class="main">..&lt;</span><span class="free">b</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">b</span><span class="main">&lt;..</span><span class="free">c</span><span class="main">}</span><span class="main">)</span>  <span class="main">=</span> <span class="main">{</span><span class="free">a</span> <span class="main">..</span> <span class="free">c</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> frontier_ic<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> frontier_ci<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> closure_Un assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> frontier_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Integrals-interior_ic_ci_union"><span class="command">lemma</span></span> interior_ic_ci_union<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">b</span><span class="main">::</span>real<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&lt;</span> <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∉</span> <span class="main">(</span>interior <span class="main">(</span><span class="main">{</span><span class="free">a</span><span class="main">..&lt;</span><span class="free">b</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">b</span><span class="main">&lt;..</span><span class="free">c</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∉</span> <span class="main">(</span><span class="main">{</span><span class="free">a</span><span class="main">..&lt;</span><span class="free">b</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">b</span><span class="main">&lt;..</span><span class="free">c</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> interior_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Integrals-frontier_ic_union_ci"><span class="command">lemma</span></span> frontier_ic_union_ci<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">b</span><span class="main">::</span>real<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&lt;</span> <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> frontier <span class="main">(</span><span class="main">{</span><span class="free">a</span><span class="main">..&lt;</span><span class="free">b</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">b</span><span class="main">&lt;..</span><span class="free">c</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> closure_ic_union_ci assms interior_ic_ci_union
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> frontier_def<span class="main">)</span>

<span class="keyword1" id="Integrals-ic_union_ci_not_closed"><span class="command">lemma</span></span> ic_union_ci_not_closed<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">b</span><span class="main">::</span>real<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&lt;</span> <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> closed <span class="main">(</span><span class="main">{</span><span class="free">a</span><span class="main">..&lt;</span><span class="free">b</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">b</span><span class="main">&lt;..</span><span class="free">c</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∉</span> <span class="main">(</span><span class="main">{</span><span class="free">a</span><span class="main">..&lt;</span><span class="free">b</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">b</span><span class="main">&lt;..</span><span class="free">c</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms frontier_subset_eq frontier_ic_union_ci<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> subset_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Integrals-integrable_continuous_"><span class="command">lemma</span></span> integrable_continuous_<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span><span class="main">::</span>euclidean_space <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>banach"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">integrable_on</span> cbox <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms integrable_continuous<span class="main">)</span>

<span class="keyword1" id="Integrals-removing_singletons_from_div"><span class="command">lemma</span></span> removing_singletons_from_div<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="main">∃</span><span class="bound">c</span> <span class="bound">d</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">c</span> <span class="main">&lt;</span> <span class="bound">d</span> <span class="main">∧</span> <span class="main">{</span><span class="bound">c</span><span class="main">..</span><span class="bound">d</span><span class="main">}</span> <span class="main">=</span> <span class="bound">t</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">∪</span> <span class="main">⋃</span><span class="free">S</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span>
    <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="free">x</span> <span class="main">∈</span> <span class="bound">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">t</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="free">x</span> <span class="main">∈</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="free">x</span> <span class="main">∉</span> <span class="bound">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="main">⋃</span><span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="free">S</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span> <span class="main">..</span> <span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span><span class="main">..&lt;</span><span class="free">x</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">x</span><span class="main">&lt;..</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="free">S</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span><span class="main">..&lt;</span><span class="free">x</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">x</span><span class="main">&lt;..</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"closed <span class="main">(</span><span class="main">⋃</span><span class="free">S</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> closed_Union<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">T</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> closed <span class="bound">T</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> 0 1 ic_union_ci_not_closed assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Integrals-remove_singleton_from_division_of"><span class="command">lemma</span></span> remove_singleton_from_division_of<span class="main">:</span><span class="comment1">(*By Manuel Eberl*)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">division_of</span> <span class="main">{</span><span class="free">a</span><span class="main">::</span>real<span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="bound">c</span> <span class="main">&lt;</span> <span class="bound">d</span> <span class="main">∧</span> <span class="main">{</span><span class="bound">c</span><span class="main">..</span><span class="bound">d</span><span class="main">}</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">c</span><span class="main">..</span><span class="bound">d</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">islimpt</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> connected_imp_perfect<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">{</span><span class="bound">x</span><span class="main">..</span><span class="bound">x</span><span class="main">}</span> <span class="main">∈</span> <span class="free">A</span><span class="main">}</span> <span class="main">∪</span> <span class="main">(</span><span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">{</span><span class="bound">x</span><span class="main">..</span><span class="bound">x</span><span class="main">}</span> <span class="main">∈</span> <span class="free">A</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">islimpt</span> <span class="main">…</span> <span class="main">⟷</span> <span class="free">x</span> <span class="keyword1">islimpt</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">{</span><span class="bound">x</span><span class="main">..</span><span class="bound">x</span><span class="main">}</span> <span class="main">∈</span> <span class="free">A</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> islimpt_Un_finite<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">{</span><span class="bound">x</span><span class="main">..</span><span class="bound">x</span><span class="main">}</span> <span class="main">∈</span> <span class="free">A</span><span class="main">}</span> <span class="main">⊆</span> Inf <span class="main">`</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">x</span><span class="main">..</span><span class="skolem">x</span><span class="main">}</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> Inf <span class="main">`</span> <span class="free">A</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bexI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> division_of_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>Inf <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">{</span><span class="bound">x</span><span class="main">..</span><span class="bound">x</span><span class="main">}</span> <span class="main">∈</span> <span class="free">A</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">⋃</span><span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> division_of_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">islimpt</span> <span class="main">⋃</span><span class="main">(</span><span class="free">A</span> <span class="main">-</span> range <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">{</span><span class="bound">x</span><span class="main">..</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> islimpt_subset<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"closed <span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="free">A</span> <span class="main">-</span> range <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">{</span><span class="bound">x</span><span class="main">..</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> closed_Union<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="free">A</span> <span class="main">-</span> range <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">{</span><span class="bound">x</span><span class="main">..</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> closed_limpt<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">X</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∉</span> range <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">{</span><span class="bound">x</span><span class="main">..</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> division_ofD<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> this<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> division_ofD<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> this<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
    division_ofD<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> this<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> cbox <span class="skolem">c</span> <span class="skolem">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≤</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≠</span> <span class="skolem">d</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">=</span> cbox <span class="skolem">c</span> <span class="skolem">d</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">c</span><span class="main">..</span><span class="skolem">c</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> range <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">{</span><span class="bound">x</span><span class="main">..</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">∉</span> range <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">{</span><span class="bound">x</span><span class="main">..</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">≤</span> <span class="skolem">d</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">&lt;</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">=</span> cbox <span class="skolem">c</span> <span class="skolem">d</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> <span class="skolem">X</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Integrals-remove_singleton_from_tagged_division_of"><span class="command">lemma</span></span> remove_singleton_from_tagged_division_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">tagged_division_of</span> <span class="main">{</span><span class="free">a</span><span class="main">::</span>real<span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="bound">c</span> <span class="main">&lt;</span> <span class="bound">d</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="main">{</span><span class="bound">c</span><span class="main">..</span><span class="bound">d</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">c</span><span class="main">..</span><span class="bound">d</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> remove_singleton_from_division_of<span class="main">[</span><span class="operator">OF</span> division_of_tagged_division<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="comment1">(*sledgehammer*)</span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Integrals-tagged_div_wo_singlestons"><span class="command">lemma</span></span> tagged_div_wo_singlestons<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">tagged_division_of</span> <span class="main">{</span><span class="free">a</span><span class="main">::</span>real<span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="main">{</span><span class="bound">xk</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">xk</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="main">{</span><span class="bound">y</span><span class="main">}</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="keyword1">tagged_division_of</span> cbox <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> remove_singleton_from_tagged_division_of<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tagged_division_of_def tagged_partial_division_of_def<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Integrals-tagged_div_wo_empty"><span class="command">lemma</span></span> tagged_div_wo_empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">tagged_division_of</span> <span class="main">{</span><span class="free">a</span><span class="main">::</span>real<span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="main">{</span><span class="bound">xk</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">xk</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="keyword1">tagged_division_of</span> cbox <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> remove_singleton_from_tagged_division_of<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tagged_division_of_def tagged_partial_division_of_def<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Integrals-fine_diff"><span class="command">lemma</span></span> fine_diff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="keyword1">fine</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="keyword1">fine</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fine_def<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Integrals-tagged_div_tage_notin_set"><span class="command">lemma</span></span> tagged_div_tage_notin_set<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">s</span><span class="main">::</span>real set<span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">tagged_division_of</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="keyword1">fine</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">K</span><span class="main">)</span><span class="main">∈</span><span class="free">p</span><span class="main">.</span> <span class="main">∃</span><span class="bound">c</span> <span class="bound">d</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">c</span> <span class="main">&lt;</span> <span class="bound">d</span> <span class="main">∧</span> <span class="bound">K</span> <span class="main">=</span> <span class="main">{</span><span class="bound">c</span><span class="main">..</span><span class="bound">d</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"gauge <span class="free">γ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p'</span> <span class="bound">γ'</span><span class="main">.</span> <span class="bound">p'</span> <span class="keyword1">tagged_division_of</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">∧</span>
                  <span class="bound">γ'</span> <span class="keyword1">fine</span> <span class="bound">p'</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">K</span><span class="main">)</span><span class="main">∈</span><span class="bound">p'</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> <span class="free">s</span><span class="main">)</span> <span class="main">∧</span> gauge <span class="bound">γ'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">x</span><span class="main">::</span>real<span class="main">,</span> <span class="bound">K</span><span class="main">)</span><span class="main">∈</span><span class="free">p</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x'</span><span class="main">.</span> <span class="bound">x'</span> <span class="main">∉</span> <span class="free">s</span> <span class="main">∧</span> <span class="bound">x'</span><span class="main">∈</span> interior <span class="bound">K</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted">real</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">K</span>
      <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">::</span>real<span class="main">,</span><span class="skolem">K</span><span class="main">)</span> <span class="main">∈</span> <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">K</span><span class="main">)</span><span class="main">∈</span><span class="free">p</span><span class="main">.</span> infinite <span class="main">(</span>interior <span class="bound">K</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> infinite_Ioo interior_atLeastAtMost_real
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> split_beta<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>interior <span class="skolem">K</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ass <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x'</span><span class="main">.</span> <span class="bound">x'</span> <span class="main">∉</span> <span class="free">s</span> <span class="main">∧</span> <span class="bound">x'</span><span class="main">∈</span> interior <span class="skolem">K</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> infinite_imp_nonempty<span class="main">[</span><span class="operator">OF</span> Diff_infinite_finite<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> i<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span><span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">x</span><span class="main">::</span>real<span class="main">,</span> <span class="bound">K</span><span class="main">)</span><span class="main">∈</span><span class="free">p</span><span class="main">.</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">K</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="free">s</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">K</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> interior <span class="bound">K</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> choice_iff<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?Q</span> <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">K</span><span class="main">)</span> <span class="bound">x'</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">::</span>real<span class="main">,</span> <span class="bound">K</span><span class="main">)</span><span class="main">∈</span><span class="free">p</span> <span class="main">⟶</span> <span class="bound">x'</span> <span class="main">∉</span> <span class="free">s</span> <span class="main">∧</span> <span class="bound">x'</span> <span class="main">∈</span> interior <span class="bound">K</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> case_prod_beta<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> f'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">x</span><span class="main">::</span>real<span class="main">,</span> <span class="bound">K</span><span class="main">)</span><span class="main">∈</span><span class="free">p</span><span class="main">.</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">K</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="free">s</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">K</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">K</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f interior_subset
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> case_prod_beta subset_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">xK</span><span class="main">.</span> <span class="bound">m</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">f</span> <span class="bound">xK</span><span class="main">)</span><span class="main">,</span> snd <span class="bound">xK</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">xK</span> <span class="main">∈</span> <span class="free">p</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">K</span><span class="main">)</span><span class="main">∈</span><span class="var">?p'</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> case_prod_beta<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">|</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">p</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">|</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">p</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="free">p</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p'</span> <span class="keyword1">tagged_division_of</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> f'
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tagged_division_of_def tagged_partial_division_of_def case_prod_beta<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">metis</span> i<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="comment1">(*f is injective becuase interiors of different K's are disjoint and f is in interior*)</span>
  <span class="keyword1"><span class="command">have</span></span> f_inj<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">f</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">p</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f
          tagged_division_ofD<span class="main">(</span>5<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
          <span class="comment1">(*sledgehammer*)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> case_prodE disjoint_insert<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> mk_disjoint_insert<span class="main">)</span><span class="keyword1"><span class="command">}</span></span><span class="keyword1"><span class="command">note</span></span> * <span class="main">=</span> this
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">p</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">f</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?γ'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="main">(</span><span class="main">∃</span><span class="bound">xK</span> <span class="main">∈</span> <span class="free">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">xK</span>  <span class="main">=</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free">γ</span> <span class="keyword1">o</span> fst <span class="keyword1">o</span>  the_inv_into <span class="free">p</span> <span class="skolem">f</span><span class="main">)</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="free">γ</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?γ'</span> <span class="keyword1">fine</span> <span class="var">?p'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fine_def case_prod_beta the_inv_into_f_f<span class="main"><span class="main">[</span></span><span class="operator">OF</span> f_inj<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"gauge <span class="var">?γ'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>5<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> f'
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fine_def gauge_def case_prod_beta the_inv_into_f_f<span class="main"><span class="main">[</span></span><span class="operator">OF</span> f_inj<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p'</span> <span class="keyword1">tagged_division_of</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">∧</span> <span class="var">?γ'</span> <span class="keyword1">fine</span> <span class="var">?p'</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">K</span><span class="main">)</span><span class="main">∈</span><span class="var">?p'</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> <span class="free">s</span><span class="main">)</span> <span class="main">∧</span> gauge <span class="var">?γ'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 0 1 2 3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">smt</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Integrals-has_integral_bound_spike_finite"><span class="command">lemma</span></span> has_integral_bound_spike_finite<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>euclidean_space <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>real_normed_vector"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">has_integral</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> leB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> cbox <span class="free">a</span> <span class="free">b</span> <span class="main">-</span> <span class="free">S</span> <span class="main">⟹</span> norm <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"norm <span class="free">i</span> <span class="main">≤</span> <span class="free">B</span> <span class="main">*</span> content <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">S</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> cbox <span class="free">a</span> <span class="free">b</span> <span class="main">-</span> <span class="free">S</span> <span class="main">⟹</span> norm <span class="main">(</span><span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> leB <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="keyword1">has_integral</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> has_integral_spike_finite <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite <span class="free">S</span>›</span></span> _ f<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">≤</span> <span class="free">B</span>›</span></span> g_def has_integral_bound<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Integrals-has_integral_bound_"><span class="command">lemma</span></span> has_integral_bound_<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>real_normed_vector"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">B</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">has_integral</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">s</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">-</span><span class="free">s</span><span class="main">.</span> norm <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"norm <span class="free">i</span> <span class="main">≤</span> <span class="free">B</span> <span class="main">*</span> content <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> has_integral_bound_spike_finite assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">corollary</span></span> has_integral_bound_real'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>real_normed_vector"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">B</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">has_integral</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">s</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">-</span><span class="free">s</span><span class="main">.</span> norm <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"norm <span class="free">i</span> <span class="main">≤</span> <span class="free">B</span> <span class="main">*</span> content <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span>
    <span class="comment1">(*sledgehammer*)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> box_real<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> f has_integral_bound_spike_finite<span class="main">)</span>

<span class="keyword1" id="Integrals-integral_has_vector_derivative_continuous_at'"><span class="command">lemma</span></span> integral_has_vector_derivative_continuous_at'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>banach"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">s</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="free">s</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> fx<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span> <span class="keyword1">within</span> <span class="main">(</span><span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> integral <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="bound">u</span><span class="main">}</span> <span class="free">f</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> <span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span> <span class="keyword1">within</span> <span class="main">(</span><span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?I</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> integral <span class="main">{</span><span class="bound">a</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span><span class="main">::</span><span class="quoted">real</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x'</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">x'</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="free">s</span><span class="main">;</span> <span class="main">¦</span><span class="bound">x'</span> <span class="main">-</span> <span class="free">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">d</span><span class="main">⟧</span> <span class="main">⟹</span> norm<span class="main">(</span><span class="free">f</span> <span class="bound">x'</span> <span class="main">-</span> <span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">e</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> fx <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> continuous_within_eps_delta dist_norm less_imp_le<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>integral <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="skolem">y</span><span class="main">}</span> <span class="free">f</span> <span class="main">-</span> integral <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">x</span><span class="main">}</span> <span class="free">f</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">y</span><span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">e</span> <span class="main">*</span> <span class="main">¦</span><span class="skolem">y</span> <span class="main">-</span> <span class="free">x</span><span class="main">¦</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">y</span> <span class="main">-</span> <span class="free">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">d</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="skolem">y</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f y <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> integrable_subinterval_real<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Idiff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?I</span> <span class="free">a</span> <span class="skolem">y</span> <span class="main">-</span> <span class="var">?I</span> <span class="free">a</span> <span class="free">x</span> <span class="main">=</span> <span class="var">?I</span> <span class="free">x</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> False x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> Henstock_Kurzweil_Integration.integral_combine<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> fux_int<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="free">f</span> <span class="bound">u</span> <span class="main">-</span> <span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="keyword1">has_integral</span> integral <span class="main">{</span><span class="free">x</span><span class="main">..</span><span class="skolem">y</span><span class="main">}</span> <span class="free">f</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">y</span><span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">{</span><span class="free">x</span><span class="main">..</span><span class="skolem">y</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> has_integral_diff<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> x y <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> integrable_integral <span class="main"><span class="main">[</span></span><span class="operator">OF</span> integrable_subinterval_real <span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> f<span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> has_integral_const_real <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span> False
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> False
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_eq_content <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> content_real_if measure_lborel_Icc<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> has_integral_bound_real'<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">u</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">f</span></span> <span class="bound"><span class="bound">u</span></span> <span class="main"><span class="main">-</span></span> <span class="free"><span class="free">f</span></span> <span class="free"><span class="free">x</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> yx False d x y <span class="quoted"><span class="quoted">‹<span class="skolem">e</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Idiff fux_int<span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M48</span></span></span><span class="main">=</span> <span class="quoted"><span class="quoted">"mset_set <span class="free">s</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="skolem">y</span> <span class="main">-</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="skolem">d</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">x'</span><span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x'</span> <span class="main">∧</span> <span class="bound">x'</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">x'</span> <span class="main">∉</span> <span class="free">s</span> <span class="main">⟹</span> <span class="main">¦</span><span class="bound">x'</span> <span class="main">-</span> <span class="free">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">d</span> <span class="main">⟹</span> norm <span class="main">(</span><span class="free">f</span> <span class="bound">x'</span> <span class="main">-</span> <span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">e</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">e</span> <span class="main">⟹</span> <span class="bound">z</span> <span class="main">∉#</span> <span class="var">?M48</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∉</span> <span class="free">s</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">∉</span> <span class="free">s</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="bound">z</span> <span class="main">⟹</span> <span class="bound">z</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟹</span> norm <span class="main">(</span><span class="free">f</span> <span class="bound">z</span> <span class="main">-</span> <span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">e</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">x</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> integrable_subinterval_real<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Idiff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?I</span> <span class="free">a</span> <span class="free">x</span> <span class="main">-</span> <span class="var">?I</span> <span class="free">a</span> <span class="skolem">y</span> <span class="main">=</span> <span class="var">?I</span> <span class="skolem">y</span> <span class="free">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> True x y <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> Henstock_Kurzweil_Integration.integral_combine<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> fux_int<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="free">f</span> <span class="bound">u</span> <span class="main">-</span> <span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="keyword1">has_integral</span> integral <span class="main">{</span><span class="skolem">y</span><span class="main">..</span><span class="free">x</span><span class="main">}</span> <span class="free">f</span> <span class="main">-</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">{</span><span class="skolem">y</span><span class="main">..</span><span class="free">x</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> has_integral_diff<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> x y <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> integrable_integral <span class="main"><span class="main">[</span></span><span class="operator">OF</span> integrable_subinterval_real <span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> f<span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> has_integral_const_real <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> True
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>integral <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">x</span><span class="main">}</span> <span class="free">f</span> <span class="main">-</span> integral <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="skolem">y</span><span class="main">}</span> <span class="free">f</span> <span class="main">-</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">e</span> <span class="main">*</span> <span class="main">¦</span><span class="skolem">y</span> <span class="main">-</span> <span class="free">x</span><span class="main">¦</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> True
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_eq_content <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> content_real_if measure_lborel_Icc<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> has_integral_bound_real'<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">u</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">f</span></span> <span class="bound"><span class="bound">u</span></span> <span class="main"><span class="main">-</span></span> <span class="free"><span class="free">f</span></span> <span class="free"><span class="free">x</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> yx True d x y <span class="quoted"><span class="quoted">‹<span class="skolem">e</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Idiff fux_int<span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M44</span></span></span><span class="main">=</span> <span class="quoted"><span class="quoted">"mset_set <span class="free">s</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">⋀</span><span class="bound">xa</span><span class="main">.</span> <span class="free">x</span> <span class="main">-</span> <span class="skolem">y</span> <span class="main">&lt;</span> <span class="skolem">d</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">x'</span><span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x'</span> <span class="main">∧</span> <span class="bound">x'</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">x'</span> <span class="main">∉</span> <span class="free">s</span> <span class="main">⟹</span> <span class="main">¦</span><span class="bound">x'</span> <span class="main">-</span> <span class="free">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">d</span> <span class="main">⟹</span> norm <span class="main">(</span><span class="free">f</span> <span class="bound">x'</span> <span class="main">-</span> <span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">e</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">e</span> <span class="main">⟹</span> <span class="bound">xa</span> <span class="main">∉#</span> <span class="var">?M44</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∉</span> <span class="free">s</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">∉</span> <span class="free">s</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="bound">xa</span> <span class="main">⟹</span> <span class="bound">xa</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟹</span> norm <span class="main">(</span><span class="free">f</span> <span class="bound">xa</span> <span class="main">-</span> <span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">e</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> norm_minus_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">d</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="free">s</span><span class="main">.</span> <span class="main">¦</span><span class="bound">y</span> <span class="main">-</span> <span class="free">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="bound">d</span> <span class="main">⟶</span> norm <span class="main">(</span>integral <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="bound">y</span><span class="main">}</span> <span class="free">f</span> <span class="main">-</span> integral <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">x</span><span class="main">}</span> <span class="free">f</span> <span class="main">-</span> <span class="main">(</span><span class="bound">y</span><span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">e</span> <span class="main">*</span> <span class="main">¦</span><span class="bound">y</span> <span class="main">-</span> <span class="free">x</span><span class="main">¦</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_vector_derivative_def has_derivative_within_alt bounded_linear_scaleR_left<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Integrals-integral_has_vector_derivative'"><span class="command">lemma</span></span> integral_has_vector_derivative'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>banach"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">s</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="free">s</span>"</span></span>
    <span class="quoted"><span class="quoted">"continuous <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> integral <span class="main">{</span><span class="free">a</span> <span class="main">..</span> <span class="bound">u</span><span class="main">}</span> <span class="free">f</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> <span class="free">f</span><span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">a</span> <span class="main">..</span> <span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> integral_has_vector_derivative_continuous_at'<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> continuous_on_eq_continuous_within<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Integrals-fundamental_theorem_of_calculus_interior_stronger"><span class="command">lemma</span></span> fundamental_theorem_of_calculus_interior_stronger<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>banach"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span> <span class="main">&lt;..&lt;</span> <span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="free">S</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">has_vector_derivative</span> <span class="free">f'</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">a</span> <span class="main">..</span> <span class="free">b</span><span class="main">}</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f'</span> <span class="keyword1">has_integral</span> <span class="main">(</span><span class="free">f</span> <span class="free">b</span> <span class="main">-</span> <span class="free">f</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="free">a</span> <span class="main">..</span> <span class="free">b</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> empty
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> fundamental_theorem_of_calculus_interior <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">S</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">a</span><span class="main">&lt;..&lt;</span><span class="skolem">b</span><span class="main">}</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> insert <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f'</span> <span class="keyword1">has_integral</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">-</span> <span class="free">f</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">x</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> insert<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">&lt;</span> <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">b</span>›</span></span> insert.prems continuous_on_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f'</span> <span class="keyword1">has_integral</span> <span class="free">f</span> <span class="skolem">b</span> <span class="main">-</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">{</span><span class="skolem">x</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> insert<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">&lt;</span> <span class="skolem">x</span>›</span></span> insert.prems continuous_on_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> finite_insert fundamental_theorem_of_calculus_interior_strong insert.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> insert.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> insert.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> insert.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Integrals-at_within_closed_interval_finite"><span class="command">lemma</span></span> at_within_closed_interval_finite<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">at</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"interior <span class="main">(</span><span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">S</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> interior_diff finite_imp_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> at_within_interior assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Integrals-at_within_cbox_finite"><span class="command">lemma</span></span> at_within_cbox_finite<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> box <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span> <span class="keyword1">within</span> cbox <span class="free">a</span> <span class="free">b</span> <span class="main">-</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">at</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"interior <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span> <span class="main">-</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> box <span class="free">a</span> <span class="free">b</span> <span class="main">-</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> interior_diff finite_imp_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> at_within_interior assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Integrals-fundamental_theorem_of_calculus_interior_stronger'"><span class="command">lemma</span></span> fundamental_theorem_of_calculus_interior_stronger'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>banach"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span> <span class="main">&lt;..&lt;</span> <span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="free">S</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">has_vector_derivative</span> <span class="free">f'</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="free">S</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">a</span> <span class="main">..</span> <span class="free">b</span><span class="main">}</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f'</span> <span class="keyword1">has_integral</span> <span class="main">(</span><span class="free">f</span> <span class="free">b</span> <span class="main">-</span> <span class="free">f</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="free">a</span> <span class="main">..</span> <span class="free">b</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms fundamental_theorem_of_calculus_interior_strong at_within_cbox_finite
    <span class="comment1">(*sledgehammer*)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DiffD1 DiffD2 interior_atLeastAtMost_real interior_cbox interval_cbox<span class="main">)</span>

<span class="keyword1" id="Integrals-has_integral_substitution_general_"><span class="command">lemma</span></span> has_integral_substitution_general_<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>euclidean_space"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">`</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">c</span><span class="main">..</span><span class="free">d</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="free">c</span><span class="main">..</span><span class="free">d</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span><span class="main">{</span><span class="free">c</span><span class="main">..</span><span class="free">d</span><span class="main">}</span> <span class="main">-</span> <span class="main">(</span><span class="free">g</span> <span class="main">`</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="free">f</span>"</span></span>
    <span class="comment1">(*and f [continuous_intros]: "continuous_on {c..d} f"*)</span>
    <span class="keyword2"><span class="keyword">and</span></span> g <span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="free">g</span> <span class="main">(</span><span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">∪</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> deriv <span class="main">[</span><span class="operator">derivative_intros</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="free">s</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">g</span> <span class="keyword1">has_field_derivative</span> <span class="free">g'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g'</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="main">(</span>integral <span class="main">{</span><span class="free">g</span> <span class="free">a</span><span class="main">..</span><span class="free">g</span> <span class="free">b</span><span class="main">}</span> <span class="free">f</span> <span class="main">-</span> integral <span class="main">{</span><span class="free">g</span> <span class="free">b</span><span class="main">..</span><span class="free">g</span> <span class="free">a</span><span class="main">}</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral <span class="main">{</span><span class="free">c</span><span class="main">..</span><span class="free">g</span> <span class="bound">x</span><span class="main">}</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> cont_int<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="var">?F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> continuous_on_compose2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ g<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> subset<span class="main"><span class="main">]</span></span> indefinite_integral_continuous_1
        f<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> deriv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="free">s</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral <span class="main">{</span><span class="free">c</span><span class="main">..</span><span class="bound">x</span><span class="main">}</span> <span class="free">f</span><span class="main">)</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> <span class="free">g'</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>
                 <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">(</span><span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> has_vector_derivative_eq_rhs<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> vector_diff_chain_within<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> has_field_derivative_iff_has_vector_derivative <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted">real</span>
    <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f'3</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">g'</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="free">s</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="free">g</span> <span class="keyword1">has_vector_derivative</span> <span class="free">g'</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> deriv<span class="main">[</span><span class="operator">OF</span> ass<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> has_field_derivative_iff_has_vector_derivative<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="keyword1">has_real_derivative</span> <span class="var">?f'3</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> has_vector_derivative_within_subset<span class="main">[</span><span class="operator">OF</span> ii i<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> has_field_derivative_iff_has_vector_derivative<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g'3</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">o</span> <span class="free">g</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="free">s</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral <span class="main">{</span><span class="free">c</span><span class="main">..</span><span class="bound">x</span><span class="main">}</span> <span class="free">f</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> <span class="var">?g'3</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">within</span> <span class="free">g</span> <span class="main">`</span> <span class="main">(</span><span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted">real</span>
      <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="free">s</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">g</span> <span class="main">`</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> s <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral <span class="main">{</span><span class="free">c</span><span class="main">..</span><span class="bound">x</span><span class="main">}</span> <span class="free">f</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> <span class="free">f</span><span class="main">(</span><span class="free">g</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">within</span> <span class="main">(</span><span class="main">{</span><span class="free">c</span><span class="main">..</span><span class="free">d</span><span class="main">}</span> <span class="main">-</span> <span class="free">g</span> <span class="main">`</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> integral_has_vector_derivative'<span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="free">f</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="free">c</span><span class="main">..</span><span class="free">d</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">c</span><span class="main">..</span><span class="free">d</span><span class="main">}</span> <span class="main">-</span> <span class="free">g</span> <span class="main">`</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ass subset
            <span class="comment1">(*sledgehammer*)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Diff_iff Un_upper1 Un_upper2 g<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> imageE image_subset_iff inj_onD subsetCE<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"continuous <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">c</span><span class="main">..</span><span class="free">d</span><span class="main">}</span> <span class="main">-</span> <span class="free">g</span> <span class="main">`</span> <span class="free">s</span><span class="main">)</span> <span class="free">f</span>"</span></span>
          <span class="comment1">(*sledgehammer*)</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">c</span><span class="main">..</span><span class="free">d</span><span class="main">}</span> <span class="main">-</span> <span class="free">g</span> <span class="main">`</span> <span class="free">s</span>›</span></span> continuous_on_eq_continuous_within f<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">`</span> <span class="main">(</span><span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">{</span><span class="free">c</span><span class="main">..</span><span class="free">d</span><span class="main">}</span> <span class="main">-</span> <span class="free">g</span> <span class="main">`</span> <span class="free">s</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> subset g<span class="main">(</span>2<span class="main">)</span>
          <span class="comment1">(*sledgehammer*)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Diff_subset Un_Diff Un_commute Un_upper2 inj_on_image_set_diff subset_trans sup.order_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral <span class="main">{</span><span class="free">c</span><span class="main">..</span><span class="bound">x</span><span class="main">}</span> <span class="free">f</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> <span class="var">?g'3</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">within</span> <span class="free">g</span> <span class="main">`</span> <span class="main">(</span><span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="comment1">(*sledgehammer*)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Diff_subset has_vector_derivative_weaken Un_upper1 Un_upper2 <span class="quoted"><span class="quoted">‹finite <span class="main">(</span><span class="free">g</span> <span class="main">`</span> <span class="free">s</span><span class="main">)</span>›</span></span> ass comp_def continuous_on_eq_continuous_within f<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> f<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> g<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> image_diff_subset image_subset_iff inj_on_image_set_diff integral_has_vector_derivative_continuous_at' subset_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="free">s</span> <span class="main">⟹</span> <span class="free">g'</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="var">?g'3</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">g'</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> deriv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?F</span> <span class="keyword1">has_vector_derivative</span> <span class="free">g'</span> <span class="skolem">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="main">(</span><span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">using</span></span> deriv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> at_within_Icc_at o_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g'</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="main">(</span><span class="var">?F</span> <span class="free">b</span> <span class="main">-</span> <span class="var">?F</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cont_int
    <span class="keyword1"><span class="command">using</span></span> fundamental_theorem_of_calculus_interior_stronger'<span class="main">[</span><span class="operator">OF</span> s le deriv<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span>
  <span class="keyword1"><span class="command">from</span></span> subset <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">c</span><span class="main">..</span><span class="free">d</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> this<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> le <span class="keyword1"><span class="command">have</span></span> cd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≤</span> <span class="free">g</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="free">b</span> <span class="main">≤</span> <span class="free">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≤</span> <span class="free">g</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="free">a</span> <span class="main">≤</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integral <span class="main">{</span><span class="free">c</span><span class="main">..</span><span class="free">g</span> <span class="free">b</span><span class="main">}</span> <span class="free">f</span> <span class="main">-</span> integral <span class="main">{</span><span class="free">c</span><span class="main">..</span><span class="free">g</span> <span class="free">a</span><span class="main">}</span> <span class="free">f</span> <span class="main">=</span> integral <span class="main">{</span><span class="free">g</span> <span class="free">a</span><span class="main">..</span><span class="free">g</span> <span class="free">b</span><span class="main">}</span> <span class="free">f</span> <span class="main">-</span> integral <span class="main">{</span><span class="free">g</span> <span class="free">b</span><span class="main">..</span><span class="free">g</span> <span class="free">a</span><span class="main">}</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="free">a</span> <span class="main">≤</span> <span class="free">g</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">note</span></span> le <span class="main">=</span> le this
    <span class="keyword1"><span class="command">from</span></span> cd <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integral <span class="main">{</span><span class="free">c</span><span class="main">..</span><span class="free">g</span> <span class="free">a</span><span class="main">}</span> <span class="free">f</span> <span class="main">+</span> integral <span class="main">{</span><span class="free">g</span> <span class="free">a</span><span class="main">..</span><span class="free">g</span> <span class="free">b</span><span class="main">}</span> <span class="free">f</span> <span class="main">=</span> integral <span class="main">{</span><span class="free">c</span><span class="main">..</span><span class="free">g</span> <span class="free">b</span><span class="main">}</span> <span class="free">f</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Henstock_Kurzweil_Integration.integral_combine atLeastatMost_subset_iff f<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> integrable_on_subinterval le<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> order_refl<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> le <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="free">a</span> <span class="main">=</span> <span class="free">g</span> <span class="free">b</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">g</span> <span class="free">a</span> <span class="main">≤</span> <span class="free">g</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="free">a</span> <span class="main">≥</span> <span class="free">g</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">note</span></span> le <span class="main">=</span> le this
    <span class="keyword1"><span class="command">from</span></span> cd <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integral <span class="main">{</span><span class="free">c</span><span class="main">..</span><span class="free">g</span> <span class="free">b</span><span class="main">}</span> <span class="free">f</span> <span class="main">+</span> integral <span class="main">{</span><span class="free">g</span> <span class="free">b</span><span class="main">..</span><span class="free">g</span> <span class="free">a</span><span class="main">}</span> <span class="free">f</span> <span class="main">=</span> integral <span class="main">{</span><span class="free">c</span><span class="main">..</span><span class="free">g</span> <span class="free">a</span><span class="main">}</span> <span class="free">f</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Henstock_Kurzweil_Integration.integral_combine atLeastatMost_subset_iff f<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> integrable_on_subinterval le<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> order_refl<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> less <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Integrals-has_integral_substitution_general__"><span class="command">lemma</span></span> has_integral_substitution_general__<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>euclidean_space"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> s_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">`</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">c</span><span class="main">..</span><span class="free">d</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="free">c</span><span class="main">..</span><span class="free">d</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span><span class="main">{</span><span class="free">c</span><span class="main">..</span><span class="free">d</span><span class="main">}</span> <span class="main">-</span> <span class="main">(</span><span class="free">g</span> <span class="main">`</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="free">f</span>"</span></span>
    <span class="comment1">(*and f [continuous_intros]: "continuous_on {c..d} f"*)</span>
    <span class="keyword2"><span class="keyword">and</span></span> g <span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="free">g</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> deriv <span class="main">[</span><span class="operator">derivative_intros</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="free">s</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">g</span> <span class="keyword1">has_field_derivative</span> <span class="free">g'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g'</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="main">(</span>integral <span class="main">{</span><span class="free">g</span> <span class="free">a</span><span class="main">..</span><span class="free">g</span> <span class="free">b</span><span class="main">}</span> <span class="free">f</span> <span class="main">-</span> integral <span class="main">{</span><span class="free">g</span> <span class="free">b</span><span class="main">..</span><span class="free">g</span> <span class="free">a</span><span class="main">}</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> s_subset has_integral_substitution_general_<span class="main">[</span><span class="operator">OF</span> s le subset f g<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> _ deriv<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> sup_absorb1<span class="main">)</span>

<span class="keyword1" id="Integrals-has_integral_substitution_general_'"><span class="command">lemma</span></span> has_integral_substitution_general_'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>euclidean_space"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> s'<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">s'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">`</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">c</span><span class="main">..</span><span class="free">d</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="free">c</span><span class="main">..</span><span class="free">d</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span><span class="main">{</span><span class="free">c</span><span class="main">..</span><span class="free">d</span><span class="main">}</span> <span class="main">-</span> <span class="free">s'</span><span class="main">)</span> <span class="free">f</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> g <span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">s'</span><span class="main">.</span> finite <span class="main">(</span><span class="free">g</span> <span class="main">-`</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"surj_on <span class="free">s'</span> <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="free">g</span> <span class="main">(</span><span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">∪</span> <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="main">∪</span> <span class="free">g</span> <span class="main">-`</span> <span class="free">s'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> deriv <span class="main">[</span><span class="operator">derivative_intros</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="free">s</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">g</span> <span class="keyword1">has_field_derivative</span> <span class="free">g'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g'</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="main">(</span>integral <span class="main">{</span><span class="free">g</span> <span class="free">a</span><span class="main">..</span><span class="free">g</span> <span class="free">b</span><span class="main">}</span> <span class="free">f</span> <span class="main">-</span> integral <span class="main">{</span><span class="free">g</span> <span class="free">b</span><span class="main">..</span><span class="free">g</span> <span class="free">a</span><span class="main">}</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">-`</span> <span class="free">s'</span> <span class="main">=</span> <span class="main">⋃</span><span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">t</span> <span class="main">=</span> <span class="free">g</span> <span class="main">-`</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">s'</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> s s' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">⋃</span><span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">t</span> <span class="main">=</span> <span class="free">g</span> <span class="main">-`</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">s'</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> s'
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="main">-`</span> <span class="free">s'</span> <span class="main">=</span> <span class="main">⋃</span><span class="main">{</span><span class="free">g</span> <span class="main">-`</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">s'</span><span class="main">}</span>›</span></span> finite_UN_I g<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> vimage_eq_UN<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">s</span> <span class="main">∪</span> <span class="main">(</span><span class="free">g</span> <span class="main">-`</span> <span class="free">s'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a s
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span><span class="main">{</span><span class="free">c</span><span class="main">..</span><span class="free">d</span><span class="main">}</span> <span class="main">-</span> <span class="free">g</span> <span class="main">`</span> <span class="main">(</span><span class="free">s</span> <span class="main">∪</span> <span class="free">g</span> <span class="main">-`</span> <span class="free">s'</span><span class="main">)</span><span class="main">)</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f<span class="main">(</span>2<span class="main">)</span> surj_on_image_vimage_eq
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_mono Un_upper2 continuous_on_subset equalityE g<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> image_Un<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="main">(</span><span class="free">s</span> <span class="main">∪</span> <span class="free">g</span> <span class="main">-`</span> <span class="free">s'</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">g</span> <span class="keyword1">has_real_derivative</span> <span class="free">g'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> has_integral_substitution_general_<span class="main">[</span><span class="operator">OF</span> 0 assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> subset f<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 1 g<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> g<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> 2<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Paths">
<div class="head">
<h1>Theory Paths</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Paths
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Derivs.html">Derivs</a> <a href="General_Utils.html">General_Utils</a> <a href="Integrals.html">Integrals</a>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(*This has everything related to paths purely*)</span>

<span class="keyword1" id="Paths-reverse_subpaths_join"><span class="command">lemma</span></span> reverse_subpaths_join<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">" subpath <span class="main">1</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="free">p</span> <span class="main">+++</span> subpath <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">0</span> <span class="free">p</span> <span class="main">=</span> reversepath <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> reversepath_subpath join_subpaths_middle pathfinish_subpath pathstart_subpath reversepath_joinpaths
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span>


<span class="comment1">(*Below F cannot be from 'a ⇒ 'b because the dot product won't work.
  We have that g returns 'a and then F takes the output of g, so F should start from 'a
  Then we have to compute the dot product of the vector b with both the derivative of g, and F.
  Since the derivative of g returns the same type as g, accordingly F should return the same type as g, i.e. 'a.
 *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">line_integral</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>euclidean_space <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>euclidean_space<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> set<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>real <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">line_integral</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">basis</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">≡</span> integral <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">basis</span></span></span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">line_integral_exists</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">line_integral_exists</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">basis</span></span></span> <span class="free"><span class="bound"><span class="entity">γ</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">basis</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">γ</span></span></span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free"><span class="bound"><span class="entity">γ</span></span></span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Paths-line_integral_on_pair_straight_path"><span class="command">lemma</span></span> line_integral_on_pair_straight_path<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">F</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>euclidean_space<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">γ</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> gamma_const<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">∙</span> <span class="free">i</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> gamma_smooth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="free">γ</span> <span class="keyword1">differentiable</span> <span class="keyword1">at</span> <span class="bound">x</span>"</span></span>          
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">γ</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">γ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> line_integral_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">(</span><span class="free">γ</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> vector_derivative_const_at<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span>"</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> gamma_const
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> derivative_component_fun_component<span class="main">[</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">γ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span>"</span></span><span class="main">]</span>
        <span class="keyword2"><span class="keyword">and</span></span> gamma_smooth <span class="keyword2"><span class="keyword">and</span></span> that
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vector_derivative_at<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> has_vector_derivative_at_within vector_derivative_at_within_ivl that
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> atLeastAtMost_iff gamma_smooth vector_derivative_works zero_less_one<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="main">0</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> has_integral_is_0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">γ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>line_integral_exists_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integral <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> * has_integral_is_0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-line_integral_on_pair_path_strong"><span class="command">lemma</span></span> line_integral_on_pair_path_strong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">F</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>euclidean_space<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">g</span><span class="main">::</span><span class="quoted"><span class="quoted">"real <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">γ</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">i</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> i_norm_1<span class="main">:</span> <span class="quoted"><span class="quoted">"norm <span class="free">i</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    g_orthogonal_to_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  
    gamma_is_in_terms_of_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">g</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    gamma_smooth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    g_continuous_on_f<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="free">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    path_start_le_path_end<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>pathstart <span class="free">γ</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span> <span class="main">≤</span> <span class="main">(</span>pathfinish <span class="free">γ</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    field_i_comp_cont<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>path_image <span class="free">γ</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">γ</span> 
         <span class="main">=</span> integral <span class="main">(</span>cbox <span class="main">(</span><span class="main">(</span>pathstart <span class="free">γ</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>pathfinish <span class="free">γ</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">f_var</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="bound">f_var</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">g</span><span class="main">(</span><span class="bound">f_var</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">γ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> line_integral_def<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> gamma_differentiable<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">.</span> <span class="free">γ</span> <span class="keyword1">differentiable</span> <span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> gamma_smooth
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C1_differentiable_on_eq piecewise_C1_differentiable_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> gamma_i_component_smooth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="keyword1">differentiable</span> <span class="keyword1">at</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> field_cont_on_path<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">f_var</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="bound">f_var</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">f_var</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
    <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> 
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="skolem">x</span> <span class="main">∙</span> <span class="free">i</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> g_orthogonal_to_i i_norm_1
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> gamma_is_in_terms_of_i  real_inner_class.inner_add_left g_orthogonal_to_i inner_scaleR_left inner_same_Basis norm_eq_1<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> 0 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> continuous_on_compose2 <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">F</span></span><span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">)</span></span>  <span class="main"><span class="main">∙</span></span> <span class="free"><span class="free">i</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">f</span></span> <span class="main"><span class="main">`</span></span> <span class="main"><span class="main">{</span></span> <span class="main"><span class="main">0</span></span><span class="main"><span class="main">..</span></span><span class="main"><span class="main">1</span></span><span class="main"><span class="main">}</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">x</span></span> <span class="keyword1"><span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span></span> <span class="free"><span class="free">i</span></span> <span class="main"><span class="main">+</span></span> <span class="free"><span class="free">g</span></span> <span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span>
          field_i_comp_cont g_continuous_on_f field_i_comp_cont <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gamma_is_in_terms_of_i path_image_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> path_start_le_path_end'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">0</span> <span class="main">∙</span> <span class="free">i</span> <span class="main">≤</span> <span class="free">γ</span> <span class="main">1</span> <span class="main">∙</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> path_start_le_path_end <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pathstart_def pathfinish_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> gamm_cont<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">a</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> continuous_on_inner<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> gamma_smooth 
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> piecewise_C1_differentiable_on_def<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> continuous_on_const <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> cd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≤</span> <span class="skolem">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">a</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">c</span><span class="main">..</span><span class="skolem">d</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> continuous_image_closed_interval zero_le_one<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> subset_cd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">a</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">c</span><span class="main">..</span><span class="skolem">d</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> field_cont_on_path_cd<span class="main">:</span>
    <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="skolem">c</span><span class="main">..</span><span class="skolem">d</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">f_var</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="bound">f_var</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">f_var</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> field_cont_on_path cd <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> path_vector_deriv_line_integrals<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> 
                                          vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>
                                                  <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> gamma_i_component_smooth <span class="keyword2"><span class="keyword">and</span></span> derivative_component_fun_component <span class="keyword2"><span class="keyword">and</span></span>
      vector_derivative_works
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>       
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> 
                                          vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                                  <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> has_vector_derivative_at_within vector_derivative_at_within_ivl
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> has_int<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="main">(</span><span class="free">γ</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">g</span> <span class="main">(</span><span class="free">γ</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span>
           integral <span class="main">{</span><span class="free">γ</span> <span class="main">0</span> <span class="main">∙</span> <span class="free">i</span><span class="main">..</span><span class="free">γ</span> <span class="main">1</span> <span class="main">∙</span> <span class="free">i</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">f_var</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="bound">f_var</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">f_var</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> has_integral_substitution_strong<span class="main">[</span><span class="operator">OF</span> gamma_differentiable<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rel_simps<span class="main"><span class="main">(</span></span>44<span class="main"><span class="main">)</span></span>
        path_start_le_path_end' subset_cd field_cont_on_path_cd gamm_cont<span class="main">,</span>
        <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span>
      gamma_is_in_terms_of_i
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> has_field_derivative_iff_has_vector_derivative<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> has_int'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span><span class="main">(</span><span class="free">γ</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span>
           integral <span class="main">{</span><span class="main">(</span><span class="main">(</span>pathstart <span class="free">γ</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span><span class="main">..</span><span class="main">(</span><span class="main">(</span>pathfinish <span class="free">γ</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">f_var</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="bound">f_var</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">f_var</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span>  gamma_is_in_terms_of_i i_norm_1
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pathstart_def pathfinish_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>  real_inner_class.inner_add_left inner_not_same_Basis g_orthogonal_to_i inner_scaleR_left norm_eq_1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> substitute<span class="main">:</span>
    <span class="quoted"><span class="quoted">"integral <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="main">(</span>pathstart <span class="free">γ</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span><span class="main">..</span><span class="main">(</span><span class="main">(</span>pathfinish <span class="free">γ</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">f_var</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="bound">f_var</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">g</span><span class="main">(</span><span class="bound">f_var</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> 
                 <span class="main">=</span> integral <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span><span class="main">(</span><span class="free">γ</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> gamma_is_in_terms_of_i integral_unique<span class="main">[</span><span class="operator">OF</span> has_int<span class="main">]</span> i_norm_1
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pathstart_def pathfinish_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>  real_inner_class.inner_add_left inner_not_same_Basis g_orthogonal_to_i inner_scaleR_left norm_eq_1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> comp_in_eq_comp_out<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">.</span>
            <span class="main">(</span>vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>
                <span class="main">=</span> <span class="main">(</span>vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span> <span class="quoted">real</span>
    <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span><span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> x_bounds<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="keyword1">differentiable</span> <span class="keyword1">at</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ass gamma_differentiable <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> dotprod_in_is_out<span class="main">:</span>
      <span class="quoted"><span class="quoted">"vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>
                         <span class="main">=</span> <span class="main">(</span>vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> derivative_component_fun_component 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span>vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">γ</span> <span class="keyword1">has_vector_derivative</span> vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">γ</span> <span class="keyword1">differentiable</span> <span class="keyword1">at</span> <span class="skolem">x</span>›</span></span> vector_derivative_works <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> x_bounds <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vector_derivative_at_within_ivl<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> path_vector_deriv_line_integrals <span class="keyword2"><span class="keyword">and</span></span> vector_derivative_at_within_ivl <span class="keyword2"><span class="keyword">and</span></span>
        x_bounds
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ass atLeastAtMost_iff zero_less_one<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 0 <span class="keyword2"><span class="keyword">and</span></span> 1 <span class="keyword2"><span class="keyword">and</span></span> dotprod_in_is_out
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integral <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                   integral <span class="main">{</span>pathstart <span class="free">γ</span> <span class="main">∙</span> <span class="free">i</span><span class="main">..</span>pathfinish <span class="free">γ</span> <span class="main">∙</span> <span class="free">i</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">f_var</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="bound">f_var</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">f_var</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> substitute <span class="keyword2"><span class="keyword">and</span></span> comp_in_eq_comp_out <span class="keyword2"><span class="keyword">and</span></span> negligible_finite
      Henstock_Kurzweil_Integration.integral_spike
      <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span> <span class="main">*</span> vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> gamma_differentiable<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span>
                   integral <span class="main">{</span>pathstart <span class="free">γ</span> <span class="main">∙</span> <span class="free">i</span><span class="main">..</span>pathfinish <span class="free">γ</span> <span class="main">∙</span> <span class="free">i</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">f_var</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="bound">f_var</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">f_var</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> has_int' <span class="keyword2"><span class="keyword">and</span></span> comp_in_eq_comp_out <span class="keyword2"><span class="keyword">and</span></span> negligible_finite
      Henstock_Kurzweil_Integration.has_integral_spike
      <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span> <span class="main">*</span> vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"integral <span class="main">{</span>pathstart <span class="free">γ</span> <span class="main">∙</span> <span class="free">i</span><span class="main">..</span>pathfinish <span class="free">γ</span> <span class="main">∙</span> <span class="free">i</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">f_var</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="bound">f_var</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">f_var</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> gamma_differentiable<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> integrable_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">γ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> line_integral_exists_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-line_integral_on_pair_path"><span class="command">lemma</span></span> line_integral_on_pair_path<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">F</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>euclidean_space<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">g</span><span class="main">::</span><span class="quoted"><span class="quoted">"real <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">γ</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span>real <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">i</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> i_norm_1<span class="main">:</span> <span class="quoted"><span class="quoted">"norm <span class="free">i</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    g_orthogonal_to_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  
    gamma_is_in_terms_of_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">g</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    gamma_smooth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="keyword1">C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    g_continuous_on_f<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="free">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    path_start_le_path_end<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>pathstart <span class="free">γ</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span> <span class="main">≤</span> <span class="main">(</span>pathfinish <span class="free">γ</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    field_i_comp_cont<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>path_image <span class="free">γ</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">γ</span><span class="main">)</span> 
                 <span class="main">=</span> integral <span class="main">(</span>cbox <span class="main">(</span><span class="main">(</span>pathstart <span class="free">γ</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>pathfinish <span class="free">γ</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">f_var</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="bound">f_var</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">g</span><span class="main">(</span><span class="bound">f_var</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> line_integral_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> gamma_differentiable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="free">γ</span> <span class="keyword1">differentiable</span> <span class="keyword1">at</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> gamma_smooth  C1_differentiable_on_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> gamma_i_component_smooth<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="keyword1">differentiable</span> <span class="keyword1">at</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> vec_deriv_i_comp_cont<span class="main">:</span>
    <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> gamma_smooth C1_differentiable_on_eq
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> C1_differentiable_on_def atLeastAtMost_iff continuous_on_eq vector_derivative_at_within_ivl<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> deriv_comp_cont<span class="main">:</span>
      <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> derivative_component_fun_component_at_within<span class="main">[</span><span class="operator">OF</span> gamma_differentiable<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">i</span>"</span></span><span class="main">]</span>                    
        continuous_on_eq<span class="main">[</span><span class="operator">OF</span> deriv_comp_cont<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> field_cont_on_path<span class="main">:</span>
    <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">f_var</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="bound">f_var</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">f_var</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
    <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> 
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="skolem">x</span> <span class="main">∙</span> <span class="free">i</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> g_orthogonal_to_i i_norm_1
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> gamma_is_in_terms_of_i  real_inner_class.inner_add_left g_orthogonal_to_i inner_scaleR_left inner_same_Basis norm_eq_1<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> 0 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> continuous_on_compose2 <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">F</span></span><span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">)</span></span>  <span class="main"><span class="main">∙</span></span> <span class="free"><span class="free">i</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">f</span></span> <span class="main"><span class="main">`</span></span> <span class="main"><span class="main">{</span></span> <span class="main"><span class="main">0</span></span><span class="main"><span class="main">..</span></span><span class="main"><span class="main">1</span></span><span class="main"><span class="main">}</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">x</span></span> <span class="keyword1"><span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span></span> <span class="free"><span class="free">i</span></span> <span class="main"><span class="main">+</span></span> <span class="free"><span class="free">g</span></span> <span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span>
          field_i_comp_cont g_continuous_on_f field_i_comp_cont <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gamma_is_in_terms_of_i path_image_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> path_vector_deriv_line_integrals<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> 
                                          vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>
                                                  <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> gamma_i_component_smooth <span class="keyword2"><span class="keyword">and</span></span> derivative_component_fun_component <span class="keyword2"><span class="keyword">and</span></span>
      vector_derivative_works
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>       
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> 
                                          vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>
                                                  <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> has_vector_derivative_at_within vector_derivative_at_within_ivl
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> substitute<span class="main">:</span>
    <span class="quoted"><span class="quoted">"integral <span class="main">(</span>cbox <span class="main">(</span><span class="main">(</span>pathstart <span class="free">γ</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>pathfinish <span class="free">γ</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">f_var</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="bound">f_var</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">g</span><span class="main">(</span><span class="bound">f_var</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> 
                 <span class="main">=</span> integral <span class="main">(</span>cbox <span class="main">0</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span><span class="main">(</span><span class="free">γ</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> gauge_integral_by_substitution
      <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">f_var</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="bound">f_var</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">g</span><span class="main">(</span><span class="bound">f_var</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
      path_start_le_path_end <span class="keyword2"><span class="keyword">and</span></span> vec_deriv_i_comp_cont <span class="keyword2"><span class="keyword">and</span></span> field_cont_on_path <span class="keyword2"><span class="keyword">and</span></span> 
      gamma_is_in_terms_of_i i_norm_1
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pathstart_def pathfinish_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>  real_inner_class.inner_add_left inner_not_same_Basis g_orthogonal_to_i inner_scaleR_left norm_eq_1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
      <span class="comment1">(*integration by substitution*)</span>
  <span class="keyword1"><span class="command">have</span></span> comp_in_eq_comp_out<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span>
            <span class="main">(</span>vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>
                <span class="main">=</span> <span class="main">(</span>vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span> <span class="quoted">real</span>
    <span class="keyword3"><span class="command">assume</span></span> x_bounds<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="keyword1">differentiable</span> <span class="keyword1">at</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gamma_differentiable <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> dotprod_in_is_out<span class="main">:</span>
      <span class="quoted"><span class="quoted">"vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>
                         <span class="main">=</span> <span class="main">(</span>vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> derivative_component_fun_component 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span>
                         <span class="main">=</span> <span class="main">(</span>vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> has_vector_derivative_at_within <span class="keyword2"><span class="keyword">and</span></span> x_bounds <span class="keyword2"><span class="keyword">and</span></span> vector_derivative_at_within_ivl
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> atLeastAtMost_iff gamma_differentiable inner_commute vector_derivative_works<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> path_vector_deriv_line_integrals <span class="keyword2"><span class="keyword">and</span></span> vector_derivative_at_within_ivl <span class="keyword2"><span class="keyword">and</span></span>
        x_bounds
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 0 <span class="keyword2"><span class="keyword">and</span></span> 1 <span class="keyword2"><span class="keyword">and</span></span> dotprod_in_is_out
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integral <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                   integral <span class="main">{</span>pathstart <span class="free">γ</span> <span class="main">∙</span> <span class="free">i</span><span class="main">..</span>pathfinish <span class="free">γ</span> <span class="main">∙</span> <span class="free">i</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">f_var</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="bound">f_var</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">f_var</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> substitute <span class="keyword2"><span class="keyword">and</span></span> comp_in_eq_comp_out <span class="keyword2"><span class="keyword">and</span></span> 
      Henstock_Kurzweil_Integration.integral_cong
      <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span> <span class="main">*</span> vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">γ</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-content_box_cases"><span class="command">lemma</span></span> content_box_cases<span class="main">:</span>
  <span class="quoted"><span class="quoted">"content <span class="main">(</span>box <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">i</span><span class="main">∈</span>Basis<span class="main">.</span> <span class="free">a</span><span class="main">∙</span><span class="bound">i</span> <span class="main">≤</span> <span class="free">b</span><span class="main">∙</span><span class="bound">i</span> <span class="keyword1">then</span> prod <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">b</span><span class="main">∙</span><span class="bound">i</span> <span class="main">-</span> <span class="free">a</span><span class="main">∙</span><span class="bound">i</span><span class="main">)</span> Basis <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> measure_lborel_box_eq inner_diff<span class="main">)</span>

<span class="keyword1" id="Paths-content_box_cbox"><span class="command">lemma</span></span> content_box_cbox<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"content <span class="main">(</span>box <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> content <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> content_box_cases content_cbox_cases<span class="main">)</span>

<span class="keyword1" id="Paths-content_eq_0"><span class="command">lemma</span></span> content_eq_0<span class="main">:</span> <span class="quoted"><span class="quoted">"content <span class="main">(</span>box <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">i</span><span class="main">∈</span>Basis<span class="main">.</span> <span class="free">b</span><span class="main">∙</span><span class="bound">i</span> <span class="main">≤</span> <span class="free">a</span><span class="main">∙</span><span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> content_box_cases not_le <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> less_imp_le antisym eq_refl<span class="main">)</span>

<span class="keyword1" id="Paths-content_pos_lt_eq"><span class="command">lemma</span></span> content_pos_lt_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> content <span class="main">(</span>cbox <span class="free">a</span> <span class="main">(</span><span class="free">b</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>euclidean_space<span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">∈</span>Basis<span class="main">.</span> <span class="free">a</span><span class="main">∙</span><span class="bound">i</span> <span class="main">&lt;</span> <span class="free">b</span><span class="main">∙</span><span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> content_cbox_cases less_le prod_nonneg<span class="main">)</span>

<span class="keyword1" id="Paths-content_lt_nz"><span class="command">lemma</span></span> content_lt_nz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> content <span class="main">(</span>box <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">⟷</span> content <span class="main">(</span>box <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Paths.content_eq_0 zero_less_measure_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Paths-content_subset"><span class="command">lemma</span></span> content_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"cbox <span class="free">a</span> <span class="free">b</span> <span class="main">⊆</span> box <span class="free">c</span> <span class="free">d</span> <span class="main">⟹</span> content <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">≤</span> content <span class="main">(</span>box <span class="free">c</span> <span class="free">d</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> measure_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> enn2real_mono emeasure_mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> emeasure_lborel_cbox_eq emeasure_lborel_box_eq<span class="main">)</span>

<span class="keyword1" id="Paths-sum_content_null"><span class="command">lemma</span></span> sum_content_null<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"content <span class="main">(</span>box <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">tagged_division_of</span> <span class="main">(</span>box <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">.</span> content <span class="bound">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>real_normed_vector<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">p</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> xk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> surj_pair<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">note</span></span> assm <span class="main">=</span> tagged_division_ofD<span class="main">(</span>3-4<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span> y<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator"><span class="operator">unfolded</span></span> xk<span class="main"><span class="main"><span class="main">]</span></span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> cbox <span class="skolem">c</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">k</span><span class="main">)</span><span class="main">.</span> content <span class="bound">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="skolem">y</span> <span class="main">=</span> content <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> xk <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> content_subset<span class="main">[</span><span class="operator">OF</span> assm<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> k<span class="main"><span class="main">]</span></span><span class="main">]</span> content_pos_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"cbox <span class="skolem">c</span> <span class="skolem">d</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> assms<span class="main">(</span>1<span class="main">)</span> k
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">k</span><span class="main">)</span><span class="main">.</span> content <span class="bound">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Paths-has_integral_null"><span class="command">lemma</span></span> has_integral_null <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"content<span class="main">(</span>box <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">has_integral</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>box <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> content_box_cbox content_eq_0_interior<span class="main">)</span>

<span class="keyword1" id="Paths-line_integral_distrib"><span class="command">lemma</span></span> line_integral_distrib<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">f</span> <span class="free">basis</span> <span class="free">g1</span>"</span></span>
    <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">f</span> <span class="free">basis</span> <span class="free">g2</span>"</span></span>
    <span class="quoted"><span class="quoted">"valid_path <span class="free">g1</span>"</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="free">g2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">f</span> <span class="free">basis</span> <span class="main">(</span><span class="free">g1</span> <span class="main">+++</span> <span class="free">g2</span><span class="main">)</span> <span class="main">=</span> line_integral <span class="free">f</span> <span class="free">basis</span> <span class="free">g1</span> <span class="main">+</span> line_integral <span class="free">f</span> <span class="free">basis</span> <span class="free">g2</span>"</span></span>
    <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">f</span> <span class="free">basis</span> <span class="main">(</span><span class="free">g1</span> <span class="main">+++</span> <span class="free">g2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s1</span></span> <span class="skolem"><span class="skolem">s2</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> s1<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">s1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="skolem">s1</span><span class="main">.</span> <span class="free">g1</span> <span class="keyword1">differentiable</span> <span class="keyword1">at</span> <span class="bound">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> s2<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">s2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="skolem">s2</span><span class="main">.</span> <span class="free">g2</span> <span class="keyword1">differentiable</span> <span class="keyword1">at</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> valid_path_def piecewise_C1_differentiable_on_def C1_differentiable_on_eq<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i1</span></span> <span class="skolem"><span class="skolem">i2</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">g1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">g1</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="skolem">i1</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">g2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">g2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="skolem">i2</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> line_integral_exists_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> i1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">g1</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">g1</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="skolem">i1</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">}</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> i2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">g2</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">g2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="skolem">i2</span><span class="main">)</span> <span class="main">{</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> has_integral_affinity01 <span class="main">[</span><span class="operator">OF</span> 1<span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> m<span class="main"><span class="main">=</span></span> <span class="quoted"><span class="numeral">2</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="main">0</span></span><span class="main">,</span> <span class="operator">THEN</span> has_integral_cmul <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> c<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="numeral">2</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
      has_integral_affinity01 <span class="main">[</span><span class="operator">OF</span> 2<span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> m<span class="main"><span class="main">=</span></span> <span class="quoted"><span class="numeral">2</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span>"</span></span><span class="main">,</span> <span class="operator">THEN</span> has_integral_cmul <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> c<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="numeral">2</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> image_affinity_atLeastAtMost_div_diff<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scaleR_conv_of_real mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">0</span> <span class="main">≤</span> <span class="skolem">z</span><span class="main">;</span> <span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">;</span> <span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span> <span class="main">∉</span> <span class="skolem">s1</span><span class="main">⟧</span> <span class="main">⟹</span>
            vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span><span class="main">*</span><span class="numeral">2</span> <span class="main">≤</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="free">g1</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">g2</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">z</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span>
            <span class="numeral">2</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> vector_derivative <span class="free">g1</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">z</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">0</span> <span class="main">≤</span> <span class="skolem">z</span><span class="main">;</span> <span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">;</span> <span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span> <span class="main">∉</span> <span class="skolem">s1</span><span class="main">⟧</span> <span class="main">⟹</span>
              vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">≤</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="free">g1</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">g2</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">z</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> vector_derivative <span class="free">g1</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">z</span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> g1_at_z<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">0</span> <span class="main">≤</span> <span class="skolem">z</span><span class="main">;</span> <span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">;</span> <span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span> <span class="main">∉</span> <span class="skolem">s1</span><span class="main">⟧</span> <span class="main">⟹</span>
                         <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span><span class="main">*</span><span class="numeral">2</span> <span class="main">≤</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="free">g1</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">g2</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span>
                         <span class="numeral">2</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> vector_derivative <span class="free">g1</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">z</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> has_vector_derivative_transform_at <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">¦</span></span><span class="skolem"><span class="skolem">z</span></span> <span class="main"><span class="main">-</span></span> <span class="main"><span class="main">1</span></span><span class="main"><span class="main">/</span></span><span class="numeral"><span class="numeral">2</span></span><span class="main"><span class="main">¦</span></span>"</span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">g1</span></span><span class="main"><span class="main">(</span></span><span class="numeral"><span class="numeral">2</span></span><span class="main"><span class="main">*</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_real_def abs_if <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> vector_diff_chain_at <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="numeral"><span class="numeral">2</span></span><span class="main"><span class="main">*</span></span><span class="bound"><span class="bound">x</span></span>"</span></span></span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">2</span></span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">g1</span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span> o_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_vector_derivative_def has_derivative_def bounded_linear_mult_left<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> s1
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> vector_derivative_works<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span> <span class="main">∉</span> <span class="skolem">s1</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> z_ge<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">≤</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="free">g1</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">g2</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">z</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> vector_derivative <span class="free">g1</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Derivative.vector_derivative_at_within_ivl<span class="main">[</span><span class="operator">OF</span> g1_at_z<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ass<span class="main"><span class="main">]</span></span> ass<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> z_ge<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span> <span class="main">∉</span> <span class="skolem">s1</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g1</span> <span class="keyword1">has_vector_derivative</span> <span class="main">(</span><span class="main">(</span>vector_derivative <span class="free">g1</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> s1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> vector_derivative_works<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vector_derivative <span class="free">g1</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vector_derivative <span class="free">g1</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Derivative.vector_derivative_at_within_ivl ass
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">≤</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="free">g1</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">g2</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">z</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> vector_derivative <span class="free">g1</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">)</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> i<span class="main">[</span><span class="operator">OF</span> ass<span class="main">]</span> ii
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span><span class="main">;</span> <span class="skolem">z</span> <span class="main">≤</span> <span class="main">1</span><span class="main">;</span> <span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">1</span> <span class="main">∉</span> <span class="skolem">s2</span><span class="main">⟧</span> <span class="main">⟹</span>
            vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span><span class="main">*</span><span class="numeral">2</span> <span class="main">≤</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="free">g1</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">g2</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">z</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span>
            <span class="numeral">2</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> vector_derivative <span class="free">g2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">z</span>       <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span><span class="main">;</span> <span class="skolem">z</span> <span class="main">≤</span> <span class="main">1</span><span class="main">;</span> <span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">1</span> <span class="main">∉</span> <span class="skolem">s2</span><span class="main">⟧</span> <span class="main">⟹</span>
              vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">≤</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="free">g1</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">g2</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">z</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>
                   <span class="main">=</span> <span class="numeral">2</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> vector_derivative <span class="free">g2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">z</span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> g2_at_z<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span><span class="main">;</span> <span class="skolem">z</span> <span class="main">≤</span> <span class="main">1</span><span class="main">;</span> <span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">1</span> <span class="main">∉</span> <span class="skolem">s2</span><span class="main">⟧</span> <span class="main">⟹</span>
                      <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span><span class="main">*</span><span class="numeral">2</span> <span class="main">≤</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="free">g1</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">g2</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> <span class="numeral">2</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> vector_derivative <span class="free">g2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">z</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> has_vector_derivative_transform_at <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">¦</span></span><span class="skolem"><span class="skolem">z</span></span> <span class="main"><span class="main">-</span></span> <span class="main"><span class="main">1</span></span><span class="main"><span class="main">/</span></span><span class="numeral"><span class="numeral">2</span></span><span class="main"><span class="main">¦</span></span>"</span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">g2</span></span> <span class="main"><span class="main">(</span></span><span class="numeral"><span class="numeral">2</span></span><span class="main"><span class="main">*</span></span><span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">-</span></span> <span class="main"><span class="main">1</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_real_def abs_if <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> vector_diff_chain_at <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="numeral"><span class="numeral">2</span></span><span class="main"><span class="main">*</span></span><span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">-</span></span> <span class="main"><span class="main">1</span></span>"</span></span></span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">2</span></span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">g2</span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span> o_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_vector_derivative_def has_derivative_def bounded_linear_mult_left<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> s2
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> vector_derivative_works<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">1</span> <span class="main">∉</span> <span class="skolem">s2</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> z_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> z_ge<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ass <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">≤</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="free">g1</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">g2</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">z</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>
                                <span class="main">=</span> <span class="numeral">2</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> vector_derivative <span class="free">g2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Derivative.vector_derivative_at_within_ivl<span class="main">[</span><span class="operator">OF</span> g2_at_z<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ass<span class="main"><span class="main">]</span></span> z_ge z_le<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">1</span> <span class="main">∉</span> <span class="skolem">s2</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g2</span> <span class="keyword1">has_vector_derivative</span> <span class="main">(</span><span class="main">(</span>vector_derivative <span class="free">g2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> s2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> vector_derivative_works<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vector_derivative <span class="free">g2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vector_derivative <span class="free">g2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Derivative.vector_derivative_at_within_ivl ass
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">≤</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="free">g1</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">g2</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">z</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> vector_derivative <span class="free">g2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> i<span class="main">[</span><span class="operator">OF</span> ass<span class="main">]</span> ii
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> lem1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="main">(</span><span class="free">g1</span><span class="main">+++</span><span class="free">g2</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="main">(</span><span class="free">g1</span><span class="main">+++</span><span class="free">g2</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="skolem">i1</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> has_integral_spike_finite <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ i1<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"insert <span class="main"><span class="main">(</span></span><span class="main"><span class="main">1</span></span><span class="main"><span class="main">/</span></span><span class="numeral"><span class="numeral">2</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">(*)</span></span><span class="numeral"><span class="numeral">2</span></span> <span class="main"><span class="main">-`</span></span> <span class="skolem"><span class="skolem">s1</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> s1
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> finite_vimageI <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> h <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">(*)</span><span class="numeral">2</span>"</span></span><span class="main"><span class="main">]</span></span> inj_onI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> joinpaths_def scaleR_conv_of_real mult_ac g1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_distrib_left<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> lem2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="main">(</span><span class="free">g1</span><span class="main">+++</span><span class="free">g2</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="main">(</span><span class="free">g1</span><span class="main">+++</span><span class="free">g2</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="skolem">i2</span><span class="main">)</span> <span class="main">{</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> has_integral_spike_finite <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ i2<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"insert <span class="main"><span class="main">(</span></span><span class="main"><span class="main">1</span></span><span class="main"><span class="main">/</span></span><span class="numeral"><span class="numeral">2</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="numeral"><span class="numeral">2</span></span><span class="main"><span class="main">*</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">-</span></span><span class="main"><span class="main">1</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">-`</span></span> <span class="skolem"><span class="skolem">s2</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> s2
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> finite_vimageI <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> h <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="numeral">2</span><span class="main">*</span><span class="bound">x</span><span class="main">-</span><span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span> inj_onI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> joinpaths_def scaleR_conv_of_real mult_ac g2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_distrib_left<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">f</span> <span class="free">basis</span> <span class="main">(</span><span class="free">g1</span> <span class="main">+++</span> <span class="free">g2</span><span class="main">)</span> <span class="main">=</span> line_integral <span class="free">f</span> <span class="free">basis</span> <span class="free">g1</span> <span class="main">+</span> line_integral <span class="free">f</span> <span class="free">basis</span> <span class="free">g2</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> line_integral_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> integral_unique <span class="main"><span class="main">[</span></span><span class="operator">OF</span> has_integral_combine <span class="main"><span class="main"><span class="main">[</span></span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> c <span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">1</span></span><span class="main"><span class="main">/</span></span><span class="numeral"><span class="numeral">2</span></span>"</span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> 1 2 integral_unique <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">f</span> <span class="free">basis</span> <span class="main">(</span><span class="free">g1</span> <span class="main">+++</span> <span class="free">g2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> line_integral_exists_def integrable_on_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">∧</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> <span class="main">∑</span><span class="bound">a</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="main">(</span><span class="free">g1</span> <span class="main">+++</span> <span class="free">g2</span><span class="main">)</span> <span class="bound">r</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">a</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="main">(</span><span class="free">g1</span> <span class="main">+++</span> <span class="free">g2</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">r</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="bound">r</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> has_integral_combine <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> c <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main">]</span> 1 2 divide_le_eq_numeral1<span class="main">(</span>1<span class="main">)</span> lem1 lem2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-line_integral_exists_joinD1"><span class="command">lemma</span></span> line_integral_exists_joinD1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">f</span> <span class="free">basis</span> <span class="main">(</span><span class="free">g1</span> <span class="main">+++</span> <span class="free">g2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="free">g1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">f</span> <span class="free">basis</span> <span class="free">g1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s1</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> s1<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">s1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="skolem">s1</span><span class="main">.</span> <span class="free">g1</span> <span class="keyword1">differentiable</span> <span class="keyword1">at</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> valid_path_def piecewise_C1_differentiable_on_def C1_differentiable_on_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="main">(</span><span class="free">g1</span> <span class="main">+++</span> <span class="free">g2</span><span class="main">)</span> <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="main">(</span><span class="free">g1</span> <span class="main">+++</span> <span class="free">g2</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> line_integral_exists_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> integrable_on_subcbox <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> b<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">1</span></span><span class="main"><span class="main">/</span></span><span class="numeral"><span class="numeral">2</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> integrable_affinity <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">::</span>real"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="main">(</span><span class="free">g1</span> <span class="main">+++</span> <span class="free">g2</span><span class="main">)</span> <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">*</span> <span class="main">(</span>vector_derivative <span class="main">(</span><span class="free">g1</span> <span class="main">+++</span> <span class="free">g2</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Groups_Big.sum_distrib_left <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> integrable_cmul <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> c<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> scaleR_conv_of_real<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">0</span> <span class="main">≤</span> <span class="skolem">z</span><span class="main">;</span> <span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">;</span> <span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span> <span class="main">∉</span> <span class="skolem">s1</span><span class="main">⟧</span> <span class="main">⟹</span>
            vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span><span class="main">*</span><span class="numeral">2</span> <span class="main">≤</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="free">g1</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">g2</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">z</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span>
            <span class="numeral">2</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> vector_derivative <span class="free">g1</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">z</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">0</span> <span class="main">≤</span> <span class="skolem">z</span><span class="main">;</span> <span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">;</span> <span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span> <span class="main">∉</span> <span class="skolem">s1</span><span class="main">⟧</span> <span class="main">⟹</span>
              vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">≤</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="free">g1</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">g2</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">z</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> vector_derivative <span class="free">g1</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">z</span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> g1_at_z<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">0</span> <span class="main">≤</span> <span class="skolem">z</span><span class="main">;</span> <span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">;</span> <span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span> <span class="main">∉</span> <span class="skolem">s1</span><span class="main">⟧</span> <span class="main">⟹</span>
                         <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span><span class="main">*</span><span class="numeral">2</span> <span class="main">≤</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="free">g1</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">g2</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span>
                         <span class="numeral">2</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> vector_derivative <span class="free">g1</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">z</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> has_vector_derivative_transform_at <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">¦</span></span><span class="skolem"><span class="skolem">z</span></span> <span class="main"><span class="main">-</span></span> <span class="main"><span class="main">1</span></span><span class="main"><span class="main">/</span></span><span class="numeral"><span class="numeral">2</span></span><span class="main"><span class="main">¦</span></span>"</span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">g1</span></span><span class="main"><span class="main">(</span></span><span class="numeral"><span class="numeral">2</span></span><span class="main"><span class="main">*</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_real_def abs_if <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> vector_diff_chain_at <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="numeral"><span class="numeral">2</span></span><span class="main"><span class="main">*</span></span><span class="bound"><span class="bound">x</span></span>"</span></span></span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">2</span></span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">g1</span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span> o_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_vector_derivative_def has_derivative_def bounded_linear_mult_left<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> s1
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> vector_derivative_works<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span> <span class="main">∉</span> <span class="skolem">s1</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> z_ge<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">≤</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="free">g1</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">g2</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">z</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> vector_derivative <span class="free">g1</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Derivative.vector_derivative_at_within_ivl<span class="main">[</span><span class="operator">OF</span> g1_at_z<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ass<span class="main"><span class="main">]</span></span> ass<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> z_ge<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span> <span class="main">∉</span> <span class="skolem">s1</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g1</span> <span class="keyword1">has_vector_derivative</span> <span class="main">(</span><span class="main">(</span>vector_derivative <span class="free">g1</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> s1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> vector_derivative_works<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vector_derivative <span class="free">g1</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vector_derivative <span class="free">g1</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Derivative.vector_derivative_at_within_ivl ass <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">≤</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="free">g1</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">g2</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">z</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> vector_derivative <span class="free">g1</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">)</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> i<span class="main">[</span><span class="operator">OF</span> ass<span class="main">]</span> ii <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> s1
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> line_integral_exists_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> integrable_spike_finite <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span><span class="main"><span class="main">0</span></span><span class="main"><span class="main">,</span></span><span class="main"><span class="main">1</span></span><span class="main"><span class="main">}</span></span> <span class="main"><span class="main">∪</span></span> <span class="skolem"><span class="skolem">s1</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> _ _ *<span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> joinpaths_def scaleR_conv_of_real g1<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-line_integral_exists_joinD2"><span class="command">lemma</span></span> line_integral_exists_joinD2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">f</span> <span class="free">basis</span> <span class="main">(</span><span class="free">g1</span> <span class="main">+++</span> <span class="free">g2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="free">g2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">f</span> <span class="free">basis</span> <span class="free">g2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s2</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> s2<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">s2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="skolem">s2</span><span class="main">.</span> <span class="free">g2</span> <span class="keyword1">differentiable</span> <span class="keyword1">at</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> valid_path_def piecewise_C1_differentiable_on_def C1_differentiable_on_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="main">(</span><span class="free">g1</span> <span class="main">+++</span> <span class="free">g2</span><span class="main">)</span> <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="main">(</span><span class="free">g1</span> <span class="main">+++</span> <span class="free">g2</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> line_integral_exists_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> integrable_on_subcbox <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">1</span></span><span class="main"><span class="main">/</span></span><span class="numeral"><span class="numeral">2</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> b<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> integrable_affinity <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">1</span></span><span class="main"><span class="main">/</span></span><span class="numeral"><span class="numeral">2</span></span><span class="main"><span class="main">::</span></span>real"</span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">1</span></span><span class="main"><span class="main">/</span></span><span class="numeral"><span class="numeral">2</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">1</span></span><span class="main"><span class="main">/</span></span><span class="numeral"><span class="numeral">2</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_affinity_atLeastAtMost_diff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="main">(</span><span class="free">g1</span> <span class="main">+++</span> <span class="free">g2</span><span class="main">)</span> <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">*</span> <span class="main">(</span>vector_derivative <span class="main">(</span><span class="free">g1</span> <span class="main">+++</span> <span class="free">g2</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Groups_Big.sum_distrib_left <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> integrable_cmul <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> c<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> scaleR_conv_of_real<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span><span class="main">;</span> <span class="skolem">z</span> <span class="main">≤</span> <span class="main">1</span><span class="main">;</span> <span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">1</span> <span class="main">∉</span> <span class="skolem">s2</span><span class="main">⟧</span> <span class="main">⟹</span>
            vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span><span class="main">*</span><span class="numeral">2</span> <span class="main">≤</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="free">g1</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">g2</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">z</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span>
            <span class="numeral">2</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> vector_derivative <span class="free">g2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">z</span>       <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span><span class="main">;</span> <span class="skolem">z</span> <span class="main">≤</span> <span class="main">1</span><span class="main">;</span> <span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">1</span> <span class="main">∉</span> <span class="skolem">s2</span><span class="main">⟧</span> <span class="main">⟹</span>
              vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">≤</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="free">g1</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">g2</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">z</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>
                   <span class="main">=</span> <span class="numeral">2</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> vector_derivative <span class="free">g2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">z</span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> g2_at_z<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span><span class="main">;</span> <span class="skolem">z</span> <span class="main">≤</span> <span class="main">1</span><span class="main">;</span> <span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">1</span> <span class="main">∉</span> <span class="skolem">s2</span><span class="main">⟧</span> <span class="main">⟹</span>
                      <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span><span class="main">*</span><span class="numeral">2</span> <span class="main">≤</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="free">g1</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">g2</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> <span class="numeral">2</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> vector_derivative <span class="free">g2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">z</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> has_vector_derivative_transform_at <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">¦</span></span><span class="skolem"><span class="skolem">z</span></span> <span class="main"><span class="main">-</span></span> <span class="main"><span class="main">1</span></span><span class="main"><span class="main">/</span></span><span class="numeral"><span class="numeral">2</span></span><span class="main"><span class="main">¦</span></span>"</span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">g2</span></span> <span class="main"><span class="main">(</span></span><span class="numeral"><span class="numeral">2</span></span><span class="main"><span class="main">*</span></span><span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">-</span></span> <span class="main"><span class="main">1</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_real_def abs_if <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> vector_diff_chain_at <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="numeral"><span class="numeral">2</span></span><span class="main"><span class="main">*</span></span><span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">-</span></span> <span class="main"><span class="main">1</span></span>"</span></span></span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">2</span></span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">g2</span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span> o_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_vector_derivative_def has_derivative_def bounded_linear_mult_left<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> s2
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> vector_derivative_works<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">1</span> <span class="main">∉</span> <span class="skolem">s2</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> z_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> z_ge<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ass <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">≤</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="free">g1</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">g2</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">z</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>
                                <span class="main">=</span> <span class="numeral">2</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> vector_derivative <span class="free">g2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Derivative.vector_derivative_at_within_ivl<span class="main">[</span><span class="operator">OF</span> g2_at_z<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ass<span class="main"><span class="main">]</span></span> z_ge z_le<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">1</span> <span class="main">∉</span> <span class="skolem">s2</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g2</span> <span class="keyword1">has_vector_derivative</span> <span class="main">(</span><span class="main">(</span>vector_derivative <span class="free">g2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> s2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> vector_derivative_works<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vector_derivative <span class="free">g2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vector_derivative <span class="free">g2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">z</span><span class="main">*</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Derivative.vector_derivative_at_within_ivl ass
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">≤</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="free">g1</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">g2</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">z</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> vector_derivative <span class="free">g2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> i<span class="main">[</span><span class="operator">OF</span> ass<span class="main">]</span> ii
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> s2
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> line_integral_exists_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> integrable_spike_finite <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span><span class="main"><span class="main">0</span></span><span class="main"><span class="main">,</span></span><span class="main"><span class="main">1</span></span><span class="main"><span class="main">}</span></span> <span class="main"><span class="main">∪</span></span> <span class="skolem"><span class="skolem">s2</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> _ _ *<span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> joinpaths_def scaleR_conv_of_real g2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-has_line_integral_on_reverse_path"><span class="command">lemma</span></span> has_line_integral_on_reverse_path<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_path <span class="free">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> int<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">g</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="free">c</span><span class="main">)</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="main">(</span>reversepath <span class="free">g</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="main">(</span>reversepath <span class="free">g</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="main">-</span><span class="free">c</span><span class="main">)</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">C1_differentiable_on</span> <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="main">(-)</span> <span class="main">1</span> <span class="main">`</span> <span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span>
                <span class="main">-</span> vector_derivative <span class="free">g</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f'</span></span> <span class="keyword2"><span class="keyword">where</span></span> f'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="keyword1">has_vector_derivative</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> xs
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> has_vector_derivative_def C1_differentiable_on_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> <span class="main">-</span><span class="main">1</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> vector_diff_chain_within<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> vector_diff_chain_within <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> <span class="main"><span class="keyword3">|</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> has_vector_derivative_at_within <span class="main"><span class="main">[</span></span><span class="operator">OF</span> f'<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> mf'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> <span class="main">-</span><span class="skolem">f'</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> o_def<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> xs
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vector_derivative_at_within_ivl <span class="main"><span class="main">[</span></span><span class="operator">OF</span> mf'<span class="main"><span class="main">]</span></span> vector_derivative_at_within_ivl <span class="main"><span class="main">[</span></span><span class="operator">OF</span> f'<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> * <span class="main">=</span> this
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="skolem">S</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> g
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> valid_path_def piecewise_C1_differentiable_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> has_integral_affinity01 <span class="main">[</span><span class="operator">OF</span> int<span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> m<span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="main">1</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> reversepath_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> S <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">S</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> has_integral_spike_finite<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> * has_integral_neg Groups_Big.sum_negf<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-line_integral_on_reverse_path"><span class="command">lemma</span></span> line_integral_on_reverse_path<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="free">γ</span>"</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="free">γ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">γ</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span>line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>reversepath <span class="free">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>reversepath <span class="free">γ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="skolem">i</span><span class="main">)</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> integrable_on_def line_integral_exists_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="main">(</span>reversepath <span class="free">γ</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="main">(</span>reversepath <span class="free">γ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="main">-</span><span class="skolem">i</span><span class="main">)</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> has_line_integral_on_reverse_path assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> rev_line_integral<span class="main">:</span><span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>reversepath <span class="free">γ</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> line_integral_def Henstock_Kurzweil_Integration.integral_unique
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> line_integral<span class="main">:</span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">γ</span> <span class="main">=</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> line_integral_def 0 Henstock_Kurzweil_Integration.integral_unique
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">γ</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span>line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>reversepath <span class="free">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> line_integral rev_line_integral
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>reversepath <span class="free">γ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 line_integral_exists_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-line_integral_exists_on_degenerate_path"><span class="command">lemma</span></span> line_integral_exists_on_degenerate_path<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">basis</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> every_component_integrable<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span>
    <span class="keyword3"><span class="command">assume</span></span> b_in_basis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">basis</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> cont_field_zero_one<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> continuous_on_const <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> cont_path_zero_one<span class="main">:</span>
      <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> that gamma_deriv_at_within<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span><span class="main">]</span> differentiable_const vector_derivative_const_at
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="skolem">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> continuous_on_const<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span><span class="main">]</span> continuous_on_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="skolem">b</span><span class="main">)</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">c</span><span class="main">)</span> <span class="main">∙</span> <span class="skolem">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> cont_field_zero_one cont_path_zero_one continuous_on_mult integrable_continuous_real
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> integrable_sum'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span> <span class="bound">f</span> <span class="bound">s</span><span class="main">.</span> finite <span class="bound">t</span> <span class="main">⟹</span>
                <span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="bound">t</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">a</span> <span class="keyword1">integrable_on</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">a</span><span class="main">∈</span><span class="bound">t</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">a</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="bound">s</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> integrable_sum <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> field_integrable_on_basis<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">c</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> integrable_sum'<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> every_component_integrable<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> line_integral_exists_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-degenerate_path_is_valid_path"><span class="command">lemma</span></span> degenerate_path_is_valid_path<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_path <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_path_def piecewise_C1_differentiable_on_def continuous_on_const<span class="main">)</span>

<span class="keyword1" id="Paths-line_integral_degenerate_path"><span class="command">lemma</span></span> line_integral_degenerate_path<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">basis</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> line_integral_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">b</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that gamma_deriv_at_within<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span><span class="main">]</span> differentiable_const vector_derivative_const_at
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="skolem">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> <span class="free">F</span> <span class="free">c</span> <span class="main">∙</span> <span class="bound">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integral <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> <span class="free">F</span> <span class="free">c</span> <span class="main">∙</span> <span class="bound">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> integral_cong<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> 0<span class="main">]</span> integral_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">point_path</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">point_path</span> <span class="free"><span class="bound"><span class="entity">γ</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">γ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">c</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Paths-line_integral_point_path"><span class="command">lemma</span></span> line_integral_point_path<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"point_path <span class="free">γ</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">basis</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">γ</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> point_path_def line_integral_degenerate_path<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Paths-line_integral_exists_point_path"><span class="command">lemma</span></span> line_integral_exists_point_path<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">basis</span>"</span></span> <span class="quoted"><span class="quoted">"point_path <span class="free">γ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="free">γ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> point_path_def<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> line_integral_exists_on_degenerate_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Paths-line_integral_exists_subpath"><span class="command">lemma</span></span> line_integral_exists_subpath<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">f</span> <span class="free">basis</span> <span class="free">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_path <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> uv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≤</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>line_integral_exists <span class="free">f</span> <span class="free">basis</span> <span class="main">(</span>subpath <span class="free">u</span> <span class="free">v</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">=</span><span class="free">u</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> tr<span class="main">:</span> True
  <span class="keyword1"><span class="command">have</span></span> zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="free">u</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="free">u</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="free">u</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Deriv.has_vector_derivative_const that Derivative.vector_derivative_at_within_ivl
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="free">u</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="free">u</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="free">u</span><span class="main">)</span>  <span class="main">∙</span> <span class="bound">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="free">u</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>  <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="main">0</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> has_integral_is_0<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> f tr <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> line_integral_def line_integral_exists_def subpath_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="skolem">s</span> <span class="main">⟹</span> <span class="free">g</span> <span class="keyword1">differentiable</span> <span class="keyword1">at</span> <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fs<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> g <span class="keyword1"><span class="command">unfolding</span></span> piecewise_C1_differentiable_on_def C1_differentiable_on_eq valid_path_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="main">(</span><span class="main">(</span><span class="free">v</span> <span class="main">-</span> <span class="free">u</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">u</span><span class="main">)</span><span class="main">)</span>  <span class="main">∙</span> <span class="bound">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">g</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="main">(</span><span class="free">v</span> <span class="main">-</span> <span class="free">u</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">u</span><span class="main">)</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>  <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span>
            <span class="keyword1">has_integral</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">v</span> <span class="main">-</span> <span class="free">u</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> integral <span class="main">{</span><span class="free">u</span><span class="main">..</span><span class="free">v</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>  <span class="main">∙</span> <span class="bound">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">g</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>  <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
           <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f uv
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> line_integral_exists_def subpath_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> integrable_on_subcbox <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">u</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> b<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">v</span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_integral_integral<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> has_integral_affinity <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> m<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">v</span></span><span class="main"><span class="main">-</span></span><span class="free"><span class="free">u</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> c<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">u</span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False image_affinity_atLeastAtMost_div_diff scaleR_conv_of_real<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> False<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">have</span></span> vd<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">⟹</span>
           <span class="bound">x</span> <span class="main">∉</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="free">v</span><span class="main">-</span><span class="free">u</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">t</span> <span class="main">+</span> <span class="free">u</span><span class="main">)</span> <span class="main">-`</span> <span class="skolem">s</span> <span class="main">⟹</span>
           vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="main">(</span><span class="main">(</span><span class="free">v</span><span class="main">-</span><span class="free">u</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">u</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">v</span><span class="main">-</span><span class="free">u</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> vector_derivative <span class="free">g</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="main">(</span><span class="free">v</span><span class="main">-</span><span class="free">u</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">u</span><span class="main">)</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> test2<span class="main">[</span><span class="operator">OF</span> s fs uv<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> arg<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> <span class="main">(</span><span class="free">v</span> <span class="main">-</span> <span class="free">u</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="main">(</span><span class="main">(</span><span class="free">v</span> <span class="main">-</span> <span class="free">u</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">u</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">g</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="main">(</span><span class="free">v</span> <span class="main">-</span> <span class="free">u</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">u</span><span class="main">)</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>
              <span class="main">=</span>    <span class="main">(</span><span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="main">(</span><span class="main">(</span><span class="free">v</span> <span class="main">-</span> <span class="free">u</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">u</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span> <span class="main">*</span> <span class="main">(</span><span class="free">v</span> <span class="main">-</span> <span class="free">u</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">g</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="main">(</span><span class="free">v</span> <span class="main">-</span> <span class="free">u</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">u</span><span class="main">)</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="main">(</span><span class="main">(</span><span class="free">v</span> <span class="main">-</span> <span class="free">u</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">u</span><span class="main">)</span><span class="main">)</span>  <span class="main">∙</span> <span class="bound">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="main">(</span><span class="main">(</span><span class="free">v</span> <span class="main">-</span> <span class="free">u</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">u</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>  <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span>
          <span class="main">(</span>integral <span class="main">{</span><span class="free">u</span><span class="main">..</span><span class="free">v</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>  <span class="main">∙</span> <span class="bound">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">g</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cut_tac</span> Henstock_Kurzweil_Integration.has_integral_mult_right <span class="main"><span class="main">[</span></span><span class="operator">OF</span> *<span class="main"><span class="main">,</span></span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> c <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">v</span></span><span class="main"><span class="main">-</span></span><span class="free"><span class="free">u</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> fs assms
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False subpath_def line_integral_exists_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> S <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">v</span><span class="main">-</span><span class="free">u</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">t</span> <span class="main">+</span> <span class="free">u</span><span class="main">)</span><span class="main">)</span> <span class="main">-`</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> has_integral_spike_finite<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def False vd finite_vimageI scaleR_conv_of_real Groups_Big.sum_distrib_left
        mult.assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> arg<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>line_integral_exists <span class="free">f</span> <span class="free">basis</span> <span class="main">(</span>subpath <span class="free">u</span> <span class="free">v</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> line_integral_exists_def subpath_def integrable_on_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*This should have everything that has to do with onecubes*)</span>

   <span class="keyword1"><span class="command">type_synonym</span></span> path <span class="main">=</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> <span class="main">(</span>real <span class="main">*</span> real<span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">type_synonym</span></span> one_cube <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real <span class="main">⇒</span> <span class="main">(</span>real <span class="main">*</span> real<span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">type_synonym</span></span> one_chain <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>int <span class="main">*</span> path<span class="main">)</span> set"</span></span>
   <span class="keyword1"><span class="command">type_synonym</span></span> two_cube <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real <span class="main">*</span> real<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>real <span class="main">*</span> real<span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">type_synonym</span></span> two_chain <span class="main">=</span> <span class="quoted"><span class="quoted">"two_cube set"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">one_chain_line_integral</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>real <span class="main">*</span> real<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>real <span class="main">*</span> real<span class="main">)</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">(</span>real<span class="main">*</span>real<span class="main">)</span> set<span class="main">)</span> <span class="main">⇒</span> one_chain <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">one_chain_line_integral</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">g</span><span class="main">)</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> <span class="main">(</span>line_integral <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">boundary_chain</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">boundary_chain</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">.</span> <span class="bound">k</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∨</span> <span class="bound">k</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">coeff_cube_to_path</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span>int <span class="main">*</span> one_cube<span class="main">)</span> <span class="main">⇒</span> path"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">coeff_cube_to_path</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">γ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">γ</span></span></span> <span class="keyword1">else</span> <span class="main">(</span>reversepath <span class="free"><span class="bound"><span class="entity">γ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">rec_join</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>int<span class="main">*</span>path<span class="main">)</span> list <span class="main">⇒</span> path"</span></span> <span class="keyword2"><span class="keyword">where</span></span>   
  <span class="quoted"><span class="quoted">"<span class="free">rec_join</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span><span class="main">0</span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">rec_join</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">oneC</span></span></span><span class="main">]</span> <span class="main">=</span> coeff_cube_to_path <span class="free"><span class="bound"><span class="entity">oneC</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">rec_join</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">oneC</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> coeff_cube_to_path <span class="free"><span class="bound"><span class="entity">oneC</span></span></span> <span class="main">+++</span> <span class="main">(</span><span class="free">rec_join</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">valid_chain_list</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">valid_chain_list</span> <span class="main">[]</span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">valid_chain_list</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">oneC</span></span></span><span class="main">]</span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">valid_chain_list</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">oneC</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>pathfinish <span class="main">(</span>coeff_cube_to_path <span class="main">(</span><span class="free"><span class="bound"><span class="entity">oneC</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> pathstart <span class="main">(</span>rec_join <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="free">valid_chain_list</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Paths-joined_is_valid"><span class="command">lemma</span></span> joined_is_valid<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> boundary_chain<span class="main">:</span> <span class="quoted"><span class="quoted">"boundary_chain <span class="main">(</span>set <span class="free">l</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    valid_path<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span> <span class="bound">γ</span><span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">l</span> <span class="main">⟹</span> valid_path <span class="bound">γ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    valid_chain_list_ass<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_chain_list <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="main">(</span>rec_join <span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> C1_differentiable_imp_piecewise<span class="main">[</span><span class="operator">OF</span> C1_differentiable_on_const<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_path_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">l</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_path <span class="main">(</span>rec_join <span class="main">(</span><span class="main">(</span><span class="skolem">k</span><span class="main">::</span>int<span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"boundary_chain <span class="main">(</span>set <span class="main">(</span><span class="skolem">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">k'</span> <span class="bound">γ'</span><span class="main">.</span> <span class="main">(</span><span class="bound">k'</span><span class="main">,</span> <span class="bound">γ'</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">l</span> <span class="main">⟹</span> valid_path <span class="bound">γ'</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"valid_chain_list <span class="skolem">l</span>"</span></span>
      <span class="quoted"><span class="quoted">"valid_path <span class="main">(</span>rec_join <span class="skolem">l</span><span class="main">)</span> "</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">k'</span> <span class="bound">γ'</span><span class="main">.</span> <span class="main">(</span><span class="bound">k'</span><span class="main">,</span> <span class="bound">γ'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">⟹</span> valid_path <span class="bound">γ'</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"valid_chain_list <span class="main">(</span><span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">l</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"boundary_chain <span class="main">(</span>set <span class="main">(</span><span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">γ</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">l</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">γ</span> <span class="skolem">l</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> that <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="main">(</span>rec_join <span class="main">(</span><span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="skolem"><span class="skolem">l'</span></span> <span class="keyword2"><span class="keyword">where</span></span> l_nempty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> <span class="skolem">h</span><span class="main">#</span><span class="skolem">l'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> rec_join.elims<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="main">(</span>rec_join <span class="main">(</span><span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI impI<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> k_eq_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span><span class="quoted"><span class="quoted">"valid_path <span class="skolem">γ</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"pathfinish <span class="skolem">γ</span> <span class="main">=</span> pathstart <span class="main">(</span>rec_join <span class="main">(</span><span class="skolem">h</span><span class="main">#</span><span class="skolem">l'</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>6<span class="main">)</span> k_eq_1 l_nempty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="main">(</span><span class="skolem">γ</span> <span class="main">+++</span> rec_join <span class="main">(</span><span class="skolem">h</span><span class="main">#</span><span class="skolem">l'</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 0 1 valid_path_join that<span class="main">(</span>4<span class="main">)</span> l_nempty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> k_eq_neg_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>7<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_chain_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="skolem">γ</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_path <span class="main">(</span>reversepath <span class="skolem">γ</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> valid_path_imp_reverse
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"pathfinish <span class="main">(</span>reversepath <span class="skolem">γ</span><span class="main">)</span> <span class="main">=</span> pathstart <span class="main">(</span>rec_join <span class="main">(</span><span class="skolem">h</span><span class="main">#</span><span class="skolem">l'</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>6<span class="main">)</span> k_eq_neg_1 l_nempty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="main">(</span><span class="main">(</span>reversepath <span class="skolem">γ</span><span class="main">)</span> <span class="main">+++</span> rec_join <span class="main">(</span><span class="skolem">h</span><span class="main">#</span><span class="skolem">l'</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 0 1 valid_path_join that<span class="main">(</span>4<span class="main">)</span> l_nempty <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ps</span><span class="main">.</span> valid_chain_list <span class="bound">ps</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">i</span> <span class="bound">f</span> <span class="bound">p</span> <span class="bound">psa</span><span class="main">.</span> <span class="bound">ps</span> <span class="main">=</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">f</span><span class="main">)</span> <span class="main">#</span> <span class="bound">p</span> <span class="main">#</span> <span class="bound">psa</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="bound">i</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> pathfinish <span class="bound">f</span> <span class="main">≠</span> pathstart <span class="main">(</span>rec_join <span class="main">(</span><span class="bound">p</span> <span class="main">#</span> <span class="bound">psa</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">1</span> <span class="main">∧</span> pathfinish <span class="main">(</span>reversepath <span class="bound">f</span><span class="main">)</span> <span class="main">≠</span> pathstart <span class="main">(</span>rec_join <span class="main">(</span><span class="bound">p</span> <span class="main">#</span> <span class="bound">psa</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">¬</span> valid_chain_list <span class="main">(</span><span class="bound">p</span> <span class="main">#</span> <span class="bound">psa</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> coeff_cube_to_path.elims valid_chain_list.elims<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"boundary_chain <span class="main">(</span>set <span class="skolem">l</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Cons.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> boundary_chain_def set_subset_Cons subset_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> * Cons <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> list.set_intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> prod.collapse valid_chain_list.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-pathstart_rec_join_1"><span class="command">lemma</span></span> pathstart_rec_join_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"pathstart <span class="main">(</span>rec_join <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="free">γ</span><span class="main">)</span> <span class="main">#</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> pathstart <span class="free">γ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pathstart <span class="main">(</span>rec_join <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="free">γ</span><span class="main">)</span> <span class="main">#</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> pathstart <span class="free">γ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="skolem"><span class="skolem">l'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> <span class="skolem">h</span><span class="main">#</span><span class="skolem">l'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> rec_join.elims<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pathstart <span class="main">(</span>rec_join <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="free">γ</span><span class="main">)</span> <span class="main">#</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> pathstart <span class="free">γ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-pathstart_rec_join_2"><span class="command">lemma</span></span> pathstart_rec_join_2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"pathstart <span class="main">(</span>rec_join <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="free">γ</span><span class="main">)</span> <span class="main">#</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> pathstart <span class="main">(</span>reversepath <span class="free">γ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pathstart <span class="main">(</span>rec_join <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="free">γ</span><span class="main">)</span> <span class="main">#</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> pathstart <span class="main">(</span>reversepath <span class="free">γ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≠</span> <span class="main">[]</span> "</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="skolem"><span class="skolem">l'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> <span class="skolem">h</span><span class="main">#</span><span class="skolem">l'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> rec_join.elims<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pathstart <span class="main">(</span>rec_join <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="free">γ</span><span class="main">)</span> <span class="main">#</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> pathstart <span class="main">(</span>reversepath <span class="free">γ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-pathstart_rec_join"><span class="command">lemma</span></span> pathstart_rec_join<span class="main">:</span>
  <span class="quoted"><span class="quoted">"pathstart <span class="main">(</span>rec_join <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="free">γ</span><span class="main">)</span> <span class="main">#</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> pathstart <span class="free">γ</span>"</span></span>
  <span class="quoted"><span class="quoted">"pathstart <span class="main">(</span>rec_join <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="free">γ</span><span class="main">)</span> <span class="main">#</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> pathstart <span class="main">(</span>reversepath <span class="free">γ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> pathstart_rec_join_1 pathstart_rec_join_2
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Paths-line_integral_exists_on_rec_join"><span class="command">lemma</span></span> line_integral_exists_on_rec_join<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> boundary_chain<span class="main">:</span> <span class="quoted"><span class="quoted">"boundary_chain <span class="main">(</span>set <span class="free">l</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    valid_chain_list<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_chain_list <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    valid_path<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span> <span class="bound">γ</span><span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">l</span> <span class="main">⟹</span> valid_path <span class="bound">γ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    line_integral_exists<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">l</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>rec_join <span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> line_integral_exists_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Derivative.vector_derivative_const_at
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Derivative.vector_derivative_const_at
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Derivative.vector_derivative_const_at
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gamma_deriv_at_within<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> <span class="free">F</span> <span class="main">0</span> <span class="main">∙</span> <span class="bound">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 0<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> <span class="free">F</span> <span class="main">0</span> <span class="main">∙</span> <span class="bound">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="main">0</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> has_integral_is_0<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> <span class="free">F</span> <span class="main">0</span> <span class="main">∙</span> <span class="bound">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">l</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="skolem"><span class="skolem">γ</span></span> <span class="keyword2"><span class="keyword">where</span></span> aeq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">γ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> aeq
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> l_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>rec_join <span class="main">(</span><span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Cons.prems aeq line_integral_on_reverse_path<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="skolem"><span class="skolem">l'</span></span> <span class="keyword2"><span class="keyword">where</span></span> l_nempty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> <span class="skolem">h</span><span class="main">#</span><span class="skolem">l'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> rec_join.elims<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>rec_join <span class="main">(</span><span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_nempty<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> k_eq_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Cons.prems<span class="main">(</span>4<span class="main">)</span> aeq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>rec_join <span class="skolem">l</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> Cons boundary_chain_def list.set_intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> valid_chain_list.elims<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> valid_chain_list.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_path <span class="skolem">γ</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Cons aeq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span><span class="quoted"><span class="quoted">"valid_path <span class="main">(</span>rec_join <span class="skolem">l</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> Cons.prems boundary_chain_def joined_is_valid l_nempty set_subset_Cons subsetCE valid_chain_list.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="skolem">γ</span> <span class="main">+++</span> rec_join <span class="main">(</span><span class="skolem">h</span><span class="main">#</span><span class="skolem">l'</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> line_integral_distrib<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 0 1 2 3<span class="main">]</span> assms l_nempty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> k_eq_neg_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Cons aeq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_chain_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> gamma_valid<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_path <span class="skolem">γ</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Cons aeq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_path <span class="main">(</span>reversepath <span class="skolem">γ</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> valid_path_imp_reverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Cons aeq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>reversepath <span class="skolem">γ</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> line_integral_on_reverse_path<span class="main">(</span>2<span class="main">)</span> gamma_valid
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>rec_join <span class="skolem">l</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Cons aeq
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> boundary_chain_def insert_iff list.set<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> list.set_intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> valid_chain_list.elims<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> valid_chain_list.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span><span class="quoted"><span class="quoted">"valid_path <span class="main">(</span>rec_join <span class="skolem">l</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> Cons.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Cons.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> Cons.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> boundary_chain_def joined_is_valid l_nempty set_subset_Cons subsetCE valid_chain_list.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="main">(</span>reversepath <span class="skolem">γ</span><span class="main">)</span> <span class="main">+++</span> rec_join <span class="main">(</span><span class="skolem">h</span><span class="main">#</span><span class="skolem">l'</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> line_integral_distrib<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 0 1 2 3<span class="main">]</span> assms l_nempty
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-line_integral_exists_rec_join_cons"><span class="command">lemma</span></span> line_integral_exists_rec_join_cons<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>rec_join <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span> <span class="main">#</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">k'</span> <span class="bound">γ'</span><span class="main">.</span> <span class="main">(</span><span class="bound">k'</span><span class="main">,</span> <span class="bound">γ'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span> <span class="main">#</span> <span class="free">l</span><span class="main">)</span> <span class="main">⟹</span> valid_path <span class="bound">γ'</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"finite <span class="free">basis</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="free">γ</span> <span class="main">+++</span> <span class="main">(</span>rec_join <span class="free">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> l_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="free">γ</span> <span class="main">+++</span> rec_join <span class="free">l</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> line_integral_distrib<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> line_integral_exists_on_degenerate_path<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> degenerate_path_is_valid_path
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_empty<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="skolem"><span class="skolem">l'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> <span class="skolem">h</span><span class="main">#</span><span class="skolem">l'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> rec_join.elims<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="free">γ</span> <span class="main">+++</span> rec_join <span class="free">l</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-line_integral_exists_rec_join_cons_2"><span class="command">lemma</span></span> line_integral_exists_rec_join_cons_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>rec_join <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span> <span class="main">#</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">k'</span> <span class="bound">γ'</span><span class="main">.</span> <span class="main">(</span><span class="bound">k'</span><span class="main">,</span> <span class="bound">γ'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span> <span class="main">#</span> <span class="free">l</span><span class="main">)</span> <span class="main">⟹</span> valid_path <span class="bound">γ'</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"finite <span class="free">basis</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="main">(</span>reversepath <span class="free">γ</span><span class="main">)</span> <span class="main">+++</span> <span class="main">(</span>rec_join <span class="free">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> l_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="main">(</span>reversepath <span class="free">γ</span><span class="main">)</span> <span class="main">+++</span> rec_join <span class="free">l</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> line_integral_distrib<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> line_integral_exists_on_degenerate_path<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> degenerate_path_is_valid_path
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_empty<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="skolem"><span class="skolem">l'</span></span> <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> <span class="skolem">h</span><span class="main">#</span><span class="skolem">l'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> rec_join.elims<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="main">(</span>reversepath <span class="free">γ</span><span class="main">)</span> <span class="main">+++</span> rec_join <span class="free">l</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-line_integral_exists_on_rec_join'"><span class="command">lemma</span></span> line_integral_exists_on_rec_join'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> boundary_chain<span class="main">:</span> <span class="quoted"><span class="quoted">"boundary_chain <span class="main">(</span>set <span class="free">l</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    valid_chain_list<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_chain_list <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    valid_path<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span> <span class="bound">γ</span><span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">l</span> <span class="main">⟹</span> valid_path <span class="bound">γ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    line_integral_exists<span class="main">:</span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>rec_join <span class="free">l</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    finite_basis<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">basis</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">l</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> line_integral_exists_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> ass<span class="main">:</span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">l</span><span class="main">)</span>          
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="skolem"><span class="skolem">γ</span></span> <span class="keyword2"><span class="keyword">where</span></span> k_gamma<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">γ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> k_gamma<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> k_eq_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="skolem">γ</span> <span class="main">+++</span> <span class="main">(</span>rec_join <span class="skolem">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> line_integral_exists_rec_join_cons k_eq_1 k_gamma ass<span class="main">(</span>4<span class="main">)</span> ass<span class="main">(</span>5<span class="main">)</span> ass<span class="main">(</span>6<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_path <span class="skolem">γ</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ass k_gamma <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> line_integral_exists_joinD1<span class="main">[</span><span class="operator">OF</span> 0 2<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> k_eq_neg_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ass k_gamma
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_chain_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="main">(</span>reversepath <span class="skolem">γ</span><span class="main">)</span> <span class="main">+++</span> <span class="main">(</span>rec_join <span class="skolem">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> line_integral_exists_rec_join_cons_2<span class="main">[</span><span class="operator">OF</span> <span class="main">]</span> k_eq_neg_1 k_gamma ass<span class="main">(</span>4<span class="main">)</span> ass<span class="main">(</span>5<span class="main">)</span> ass<span class="main">(</span>6<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">have</span></span> gamma_valid<span class="main">:</span>
        <span class="quoted"><span class="quoted">"valid_path <span class="skolem">γ</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ass k_gamma <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_path <span class="main">(</span>reversepath <span class="skolem">γ</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> valid_path_imp_reverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>reversepath <span class="skolem">γ</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> line_integral_exists_joinD1<span class="main">[</span><span class="operator">OF</span> 0 2<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="skolem">γ</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> line_integral_on_reverse_path<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 2<span class="main">]</span> reversepath_reversepath
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span><span class="quoted"><span class="quoted">"boundary_chain <span class="main">(</span>set <span class="skolem">l</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ass<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_chain_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"valid_chain_list <span class="skolem">l</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ass<span class="main">(</span>3<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> k_gamma<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> valid_chain_list.elims<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> valid_chain_list.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">k</span> <span class="bound">γ</span><span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">l</span><span class="main">)</span> <span class="main">⟹</span> valid_path <span class="bound">γ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ass<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_path <span class="main">(</span>rec_join <span class="skolem">l</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> joined_is_valid<span class="main">[</span><span class="operator">OF</span> 0<span class="main">]</span> 1 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>rec_join <span class="skolem">l</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> k_eq_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="skolem">γ</span> <span class="main">+++</span> <span class="main">(</span>rec_join <span class="skolem">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> line_integral_exists_rec_join_cons k_eq_1 k_gamma ass<span class="main">(</span>4<span class="main">)</span> ass<span class="main">(</span>5<span class="main">)</span> ass<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>rec_join <span class="skolem">l</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> line_integral_exists_joinD2<span class="main">[</span><span class="operator">OF</span> 0 3<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> k_eq_neg_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ass k_gamma
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_chain_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="main">(</span>reversepath <span class="skolem">γ</span><span class="main">)</span> <span class="main">+++</span> <span class="main">(</span>rec_join <span class="skolem">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> line_integral_exists_rec_join_cons_2<span class="main">[</span><span class="operator">OF</span> <span class="main">]</span> k_eq_neg_1 k_gamma ass<span class="main">(</span>4<span class="main">)</span> ass<span class="main">(</span>5<span class="main">)</span> ass<span class="main">(</span>6<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>rec_join <span class="skolem">l</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> line_integral_exists_joinD2<span class="main">[</span><span class="operator">OF</span> 0 3<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">l</span> <span class="main">⟹</span> line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="bound">b</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 0 1 2 3 4 ass<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 0 1 2<span class="main">]</span> ass<span class="main">(</span>6<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">chain_subdiv_path</span>
  <span class="keyword2"><span class="keyword">where</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">chain_subdiv_path</span> <span class="free"><span class="bound"><span class="entity">γ</span></span></span> <span class="main">(</span>set <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free"><span class="bound"><span class="entity">l</span></span></span>"</span></span> <span class="quoted"><span class="quoted">"rec_join <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">γ</span></span></span>"</span></span> <span class="quoted"><span class="quoted">"valid_chain_list <span class="free"><span class="bound"><span class="entity">l</span></span></span>"</span></span>

<span class="keyword1" id="Paths-valid_path_equiv_valid_chain_list"><span class="command">lemma</span></span> valid_path_equiv_valid_chain_list<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path_eq_chain<span class="main">:</span> <span class="quoted"><span class="quoted">"chain_subdiv_path <span class="free">γ</span> <span class="free">one_chain</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"boundary_chain <span class="free">one_chain</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">one_chain</span><span class="main">.</span> valid_path <span class="bound">γ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="free">γ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> l_props<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">l</span> <span class="main">=</span> <span class="free">one_chain</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">l</span>"</span></span> <span class="quoted"><span class="quoted">"rec_join <span class="skolem">l</span> <span class="main">=</span> <span class="free">γ</span>"</span></span> <span class="quoted"><span class="quoted">"valid_chain_list <span class="skolem">l</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> chain_subdiv_path.cases path_eq_chain <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="free">γ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> joined_is_valid assms l_props <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-line_integral_rec_join_cons"><span class="command">lemma</span></span> line_integral_rec_join_cons<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="free">γ</span>"</span></span>
    <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>rec_join <span class="main">(</span><span class="main">(</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">k'</span> <span class="bound">γ'</span><span class="main">.</span> <span class="main">(</span><span class="bound">k'</span><span class="main">,</span> <span class="bound">γ'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span> <span class="main">#</span> <span class="free">l</span><span class="main">)</span> <span class="main">⟹</span> valid_path <span class="bound">γ'</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"finite <span class="free">basis</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>rec_join <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span> <span class="main">#</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="free">γ</span> <span class="main">+++</span> <span class="main">(</span>rec_join <span class="free">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> l_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>rec_join <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span> <span class="main">#</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="free">γ</span> <span class="main">+++</span> <span class="main">(</span>rec_join <span class="free">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms line_integral_distrib<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> line_integral_exists_on_degenerate_path<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_empty<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> degenerate_path_is_valid_path line_integral_degenerate_path
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="skolem"><span class="skolem">l'</span></span> <span class="keyword2"><span class="keyword">where</span></span> l_nempty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> <span class="skolem">h</span><span class="main">#</span><span class="skolem">l'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> rec_join.elims<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>rec_join <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span> <span class="main">#</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="free">γ</span> <span class="main">+++</span> <span class="main">(</span>rec_join <span class="free">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_nempty<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-line_integral_rec_join_cons_2"><span class="command">lemma</span></span> line_integral_rec_join_cons_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="free">γ</span>"</span></span>
    <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>rec_join <span class="main">(</span><span class="main">(</span><span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">k'</span> <span class="bound">γ'</span><span class="main">.</span> <span class="main">(</span><span class="bound">k'</span><span class="main">,</span> <span class="bound">γ'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span> <span class="main">#</span> <span class="free">l</span><span class="main">)</span> <span class="main">⟹</span> valid_path <span class="bound">γ'</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"finite <span class="free">basis</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>rec_join <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span> <span class="main">#</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="main">(</span>reversepath <span class="free">γ</span><span class="main">)</span> <span class="main">+++</span> <span class="main">(</span>rec_join <span class="free">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> l_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>reversepath <span class="free">γ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms line_integral_on_reverse_path<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_path <span class="main">(</span>reversepath <span class="free">γ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>rec_join <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span> <span class="main">#</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="main">(</span>reversepath <span class="free">γ</span><span class="main">)</span> <span class="main">+++</span> <span class="main">(</span>rec_join <span class="free">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms line_integral_distrib<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 0 line_integral_exists_on_degenerate_path<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_empty<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> degenerate_path_is_valid_path line_integral_degenerate_path
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="skolem"><span class="skolem">l'</span></span> <span class="keyword2"><span class="keyword">where</span></span> l_nempty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> <span class="skolem">h</span><span class="main">#</span><span class="skolem">l'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> rec_join.elims<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>rec_join <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span> <span class="main">#</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="main">(</span>reversepath <span class="free">γ</span><span class="main">)</span> <span class="main">+++</span> <span class="main">(</span>rec_join <span class="free">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_nempty<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-one_chain_line_integral_rec_join"><span class="command">lemma</span></span> one_chain_line_integral_rec_join<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> l_props<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">l</span> <span class="main">=</span> <span class="free">one_chain</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">l</span>"</span></span> <span class="quoted"><span class="quoted">"valid_chain_list <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    boundary_chain<span class="main">:</span> <span class="quoted"><span class="quoted">"boundary_chain <span class="free">one_chain</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    line_integral_exists<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">one_chain</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    valid_path<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">one_chain</span><span class="main">.</span> valid_path <span class="bound">γ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    finite_basis<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">basis</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>rec_join <span class="free">l</span><span class="main">)</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">one_chain</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"sum_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">)</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">)</span> <span class="main">*</span> <span class="main">(</span>line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span><span class="main">)</span><span class="main">)</span> <span class="free">l</span><span class="main">)</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">one_chain</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> one_chain_line_integral_def
    <span class="keyword1"><span class="command">using</span></span> l_props Groups_List.comm_monoid_add_class.sum.distinct_set_conv_list<span class="main">[</span><span class="operator">OF</span> l_props<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">)</span> <span class="main">*</span> <span class="main">(</span>line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_chain_list <span class="free">l</span> <span class="main">⟹</span>
                    boundary_chain <span class="main">(</span>set <span class="free">l</span><span class="main">)</span> <span class="main">⟹</span>
                    <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">l</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">⟹</span>
                    <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">l</span><span class="main">.</span> valid_path <span class="bound">γ</span><span class="main">)</span> <span class="main">⟹</span>
                    line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>rec_join <span class="free">l</span><span class="main">)</span> <span class="main">=</span> sum_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> <span class="main">(</span>line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span><span class="main">)</span><span class="main">)</span> <span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> line_integral_def boundary_chain_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Derivative.vector_derivative_const_at
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Derivative.vector_derivative_const_at
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Derivative.vector_derivative_const_at
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> box_real<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> vector_derivative_within_cbox zero_less_one<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> <span class="free">F</span> <span class="main">0</span> <span class="main">∙</span> <span class="bound">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 0<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> <span class="free">F</span> <span class="main">0</span> <span class="main">∙</span> <span class="bound">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="main">0</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> has_integral_is_0<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> ass<span class="main">:</span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">l</span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span><span class="main">::</span><span class="quoted"><span class="quoted">"int"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="skolem"><span class="skolem">γ</span></span><span class="main">::</span><span class="quoted"><span class="quoted">"one_cube"</span></span> <span class="keyword2"><span class="keyword">where</span></span> props<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">γ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?k2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?γ2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"snd <span class="skolem">a</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="var">?k2</span><span class="main">,</span> <span class="var">?γ2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>rec_join <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> line_integral_exists_on_rec_join<span class="main">[</span><span class="operator">OF</span> ass<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> ass<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> ass<span class="main">(</span>5<span class="main">)</span> ass<span class="main">(</span>4<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"boundary_chain <span class="main">(</span>set <span class="skolem">l</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ass.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> boundary_chain_def list.set_intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> val_l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">f</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">l</span> <span class="main">⟹</span> valid_path <span class="bound">f</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ass.prems<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> vcl_l<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_chain_list <span class="skolem">l</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> ass.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> valid_chain_list.elims<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> valid_chain_list.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> line_integral_exists_on_joined<span class="main">:</span>
      <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>rec_join <span class="skolem">l</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹boundary_chain <span class="main">(</span>set <span class="skolem">l</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>rec_join <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">l</span><span class="main">)</span><span class="main">)</span>›</span></span> emptyE val_l vcl_l joined_is_valid line_integral_exists_joinD2 line_integral_exists_on_rec_join list.set<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> neq_Nil_conv rec_join.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="main">(</span>rec_join <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> joined_is_valid ass<span class="main">(</span>5<span class="main">)</span> ass<span class="main">(</span>3<span class="main">)</span> ass<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> joined_is_valid<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_path <span class="main">(</span>rec_join <span class="skolem">l</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹boundary_chain <span class="main">(</span>set <span class="skolem">l</span><span class="main">)</span>›</span></span> val_l vcl_l joined_is_valid <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> k_eq_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span><span class="main">::</span>int<span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> line_integral_exists_on_gamma<span class="main">:</span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ass props <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> gamma_is_valid<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_path <span class="skolem">γ</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ass props <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> line_int_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>rec_join <span class="main">(</span><span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="skolem">γ</span> <span class="main">+++</span> rec_join <span class="skolem">l</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> gam_int<span class="main">:</span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ass props <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> rec_join_int<span class="main">:</span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>rec_join <span class="skolem">l</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> line_integral_exists_on_rec_join
          <span class="keyword1"><span class="command">using</span></span> line_integral_exists_on_joined <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> line_integral_rec_join_cons<span class="main">[</span><span class="operator">OF</span> gam_int rec_join_int<span class="main">]</span> ass k_eq_1 finite_basis props <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>rec_join <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
            <span class="main">(</span><span class="keyword1">case</span> <span class="skolem">a</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">⇒</span> real_of_int <span class="bound">x</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">←</span><span class="skolem">l</span><span class="main">.</span> real_of_int <span class="bound">x</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> props line_int_rw<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> line_integral_distrib<span class="main">[</span><span class="operator">OF</span> line_integral_exists_on_gamma line_integral_exists_on_joined gamma_is_valid joined_is_valid<span class="main">]</span>
          ass k_eq_1 vcl_l
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> boundary_chain_def props<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> k_eq_neg_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ass props
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_chain_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> line_integral_exists_on_gamma<span class="main">:</span>
        <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>reversepath <span class="skolem">γ</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> line_integral_on_reverse_path ass props
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> gamma_is_valid<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_path <span class="main">(</span>reversepath <span class="skolem">γ</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> valid_path_imp_reverse ass props <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> line_int_rw<span class="main">:</span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>rec_join <span class="main">(</span><span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="main">(</span>reversepath <span class="skolem">γ</span><span class="main">)</span> <span class="main">+++</span> rec_join <span class="skolem">l</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> gam_int<span class="main">:</span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ass props <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> rec_join_int<span class="main">:</span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>rec_join <span class="skolem">l</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> line_integral_exists_on_rec_join
          <span class="keyword1"><span class="command">using</span></span> line_integral_exists_on_joined <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> line_integral_rec_join_cons_2<span class="main">[</span><span class="operator">OF</span> gam_int rec_join_int<span class="main">]</span>
          <span class="keyword1"><span class="command">using</span></span> ass k_eq_neg_1
          <span class="keyword1"><span class="command">using</span></span> finite_basis props <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>rec_join <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
            <span class="main">(</span><span class="keyword1">case</span> <span class="skolem">a</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">⇒</span> real_of_int <span class="bound">x</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">←</span><span class="skolem">l</span><span class="main">.</span> real_of_int <span class="bound">x</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> props line_int_rw<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> line_integral_distrib<span class="main">[</span><span class="operator">OF</span> line_integral_exists_on_gamma line_integral_exists_on_joined gamma_is_valid joined_is_valid<span class="main">]</span>
          props ass line_integral_on_reverse_path<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">γ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">basis</span>"</span></span><span class="main">]</span> k_eq_neg_1
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹boundary_chain <span class="main">(</span>set <span class="skolem">l</span><span class="main">)</span>›</span></span> vcl_l <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>rec_join <span class="free">l</span><span class="main">)</span> <span class="main">=</span> sum_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> <span class="main">(</span>line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span><span class="main">)</span><span class="main">)</span> <span class="free">l</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> l_props assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> 0 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-line_integral_on_path_eq_line_integral_on_equiv_chain"><span class="command">lemma</span></span> line_integral_on_path_eq_line_integral_on_equiv_chain<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path_eq_chain<span class="main">:</span> <span class="quoted"><span class="quoted">"chain_subdiv_path <span class="free">γ</span> <span class="free">one_chain</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    boundary_chain<span class="main">:</span> <span class="quoted"><span class="quoted">"boundary_chain <span class="free">one_chain</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    line_integral_exists<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">one_chain</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    valid_path<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">one_chain</span><span class="main">.</span> valid_path <span class="bound">γ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    finite_basis<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">basis</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">one_chain</span> <span class="main">=</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">γ</span>"</span></span>
    <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="free">γ</span>"</span></span>
    <span class="quoted"><span class="quoted">"valid_path <span class="free">γ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> l_props<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">l</span> <span class="main">=</span> <span class="free">one_chain</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">l</span>"</span></span> <span class="quoted"><span class="quoted">"rec_join <span class="skolem">l</span> <span class="main">=</span> <span class="free">γ</span>"</span></span> <span class="quoted"><span class="quoted">"valid_chain_list <span class="skolem">l</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> chain_subdiv_path.cases path_eq_chain <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="free">γ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> line_integral_exists_on_rec_join assms l_props
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="free">γ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> joined_is_valid assms l_props
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>rec_join <span class="skolem">l</span><span class="main">)</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">one_chain</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> one_chain_line_integral_rec_join l_props assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">one_chain</span> <span class="main">=</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">γ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> l_props
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-line_integral_on_path_eq_line_integral_on_equiv_chain'"><span class="command">lemma</span></span> line_integral_on_path_eq_line_integral_on_equiv_chain'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path_eq_chain<span class="main">:</span> <span class="quoted"><span class="quoted">"chain_subdiv_path <span class="free">γ</span> <span class="free">one_chain</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    boundary_chain<span class="main">:</span> <span class="quoted"><span class="quoted">"boundary_chain <span class="free">one_chain</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    line_integral_exists<span class="main">:</span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="free">γ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    valid_path<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">one_chain</span><span class="main">.</span> valid_path <span class="bound">γ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    finite_basis<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">basis</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">one_chain</span> <span class="main">=</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">γ</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">one_chain</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> l_props<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">l</span> <span class="main">=</span> <span class="free">one_chain</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">l</span>"</span></span> <span class="quoted"><span class="quoted">"rec_join <span class="skolem">l</span> <span class="main">=</span> <span class="free">γ</span>"</span></span> <span class="quoted"><span class="quoted">"valid_chain_list <span class="skolem">l</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> chain_subdiv_path.cases path_eq_chain <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">show</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">one_chain</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> line_integral_exists_on_rec_join' assms l_props
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">one_chain</span> <span class="main">=</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">γ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> line_integral_on_path_eq_line_integral_on_equiv_chain<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 0 assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">chain_subdiv_chain</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">chain_subdiv_chain</span> <span class="free"><span class="bound"><span class="entity">one_chain1</span></span></span> <span class="free"><span class="bound"><span class="entity">subdiv</span></span></span>
        <span class="main">≡</span> <span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="bound">f</span> <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">one_chain1</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">subdiv</span></span></span> <span class="main">∧</span>
              <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">one_chain1</span></span></span><span class="main">.</span> chain_subdiv_path <span class="main">(</span>coeff_cube_to_path <span class="bound">c</span><span class="main">)</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">c</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
              pairwise <span class="main">(</span><span class="main">λ</span> <span class="bound">p</span> <span class="bound">p'</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">p</span> <span class="main">∩</span> <span class="bound">f</span> <span class="bound">p'</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">one_chain1</span></span></span> <span class="main">∧</span>
              <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">one_chain1</span></span></span><span class="main">.</span> finite <span class="main">(</span><span class="bound">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Paths-chain_subdiv_chain_character"><span class="command">lemma</span></span> chain_subdiv_chain_character<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"chain_subdiv_chain <span class="free">one_chain1</span> <span class="free">subdiv</span> <span class="main">⟷</span>
        <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="main">⋃</span><span class="main">(</span><span class="bound">f</span> <span class="main">`</span> <span class="free">one_chain1</span><span class="main">)</span> <span class="main">=</span> <span class="free">subdiv</span> <span class="main">∧</span>
             <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain1</span><span class="main">.</span>
                 <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="main">1</span>
                 <span class="keyword1">then</span> chain_subdiv_path <span class="bound">γ</span> <span class="main">(</span><span class="bound">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">)</span>
                 <span class="keyword1">else</span> chain_subdiv_path <span class="main">(</span>reversepath <span class="bound">γ</span><span class="main">)</span> <span class="main">(</span><span class="bound">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
             <span class="main">(</span><span class="main">∀</span><span class="bound">p</span><span class="main">∈</span><span class="free">one_chain1</span><span class="main">.</span>
                 <span class="main">∀</span><span class="bound">p'</span><span class="main">∈</span><span class="free">one_chain1</span><span class="main">.</span> <span class="bound">p</span> <span class="main">≠</span> <span class="bound">p'</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="bound">p</span> <span class="main">∩</span> <span class="bound">f</span> <span class="bound">p'</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∧</span>
             <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">one_chain1</span><span class="main">.</span> finite <span class="main">(</span><span class="bound">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>  
  <span class="keyword1"><span class="command">unfolding</span></span> chain_subdiv_chain_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">intro</span> exI conjI iffI<span class="main"><span class="keyword3">;</span></span> <span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pairwise_def<span class="main">)</span>

<span class="keyword1" id="Paths-chain_subdiv_chain_imp_finite_subdiv"><span class="command">lemma</span></span> chain_subdiv_chain_imp_finite_subdiv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">one_chain1</span>"</span></span>
    <span class="quoted"><span class="quoted">"chain_subdiv_chain <span class="free">one_chain1</span> <span class="free">subdiv</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">subdiv</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> chain_subdiv_chain_def<span class="main">)</span>

<span class="keyword1" id="Paths-valid_subdiv_imp_valid_one_chain"><span class="command">lemma</span></span> valid_subdiv_imp_valid_one_chain<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> chain1_eq_chain2<span class="main">:</span> <span class="quoted"><span class="quoted">"chain_subdiv_chain <span class="free">one_chain1</span> <span class="free">subdiv</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    boundary_chain1<span class="main">:</span> <span class="quoted"><span class="quoted">"boundary_chain <span class="free">one_chain1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    boundary_chain2<span class="main">:</span> <span class="quoted"><span class="quoted">"boundary_chain <span class="free">subdiv</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    valid_path<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">subdiv</span><span class="main">.</span> valid_path <span class="bound">γ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">one_chain1</span><span class="main">.</span> valid_path <span class="bound">γ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f_props<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="free">one_chain1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">subdiv</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain1</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> chain_subdiv_path <span class="bound">γ</span> <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> chain_subdiv_path <span class="main">(</span>reversepath <span class="bound">γ</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">p</span><span class="main">∈</span><span class="free">one_chain1</span><span class="main">.</span> <span class="main">∀</span><span class="bound">p'</span><span class="main">∈</span><span class="free">one_chain1</span><span class="main">.</span> <span class="bound">p</span> <span class="main">≠</span> <span class="bound">p'</span> <span class="main">⟶</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">∩</span> <span class="skolem">f</span> <span class="bound">p'</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> chain1_eq_chain2 chain_subdiv_chain_character <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">k</span> <span class="bound">γ</span><span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">one_chain1</span><span class="main">⟹</span> valid_path <span class="bound">γ</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="skolem">γ</span>
    <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">one_chain1</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="skolem">γ</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> k_eq_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span><span class="quoted"><span class="quoted">"chain_subdiv_path <span class="skolem">γ</span> <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>2<span class="main">)</span> ass <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span><span class="quoted"><span class="quoted">"boundary_chain <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>1<span class="main">)</span> ass assms
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_chain_def<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted">"iv"</span><span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">.</span> valid_path <span class="bound">γ</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>1<span class="main">)</span> ass assms
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> valid_path_equiv_valid_chain_list<span class="main">[</span><span class="operator">OF</span> i ii iv<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> k_eq_neg1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ass boundary_chain1
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_chain_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span><span class="quoted"><span class="quoted">"chain_subdiv_path <span class="main">(</span>reversepath <span class="skolem">γ</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>2<span class="main">)</span> ass <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">≠</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span><span class="quoted"><span class="quoted">"boundary_chain <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>1<span class="main">)</span> ass assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_chain_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted">"iv"</span><span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">.</span> valid_path <span class="bound">γ</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>1<span class="main">)</span> ass assms
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="main">(</span>reversepath <span class="skolem">γ</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> valid_path_equiv_valid_chain_list<span class="main">[</span><span class="operator">OF</span> i ii iv<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span>  reversepath_reversepath valid_path_imp_reverse
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> valid_path1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">one_chain1</span><span class="main">.</span> valid_path <span class="bound">γ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-one_chain_line_integral_eq_line_integral_on_sudivision"><span class="command">lemma</span></span> one_chain_line_integral_eq_line_integral_on_sudivision<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> chain1_eq_chain2<span class="main">:</span> <span class="quoted"><span class="quoted">"chain_subdiv_chain <span class="free">one_chain1</span> <span class="free">subdiv</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    boundary_chain1<span class="main">:</span> <span class="quoted"><span class="quoted">"boundary_chain <span class="free">one_chain1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    boundary_chain2<span class="main">:</span> <span class="quoted"><span class="quoted">"boundary_chain <span class="free">subdiv</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    line_integral_exists_on_chain2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">subdiv</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    valid_path<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">subdiv</span><span class="main">.</span> valid_path <span class="bound">γ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    finite_chain1<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">one_chain1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    finite_basis<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">basis</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">one_chain1</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">subdiv</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">one_chain1</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f_props<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="free">one_chain1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">subdiv</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain1</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> chain_subdiv_path <span class="bound">γ</span> <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> chain_subdiv_path <span class="main">(</span>reversepath <span class="bound">γ</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">p</span><span class="main">∈</span><span class="free">one_chain1</span><span class="main">.</span> <span class="main">∀</span><span class="bound">p'</span><span class="main">∈</span><span class="free">one_chain1</span><span class="main">.</span> <span class="bound">p</span> <span class="main">≠</span> <span class="bound">p'</span> <span class="main">⟶</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">∩</span> <span class="skolem">f</span> <span class="bound">p'</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">one_chain1</span><span class="main">.</span> finite <span class="main">(</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> chain1_eq_chain2 chain_subdiv_chain_character <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pairwise_def chain_subdiv_chain_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">subdiv</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="free">one_chain1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> finite_chain2<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">subdiv</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> finite_chain1 f_props<span class="main">(</span>1<span class="main">)</span> f_props<span class="main">(</span>4<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_def<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">k</span> <span class="bound">γ</span><span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">one_chain1</span><span class="main">⟹</span> line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="skolem">γ</span>
    <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">one_chain1</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> k_eq_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span><span class="quoted"><span class="quoted">"chain_subdiv_path <span class="skolem">γ</span> <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>2<span class="main">)</span> ass <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span><span class="quoted"><span class="quoted">"boundary_chain <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>1<span class="main">)</span> ass assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_chain_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> iii<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>1<span class="main">)</span> ass assms
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted">"iv"</span><span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">.</span> valid_path <span class="bound">γ</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>1<span class="main">)</span> ass assms
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> line_integral_on_path_eq_line_integral_on_equiv_chain<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> i ii iii iv finite_basis<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> k_eq_neg1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ass boundary_chain1
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_chain_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span><span class="quoted"><span class="quoted">"chain_subdiv_path <span class="main">(</span>reversepath <span class="skolem">γ</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>2<span class="main">)</span> ass <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span><span class="quoted"><span class="quoted">"boundary_chain <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>1<span class="main">)</span> ass assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_chain_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> iii<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>1<span class="main">)</span> ass assms
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted">"iv"</span><span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">.</span> valid_path <span class="bound">γ</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>1<span class="main">)</span> ass assms
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span><span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>reversepath <span class="skolem">γ</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> line_integral_on_path_eq_line_integral_on_equiv_chain<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> i ii iii iv finite_basis<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="main">(</span>reversepath <span class="skolem">γ</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> line_integral_on_path_eq_line_integral_on_equiv_chain<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> i ii iii iv finite_basis<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> line_integral_on_reverse_path<span class="main">(</span>2<span class="main">)</span> reversepath_reversepath x
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> line_integral_exists_on_chain1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">one_chain1</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="free">one_chain1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">one_chain1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span><span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="free">one_chain1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                           <span class="main">(</span><span class="main">∑</span><span class="bound">one_chain</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="free">one_chain1</span><span class="main">)</span><span class="main">.</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">one_chain</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> finite<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">chain</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="free">one_chain1</span><span class="main">)</span><span class="main">.</span> finite <span class="bound">chain</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>1<span class="main">)</span> finite_chain2
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Sup_upper finite_subset<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> disj<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">A</span><span class="main">∈</span><span class="skolem">f</span> <span class="main">`</span> <span class="free">one_chain1</span><span class="main">.</span> <span class="main">∀</span><span class="bound">B</span><span class="main">∈</span><span class="skolem">f</span> <span class="main">`</span> <span class="free">one_chain1</span><span class="main">.</span> <span class="bound">A</span> <span class="main">≠</span> <span class="bound">B</span> <span class="main">⟶</span> <span class="bound">A</span> <span class="main">∩</span> <span class="bound">B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> f_props<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> image_iff<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="free">one_chain1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                                <span class="main">(</span><span class="main">∑</span><span class="bound">one_chain</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="free">one_chain1</span><span class="main">)</span><span class="main">.</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">one_chain</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Groups_Big.comm_monoid_add_class.sum.Union_disjoint<span class="main">[</span><span class="operator">OF</span> finite disj<span class="main">]</span>
          one_chain_line_integral_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">one_chain</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="free">one_chain1</span><span class="main">)</span><span class="main">.</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">one_chain</span><span class="main">)</span> <span class="main">=</span>
                            one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">one_chain1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">one_chain</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="free">one_chain1</span><span class="main">)</span><span class="main">.</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">one_chain</span><span class="main">)</span> <span class="main">=</span>
                                     <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain1</span><span class="main">.</span> <span class="bound">k</span><span class="main">*</span><span class="main">(</span>line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">one_chain</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">one_chain</span><span class="main">)</span> <span class="main">=</span>
                                       <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">.</span> <span class="bound">k</span><span class="main">*</span><span class="main">(</span>line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">f</span> <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">one_chain</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">one_chain</span><span class="main">)</span>
                                                       <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> Groups_Big.comm_monoid_add_class.sum.reindex
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">k</span> <span class="bound">γ</span><span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">)</span> <span class="main">⟹</span>
                        one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="bound">k</span><span class="main">*</span> <span class="main">(</span>line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="skolem">γ</span>
            <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">have</span></span> bchain<span class="main">:</span> <span class="quoted"><span class="quoted">"boundary_chain <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>1<span class="main">)</span> boundary_chain2 ass
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_chain_def<span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> wexist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">γ</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>1<span class="main">)</span> line_integral_exists_on_chain2 ass
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">have</span></span> vpath<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> valid_path <span class="bound">γ</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>1<span class="main">)</span> assms ass
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">assume</span></span> k_eq_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>2<span class="main">)</span> k_eq_1 line_integral_on_path_eq_line_integral_on_equiv_chain bchain wexist vpath ass finite_basis
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> k_eq_1  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> k_eq_neg1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> ass boundary_chain1
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_chain_def<span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>reversepath <span class="skolem">γ</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>2<span class="main">)</span> k_eq_neg1 line_integral_on_path_eq_line_integral_on_equiv_chain bchain wexist vpath ass finite_basis
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span>line_integral <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> line_integral_on_reverse_path<span class="main">(</span>1<span class="main">)</span> ass line_integral_exists_on_chain1
                  valid_subdiv_imp_valid_one_chain<span class="main">[</span><span class="operator">OF</span> chain1_eq_chain2 boundary_chain1 boundary_chain2 valid_path<span class="main">]</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> k_eq_neg1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                   <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="bound">k</span><span class="main">*</span> <span class="main">(</span>line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Finite_Cartesian_Product.sum_cong_aux<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">one_chain</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">one_chain</span><span class="main">)</span> <span class="main">=</span>
                                                     <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="bound">k</span><span class="main">*</span> <span class="main">(</span>line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> 0  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">)</span> <span class="bound">γ</span><span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">one_chain1</span> <span class="main">⟹</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">k'</span><span class="main">,</span><span class="bound">γ'</span><span class="main">)</span><span class="main">.</span> <span class="bound">k'</span><span class="main">*</span> <span class="main">(</span>line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ'</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span><span class="main">::</span><span class="quoted"><span class="quoted">"int"</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">γ</span><span class="main">::</span><span class="quoted"><span class="quoted">"one_cube"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">one_chain1</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> zero_line_integral<span class="main">:</span><span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> one_chain_line_integral_def
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> bchain<span class="main">:</span> <span class="quoted"><span class="quoted">"boundary_chain <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>1<span class="main">)</span> boundary_chain2 ass
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_chain_def<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> wexist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">γ</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>1<span class="main">)</span> line_integral_exists_on_chain2 ass
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">have</span></span> vpath<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> valid_path <span class="bound">γ</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>1<span class="main">)</span> assms ass <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">assume</span></span> k_eq_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>2<span class="main">)</span> k_eq_1 line_integral_on_path_eq_line_integral_on_equiv_chain bchain wexist vpath ass finite_basis
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> k_eq_1
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> k_eq_neg1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> ass boundary_chain1
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_chain_def<span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>reversepath <span class="skolem">γ</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>2<span class="main">)</span> k_eq_neg1 line_integral_on_path_eq_line_integral_on_equiv_chain bchain wexist vpath ass finite_basis
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span>line_integral <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> line_integral_on_reverse_path<span class="main">(</span>1<span class="main">)</span>  ass line_integral_exists_on_chain1
                valid_subdiv_imp_valid_one_chain<span class="main">[</span><span class="operator">OF</span> chain1_eq_chain2 boundary_chain1 boundary_chain2 valid_path<span class="main">]</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">::</span>int<span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> k_eq_neg1  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">k'</span><span class="main">::</span>int<span class="main">,</span> <span class="bound">γ'</span><span class="main">)</span><span class="main">.</span> <span class="bound">k'</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ'</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> zero_line_integral <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">one_chain</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">one_chain</span><span class="main">)</span> <span class="main">=</span>
                                                          <span class="main">(</span><span class="main">∑</span><span class="bound">one_chain</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="main">(</span><span class="free">one_chain1</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">one_chain</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">one_chain</span><span class="main">.</span> <span class="bound">one_chain</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="main">(</span><span class="free">one_chain1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
                                                         one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">one_chain</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">one_chain</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">one_chain</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="main">(</span><span class="free">one_chain1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="skolem">one_chain</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_chain_line_integral_def<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">one_chain</span> <span class="main">∈</span> <span class="skolem">f</span> <span class="main">`</span> <span class="main">(</span><span class="free">one_chain1</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">one_chain</span><span class="main">)</span>
                                                       <span class="main">=</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> comm_monoid_add_class.sum.neutral <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">one_chain</span> <span class="main">∈</span> <span class="skolem">f</span> <span class="main">`</span> <span class="main">(</span><span class="free">one_chain1</span><span class="main">)</span><span class="main">.</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">one_chain</span><span class="main">)</span>
                                                      <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">one_chain</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">one_chain</span><span class="main">)</span>
                                                       <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> finte<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="free">one_chain1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_chain1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> Groups_Big.sum_diff<span class="main">[</span><span class="operator">OF</span> finte<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span>"</span></span><span class="main">]</span>
                0
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">one_chain</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">one_chain</span><span class="main">)</span> <span class="main">=</span>
                                                          <span class="main">(</span><span class="main">∑</span><span class="bound">one_chain</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="main">(</span><span class="free">one_chain1</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">one_chain</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">)</span> <span class="bound">γ</span><span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">one_chain1</span> <span class="main">⟹</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">chain</span><span class="main">.</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">chain</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span><span class="main">::</span><span class="quoted"><span class="quoted">"int"</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">γ</span><span class="main">::</span><span class="quoted"><span class="quoted">"one_cube"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">one_chain1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> one_chain_line_integral_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">p'</span><span class="main">.</span> <span class="main">(</span>one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">p'</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> iii<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">.</span> <span class="bound">k</span><span class="main">*</span><span class="main">(</span>line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span><span class="main">)</span><span class="main">)</span>
                                                 <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain1</span><span class="main">.</span> <span class="bound">k</span><span class="main">*</span><span class="main">(</span>line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">k</span> <span class="bound">γ</span><span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">)</span>
                                                    <span class="main">⟹</span> <span class="bound">k</span><span class="main">*</span> <span class="main">(</span>line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="skolem">γ</span>
            <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_chain_line_integral_def<span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> zero_line_integral<span class="main">:</span><span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> one_chain_line_integral_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">have</span></span> bchain<span class="main">:</span> <span class="quoted"><span class="quoted">"boundary_chain <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>1<span class="main">)</span> boundary_chain2 ass
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_chain_def<span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> wexist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">γ</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>1<span class="main">)</span> line_integral_exists_on_chain2 ass
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">have</span></span> vpath<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> valid_path <span class="bound">γ</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>1<span class="main">)</span> assms ass
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">assume</span></span> k_eq_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>2<span class="main">)</span> k_eq_1 line_integral_on_path_eq_line_integral_on_equiv_chain bchain wexist vpath ass finite_basis
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> k_eq_1
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> k_eq_neg1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> ass boundary_chain1
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_chain_def<span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>reversepath <span class="skolem">γ</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>2<span class="main">)</span> k_eq_neg1 line_integral_on_path_eq_line_integral_on_equiv_chain bchain wexist vpath ass finite_basis
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span>line_integral <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> line_integral_on_reverse_path<span class="main">(</span>1<span class="main">)</span>  ass line_integral_exists_on_chain1
                  valid_subdiv_imp_valid_one_chain<span class="main">[</span><span class="operator">OF</span> chain1_eq_chain2 boundary_chain1 boundary_chain2 valid_path<span class="main">]</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> k_eq_neg1
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">*</span> <span class="main">(</span>line_integral <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> zero_line_integral
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">.</span>
                                                      <span class="bound">k</span><span class="main">*</span> <span class="main">(</span>line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="bound">k</span><span class="main">*</span><span class="main">(</span>line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> Groups_Big.comm_monoid_add_class.sum.neutral
              <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">one_chain1</span> <span class="main">-</span> <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">.</span> <span class="bound">k</span><span class="main">*</span> <span class="main">(</span>line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> split_beta<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain1</span><span class="main">.</span> <span class="bound">k</span><span class="main">*</span><span class="main">(</span>line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span>
                     <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span> <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="bound">k</span><span class="main">*</span><span class="main">(</span>line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> Groups_Big.sum_diff<span class="main">[</span><span class="operator">OF</span> finite_chain1<span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> Diff_subset <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">f</span> <span class="bound">B</span><span class="main">.</span> <span class="bound">B</span> <span class="main">⊆</span> <span class="free">one_chain1</span> <span class="main">⟹</span> sum <span class="bound">f</span> <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="bound">B</span><span class="main">)</span> <span class="main">=</span> sum <span class="bound">f</span> <span class="free">one_chain1</span> <span class="main">-</span> sum <span class="bound">f</span> <span class="bound">B</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> i ii iii <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> one_chain_line_integral_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 0 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">one_chain1</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">subdiv</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 0 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-one_chain_line_integral_eq_line_integral_on_sudivision'"><span class="command">lemma</span></span> one_chain_line_integral_eq_line_integral_on_sudivision'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> chain1_eq_chain2<span class="main">:</span> <span class="quoted"><span class="quoted">"chain_subdiv_chain <span class="free">one_chain1</span> <span class="free">subdiv</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    boundary_chain1<span class="main">:</span> <span class="quoted"><span class="quoted">"boundary_chain <span class="free">one_chain1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    boundary_chain2<span class="main">:</span> <span class="quoted"><span class="quoted">"boundary_chain <span class="free">subdiv</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    line_integral_exists_on_chain1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">one_chain1</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    valid_path<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">subdiv</span><span class="main">.</span> valid_path <span class="bound">γ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    finite_chain1<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">one_chain1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    finite_basis<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">basis</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">one_chain1</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">subdiv</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">subdiv</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f_props<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="free">one_chain1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">subdiv</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain1</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> chain_subdiv_path <span class="bound">γ</span> <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> chain_subdiv_path <span class="main">(</span>reversepath <span class="bound">γ</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">p</span><span class="main">∈</span><span class="free">one_chain1</span><span class="main">.</span> <span class="main">∀</span><span class="bound">p'</span><span class="main">∈</span><span class="free">one_chain1</span><span class="main">.</span> <span class="bound">p</span> <span class="main">≠</span> <span class="bound">p'</span> <span class="main">⟶</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">∩</span> <span class="skolem">f</span> <span class="bound">p'</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">one_chain1</span><span class="main">.</span> finite <span class="main">(</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> chain1_eq_chain2 chain_subdiv_chain_character <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pairwise_def chain_subdiv_chain_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> finite_chain2<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">subdiv</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> finite_chain1 f_props<span class="main">(</span>1<span class="main">)</span> f_props<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span> <span class="bound">γ</span><span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">subdiv</span> <span class="main">⟹</span> line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="skolem">γ</span>
    <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">subdiv</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k'</span></span> <span class="skolem"><span class="skolem">γ'</span></span> <span class="keyword2"><span class="keyword">where</span></span> kp_gammap<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k'</span><span class="main">,</span><span class="skolem">γ'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">one_chain1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">f</span><span class="main">(</span><span class="skolem">k'</span><span class="main">,</span><span class="skolem">γ'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">k'</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> k_eq_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k'</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span><span class="quoted"><span class="quoted">"chain_subdiv_path <span class="skolem">γ'</span> <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">k'</span><span class="main">,</span><span class="skolem">γ'</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>2<span class="main">)</span> kp_gammap ass  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span><span class="quoted"><span class="quoted">"boundary_chain <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">k'</span><span class="main">,</span><span class="skolem">γ'</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>1<span class="main">)</span> ass assms kp_gammap  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> UN_I boundary_chain_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> iii<span class="main">:</span><span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms kp_gammap <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted">"iv"</span><span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k'</span><span class="main">,</span> <span class="skolem">γ'</span><span class="main">)</span><span class="main">.</span> valid_path <span class="bound">γ</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>1<span class="main">)</span> ass assms kp_gammap <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> line_integral_on_path_eq_line_integral_on_equiv_chain'<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> i ii iii iv finite_basis<span class="main">]</span> kp_gammap
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k'</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> k_eq_neg1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k'</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> boundary_chain1 kp_gammap
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_chain_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span><span class="quoted"><span class="quoted">"chain_subdiv_path <span class="main">(</span>reversepath <span class="skolem">γ'</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">k'</span><span class="main">,</span><span class="skolem">γ'</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>2<span class="main">)</span> kp_gammap <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span><span class="quoted"><span class="quoted">"boundary_chain <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">k'</span><span class="main">,</span><span class="skolem">γ'</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>1<span class="main">)</span> assms kp_gammap  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> UN_I boundary_chain_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> iii<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k'</span><span class="main">,</span> <span class="skolem">γ'</span><span class="main">)</span><span class="main">.</span> valid_path <span class="bound">γ</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>1<span class="main">)</span> ass assms kp_gammap <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> iv<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_path <span class="main">(</span>reversepath <span class="skolem">γ'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> valid_path_equiv_valid_chain_list<span class="main">[</span><span class="operator">OF</span> i ii iii<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms kp_gammap  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>reversepath <span class="skolem">γ'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> iv line_integral_on_reverse_path<span class="main">(</span>2<span class="main">)</span> valid_path_reversepath
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> line_integral_on_path_eq_line_integral_on_equiv_chain'<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> i ii x iii finite_basis<span class="main">]</span> kp_gammap
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">subdiv</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">one_chain1</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">subdiv</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> one_chain_line_integral_eq_line_integral_on_sudivision<span class="main">(</span>1<span class="main">)</span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-line_integral_sum_gen"><span class="command">lemma</span></span> line_integral_sum_gen<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> finite_basis<span class="main">:</span>
    <span class="quoted"><span class="quoted">"finite <span class="free">basis</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    line_integral_exists<span class="main">:</span>
    <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis1</span> <span class="free">γ</span>"</span></span>
    <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis2</span> <span class="free">γ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    basis_partition<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">basis1</span> <span class="main">∪</span> <span class="free">basis2</span> <span class="main">=</span> <span class="free">basis</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">basis1</span> <span class="main">∩</span> <span class="free">basis2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">γ</span> <span class="main">=</span> <span class="main">(</span>line_integral <span class="free">F</span>  <span class="free">basis1</span> <span class="free">γ</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>line_integral <span class="free">F</span> <span class="free">basis2</span> <span class="free">γ</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="free">γ</span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> line_integral_def<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"integral <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis1</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
                                       <span class="main">(</span><span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis2</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                    integral <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis1</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
                           integral <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis2</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Henstock_Kurzweil_Integration.integral_add line_integral_exists
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> line_integral_exists_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"integral <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                       integral <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis1</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
                                            <span class="main">(</span><span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis2</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> basis_partition finite_Un finite_basis sum.union_disjoint<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integral <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                  integral <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis1</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
                  integral <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis2</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 0 1
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis1</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
                                       <span class="main">(</span><span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis2</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span>
                    integral <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis1</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
                           integral <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis2</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Henstock_Kurzweil_Integration.has_integral_add line_integral_exists has_integral_integral
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> line_integral_exists_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                       <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis1</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
                                            <span class="main">(</span><span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis2</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> basis_partition finite_Un finite_basis sum.union_disjoint<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="free">γ</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> line_integral_exists_def has_integral_integral<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> 2 3
    <span class="keyword1"><span class="command">using</span></span> has_integral_integrable_integral <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">common_boundary_sudivision_exists</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">common_boundary_sudivision_exists</span> <span class="free"><span class="bound"><span class="entity">one_chain1</span></span></span> <span class="free"><span class="bound"><span class="entity">one_chain2</span></span></span> <span class="main">≡</span>
             <span class="main">∃</span><span class="bound">subdiv</span><span class="main">.</span> chain_subdiv_chain <span class="free"><span class="bound"><span class="entity">one_chain1</span></span></span> <span class="bound">subdiv</span> <span class="main">∧</span>
                      chain_subdiv_chain <span class="free"><span class="bound"><span class="entity">one_chain2</span></span></span> <span class="bound">subdiv</span> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">subdiv</span><span class="main">.</span> valid_path <span class="bound">γ</span><span class="main">)</span><span class="main">∧</span>
                      boundary_chain <span class="bound">subdiv</span>"</span></span>

<span class="keyword1" id="Paths-common_boundary_sudivision_commutative"><span class="command">lemma</span></span> common_boundary_sudivision_commutative<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>common_boundary_sudivision_exists <span class="free">one_chain1</span> <span class="free">one_chain2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>common_boundary_sudivision_exists <span class="free">one_chain2</span> <span class="free">one_chain1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> common_boundary_sudivision_exists_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Paths-common_subdivision_imp_eq_line_integral"><span class="command">lemma</span></span> common_subdivision_imp_eq_line_integral<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>common_boundary_sudivision_exists <span class="free">one_chain1</span> <span class="free">one_chain2</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"boundary_chain <span class="free">one_chain1</span>"</span></span>
    <span class="quoted"><span class="quoted">"boundary_chain <span class="free">one_chain2</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain1</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span>"</span></span>
    <span class="quoted"><span class="quoted">"finite <span class="free">one_chain1</span>"</span></span>
    <span class="quoted"><span class="quoted">"finite <span class="free">one_chain2</span>"</span></span>
    <span class="quoted"><span class="quoted">"finite <span class="free">basis</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">one_chain1</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">one_chain2</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain2</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">subdiv</span></span> <span class="keyword2"><span class="keyword">where</span></span> subdiv_props<span class="main">:</span>
    <span class="quoted"><span class="quoted">"chain_subdiv_chain <span class="free">one_chain1</span> <span class="skolem">subdiv</span>"</span></span>
    <span class="quoted"><span class="quoted">"chain_subdiv_chain <span class="free">one_chain2</span> <span class="skolem">subdiv</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">subdiv</span><span class="main">.</span> valid_path <span class="bound">γ</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>boundary_chain <span class="skolem">subdiv</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> common_boundary_sudivision_exists_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="skolem">subdiv</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> one_chain_line_integral_eq_line_integral_on_sudivision'<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> subdiv_props<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> subdiv_props<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> subdiv_props<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">one_chain1</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">one_chain2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> one_chain_line_integral_eq_line_integral_on_sudivision'<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> subdiv_props<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> subdiv_props<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> subdiv_props<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">]</span>
      one_chain_line_integral_eq_line_integral_on_sudivision<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> subdiv_props<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> subdiv_props<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> i subdiv_props<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain2</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> one_chain_line_integral_eq_line_integral_on_sudivision<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> subdiv_props<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> subdiv_props<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> i subdiv_props<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">common_sudiv_exists</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">common_sudiv_exists</span> <span class="free"><span class="bound"><span class="entity">one_chain1</span></span></span> <span class="free"><span class="bound"><span class="entity">one_chain2</span></span></span> <span class="main">≡</span>
        <span class="main">∃</span><span class="bound">subdiv</span> <span class="bound">ps1</span> <span class="bound">ps2</span><span class="main">.</span> chain_subdiv_chain <span class="main">(</span><span class="free"><span class="bound"><span class="entity">one_chain1</span></span></span> <span class="main">-</span> <span class="bound">ps1</span><span class="main">)</span> <span class="bound">subdiv</span> <span class="main">∧</span>
                  chain_subdiv_chain <span class="main">(</span><span class="free"><span class="bound"><span class="entity">one_chain2</span></span></span> <span class="main">-</span> <span class="bound">ps2</span><span class="main">)</span> <span class="bound">subdiv</span> <span class="main">∧</span>
                  <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">subdiv</span><span class="main">.</span> valid_path <span class="bound">γ</span><span class="main">)</span> <span class="main">∧</span>
                  <span class="main">(</span>boundary_chain <span class="bound">subdiv</span><span class="main">)</span> <span class="main">∧</span>
                  <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">ps1</span><span class="main">.</span> point_path <span class="bound">γ</span><span class="main">)</span> <span class="main">∧</span>
                  <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">ps2</span><span class="main">.</span> point_path <span class="bound">γ</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Paths-common_sudiv_exists_comm"><span class="command">lemma</span></span> common_sudiv_exists_comm<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"common_sudiv_exists <span class="free">C1</span> <span class="free">C2</span> <span class="main">=</span> common_sudiv_exists <span class="free">C2</span> <span class="free">C1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> common_sudiv_exists_def<span class="main">)</span>

<span class="keyword1" id="Paths-line_integral_degenerate_chain"><span class="command">lemma</span></span> line_integral_degenerate_chain<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">chain</span><span class="main">.</span> point_path <span class="bound">γ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">basis</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">chain</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_chain_line_integral_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">g</span><span class="main">)</span><span class="main">∈</span><span class="free">chain</span><span class="main">.</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">g</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms line_integral_point_path
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">g</span><span class="main">)</span><span class="main">∈</span><span class="free">chain</span><span class="main">.</span> real_of_int <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">g</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> <span class="free">chain</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">p</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">f</span><span class="main">)</span> <span class="main">⇒</span> real_of_int <span class="bound">i</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">f</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">chain</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⇒</span> real_of_int <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">g</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-gen_common_subdiv_imp_common_subdiv"><span class="command">lemma</span></span> gen_common_subdiv_imp_common_subdiv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>common_sudiv_exists <span class="free">one_chain1</span> <span class="free">one_chain2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ps1</span> <span class="bound">ps2</span><span class="main">.</span> <span class="main">(</span>common_boundary_sudivision_exists <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="bound">ps1</span><span class="main">)</span> <span class="main">(</span><span class="free">one_chain2</span> <span class="main">-</span> <span class="bound">ps2</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="bound">ps1</span><span class="main">.</span> point_path <span class="bound">γ</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="bound">ps2</span><span class="main">.</span> point_path <span class="bound">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> common_sudiv_exists_def common_boundary_sudivision_exists_def<span class="main">)</span>

<span class="keyword1" id="Paths-common_subdiv_imp_gen_common_subdiv"><span class="command">lemma</span></span> common_subdiv_imp_gen_common_subdiv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>common_boundary_sudivision_exists <span class="free">one_chain1</span> <span class="free">one_chain2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>common_sudiv_exists <span class="free">one_chain1</span> <span class="free">one_chain2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> common_sudiv_exists_def common_boundary_sudivision_exists_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_empty all_not_in_conv<span class="main">)</span>

<span class="keyword1" id="Paths-one_chain_line_integral_point_paths"><span class="command">lemma</span></span> one_chain_line_integral_point_paths<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">one_chain</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">basis</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">ps</span><span class="main">.</span> point_path <span class="bound">γ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="free">one_chain</span> <span class="main">-</span> <span class="free">ps</span><span class="main">)</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="free">one_chain</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">ps</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⇒</span>  <span class="main">(</span>real_of_int <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">g</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> line_integral_point_path assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="free">one_chain</span> <span class="main">-</span> <span class="free">ps</span><span class="main">)</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">one_chain</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> one_chain_line_integral_def <span class="keyword1"><span class="command">using</span></span> 0 <span class="quoted"><span class="quoted">‹finite <span class="free">one_chain</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> comm_monoid_add_class.sum.mono_neutral_left<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-boundary_chain_diff"><span class="command">lemma</span></span> boundary_chain_diff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"boundary_chain <span class="free">one_chain</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"boundary_chain <span class="main">(</span><span class="free">one_chain</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_chain_def<span class="main">)</span>

<span class="keyword1" id="Paths-gen_common_subdivision_imp_eq_line_integral"><span class="command">lemma</span></span> gen_common_subdivision_imp_eq_line_integral<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>common_sudiv_exists <span class="free">one_chain1</span> <span class="free">one_chain2</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"boundary_chain <span class="free">one_chain1</span>"</span></span>
    <span class="quoted"><span class="quoted">"boundary_chain <span class="free">one_chain2</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain1</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span>"</span></span>
    <span class="quoted"><span class="quoted">"finite <span class="free">one_chain1</span>"</span></span>
    <span class="quoted"><span class="quoted">"finite <span class="free">one_chain2</span>"</span></span>
    <span class="quoted"><span class="quoted">"finite <span class="free">basis</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">one_chain1</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">one_chain2</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain2</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps1</span></span> <span class="skolem"><span class="skolem">ps2</span></span> <span class="keyword2"><span class="keyword">where</span></span> gen_subdiv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>common_boundary_sudivision_exists <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="skolem">ps1</span><span class="main">)</span> <span class="main">(</span><span class="free">one_chain2</span> <span class="main">-</span> <span class="skolem">ps2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="skolem">ps1</span><span class="main">.</span> point_path <span class="bound">γ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="skolem">ps2</span><span class="main">.</span> point_path <span class="bound">γ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> gen_common_subdiv_imp_common_subdiv
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">one_chain1</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">one_chain2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> one_chain_line_integral_point_paths gen_common_subdiv_imp_common_subdiv
      assms<span class="main">(</span>2-7<span class="main">)</span> gen_subdiv
      common_subdivision_imp_eq_line_integral<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> gen_subdiv<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> boundary_chain_diff<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> boundary_chain_diff<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain2</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">subdiv</span></span> <span class="keyword2"><span class="keyword">where</span></span> subdiv_props<span class="main">:</span>
      <span class="quoted"><span class="quoted">"chain_subdiv_chain <span class="main">(</span><span class="free">one_chain1</span><span class="main">-</span><span class="skolem">ps1</span><span class="main">)</span> <span class="skolem">subdiv</span>"</span></span>
      <span class="quoted"><span class="quoted">"chain_subdiv_chain <span class="main">(</span><span class="free">one_chain2</span><span class="main">-</span><span class="skolem">ps2</span><span class="main">)</span> <span class="skolem">subdiv</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">subdiv</span><span class="main">.</span> valid_path <span class="bound">γ</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span>boundary_chain <span class="skolem">subdiv</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> gen_subdiv<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> common_boundary_sudivision_exists_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="skolem">subdiv</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> one_chain_line_integral_eq_line_integral_on_sudivision'<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> subdiv_props<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> boundary_chain_diff<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> subdiv_props<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span> assms<span class="main">(</span>4<span class="main">)</span> subdiv_props<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>5<span class="main">)</span> assms<span class="main">(</span>7<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain2</span><span class="main">-</span><span class="skolem">ps2</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> one_chain_line_integral_eq_line_integral_on_sudivision<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> subdiv_props<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> boundary_chain_diff<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> subdiv_props<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span> subdiv_props<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>6<span class="main">)</span> assms<span class="main">(</span>7<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span>  gen_subdiv<span class="main">(</span>3<span class="main">)</span> line_integral_exists_point_path<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>      
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-common_sudiv_exists_refl"><span class="command">lemma</span></span> common_sudiv_exists_refl<span class="main">:</span>
      <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"common_sudiv_exists <span class="free">C1</span> <span class="free">C2</span>"</span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"common_sudiv_exists <span class="free">C2</span> <span class="free">C1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> common_sudiv_exists_def<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Paths-chain_subdiv_path_singleton"><span class="command">lemma</span></span> chain_subdiv_path_singleton<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"chain_subdiv_path <span class="free">γ</span> <span class="main">{</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span><span class="main">}</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rec_join <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="free">γ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> joinpaths_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="free">γ</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"rec_join <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="free">γ</span>"</span></span> <span class="quoted"><span class="quoted">"valid_chain_list <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> chain_subdiv_path.intros<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-chain_subdiv_path_singleton_reverse"><span class="command">lemma</span></span> chain_subdiv_path_singleton_reverse<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"chain_subdiv_path <span class="main">(</span>reversepath <span class="free">γ</span><span class="main">)</span> <span class="main">{</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rec_join <span class="main">[</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> reversepath <span class="free">γ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> joinpaths_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">[</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="free">γ</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">[</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span><span class="main">]</span>"</span></span> 
             <span class="quoted"><span class="quoted">"rec_join <span class="main">[</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> reversepath <span class="free">γ</span>"</span></span> <span class="quoted"><span class="quoted">"valid_chain_list <span class="main">[</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span>  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"chain_subdiv_path <span class="main">(</span>reversepath <span class="free">γ</span><span class="main">)</span> <span class="main">(</span>set <span class="main">[</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="free">γ</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> chain_subdiv_path.intros <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-chain_subdiv_chain_refl"><span class="command">lemma</span></span> chain_subdiv_chain_refl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"boundary_chain <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"chain_subdiv_chain <span class="free">C</span> <span class="free">C</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> chain_subdiv_path_singleton chain_subdiv_path_singleton_reverse assms
  <span class="keyword1"><span class="command">unfolding</span></span> chain_subdiv_chain_def boundary_chain_def pairwise_def <span class="keyword1"><span class="command">using</span></span> case_prodI2 coeff_cube_to_path.simps 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="operator">auto</span>

<span class="comment1">(*path reparam_weaketrization*)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">reparam_weak</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">reparam_weak</span> <span class="free"><span class="bound"><span class="entity">γ1</span></span></span> <span class="free"><span class="bound"><span class="entity">γ2</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">φ</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">γ1</span></span></span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">γ2</span></span></span> <span class="keyword1">o</span> <span class="bound">φ</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">φ</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">φ</span><span class="main">(</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">φ</span><span class="main">(</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">φ</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">reparam</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">reparam</span> <span class="free"><span class="bound"><span class="entity">γ1</span></span></span> <span class="free"><span class="bound"><span class="entity">γ2</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">φ</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">γ1</span></span></span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">γ2</span></span></span> <span class="keyword1">o</span> <span class="bound">φ</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">φ</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">φ</span><span class="main">(</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">φ</span><span class="main">(</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> bij_betw <span class="bound">φ</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">φ</span> <span class="main">-`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> finite <span class="main">(</span><span class="bound">φ</span> <span class="main">-`</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Paths-reparam_weak_eq_refl"><span class="command">lemma</span></span> reparam_weak_eq_refl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"reparam_weak <span class="free">γ1</span> <span class="free">γ1</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> reparam_weak_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"id"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> id_def piecewise_C1_differentiable_on_def C1_differentiable_on_def continuous_on_id<span class="main">)</span>

<span class="keyword1" id="Paths-line_integral_exists_smooth_one_base"><span class="command">lemma</span></span> line_integral_exists_smooth_one_base<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="keyword1">C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="comment1">(*To generalise this to valid_path we need a version of has_integral_substitution_strong that allows finite discontinuities of f*)</span>
    <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>path_image <span class="free">γ</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="free">γ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> gamma2_differentiable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="free">γ</span> <span class="keyword1">differentiable</span> <span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_path_def C1_differentiable_on_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> gamma2_b_component_differentiable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span> <span class="keyword1">differentiable</span> <span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span> <span class="keyword1">differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> differentiable_at_withinI
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> differentiable_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> gama2_cont_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> differentiable_imp_continuous_on
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> gamma2_cont<span class="main">:</span><span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="free">γ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> C1_differentiable_imp_continuous_on
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_path_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> iii<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> continuous_on_compose<span class="main">[</span><span class="operator">OF</span> gamma2_cont<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> path_image_def<span class="main">)</span> 
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="keyword2"><span class="keyword">where</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="free">γ</span> <span class="keyword1">has_vector_derivative</span> <span class="skolem">D</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="skolem">D</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C1_differentiable_on_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">D</span> <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> vector_derivative_at vector_derivative_at_within_ivl
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> continuous_on_eq D <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> continuous_on_mult<span class="main">[</span><span class="operator">OF</span> 0 1<span class="main">]</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> integrable_continuous_real
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="free">γ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> line_integral_exists_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-contour_integral_primitive_lemma"><span class="command">lemma</span></span> contour_integral_primitive_lemma<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex <span class="main">⇒</span> complex"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> complex"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">s</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">has_field_derivative</span> <span class="free">f'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="free">s</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">piecewise_differentiable_on</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">s</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f'</span><span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> vector_derivative <span class="free">g</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>
             <span class="keyword1">has_integral</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">g</span> <span class="free">b</span><span class="main">)</span> <span class="main">-</span> <span class="free">f</span><span class="main">(</span><span class="free">g</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">.</span> <span class="free">g</span> <span class="keyword1">differentiable</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cg<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> piecewise_differentiable_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> cfg<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> continuous_on_compose <span class="main"><span class="main">[</span></span><span class="operator">OF</span> cg<span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> o_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> field_differentiable_def field_differentiable_imp_continuous_at continuous_on_eq_continuous_within continuous_on_subset image_subset_iff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted">real</span>
    <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="skolem">k</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">differentiable</span> <span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> k <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> differentiable_at_withinI<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="keyword1">has_vector_derivative</span> vector_derivative <span class="free">g</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vector_derivative_works has_field_derivative_def scaleR_conv_of_real<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> gdiff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="keyword1">has_derivative</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">*</span> vector_derivative <span class="free">g</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_vector_derivative_def scaleR_conv_of_real<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">has_field_derivative</span> <span class="main">(</span><span class="free">f'</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">within</span> <span class="free">g</span> <span class="main">`</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a atLeastAtMost_iff b DERIV_subset image_subset_iff less_eq_real_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> fdiff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">has_derivative</span> <span class="main">(*)</span> <span class="main">(</span><span class="free">f'</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">within</span> <span class="free">g</span> <span class="main">`</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_field_derivative_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> <span class="free">f'</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> vector_derivative <span class="free">g</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> diff_chain_within <span class="main">[</span><span class="operator">OF</span> gdiff fdiff<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_vector_derivative_def scaleR_conv_of_real o_def mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> * <span class="main">=</span> this
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> fundamental_theorem_of_calculus_interior_strong<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> k assms cfg *
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> at_within_Icc_at<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-line_integral_primitive_lemma"><span class="command">lemma</span></span> line_integral_primitive_lemma<span class="main">:</span> <span class="comment1">(*Only for real normed fields, i.e. vectors with products*)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>euclidean_space<span class="main">,</span>real_normed_field<span class="main">}</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>euclidean_space<span class="main">,</span>real_normed_field<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="main">(</span><span class="bound">a</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">s</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">has_field_derivative</span> <span class="main">(</span><span class="free">f'</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">a</span> <span class="keyword1">within</span> <span class="free">s</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">piecewise_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">::</span>real<span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">s</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">base_vec</span> <span class="main">∈</span> Basis"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">f'</span><span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">g</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">base_vec</span><span class="main">)</span>
             <span class="keyword1">has_integral</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">g</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">base_vec</span> <span class="main">-</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">g</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">base_vec</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">.</span> <span class="free">g</span> <span class="keyword1">differentiable</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cg<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> piecewise_differentiable_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> cfg<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> continuous_on_compose <span class="main"><span class="main">[</span></span><span class="operator">OF</span> cg<span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> o_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> field_differentiable_def field_differentiable_imp_continuous_at continuous_on_eq_continuous_within continuous_on_subset image_subset_iff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted">real</span>
    <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="skolem">k</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">differentiable</span> <span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> k <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> differentiable_at_withinI<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="keyword1">has_vector_derivative</span> vector_derivative <span class="free">g</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vector_derivative_works has_field_derivative_def scaleR_conv_of_real<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> gdiff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="keyword1">has_derivative</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> of_real <span class="bound">u</span> <span class="main">*</span> vector_derivative <span class="free">g</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_vector_derivative_def scaleR_conv_of_real<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">has_field_derivative</span> <span class="main">(</span><span class="free">f'</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">within</span> <span class="free">g</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a atLeastAtMost_iff b DERIV_subset image_subset_iff less_eq_real_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> fdiff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">has_derivative</span> <span class="main">(*)</span> <span class="main">(</span><span class="free">f'</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">within</span> <span class="free">g</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_field_derivative_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> <span class="free">f'</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> vector_derivative <span class="free">g</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> diff_chain_within <span class="main">[</span><span class="operator">OF</span> gdiff fdiff<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_vector_derivative_def scaleR_conv_of_real o_def mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="skolem">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> <span class="free">f'</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> vector_derivative <span class="free">g</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">f'</span><span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>vector_derivative <span class="free">g</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
             <span class="keyword1">has_integral</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">g</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">g</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fundamental_theorem_of_calculus_interior_strong<span class="main">[</span><span class="operator">OF</span> k<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> zero_le_one _ cfg<span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> k assms cfg * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> at_within_Icc_at<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">f'</span><span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>vector_derivative <span class="free">g</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">base_vec</span><span class="main">)</span>
             <span class="keyword1">has_integral</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">g</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">g</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">base_vec</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> has_integral_componentwise_iff assms<span class="main">(</span>4<span class="main">)</span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> inner_mult_left'
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inner_mult_left' inner_diff_left<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-reparam_eq_line_integrals"><span class="command">lemma</span></span> reparam_eq_line_integrals<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> reparam<span class="main">:</span> <span class="quoted"><span class="quoted">"reparam <span class="free">γ1</span> <span class="free">γ2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    pw_smooth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">γ2</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="comment1">(*To generalise this to valid_path we need a version of has_integral_substitution_strong that allows finite discontinuities of f*)</span>
    cont<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>path_image <span class="free">γ2</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    line_integral_ex<span class="main">:</span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="free">γ2</span>"</span></span> <span class="comment1">(*We need to remove this and work on special cases like conservative fields and field/line combinations that satisfy the improper integrals theorem assumptions*)</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="free">γ1</span> <span class="main">=</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="free">γ2</span>"</span></span>
    <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="free">γ1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">φ</span></span> <span class="keyword2"><span class="keyword">where</span></span> phi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="free">γ1</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">γ2</span> <span class="keyword1">o</span> <span class="skolem">φ</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span><span class="quoted"><span class="quoted">" <span class="skolem">φ</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span><span class="quoted"><span class="quoted">" <span class="skolem">φ</span><span class="main">(</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="quoted"><span class="quoted">" <span class="skolem">φ</span><span class="main">(</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="quoted"><span class="quoted">"bij_betw <span class="skolem">φ</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">-`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> finite <span class="main">(</span><span class="skolem">φ</span> <span class="main">-`</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> reparam
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reparam_def<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="keyword1">C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> phi
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reparam_def piecewise_C1_differentiable_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∩</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> s_inter<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="var">?s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="keyword1">C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="var">?s</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> s
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_Compl Diff_Diff_Int Diff_eq inf.commute s<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> cont_phi<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="skolem">φ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> phi
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reparam_def piecewise_C1_differentiable_on_imp_continuous_on<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="keyword2"><span class="keyword">where</span></span> s'_D<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">s'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="skolem">s'</span><span class="main">.</span> <span class="free">γ2</span> <span class="keyword1">differentiable</span> <span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="skolem">s'</span><span class="main">.</span> <span class="main">(</span><span class="free">γ2</span> <span class="keyword1">has_vector_derivative</span> <span class="skolem">D</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> continuous_on <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="skolem">s'</span><span class="main">)</span> <span class="skolem">D</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> pw_smooth 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_path_def piecewise_C1_differentiable_on_def C1_differentiable_on_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vector_derivative_works<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">∩</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> gamma2_differentiable<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="var">?s'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="var">?s'</span><span class="main">.</span> <span class="free">γ2</span> <span class="keyword1">differentiable</span> <span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="var">?s'</span><span class="main">.</span> <span class="main">(</span><span class="free">γ2</span> <span class="keyword1">has_vector_derivative</span> <span class="skolem">D</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> continuous_on <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="var">?s'</span><span class="main">)</span> <span class="skolem">D</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> s'_D
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">using</span></span> s'_D<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_Int2 inf_top.left_neutral s'_D<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> gamma2_b_component_differentiable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="var">?s'</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">γ2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span> <span class="keyword1">differentiable</span> <span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> differentiable_inner <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">γ2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span> <span class="keyword1">differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="var">?s'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> differentiable_at_withinI
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> differentiable_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> gama2_cont_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="var">?s'</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">γ2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> differentiable_imp_continuous_on
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="comment1">(**********Additional needed assumptions ************)</span>
  <span class="keyword1"><span class="command">have</span></span> s_in01<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> s'_in01<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?s'</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> phi_backimg_s'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">-`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> phi <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">φ</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> phi<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bij_betw_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> bij_phi<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">φ</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> phi<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> finite_bck_img_single<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> finite <span class="main">(</span><span class="skolem">φ</span> <span class="main">-`</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> phi <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> finite_bck_img_single_s'<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="var">?s'</span><span class="main">.</span> finite <span class="main">(</span><span class="skolem">φ</span> <span class="main">-`</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> gamma2_line_integrable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> line_integral_ex
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> line_integral_exists_def<span class="main">)</span>
      <span class="comment1">(****************************************************************)</span>
  <span class="keyword1"><span class="command">have</span></span> finite_neg_img<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">φ</span> <span class="main">-`</span> <span class="var">?s'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> finite_bck_img_single
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_iff finite_Int gamma2_differentiable<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> image_vimage_eq inf_img_fin_dom'<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> gamma2_cont<span class="main">:</span><span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="var">?s'</span><span class="main">)</span> <span class="free">γ2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span>  gamma2_differentiable
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> continuous_at_imp_continuous_on differentiable_imp_continuous_within<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> iii<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="var">?s'</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="var">?s'</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> cont continuous_on_compose<span class="main">[</span><span class="operator">OF</span> gamma2_cont<span class="main">]</span> continuous_on_compose2 gamma2_cont
      <span class="keyword1"><span class="command">unfolding</span></span> path_image_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="var">?s'</span><span class="main">.</span> <span class="main">(</span><span class="free">γ2</span> <span class="keyword1">has_vector_derivative</span> <span class="skolem">D</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> continuous_on <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="var">?s'</span><span class="main">)</span> <span class="skolem">D</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> gamma2_differentiable
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>                       
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="var">?s'</span><span class="main">.</span> vector_derivative <span class="free">γ2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">D</span> <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> vector_derivative_at vector_derivative_at_within_ivl
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="var">?s'</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> vector_derivative <span class="free">γ2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> continuous_on_eq D
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="var">?s'</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>vector_derivative <span class="free">γ2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> continuous_on_mult<span class="main">[</span><span class="operator">OF</span> 0 1<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> iv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span><span class="main">(</span><span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">φ</span><span class="main">(</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> phi<span class="main">(</span>3<span class="main">)</span> phi<span class="main">(</span>4<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reparam_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span><span class="main">`</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> phi
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reparam_def bij_betw_def<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="keyword2"><span class="keyword">where</span></span> D_props<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="var">?s</span><span class="main">.</span> <span class="main">(</span><span class="skolem">φ</span> <span class="keyword1">has_vector_derivative</span> <span class="skolem">D</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> s
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C1_differentiable_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="var">?s</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="skolem">φ</span> <span class="keyword1">has_vector_derivative</span> <span class="skolem">D</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> has_vector_derivative_at_within
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> vi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="var">?s</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="skolem">φ</span> <span class="keyword1">has_real_derivative</span> <span class="skolem">D</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> has_field_derivative_iff_has_vector_derivative
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">D</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">γ2</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span>
              integral <span class="main">{</span><span class="skolem">φ</span> <span class="main">0</span><span class="main">..</span><span class="skolem">φ</span> <span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
              <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"integral <span class="main">{</span><span class="skolem">φ</span> <span class="main">1</span><span class="main">..</span><span class="skolem">φ</span> <span class="main">0</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> integral_singleton integral_empty iv
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> phi<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> phi<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">D</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">γ2</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span>
                       integral <span class="main">{</span><span class="skolem">φ</span> <span class="main">0</span><span class="main">..</span><span class="skolem">φ</span> <span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> integral <span class="main">{</span><span class="skolem">φ</span> <span class="main">1</span><span class="main">..</span><span class="skolem">φ</span> <span class="main">0</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                           <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span>  has_integral_substitution_general_'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> s_inter<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> zero_le_one gamma2_differentiable<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> v gamma2_line_integrable iii cont_phi finite_bck_img_single_s'<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"surj_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="skolem">φ</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> bij_phi
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> bij_betw_def image_subsetI rangeI<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"surj_on <span class="var">?s'</span> <span class="skolem">φ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bij_phi s'_in01
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">φ</span> <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">∪</span> <span class="main">(</span><span class="var">?s</span> <span class="main">∪</span> <span class="skolem">φ</span> <span class="main">-`</span> <span class="var">?s'</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">φ</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  bij_phi 
          <span class="keyword1"><span class="command">using</span></span> bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">∪</span> <span class="main">(</span><span class="var">?s</span> <span class="main">∪</span> <span class="skolem">φ</span> <span class="main">-`</span> <span class="var">?s'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> phi_backimg_s' s_in01 s'_in01
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> i ii <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="var">?s</span> <span class="main">⟹</span> <span class="main">(</span><span class="skolem">φ</span> <span class="keyword1">has_real_derivative</span> <span class="skolem">D</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> vi <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"integral <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">D</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">γ2</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
                       integral <span class="main">{</span><span class="skolem">φ</span> <span class="main">0</span><span class="main">..</span><span class="skolem">φ</span> <span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> gamma2_vec_diffable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="skolem">φ</span> <span class="main">-`</span> <span class="var">?s'</span><span class="main">)</span> <span class="main">∪</span> <span class="var">?s</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="free">γ2</span> <span class="keyword1">o</span> <span class="skolem">φ</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> vector_derivative <span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted">real</span> 
    <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span>   <span class="main">(</span><span class="main">(</span><span class="skolem">φ</span> <span class="main">-`</span> <span class="var">?s'</span><span class="main">)</span> <span class="main">∪</span> <span class="var">?s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> zer_le_x_le_1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">≤</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ass
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">γ2</span> <span class="keyword1">o</span> <span class="skolem">φ</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> vector_derivative <span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">γ2</span> <span class="keyword1">differentiable</span> <span class="keyword1">at</span> <span class="main">(</span><span class="skolem">φ</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span>  gamma2_differentiable<span class="main">(</span>2<span class="main">)</span> ass v 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> ***<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">φ</span> <span class="keyword1">differentiable</span> <span class="keyword1">at</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> s ass
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C1_differentiable_on_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">γ2</span> <span class="keyword1">o</span> <span class="skolem">φ</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> vector_derivative <span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> differentiable_chain_at<span class="main">[</span><span class="operator">OF</span> *** **<span class="main">]</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vector_derivative_works<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> gamma2_vec_deriv_within<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="skolem">φ</span> <span class="main">-`</span> <span class="var">?s'</span><span class="main">)</span> <span class="main">∪</span> <span class="var">?s</span><span class="main">)</span> <span class="main">⟹</span> vector_derivative <span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> vector_derivative <span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> vector_derivative_at_within_ivl<span class="main">[</span><span class="operator">OF</span> gamma2_vec_diffable<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="skolem">φ</span> <span class="main">-`</span> <span class="var">?s'</span><span class="main">)</span> <span class="main">∪</span> <span class="var">?s</span><span class="main">)</span><span class="main">.</span> <span class="skolem">D</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vector_derivative <span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted">real</span>
    <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="skolem">φ</span> <span class="main">-`</span> <span class="var">?s'</span><span class="main">)</span> <span class="main">∪</span> <span class="var">?s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="keyword1">differentiable</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> s <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C1_differentiable_on_def differentiable_def has_vector_derivative_def<span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">D2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">φ</span> <span class="keyword1">has_vector_derivative</span> <span class="skolem">D2</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> D_props ass  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="var">?s'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> phi<span class="main">(</span>5<span class="main">)</span> ass <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_Un Diff_iff Int_iff bij_betw_def image_eqI vimageI<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">γ2</span> <span class="keyword1">differentiable</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">φ</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> gamma2_differentiable
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span><span class="quoted"><span class="quoted">" vector_derivative <span class="free">γ2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">φ</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>  vector_derivative <span class="free">γ2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">φ</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">≤</span> <span class="skolem">φ</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">φ</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> phi<span class="main">(</span>5<span class="main">)</span> ass
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">φ</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="skolem">s'</span> <span class="main">∩</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">γ2</span> <span class="keyword1">has_vector_derivative</span> <span class="main">(</span>vector_derivative <span class="free">γ2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">φ</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">φ</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 vector_derivative_works  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> * vector_derivative_at_within_ivl<span class="main">[</span><span class="operator">OF</span> **<span class="main">]</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">φ</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> vector_derivative <span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> vector_derivative_chain_at<span class="main">[</span><span class="operator">OF</span> 0 1<span class="main">]</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gamma2_vec_deriv_within<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ass<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> 3<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> D_props ass vector_derivative_at
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span>  <span class="bound">x</span><span class="main">∈</span><span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="skolem">φ</span> <span class="main">-`</span> <span class="var">?s'</span><span class="main">)</span> <span class="main">∪</span> <span class="var">?s</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">D</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">γ2</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
                                    <span class="free">F</span> <span class="main">(</span><span class="free">γ2</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"integral <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">D</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">γ2</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
                                            integral <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ2</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"negligible <span class="main">(</span><span class="main">(</span><span class="skolem">φ</span> <span class="main">-`</span> <span class="var">?s'</span><span class="main">)</span> <span class="main">∪</span> <span class="var">?s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_neg_img s<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> c integral_spike  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span>lifting<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> phi_in_int<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">⟹</span> <span class="skolem">φ</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> phi
    <span class="keyword1"><span class="command">using</span></span> v <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ2</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span>
                             integral <span class="main">{</span><span class="skolem">φ</span> <span class="main">0</span><span class="main">..</span><span class="skolem">φ</span> <span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"negligible <span class="var">?s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> s_inter<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"negligible <span class="main">(</span><span class="main">(</span><span class="skolem">φ</span> <span class="main">-`</span> <span class="var">?s'</span><span class="main">)</span> <span class="main">∪</span> <span class="var">?s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_neg_img s<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> c'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span><span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="skolem">φ</span> <span class="main">-`</span> <span class="var">?s'</span><span class="main">)</span> <span class="main">∪</span> <span class="var">?s</span><span class="main">)</span><span class="main">.</span> <span class="skolem">D</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">γ2</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
                                    <span class="free">F</span> <span class="main">(</span><span class="free">γ2</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> has_integral_spike_eq'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span> <span class="bound">t</span> <span class="bound">f</span> <span class="bound">g</span> <span class="bound">y</span><span class="main">.</span> negligible <span class="bound">s</span> <span class="main">⟹</span>
                                                       <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="bound">t</span> <span class="main">-</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">g</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">f</span> <span class="keyword1">has_integral</span> <span class="bound">y</span><span class="main">)</span> <span class="bound">t</span> <span class="main">=</span> <span class="main">(</span><span class="bound">g</span> <span class="keyword1">has_integral</span> <span class="bound">y</span><span class="main">)</span> <span class="bound">t</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> has_integral_spike_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> a has_integral_spike_eq'<span class="main">[</span><span class="operator">OF</span> 0 c'<span class="main">]</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative  <span class="free">γ1</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span>
                     integral <span class="main">{</span><span class="skolem">φ</span> <span class="main">0</span><span class="main">..</span><span class="skolem">φ</span> <span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                       <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ2</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span>
                            integral <span class="main">{</span><span class="skolem">φ</span> <span class="main">0</span><span class="main">..</span><span class="skolem">φ</span> <span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                             <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="main">(</span> <span class="main">(</span><span class="main">(</span><span class="skolem">φ</span> <span class="main">-`</span> <span class="var">?s'</span><span class="main">)</span> <span class="main">∪</span> <span class="var">?s</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ2</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative  <span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span>
                                                  <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ1</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>  <span class="main">-</span> <span class="main">(</span><span class="skolem">φ</span> <span class="main">-`</span> <span class="var">?s'</span> <span class="main">∪</span> <span class="var">?s</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>vector_derivative  <span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vector_derivative  <span class="main">(</span><span class="free">γ1</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"open <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>  <span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="skolem">φ</span> <span class="main">-`</span> <span class="var">?s'</span><span class="main">)</span> <span class="main">∪</span> <span class="var">?s</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> open_diff s<span class="main">(</span>1<span class="main">)</span> open_greaterThanLessThan finite_neg_img
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> open_diff<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">::</span>real<span class="main">}</span>  <span class="main">-</span> <span class="main">(</span><span class="skolem">φ</span> <span class="main">-`</span> <span class="var">?s'</span> <span class="main">∪</span> <span class="var">?s</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">γ1</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> phi<span class="main">(</span>1<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>                              
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted">real</span>
        <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">::</span>real<span class="main">}</span> <span class="main">-</span>  <span class="main">(</span><span class="main">(</span><span class="skolem">φ</span> <span class="main">-`</span> <span class="var">?s'</span><span class="main">)</span> <span class="main">∪</span> <span class="var">?s</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> iii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span> <span class="keyword1">has_vector_derivative</span> vector_derivative <span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> Diff_iff add.commute add_strict_mono ass atLeastAtMost_iff gamma2_vec_deriv_within gamma2_vec_diffable greaterThanLessThan_iff less_irrefl not_le<span class="main">)</span>
            <span class="comment1">(*Most crucial but annoying step*)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> iv<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">γ1</span> <span class="keyword1">has_vector_derivative</span> vector_derivative <span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> has_derivative_transform_within_open i ii ass
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_vector_derivative_def<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> ass has_derivative_transform_within_open i ii<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> ass has_derivative_transform_within_open i ii<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ass has_derivative_transform_within_open i ii<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ass <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"vector_derivative <span class="free">γ1</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> vector_derivative <span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> vector_derivative_at_within_ivl<span class="main">[</span><span class="operator">OF</span> iv v<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> v<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> zero_less_one<span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"vector_derivative <span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> vector_derivative <span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> vector_derivative_at_within_ivl<span class="main">[</span><span class="operator">OF</span> iii v<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> v<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> zero_less_one<span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vector_derivative <span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> vector_derivative <span class="free">γ1</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 0 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vector_derivative <span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">=</span> vector_derivative <span class="free">γ1</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="main">(</span> <span class="main">(</span><span class="main">(</span><span class="skolem">φ</span> <span class="main">-`</span> <span class="var">?s'</span><span class="main">)</span> <span class="main">∪</span> <span class="var">?s</span><span class="main">)</span><span class="main">∪</span><span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>vector_derivative  <span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vector_derivative  <span class="main">(</span><span class="free">γ1</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">φ</span> <span class="main">-`</span> <span class="var">?s'</span><span class="main">)</span> <span class="main">∪</span> <span class="var">?s</span><span class="main">)</span><span class="main">∪</span><span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">.</span>  <span class="free">F</span> <span class="main">(</span><span class="free">γ1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">=</span>  <span class="free">F</span> <span class="main">(</span><span class="free">γ2</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> phi<span class="main">(</span>1<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> i ii  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"negligible <span class="main">(</span><span class="main">(</span><span class="skolem">φ</span> <span class="main">-`</span> <span class="var">?s'</span><span class="main">)</span> <span class="main">∪</span> <span class="var">?s</span> <span class="main">∪</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> s<span class="main">(</span>1<span class="main">)</span> finite_neg_img <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> has_integral_spike_eq'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span> <span class="bound">t</span> <span class="bound">g</span> <span class="bound">f</span> <span class="bound">y</span><span class="main">.</span> negligible <span class="bound">s</span> <span class="main">⟹</span>
                                <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="bound">t</span> <span class="main">-</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">g</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">f</span> <span class="keyword1">has_integral</span> <span class="bound">y</span><span class="main">)</span> <span class="bound">t</span> <span class="main">=</span> <span class="main">(</span><span class="bound">g</span> <span class="keyword1">has_integral</span> <span class="bound">y</span><span class="main">)</span> <span class="bound">t</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> has_integral_spike_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> has_integral_spike_eq'<span class="main">[</span><span class="operator">OF</span> ** *<span class="main">]</span> ass
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="free">γ1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> phi  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> line_integral_exists_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integral <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ2</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                      integral <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ1</span>  <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> integral_unique<span class="main">[</span><span class="operator">OF</span> e<span class="main">]</span> integral_unique<span class="main">[</span><span class="operator">OF</span> f<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integral <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ2</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                         integral <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b d phi <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="free">γ1</span> <span class="main">=</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="free">γ2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> phi  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> line_integral_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-reparam_weak_eq_line_integrals"><span class="command">lemma</span></span> reparam_weak_eq_line_integrals<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"reparam_weak <span class="free">γ1</span> <span class="free">γ2</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">γ2</span> <span class="keyword1">C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="comment1">(*To generalise this to valid_path we need a version of has_integral_substitution_strong that allows finite discontinuities of f*)</span>
    <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>path_image <span class="free">γ2</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="free">γ1</span> <span class="main">=</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="free">γ2</span>"</span></span>
    <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="free">γ1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">φ</span></span> <span class="keyword2"><span class="keyword">where</span></span> phi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="free">γ1</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">γ2</span> <span class="keyword1">o</span> <span class="skolem">φ</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span><span class="quoted"><span class="quoted">" <span class="skolem">φ</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span><span class="quoted"><span class="quoted">" <span class="skolem">φ</span><span class="main">(</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="quoted"><span class="quoted">" <span class="skolem">φ</span><span class="main">(</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="quoted"><span class="quoted">" <span class="skolem">φ</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reparam_weak_def<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="keyword1">C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> phi
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reparam_weak_def piecewise_C1_differentiable_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> cont_phi<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="skolem">φ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> phi
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reparam_weak_def piecewise_C1_differentiable_on_imp_continuous_on<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> gamma2_differentiable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="free">γ2</span> <span class="keyword1">differentiable</span> <span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_path_def C1_differentiable_on_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> gamma2_b_component_differentiable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">γ2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span> <span class="keyword1">differentiable</span> <span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">γ2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span> <span class="keyword1">differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> differentiable_at_withinI
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> differentiable_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> gama2_cont_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">γ2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> differentiable_imp_continuous_on
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> gamma2_cont<span class="main">:</span><span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="free">γ2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> C1_differentiable_imp_continuous_on
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_path_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> iii<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> continuous_on_compose<span class="main">[</span><span class="operator">OF</span> gamma2_cont<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> path_image_def<span class="main">)</span> 
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="keyword2"><span class="keyword">where</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="free">γ2</span> <span class="keyword1">has_vector_derivative</span> <span class="skolem">D</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="skolem">D</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C1_differentiable_on_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> vector_derivative <span class="free">γ2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">D</span> <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> vector_derivative_at vector_derivative_at_within_ivl
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> vector_derivative <span class="free">γ2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> continuous_on_eq D  <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>vector_derivative <span class="free">γ2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> continuous_on_mult<span class="main">[</span><span class="operator">OF</span> 0 1<span class="main">]</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> iv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span><span class="main">(</span><span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">φ</span><span class="main">(</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> phi<span class="main">(</span>3<span class="main">)</span> phi<span class="main">(</span>4<span class="main">)</span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reparam_weak_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span><span class="main">`</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> phi<span class="main">(</span>5<span class="main">)</span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reparam_weak_def<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="keyword2"><span class="keyword">where</span></span> D_props<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">.</span> <span class="main">(</span><span class="skolem">φ</span> <span class="keyword1">has_vector_derivative</span> <span class="skolem">D</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> s
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C1_differentiable_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span><span class="skolem">s</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="skolem">φ</span> <span class="keyword1">has_vector_derivative</span> <span class="skolem">D</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> has_vector_derivative_at_within  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> vi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="skolem">φ</span> <span class="keyword1">has_real_derivative</span> <span class="skolem">D</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> has_field_derivative_iff_has_vector_derivative
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">D</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">γ2</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span>
              integral <span class="main">{</span><span class="skolem">φ</span> <span class="main">0</span><span class="main">..</span><span class="skolem">φ</span> <span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
              <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> has_integral_substitution_strong<span class="main">[</span><span class="operator">OF</span> s<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> zero_le_one iv v iii cont_phi vi<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"integral <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">D</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">γ2</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
                       integral <span class="main">{</span><span class="skolem">φ</span> <span class="main">0</span><span class="main">..</span><span class="skolem">φ</span> <span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> gamma2_vec_diffable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span><span class="skolem">s</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="free">γ2</span> <span class="keyword1">o</span> <span class="skolem">φ</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> vector_derivative <span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted">real</span> 
    <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span><span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> zer_le_x_le_1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">≤</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ass <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">γ2</span> <span class="keyword1">o</span> <span class="skolem">φ</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> vector_derivative <span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">γ2</span> <span class="keyword1">differentiable</span> <span class="keyword1">at</span> <span class="main">(</span><span class="skolem">φ</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> phi gamma2_differentiable
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zer_le_x_le_1<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> ***<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">φ</span> <span class="keyword1">differentiable</span> <span class="keyword1">at</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> s ass
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C1_differentiable_on_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">γ2</span> <span class="keyword1">o</span> <span class="skolem">φ</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> vector_derivative <span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> differentiable_chain_at<span class="main">[</span><span class="operator">OF</span> *** **<span class="main">]</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vector_derivative_works<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> gamma2_vec_deriv_within<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span><span class="skolem">s</span> <span class="main">⟹</span> vector_derivative <span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> vector_derivative <span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> vector_derivative_at_within_ivl<span class="main">[</span><span class="operator">OF</span> gamma2_vec_diffable<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">.</span> <span class="skolem">D</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vector_derivative <span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted">real</span>
    <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span><span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="keyword1">differentiable</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> s
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C1_differentiable_on_def differentiable_def has_vector_derivative_def<span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">D2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">φ</span> <span class="keyword1">has_vector_derivative</span> <span class="skolem">D2</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> D_props ass
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> phi<span class="main">(</span>5<span class="main">)</span> ass 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reparam_weak_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">γ2</span> <span class="keyword1">differentiable</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">φ</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> gamma2_differentiable
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span><span class="quoted"><span class="quoted">" vector_derivative <span class="free">γ2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">φ</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>  vector_derivative <span class="free">γ2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">φ</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">≤</span> <span class="skolem">φ</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">φ</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> phi<span class="main">(</span>5<span class="main">)</span> ass <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">γ2</span> <span class="keyword1">has_vector_derivative</span> <span class="main">(</span>vector_derivative <span class="free">γ2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">φ</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">φ</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 vector_derivative_works
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> * vector_derivative_at_within_ivl<span class="main">[</span><span class="operator">OF</span> **<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">φ</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> vector_derivative <span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> vector_derivative_chain_at<span class="main">[</span><span class="operator">OF</span> 0 1<span class="main">]</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gamma2_vec_deriv_within<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ass<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> 3<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> D_props ass vector_derivative_at
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span>  <span class="bound">x</span><span class="main">∈</span><span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span><span class="skolem">s</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">D</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">γ2</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
                                    <span class="free">F</span> <span class="main">(</span><span class="free">γ2</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"integral <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">D</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">γ2</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
                                            integral <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ2</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"negligible <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> s<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> c integral_spike  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span>lifting<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> phi_in_int<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">⟹</span> <span class="skolem">φ</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> phi
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ2</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span>
                             integral <span class="main">{</span><span class="skolem">φ</span> <span class="main">0</span><span class="main">..</span><span class="skolem">φ</span> <span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span><span class="quoted"><span class="quoted">"negligible <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> s<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> c'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span><span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span><span class="skolem">s</span><span class="main">.</span> <span class="skolem">D</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">F</span> <span class="main">(</span><span class="free">γ2</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
                                    <span class="free">F</span> <span class="main">(</span><span class="free">γ2</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> has_integral_spike_eq'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span> <span class="bound">t</span> <span class="bound">f</span> <span class="bound">g</span> <span class="bound">y</span><span class="main">.</span> negligible <span class="bound">s</span> <span class="main">⟹</span>
                                               <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="bound">t</span> <span class="main">-</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">g</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">f</span> <span class="keyword1">has_integral</span> <span class="bound">y</span><span class="main">)</span> <span class="bound">t</span> <span class="main">=</span> <span class="main">(</span><span class="bound">g</span> <span class="keyword1">has_integral</span> <span class="bound">y</span><span class="main">)</span> <span class="bound">t</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> has_integral_spike_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> a has_integral_spike_eq'<span class="main">[</span><span class="operator">OF</span> 0 c'<span class="main">]</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative  <span class="free">γ1</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span>
                     integral <span class="main">{</span><span class="skolem">φ</span> <span class="main">0</span><span class="main">..</span><span class="skolem">φ</span> <span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                       <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ2</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span>
                            integral <span class="main">{</span><span class="skolem">φ</span> <span class="main">0</span><span class="main">..</span><span class="skolem">φ</span> <span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                             <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">s</span><span class="main">∪</span><span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ2</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative  <span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span>
                                                  <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ1</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">.</span> <span class="main">(</span>vector_derivative  <span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vector_derivative  <span class="main">(</span><span class="free">γ1</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"open <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> open_diff s open_greaterThanLessThan <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">::</span>real<span class="main">}</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">.</span> <span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">γ1</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> phi<span class="main">(</span>1<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>                              
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted">real</span>
        <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">::</span>real<span class="main">}</span> <span class="main">-</span> <span class="skolem">s</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> iii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span> <span class="keyword1">has_vector_derivative</span> vector_derivative <span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> has_vector_derivative_at_within gamma2_vec_deriv_within gamma2_vec_diffable
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="comment1">(*Most crucial but annoying step*)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> iv<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">γ1</span> <span class="keyword1">has_vector_derivative</span> vector_derivative <span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> has_derivative_transform_within_open i ii ass
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_vector_derivative_def<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">have</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ass <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"vector_derivative <span class="free">γ1</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> vector_derivative <span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> vector_derivative_at_within_ivl<span class="main">[</span><span class="operator">OF</span> iv v<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> v<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> zero_less_one<span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"vector_derivative <span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> vector_derivative <span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> vector_derivative_at_within_ivl<span class="main">[</span><span class="operator">OF</span> iii v<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> v<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> zero_less_one<span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vector_derivative <span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> vector_derivative <span class="free">γ1</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 0 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vector_derivative <span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">=</span> vector_derivative <span class="free">γ1</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">s</span><span class="main">∪</span><span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>vector_derivative  <span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vector_derivative  <span class="main">(</span><span class="free">γ1</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">s</span><span class="main">∪</span><span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">.</span>  <span class="free">F</span> <span class="main">(</span><span class="free">γ1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">=</span>  <span class="free">F</span> <span class="main">(</span><span class="free">γ2</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> phi<span class="main">(</span>1<span class="main">)</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> i ii <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"negligible <span class="main">(</span><span class="skolem">s</span><span class="main">∪</span><span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> s<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> has_integral_spike_eq'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span> <span class="bound">t</span> <span class="bound">g</span> <span class="bound">f</span> <span class="bound">y</span><span class="main">.</span> negligible <span class="bound">s</span> <span class="main">⟹</span>
                                <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="bound">t</span> <span class="main">-</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">g</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">f</span> <span class="keyword1">has_integral</span> <span class="bound">y</span><span class="main">)</span> <span class="bound">t</span> <span class="main">=</span> <span class="main">(</span><span class="bound">g</span> <span class="keyword1">has_integral</span> <span class="bound">y</span><span class="main">)</span> <span class="bound">t</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> has_integral_spike_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> has_integral_spike_eq'<span class="main">[</span><span class="operator">OF</span> ** *<span class="main">]</span> ass
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="free">γ1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> phi  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> line_integral_exists_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integral <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ2</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                      integral <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ1</span>  <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> integral_unique<span class="main">[</span><span class="operator">OF</span> e<span class="main">]</span> integral_unique<span class="main">[</span><span class="operator">OF</span> f<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integral <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ2</span> <span class="main">(</span><span class="skolem">φ</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="main">(</span><span class="free">γ2</span> <span class="main">∘</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                         integral <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="free">γ2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span>vector_derivative <span class="free">γ2</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∙</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b d phi  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="free">γ1</span> <span class="main">=</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="free">γ2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> phi <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> line_integral_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-line_integral_sum_basis"><span class="command">lemma</span></span> line_integral_sum_basis<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">basis</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>euclidean_space<span class="main">)</span> set<span class="main">)</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="bound">b</span><span class="main">}</span> <span class="free">γ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">γ</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="bound">b</span><span class="main">}</span> <span class="free">γ</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="free">γ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">basis</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="main">{}</span> <span class="free">γ</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="main">{}</span><span class="main">.</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="bound">b</span><span class="main">}</span> <span class="free">γ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> line_integral_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="main">{}</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="bound">b</span><span class="main">}</span> <span class="free">γ</span> <span class="main">⟹</span> line_integral_exists <span class="free">F</span> <span class="main">{}</span> <span class="free">γ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> line_integral_exists_def integrable_0<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">basis</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>euclidean_space<span class="main">)</span> set"</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>euclidean_space"</span></span>
  <span class="keyword3"><span class="command">fix</span></span>  <span class="skolem">γ</span>
  <span class="keyword3"><span class="command">assume</span></span> ind_hyp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="skolem">basis</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="bound">b</span><span class="main">}</span> <span class="skolem">γ</span> <span class="main">⟹</span> line_integral_exists <span class="free">F</span> <span class="skolem">basis</span> <span class="skolem">γ</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="skolem">basis</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="bound">b</span><span class="main">}</span> <span class="skolem">γ</span> <span class="main">⟹</span> line_integral <span class="free">F</span> <span class="skolem">basis</span> <span class="skolem">γ</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="skolem">basis</span><span class="main">.</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="bound">b</span><span class="main">}</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> step<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">basis</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="skolem">basis</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span>insert <span class="skolem">x</span> <span class="skolem">basis</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="bound">b</span><span class="main">}</span> <span class="skolem">γ</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="skolem">γ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="skolem">basis</span> <span class="skolem">γ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ind_hyp step <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">basis</span><span class="main">)</span> <span class="skolem">γ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> step<span class="main">(</span>1<span class="main">)</span> step<span class="main">(</span>2<span class="main">)</span> line_integral_sum_gen<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> _ 0 1<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">basis</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> step<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="skolem">basis</span> <span class="skolem">γ</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">b</span><span class="main">∈</span><span class="skolem">basis</span><span class="main">.</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="bound">b</span><span class="main">}</span> <span class="skolem">γ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ind_hyp step <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">basis</span><span class="main">)</span> <span class="skolem">γ</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">b</span><span class="main">∈</span>insert <span class="skolem">x</span> <span class="skolem">basis</span><span class="main">.</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="bound">b</span><span class="main">}</span> <span class="skolem">γ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> step<span class="main">(</span>1<span class="main">)</span> step<span class="main">(</span>2<span class="main">)</span> line_integral_sum_gen<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 3 0 1<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-reparam_weak_eq_line_integrals_basis"><span class="command">lemma</span></span> reparam_weak_eq_line_integrals_basis<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"reparam_weak <span class="free">γ1</span> <span class="free">γ2</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">γ2</span> <span class="keyword1">C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="comment1">(*To generalise this to valid_path we need a version of has_integral_substitution_strong that allows finite discontinuities*)</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> continuous_on <span class="main">(</span>path_image <span class="free">γ2</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"finite <span class="free">basis</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">γ1</span> <span class="main">=</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">γ2</span>"</span></span>
    <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="free">γ1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="free">γ1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> reparam_weak_eq_line_integrals<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> assms<span class="main">(</span>3-4<span class="main">)</span> line_integral_sum_basis<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subset_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">γ1</span> <span class="main">=</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">γ2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> reparam_weak_eq_line_integrals<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main">]</span> assms<span class="main">(</span>3-4<span class="main">)</span> line_integral_sum_basis<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span>
      line_integral_exists_smooth_one_base<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subset_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-reparam_eq_line_integrals_basis"><span class="command">lemma</span></span> reparam_eq_line_integrals_basis<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"reparam <span class="free">γ1</span> <span class="free">γ2</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">γ2</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> continuous_on <span class="main">(</span>path_image <span class="free">γ2</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"finite <span class="free">basis</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="bound">b</span><span class="main">}</span> <span class="free">γ2</span>"</span></span> <span class="comment1">(*We need to remove this and work on special cases like conservative fields and field/line combinations that satisfy the improper integrals theorem assumptions*)</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">γ1</span> <span class="main">=</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">γ2</span>"</span></span>
    <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="free">γ1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="free">γ1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> reparam_eq_line_integrals<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> assms<span class="main">(</span>3-5<span class="main">)</span> line_integral_sum_basis<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subset_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">γ1</span> <span class="main">=</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">γ2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> reparam_eq_line_integrals<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main">]</span> assms<span class="main">(</span>3-5<span class="main">)</span> line_integral_sum_basis<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subset_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-line_integral_exists_smooth"><span class="command">lemma</span></span> line_integral_exists_smooth<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="keyword1">C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="comment1">(*To generalise this to valid_path we need a version of has_integral_substitution_strong that allows finite discontinuities*)</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">b</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>euclidean_space<span class="main">)</span> <span class="main">∈</span><span class="free">basis</span><span class="main">.</span> continuous_on <span class="main">(</span>path_image <span class="free">γ</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"finite <span class="free">basis</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="free">γ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> reparam_weak_eq_line_integrals_basis<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> reparam_weak_eq_refl<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?γ1.0</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free">γ</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Paths-smooth_path_imp_reverse"><span class="command">lemma</span></span> smooth_path_imp_reverse<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>reversepath <span class="free">g</span><span class="main">)</span> <span class="keyword1">C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms continuous_on_const
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> reversepath_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> C1_differentiable_compose <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">::</span></span>real<span class="main"><span class="main">.</span></span> <span class="main"><span class="main">1</span></span><span class="main"><span class="main">-</span></span><span class="bound"><span class="bound">x</span></span>"</span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">g</span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> o_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> C1_differentiable_on_eq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_vimageI inj_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Paths-piecewise_smooth_path_imp_reverse"><span class="command">lemma</span></span> piecewise_smooth_path_imp_reverse<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>reversepath <span class="free">g</span><span class="main">)</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms valid_path_reversepath
  <span class="keyword1"><span class="command">using</span></span> valid_path_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">chain_reparam_weak_chain</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">chain_reparam_weak_chain</span> <span class="free"><span class="bound"><span class="entity">one_chain1</span></span></span> <span class="free"><span class="bound"><span class="entity">one_chain2</span></span></span> <span class="main">≡</span>
      <span class="main">∃</span><span class="bound">f</span><span class="main">.</span> bij <span class="bound">f</span> <span class="main">∧</span> <span class="bound">f</span> <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">one_chain1</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">one_chain2</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">one_chain1</span></span></span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> fst <span class="main">(</span><span class="bound">f</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> reparam_weak <span class="bound">γ</span> <span class="main">(</span>snd <span class="main">(</span><span class="bound">f</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> reparam_weak <span class="bound">γ</span> <span class="main">(</span>reversepath <span class="main">(</span>snd <span class="main">(</span><span class="bound">f</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Paths-chain_reparam_weak_chain_line_integral"><span class="command">lemma</span></span> chain_reparam_weak_chain_line_integral<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"chain_reparam_weak_chain <span class="free">one_chain1</span> <span class="free">one_chain2</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k2</span><span class="main">,</span><span class="bound">γ2</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain2</span><span class="main">.</span> <span class="bound">γ2</span> <span class="keyword1">C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k2</span><span class="main">,</span><span class="bound">γ2</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain2</span><span class="main">.</span><span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> continuous_on <span class="main">(</span>path_image <span class="bound">γ2</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"finite <span class="free">basis</span>"</span></span>                                                                     
  <span class="keyword2"><span class="keyword">and</span></span> bound1<span class="main">:</span> <span class="quoted"><span class="quoted">"boundary_chain <span class="free">one_chain1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> bound2<span class="main">:</span> <span class="quoted"><span class="quoted">"boundary_chain <span class="free">one_chain2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">one_chain1</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">one_chain2</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain1</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"bij <span class="skolem">f</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain1</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> fst <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> reparam_weak <span class="bound">γ</span> <span class="main">(</span>snd <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> reparam_weak <span class="bound">γ</span> <span class="main">(</span>reversepath <span class="main">(</span>snd <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">`</span> <span class="free">one_chain1</span> <span class="main">=</span> <span class="free">one_chain2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> chain_reparam_weak_chain_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">one_chain1</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>real_of_int <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">⇒</span> real_of_int <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∧</span>
                                                        line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k1</span> <span class="skolem">γ1</span>
      <span class="keyword3"><span class="command">assume</span></span> ass1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k1</span><span class="main">,</span><span class="skolem">γ1</span><span class="main">)</span> <span class="main">∈</span><span class="free">one_chain1</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_int <span class="skolem">k1</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ1</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k1</span><span class="main">,</span><span class="skolem">γ1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k2</span><span class="main">,</span> <span class="bound">γ2</span><span class="main">)</span> <span class="main">⇒</span> real_of_int <span class="bound">k2</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ2</span><span class="main">)</span> <span class="main">∧</span>
                      line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ1</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> ass2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?k2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k1</span><span class="main">,</span> <span class="skolem">γ1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?γ2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k1</span><span class="main">,</span> <span class="skolem">γ1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_int <span class="skolem">k1</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ1</span> <span class="main">=</span> real_of_int <span class="var">?k2</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="var">?γ2</span><span class="main">∧</span>
                              line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ1</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> ass3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?k2</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"reparam_weak <span class="skolem">γ1</span> <span class="var">?γ2</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> ass1 ass2 f<span class="main">(</span>2<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?γ2</span> <span class="keyword1">C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> f<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> ass1
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> continuous_on <span class="main">(</span>path_image <span class="var">?γ2</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> f<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> ass1
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"real_of_int <span class="skolem">k1</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ1</span> <span class="main">=</span> real_of_int <span class="var">?k2</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="var">?γ2</span> <span class="main">∧</span>
                                     line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ1</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> assms reparam_weak_eq_line_integrals_basis<span class="main">[</span><span class="operator">OF</span> 0 1 2 assms<span class="main"><span class="main"><span class="main">(</span></span></span>4<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main">]</span>
              ass2 ass3
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?k2</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ass3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?k2</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> bound2 ass1 f<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> boundary_chain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"reparam_weak <span class="skolem">γ1</span> <span class="main">(</span>reversepath <span class="var">?γ2</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> ass1 ass2 f<span class="main">(</span>2<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>reversepath <span class="var">?γ2</span><span class="main">)</span> <span class="keyword1">C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> f<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> ass1 smooth_path_imp_reverse
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> continuous_on <span class="main">(</span>path_image <span class="main">(</span>reversepath <span class="var">?γ2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> f<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> ass1 path_image_reversepath
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="free">basis</span> <span class="var">?γ2</span> <span class="main">=</span> <span class="main">-</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>reversepath <span class="var">?γ2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span><span class="quoted"><span class="quoted">"valid_path <span class="main">(</span>reversepath <span class="var">?γ2</span><span class="main">)</span> "</span></span>
              <span class="keyword1"><span class="command">using</span></span> 1 C1_differentiable_imp_piecewise
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_path_def<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
              <span class="keyword1"><span class="command">using</span></span> line_integral_on_reverse_path<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> i line_integral_exists_smooth<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 1 2 <span class="main"><span class="main">]</span></span><span class="main">]</span> assms
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"real_of_int <span class="skolem">k1</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ1</span> <span class="main">=</span> real_of_int <span class="var">?k2</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="var">?γ2</span> <span class="main">∧</span>
                                     line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ1</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> assms reparam_weak_eq_line_integrals_basis<span class="main">[</span><span class="operator">OF</span> 0 1 2 assms<span class="main"><span class="main"><span class="main">(</span></span></span>4<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main">]</span>
              ass2 ass3 3
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"real_of_int <span class="skolem">k1</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ1</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">k1</span><span class="main">,</span> <span class="skolem">γ1</span><span class="main">)</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k2</span><span class="main">,</span> <span class="bound">γ2</span><span class="main">)</span> <span class="main">⇒</span> real_of_int <span class="bound">k2</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ2</span><span class="main">)</span> <span class="main">∧</span>
                                   line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ1</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> case_prod_beta'<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k1</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ass2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k1</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> bound1 ass1 f<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> boundary_chain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?k2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k1</span><span class="main">,</span> <span class="skolem">γ1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?γ2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k1</span><span class="main">,</span> <span class="skolem">γ1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_int <span class="skolem">k1</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ1</span> <span class="main">=</span> real_of_int <span class="var">?k2</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="var">?γ2</span> <span class="main">∧</span>
                              line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ1</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> ass3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?k2</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"reparam_weak <span class="skolem">γ1</span> <span class="main">(</span>reversepath <span class="var">?γ2</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> ass1 ass2 f<span class="main">(</span>2<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>reversepath <span class="var">?γ2</span><span class="main">)</span> <span class="keyword1">C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> f<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> ass1 smooth_path_imp_reverse
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> continuous_on <span class="main">(</span>path_image <span class="main">(</span>reversepath <span class="var">?γ2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> f<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> ass1 path_image_reversepath
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="free">basis</span> <span class="var">?γ2</span> <span class="main">=</span> <span class="main">-</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>reversepath <span class="var">?γ2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span><span class="quoted"><span class="quoted">"valid_path <span class="main">(</span>reversepath <span class="var">?γ2</span><span class="main">)</span> "</span></span>
              <span class="keyword1"><span class="command">using</span></span> 1 C1_differentiable_imp_piecewise
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_path_def<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
              <span class="keyword1"><span class="command">using</span></span> line_integral_on_reverse_path<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> i line_integral_exists_smooth<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 1 2 assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"real_of_int <span class="skolem">k1</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ1</span> <span class="main">=</span> real_of_int <span class="var">?k2</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="var">?γ2</span> <span class="main">∧</span>
                                     line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ1</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> assms reparam_weak_eq_line_integrals_basis<span class="main">[</span><span class="operator">OF</span> 0 1 2 assms<span class="main"><span class="main"><span class="main">(</span></span></span>4<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main">]</span>
              ass2 ass3 3
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?k2</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ass3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?k2</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> bound2 ass1 f<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> boundary_chain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"reparam_weak <span class="skolem">γ1</span> <span class="var">?γ2</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> ass1 ass2 f<span class="main">(</span>2<span class="main">)</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?γ2</span> <span class="keyword1">C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> f<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> ass1  <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> continuous_on <span class="main">(</span>path_image <span class="var">?γ2</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> f<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> ass1  <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"real_of_int <span class="skolem">k1</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ1</span> <span class="main">=</span> real_of_int <span class="var">?k2</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="var">?γ2</span> <span class="main">∧</span>
                                     line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ1</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> assms reparam_weak_eq_line_integrals_basis<span class="main">[</span><span class="operator">OF</span> 0 1 2 assms<span class="main"><span class="main"><span class="main">(</span></span></span>4<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main">]</span>  ass2 ass3
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"real_of_int <span class="skolem">k1</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ1</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">k1</span><span class="main">,</span> <span class="skolem">γ1</span><span class="main">)</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k2</span><span class="main">,</span> <span class="bound">γ2</span><span class="main">)</span> <span class="main">⇒</span> real_of_int <span class="bound">k2</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ2</span><span class="main">)</span> <span class="main">∧</span>
                                   line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ1</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> case_prod_beta'<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">one_chain1</span> <span class="main">⟹</span>
                                <span class="main">(</span><span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>real_of_int <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">⇒</span> real_of_int <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∧</span>
                                                        line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> case_prod_beta'<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">one_chain1</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">one_chain2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 0 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_chain_line_integral_def sum_bij<span class="main"><span class="main">[</span></span><span class="operator">OF</span> f<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span> _ f<span class="main"><span class="main"><span class="main">(</span></span></span>3<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span> split_beta<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain1</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">chain_reparam_chain</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">chain_reparam_chain</span> <span class="free"><span class="bound"><span class="entity">one_chain1</span></span></span> <span class="free"><span class="bound"><span class="entity">one_chain2</span></span></span> <span class="main">≡</span>
      <span class="main">∃</span><span class="bound">f</span><span class="main">.</span> bij <span class="bound">f</span> <span class="main">∧</span> <span class="bound">f</span> <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">one_chain1</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">one_chain2</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">one_chain1</span></span></span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> fst <span class="main">(</span><span class="bound">f</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> reparam <span class="bound">γ</span> <span class="main">(</span>snd <span class="main">(</span><span class="bound">f</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> reparam <span class="bound">γ</span> <span class="main">(</span>reversepath <span class="main">(</span>snd <span class="main">(</span><span class="bound">f</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">chain_reparam_weak_path</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>real<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>real <span class="main">*</span> real<span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span>int <span class="main">*</span> <span class="main">(</span><span class="main">(</span>real<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>real <span class="main">*</span> real<span class="main">)</span><span class="main">)</span><span class="main">)</span> set<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">chain_reparam_weak_path</span> <span class="free"><span class="bound"><span class="entity">γ</span></span></span> <span class="free"><span class="bound"><span class="entity">one_chain</span></span></span>
           <span class="main">≡</span> <span class="main">∃</span><span class="bound">l</span><span class="main">.</span> set <span class="bound">l</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">one_chain</span></span></span> <span class="main">∧</span> distinct <span class="bound">l</span> <span class="main">∧</span> reparam <span class="free"><span class="bound"><span class="entity">γ</span></span></span> <span class="main">(</span>rec_join <span class="bound">l</span><span class="main">)</span> <span class="main">∧</span> valid_chain_list <span class="bound">l</span> <span class="main">∧</span> <span class="bound">l</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>

<span class="keyword1" id="Paths-chain_reparam_chain_line_integral"><span class="command">lemma</span></span> chain_reparam_chain_line_integral<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"chain_reparam_chain <span class="free">one_chain1</span> <span class="free">one_chain2</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k2</span><span class="main">,</span><span class="bound">γ2</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain2</span><span class="main">.</span> <span class="bound">γ2</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k2</span><span class="main">,</span><span class="bound">γ2</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain2</span><span class="main">.</span><span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> continuous_on <span class="main">(</span>path_image <span class="bound">γ2</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"finite <span class="free">basis</span>"</span></span>                                                                     
  <span class="keyword2"><span class="keyword">and</span></span> bound1<span class="main">:</span> <span class="quoted"><span class="quoted">"boundary_chain <span class="free">one_chain1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> bound2<span class="main">:</span> <span class="quoted"><span class="quoted">"boundary_chain <span class="free">one_chain2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> line<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k2</span><span class="main">,</span><span class="bound">γ2</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain2</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="bound">b</span><span class="main">}</span> <span class="bound">γ2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">one_chain1</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">one_chain2</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain1</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"bij <span class="skolem">f</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain1</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> fst <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> reparam <span class="bound">γ</span> <span class="main">(</span>snd <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> reparam <span class="bound">γ</span> <span class="main">(</span>reversepath <span class="main">(</span>snd <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">`</span> <span class="free">one_chain1</span> <span class="main">=</span> <span class="free">one_chain2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> chain_reparam_chain_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> integ_exist_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k1</span><span class="main">,</span><span class="bound">γ1</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain1</span><span class="main">.</span> <span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="bound">b</span><span class="main">}</span> <span class="main">(</span>snd <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="bound">k1</span><span class="main">,</span> <span class="bound">γ1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> line f <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> valid_cubes<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k1</span><span class="main">,</span><span class="bound">γ1</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain1</span><span class="main">.</span> valid_path <span class="main">(</span>snd <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="bound">k1</span><span class="main">,</span> <span class="bound">γ1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> f<span class="main">(</span>3<span class="main">)</span> valid_path_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> integ_rev_exist_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k1</span><span class="main">,</span><span class="bound">γ1</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain1</span><span class="main">.</span> <span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="bound">b</span><span class="main">}</span> <span class="main">(</span>reversepath <span class="main">(</span>snd <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="bound">k1</span><span class="main">,</span> <span class="bound">γ1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> line_integral_on_reverse_path<span class="main">(</span>2<span class="main">)</span> integ_exist_b valid_cubes
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>                             
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">one_chain1</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>real_of_int <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">⇒</span> real_of_int <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∧</span>
                                                        line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k1</span> <span class="skolem">γ1</span>
      <span class="keyword3"><span class="command">assume</span></span> ass1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k1</span><span class="main">,</span><span class="skolem">γ1</span><span class="main">)</span> <span class="main">∈</span><span class="free">one_chain1</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_int <span class="skolem">k1</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ1</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k1</span><span class="main">,</span><span class="skolem">γ1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k2</span><span class="main">,</span> <span class="bound">γ2</span><span class="main">)</span> <span class="main">⇒</span> real_of_int <span class="bound">k2</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ2</span><span class="main">)</span> <span class="main">∧</span>
                      line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ1</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> ass2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?k2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k1</span><span class="main">,</span> <span class="skolem">γ1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?γ2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k1</span><span class="main">,</span> <span class="skolem">γ1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_int <span class="skolem">k1</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ1</span> <span class="main">=</span> real_of_int <span class="var">?k2</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="var">?γ2</span><span class="main">∧</span>
                              line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ1</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> ass3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?k2</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"reparam <span class="skolem">γ1</span> <span class="var">?γ2</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> ass1 ass2 f<span class="main">(</span>2<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?γ2</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> f<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> ass1
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> continuous_on <span class="main">(</span>path_image <span class="var">?γ2</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> f<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> ass1
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"real_of_int <span class="skolem">k1</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ1</span> <span class="main">=</span> real_of_int <span class="var">?k2</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="var">?γ2</span> <span class="main">∧</span>
                                     line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ1</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> assms reparam_eq_line_integrals_basis<span class="main">[</span><span class="operator">OF</span> 0 1 2 assms<span class="main"><span class="main"><span class="main">(</span></span></span>4<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main">]</span> integ_exist_b
              ass1 ass2 ass3
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?k2</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ass3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?k2</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> bound2 ass1 f<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> boundary_chain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"reparam <span class="skolem">γ1</span> <span class="main">(</span>reversepath <span class="var">?γ2</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> ass1 ass2 f<span class="main">(</span>2<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>reversepath <span class="var">?γ2</span><span class="main">)</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> f<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> ass1 piecewise_smooth_path_imp_reverse
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> continuous_on <span class="main">(</span>path_image <span class="main">(</span>reversepath <span class="var">?γ2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> f<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> ass1 path_image_reversepath
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="free">basis</span> <span class="var">?γ2</span> <span class="main">=</span> <span class="main">-</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>reversepath <span class="var">?γ2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span><span class="quoted"><span class="quoted">"valid_path <span class="main">(</span>reversepath <span class="var">?γ2</span><span class="main">)</span> "</span></span>
              <span class="keyword1"><span class="command">using</span></span> 1 C1_differentiable_imp_piecewise
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_path_def<span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>snd <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k1</span><span class="main">,</span> <span class="skolem">γ1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> line_integral_sum_basis<span class="main">(</span>2<span class="main">)</span> integ_exist_b ass1
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>                                            
              <span class="keyword1"><span class="command">using</span></span> i ii line_integral_on_reverse_path<span class="main">(</span>1<span class="main">)</span> valid_path_reversepath <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"real_of_int <span class="skolem">k1</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ1</span> <span class="main">=</span> real_of_int <span class="var">?k2</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="var">?γ2</span> <span class="main">∧</span>
                                     line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ1</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> assms reparam_eq_line_integrals_basis<span class="main">[</span><span class="operator">OF</span> 0 1 2 assms<span class="main"><span class="main"><span class="main">(</span></span></span>4<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main">]</span> integ_rev_exist_b
              ass1 ass2 ass3 3 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"real_of_int <span class="skolem">k1</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ1</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">k1</span><span class="main">,</span> <span class="skolem">γ1</span><span class="main">)</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k2</span><span class="main">,</span> <span class="bound">γ2</span><span class="main">)</span> <span class="main">⇒</span> real_of_int <span class="bound">k2</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ2</span><span class="main">)</span> <span class="main">∧</span>
                                   line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ1</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> case_prod_beta'<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k1</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ass2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k1</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> bound1 ass1 f<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> boundary_chain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?k2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k1</span><span class="main">,</span> <span class="skolem">γ1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?γ2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k1</span><span class="main">,</span> <span class="skolem">γ1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_int <span class="skolem">k1</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ1</span> <span class="main">=</span> real_of_int <span class="var">?k2</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="var">?γ2</span> <span class="main">∧</span>
                              line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ1</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> ass3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?k2</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"reparam <span class="skolem">γ1</span> <span class="main">(</span>reversepath <span class="var">?γ2</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> ass1 ass2 f<span class="main">(</span>2<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>reversepath <span class="var">?γ2</span><span class="main">)</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> f<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> ass1 piecewise_smooth_path_imp_reverse
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> continuous_on <span class="main">(</span>path_image <span class="main">(</span>reversepath <span class="var">?γ2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> f<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> ass1 path_image_reversepath
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="free">basis</span> <span class="var">?γ2</span> <span class="main">=</span> <span class="main">-</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>reversepath <span class="var">?γ2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span><span class="quoted"><span class="quoted">"valid_path <span class="main">(</span>reversepath <span class="var">?γ2</span><span class="main">)</span> "</span></span>
              <span class="keyword1"><span class="command">using</span></span> 1 C1_differentiable_imp_piecewise
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_path_def<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
              <span class="keyword1"><span class="command">using</span></span> line_integral_on_reverse_path<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> i<span class="main">]</span> integ_rev_exist_b
              <span class="keyword1"><span class="command">using</span></span> ass1 assms<span class="main">(</span>4<span class="main">)</span> line_integral_sum_basis<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"real_of_int <span class="skolem">k1</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ1</span> <span class="main">=</span> real_of_int <span class="var">?k2</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="var">?γ2</span> <span class="main">∧</span>
                                     line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ1</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> assms reparam_eq_line_integrals_basis<span class="main">[</span><span class="operator">OF</span> 0 1 2 assms<span class="main"><span class="main"><span class="main">(</span></span></span>4<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main">]</span>
              ass2 ass3 3
            <span class="keyword1"><span class="command">using</span></span> ass1 integ_rev_exist_b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?k2</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ass3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?k2</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> bound2 ass1 f<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> boundary_chain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"reparam <span class="skolem">γ1</span> <span class="var">?γ2</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> ass1 ass2 f<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?γ2</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> f<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> ass1
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> continuous_on <span class="main">(</span>path_image <span class="var">?γ2</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> f<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> ass1
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"real_of_int <span class="skolem">k1</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ1</span> <span class="main">=</span> real_of_int <span class="var">?k2</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="var">?γ2</span> <span class="main">∧</span>
                                     line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ1</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> assms reparam_eq_line_integrals_basis<span class="main">[</span><span class="operator">OF</span> 0 1 2 assms<span class="main"><span class="main"><span class="main">(</span></span></span>4<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main">]</span>
              ass2 ass3
            <span class="keyword1"><span class="command">using</span></span> ass1 integ_exist_b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"real_of_int <span class="skolem">k1</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ1</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">k1</span><span class="main">,</span> <span class="skolem">γ1</span><span class="main">)</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k2</span><span class="main">,</span> <span class="bound">γ2</span><span class="main">)</span> <span class="main">⇒</span> real_of_int <span class="bound">k2</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ2</span><span class="main">)</span> <span class="main">∧</span>
                                   line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ1</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> case_prod_beta'<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">one_chain1</span> <span class="main">⟹</span>
                                <span class="main">(</span><span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>real_of_int <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">⇒</span> real_of_int <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∧</span>
                                                        line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> case_prod_beta'<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">one_chain1</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">one_chain2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_chain_line_integral_def sum_bij<span class="main"><span class="main">[</span></span><span class="operator">OF</span> f<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span> _ f<span class="main"><span class="main"><span class="main">(</span></span></span>3<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span> prod.case_eq_if<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain1</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-path_image_rec_join"><span class="command">lemma</span></span> path_image_rec_join<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">γ</span><span class="main">::</span><span class="quoted"><span class="quoted">"real <span class="main">⇒</span> <span class="main">(</span>real <span class="main">×</span> real<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">k</span><span class="main">::</span><span class="quoted">int</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">l</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span> <span class="bound">γ</span><span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">l</span> <span class="main">⟹</span> valid_chain_list <span class="free">l</span> <span class="main">⟹</span> path_image <span class="bound">γ</span> <span class="main">⊆</span> path_image <span class="main">(</span>rec_join <span class="free">l</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> ass<span class="main">:</span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">l</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k'</span></span> <span class="skolem"><span class="skolem">γ'</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">k'</span><span class="main">,</span><span class="skolem">γ'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path_image <span class="skolem">γ</span> <span class="main">⊆</span> path_image <span class="main">(</span>rec_join <span class="main">(</span><span class="main">(</span><span class="skolem">k'</span><span class="main">,</span><span class="skolem">γ'</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">=</span><span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"path_image <span class="skolem">γ</span> <span class="main">⊆</span> path_image <span class="main">(</span>rec_join <span class="main">(</span><span class="main">(</span><span class="skolem">k'</span><span class="main">,</span><span class="skolem">γ'</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ass<span class="main">(</span>2-3<span class="main">)</span> a
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">≠</span><span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">l'</span></span> <span class="keyword2"><span class="keyword">where</span></span> b_l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">#</span> <span class="skolem">l'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> rec_join.elims<span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k''</span></span> <span class="skolem"><span class="skolem">γ''</span></span> <span class="keyword2"><span class="keyword">where</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">k''</span><span class="main">,</span><span class="skolem">γ''</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> ass path_image_reversepath b_l path_image_join
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> a  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-path_image_rec_join_2"><span class="command">lemma</span></span> path_image_rec_join_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">l</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> valid_chain_list <span class="free">l</span> <span class="main">⟹</span> path_image <span class="main">(</span>rec_join <span class="free">l</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">l</span><span class="main">.</span> path_image <span class="bound">γ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> ass<span class="main">:</span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">l</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k'</span></span> <span class="skolem"><span class="skolem">γ'</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">k'</span><span class="main">,</span><span class="skolem">γ'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path_image <span class="main">(</span>rec_join <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">l</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">l</span><span class="main">)</span><span class="main">.</span> path_image <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">=</span><span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"path_image <span class="main">(</span>rec_join <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">l</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">l</span><span class="main">)</span><span class="main">.</span> path_image <span class="bound">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> step a  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">≠</span><span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">l'</span></span> <span class="keyword2"><span class="keyword">where</span></span> b_l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">#</span> <span class="skolem">l'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> rec_join.elims<span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k''</span></span> <span class="skolem"><span class="skolem">γ''</span></span> <span class="keyword2"><span class="keyword">where</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">k''</span><span class="main">,</span><span class="skolem">γ''</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> ass
        path_image_reversepath b_l path_image_join
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a<span class="main">)</span> <span class="comment1">(*Excuse the ugliness of the next script*)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-continuous_on_closed_UN"><span class="command">lemma</span></span> continuous_on_closed_UN<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> closed <span class="bound">s</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> continuous_on <span class="bound">s</span> <span class="free">f</span><span class="main">)</span> <span class="main">⟹</span> continuous_on <span class="main">(</span><span class="main">⋃</span><span class="free">S</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">S</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> empty
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> continuous_on_closed_Un closed_Union
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> closed_Union continuous_on_closed_Un<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-chain_reparam_weak_path_line_integral"><span class="command">lemma</span></span> chain_reparam_weak_path_line_integral<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path_eq_chain<span class="main">:</span> <span class="quoted"><span class="quoted">"chain_reparam_weak_path <span class="free">γ</span> <span class="free">one_chain</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    boundary_chain<span class="main">:</span> <span class="quoted"><span class="quoted">"boundary_chain <span class="free">one_chain</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    line_integral_exists<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> <span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">one_chain</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="bound">b</span><span class="main">}</span> <span class="bound">γ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    valid_path<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">one_chain</span><span class="main">.</span> valid_path <span class="bound">γ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    finite_basis<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">basis</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
    cont<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> <span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ2</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain</span><span class="main">.</span> continuous_on <span class="main">(</span>path_image <span class="bound">γ2</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    finite_one_chain<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">one_chain</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">γ</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">one_chain</span>"</span></span>
    <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="free">γ</span>"</span></span>
    <span class="comment1">(*"valid_path γ" This cannot be proven, see the crappy assumption of derivs/eq_pw_smooth :( *)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> l_props<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">l</span> <span class="main">=</span> <span class="free">one_chain</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">l</span>"</span></span> <span class="quoted"><span class="quoted">"reparam <span class="free">γ</span> <span class="main">(</span>rec_join <span class="skolem">l</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"valid_chain_list <span class="skolem">l</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> chain_reparam_weak_path_def assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> bchain_l<span class="main">:</span> <span class="quoted"><span class="quoted">"boundary_chain <span class="main">(</span>set <span class="skolem">l</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> l_props boundary_chain
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_chain_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> cont_forall<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> continuous_on <span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain</span><span class="main">.</span> path_image <span class="bound">γ</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span>
    <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">basis</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="main">(</span>path_image <span class="main">∘</span> snd<span class="main">)</span> <span class="main">`</span> <span class="free">one_chain</span><span class="main">)</span><span class="main">)</span>  <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> continuous_on_closed_UN<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?S</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span>path_image <span class="keyword1"><span class="keyword1">o</span></span> snd<span class="main"><span class="main">)</span></span> <span class="main"><span class="main">`</span></span> <span class="free"><span class="free">one_chain</span></span>"</span></span></span> <span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">one_chain</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_one_chain <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> <span class="main">(</span>path_image <span class="main">∘</span> snd<span class="main">)</span> <span class="main">`</span> <span class="free">one_chain</span> <span class="main">⟹</span> closed <span class="bound">s</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span>  closed_valid_path_image<span class="main">[</span><span class="operator">OF</span><span class="main">]</span> valid_path  
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> <span class="main">(</span>path_image <span class="main">∘</span> snd<span class="main">)</span> <span class="main">`</span> <span class="free">one_chain</span> <span class="main">⟹</span> continuous_on <span class="bound">s</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> cont ass <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain</span><span class="main">.</span> path_image <span class="bound">γ</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Union_eq case_prod_beta<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="free">γ</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> reparam_eq_line_integrals_basis<span class="main"><span class="main">[</span></span><span class="operator">OF</span> l_props<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> _ _  finite_basis<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?γ2.0</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"rec_join <span class="skolem">l</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?γ2.0</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> valid_path_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> joined_is_valid<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> assms l_props <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> continuous_on <span class="main">(</span>path_image <span class="main">(</span>rec_join <span class="skolem">l</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> path_image_rec_join_2<span class="main">[</span><span class="operator">OF</span> l_props<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> l_props<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span> l_props<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> cont_forall continuous_on_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="bound">b</span><span class="main">}</span> <span class="main">(</span>rec_join <span class="skolem">l</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span>
      <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">∈</span><span class="free">basis</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="skolem">b</span><span class="main">}</span> <span class="main">(</span>rec_join <span class="skolem">l</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> line_integral_exists_on_rec_join<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"boundary_chain <span class="main">(</span>set <span class="skolem">l</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> l_props boundary_chain <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"valid_chain_list <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l_props <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span> <span class="bound">γ</span><span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">l</span> <span class="main">⟹</span> valid_path <span class="bound">γ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l_props assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span>set <span class="skolem">l</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="skolem">b</span><span class="main">}</span> <span class="bound">γ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l_props line_integral_exists ass <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">γ</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">one_chain</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>rec_join <span class="skolem">l</span><span class="main">)</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">one_chain</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> one_chain_line_integral_rec_join<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">l</span> <span class="main">=</span> <span class="free">one_chain</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">l</span>"</span></span> <span class="quoted"><span class="quoted">"valid_chain_list <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l_props <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"boundary_chain <span class="free">one_chain</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> boundary_chain <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> line_integral_sum_basis<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> finite_basis<span class="main">]</span> line_integral_exists <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain</span><span class="main">.</span> valid_path <span class="bound">γ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> valid_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">basis</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_basis <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">γ</span> <span class="main">=</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>rec_join <span class="skolem">l</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> reparam_eq_line_integrals_basis<span class="main"><span class="main">[</span></span><span class="operator">OF</span> l_props<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> _ _  finite_basis<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?γ2.0</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"rec_join <span class="skolem">l</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?γ2.0</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> valid_path_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> joined_is_valid<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> assms l_props <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> continuous_on <span class="main">(</span>path_image <span class="main">(</span>rec_join <span class="skolem">l</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> path_image_rec_join_2<span class="main">[</span><span class="operator">OF</span> l_props<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> l_props<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span> l_props<span class="main">(</span>1<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> cont_forall continuous_on_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="bound">b</span><span class="main">}</span> <span class="main">(</span>rec_join <span class="skolem">l</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span>
        <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">∈</span><span class="free">basis</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="skolem">b</span><span class="main">}</span> <span class="main">(</span>rec_join <span class="skolem">l</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> line_integral_exists_on_rec_join<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"boundary_chain <span class="main">(</span>set <span class="skolem">l</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> l_props boundary_chain <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"valid_chain_list <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l_props <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span> <span class="bound">γ</span><span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">l</span> <span class="main">⟹</span> valid_path <span class="bound">γ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l_props assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span>set <span class="skolem">l</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="skolem">b</span><span class="main">}</span> <span class="bound">γ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l_props line_integral_exists ass <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">γ</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">one_chain</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i ii <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">chain_reparam_chain'</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">chain_reparam_chain'</span> <span class="free"><span class="bound"><span class="entity">one_chain1</span></span></span> <span class="free"><span class="bound"><span class="entity">subdiv</span></span></span>
       <span class="main">≡</span> <span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="bound">f</span> <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">one_chain1</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">subdiv</span></span></span><span class="main">)</span> <span class="main">∧</span>
              <span class="main">(</span><span class="main">∀</span><span class="bound">cube</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">one_chain1</span></span></span><span class="main">.</span> chain_reparam_weak_path <span class="main">(</span>rec_join <span class="main">[</span><span class="bound">cube</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">cube</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
              <span class="main">(</span><span class="main">∀</span><span class="bound">p</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">one_chain1</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">p'</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">one_chain1</span></span></span><span class="main">.</span> <span class="bound">p</span> <span class="main">≠</span> <span class="bound">p'</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="bound">p</span> <span class="main">∩</span> <span class="bound">f</span> <span class="bound">p'</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∧</span>
              <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">one_chain1</span></span></span><span class="main">.</span> finite <span class="main">(</span><span class="bound">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Paths-chain_reparam_chain'_imp_finite_subdiv"><span class="command">lemma</span></span> chain_reparam_chain'_imp_finite_subdiv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">one_chain1</span>"</span></span>
    <span class="quoted"><span class="quoted">"chain_reparam_chain' <span class="free">one_chain1</span> <span class="free">subdiv</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">subdiv</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> chain_reparam_chain'_def<span class="main">)</span>

<span class="keyword1" id="Paths-chain_reparam_chain'_line_integral"><span class="command">lemma</span></span> chain_reparam_chain'_line_integral<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> chain1_eq_chain2<span class="main">:</span> <span class="quoted"><span class="quoted">"chain_reparam_chain' <span class="free">one_chain1</span> <span class="free">subdiv</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    boundary_chain1<span class="main">:</span> <span class="quoted"><span class="quoted">"boundary_chain <span class="free">one_chain1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    boundary_chain2<span class="main">:</span> <span class="quoted"><span class="quoted">"boundary_chain <span class="free">subdiv</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    line_integral_exists_on_chain2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> <span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">subdiv</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="bound">b</span><span class="main">}</span> <span class="bound">γ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    valid_path<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">subdiv</span><span class="main">.</span> valid_path <span class="bound">γ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    valid_path_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">one_chain1</span><span class="main">.</span> valid_path <span class="bound">γ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    finite_chain1<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">one_chain1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    finite_basis<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">basis</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    cont_field<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> <span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ2</span><span class="main">)</span><span class="main">∈</span><span class="free">subdiv</span><span class="main">.</span> continuous_on <span class="main">(</span>path_image <span class="bound">γ2</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">one_chain1</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">subdiv</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">one_chain1</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f_props<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="free">one_chain1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">subdiv</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">cube</span> <span class="main">∈</span> <span class="free">one_chain1</span><span class="main">.</span> chain_reparam_weak_path <span class="main">(</span>rec_join <span class="main">[</span><span class="bound">cube</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">cube</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">p</span><span class="main">∈</span><span class="free">one_chain1</span><span class="main">.</span> <span class="main">∀</span><span class="bound">p'</span><span class="main">∈</span><span class="free">one_chain1</span><span class="main">.</span> <span class="bound">p</span> <span class="main">≠</span> <span class="bound">p'</span> <span class="main">⟶</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">∩</span> <span class="skolem">f</span> <span class="bound">p'</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">one_chain1</span><span class="main">.</span> finite <span class="main">(</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> chain1_eq_chain2 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> chain_reparam_chain'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">subdiv</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="free">one_chain1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="skolem">γ</span>
    <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">one_chain1</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ</span> <span class="main">∧</span>
               one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> k_eq_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span><span class="quoted"><span class="quoted">"chain_reparam_weak_path <span class="skolem">γ</span> <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>2<span class="main">)</span> ass <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span><span class="quoted"><span class="quoted">"boundary_chain <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>1<span class="main">)</span> ass assms  <span class="keyword1"><span class="command">unfolding</span></span> boundary_chain_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> iii<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> <span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="bound">b</span><span class="main">}</span> <span class="bound">γ</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>1<span class="main">)</span> ass assms
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted">"iv"</span><span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">.</span> valid_path <span class="bound">γ</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>1<span class="main">)</span> ass assms
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> <span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ2</span><span class="main">)</span><span class="main">∈</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">.</span> continuous_on <span class="main">(</span>path_image <span class="bound">γ2</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>1<span class="main">)</span> ass assms
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>        
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ</span> <span class="main">∧</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> chain_reparam_weak_path_line_integral<span class="main">[</span><span class="operator">OF</span> i ii iii iv finite_basis v<span class="main">]</span> ass f_props<span class="main">(</span>4<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ</span> <span class="main">∧</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> k_eq_1  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> k_eq_neg1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ass boundary_chain1
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_chain_def<span class="main">)</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span><span class="quoted"><span class="quoted">"chain_reparam_weak_path <span class="main">(</span>reversepath <span class="skolem">γ</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>2<span class="main">)</span> ass <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span><span class="quoted"><span class="quoted">"boundary_chain <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>1<span class="main">)</span> ass assms <span class="keyword1"><span class="command">unfolding</span></span> boundary_chain_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> iii<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> <span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="bound">b</span><span class="main">}</span> <span class="bound">γ</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>1<span class="main">)</span> ass assms
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted">"iv"</span><span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">.</span> valid_path <span class="bound">γ</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>1<span class="main">)</span> ass assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> <span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ2</span><span class="main">)</span><span class="main">∈</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">.</span> continuous_on <span class="main">(</span>path_image <span class="bound">γ2</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>1<span class="main">)</span> ass assms  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>        
      <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span><span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>reversepath <span class="skolem">γ</span><span class="main">)</span> <span class="main">∧</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span>reversepath <span class="skolem">γ</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> chain_reparam_weak_path_line_integral<span class="main">[</span><span class="operator">OF</span> i ii iii iv finite_basis v<span class="main">]</span> ass f_props<span class="main">(</span>4<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="main">(</span>reversepath <span class="skolem">γ</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>1<span class="main">)</span> ass assms  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ</span> <span class="main">∧</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span>line_integral <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> line_integral_on_reverse_path reversepath_reversepath x ass
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ</span> <span class="main">∧</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">::</span>int<span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> k_eq_neg1  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span><span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">note</span></span> cube_line_integ <span class="main">=</span> this
  <span class="keyword1"><span class="command">have</span></span> finite_chain2<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">subdiv</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> finite_chain1 f_props<span class="main">(</span>1<span class="main">)</span> f_props<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> line_integral_exists_on_chain1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">one_chain1</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cube_line_integ <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="free">one_chain1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">one_chain1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span><span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="free">one_chain1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
                           <span class="main">(</span><span class="main">∑</span><span class="bound">one_chain</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="free">one_chain1</span><span class="main">)</span><span class="main">.</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">one_chain</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> finite<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">chain</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="free">one_chain1</span><span class="main">)</span><span class="main">.</span> finite <span class="bound">chain</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>1<span class="main">)</span> finite_chain2 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Sup_upper finite_subset<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> disj<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">A</span><span class="main">∈</span><span class="skolem">f</span> <span class="main">`</span> <span class="free">one_chain1</span><span class="main">.</span> <span class="main">∀</span><span class="bound">B</span><span class="main">∈</span><span class="skolem">f</span> <span class="main">`</span> <span class="free">one_chain1</span><span class="main">.</span> <span class="bound">A</span> <span class="main">≠</span> <span class="bound">B</span> <span class="main">⟶</span> <span class="bound">A</span> <span class="main">∩</span> <span class="bound">B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>image_def<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>3<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="free">one_chain1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
                                <span class="main">(</span><span class="main">∑</span><span class="bound">one_chain</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="free">one_chain1</span><span class="main">)</span><span class="main">.</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">one_chain</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Groups_Big.comm_monoid_add_class.sum.Union_disjoint<span class="main">[</span><span class="operator">OF</span> finite disj<span class="main">]</span>
          one_chain_line_integral_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">one_chain</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="free">one_chain1</span><span class="main">)</span><span class="main">.</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">one_chain</span><span class="main">)</span> <span class="main">=</span> 
                            one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">one_chain1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">one_chain</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="free">one_chain1</span><span class="main">)</span><span class="main">.</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">one_chain</span><span class="main">)</span> <span class="main">=</span> 
                                     <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain1</span><span class="main">.</span> <span class="bound">k</span><span class="main">*</span><span class="main">(</span>line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">one_chain</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">one_chain</span><span class="main">)</span> <span class="main">=</span> 
                                       <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">.</span> <span class="bound">k</span><span class="main">*</span><span class="main">(</span>line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">f</span> <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def
            <span class="keyword1"><span class="command">using</span></span> f_props<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">one_chain</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">one_chain</span><span class="main">)</span>
                                                       <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> Groups_Big.comm_monoid_add_class.sum.reindex
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">k</span> <span class="bound">γ</span><span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">)</span> <span class="main">⟹</span>
                                                     one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="bound">k</span><span class="main">*</span> <span class="main">(</span>line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> cube_line_integ <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                   <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="bound">k</span><span class="main">*</span> <span class="main">(</span>line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Finite_Cartesian_Product.sum_cong_aux<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">one_chain</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">one_chain</span><span class="main">)</span> <span class="main">=</span>
                                                     <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="bound">k</span><span class="main">*</span> <span class="main">(</span>line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> 0  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">)</span> <span class="bound">γ</span><span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">one_chain1</span> <span class="main">⟹</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">k'</span><span class="main">,</span><span class="bound">γ'</span><span class="main">)</span><span class="main">.</span> <span class="bound">k'</span><span class="main">*</span> <span class="main">(</span>line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ'</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span><span class="main">::</span><span class="quoted"><span class="quoted">"int"</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">γ</span><span class="main">::</span><span class="quoted"><span class="quoted">"real<span class="main">⇒</span>real<span class="main">*</span>real"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">one_chain1</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> zero_line_integral<span class="main">:</span><span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> one_chain_line_integral_def
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">k'</span><span class="main">::</span>int<span class="main">,</span> <span class="bound">γ'</span><span class="main">)</span><span class="main">.</span> <span class="bound">k'</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ'</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> zero_line_integral cube_line_integ ass
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">one_chain</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">one_chain</span><span class="main">)</span> <span class="main">=</span>
                                                          <span class="main">(</span><span class="main">∑</span><span class="bound">one_chain</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="main">(</span><span class="free">one_chain1</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">one_chain</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">one_chain</span><span class="main">.</span> <span class="bound">one_chain</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="main">(</span><span class="free">one_chain1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
                                                         one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">one_chain</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">one_chain</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">one_chain</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="main">(</span><span class="free">one_chain1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">one_chain</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="skolem">one_chain</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_chain_line_integral_def<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">one_chain</span> <span class="main">∈</span> <span class="skolem">f</span> <span class="main">`</span> <span class="main">(</span><span class="free">one_chain1</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">one_chain</span><span class="main">)</span> 
                                                       <span class="main">=</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> Groups_Big.comm_monoid_add_class.sum.neutral
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">one_chain</span> <span class="main">∈</span> <span class="skolem">f</span> <span class="main">`</span> <span class="main">(</span><span class="free">one_chain1</span><span class="main">)</span><span class="main">.</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">one_chain</span><span class="main">)</span>
                                                      <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">one_chain</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">one_chain</span><span class="main">)</span> 
                                                       <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> finte<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="free">one_chain1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_chain1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> Groups_Big.sum_diff<span class="main">[</span><span class="operator">OF</span> finte<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span>"</span></span><span class="main">]</span>
                0
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>                                           
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">one_chain</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">one_chain</span><span class="main">)</span> <span class="main">=</span>
                                                          <span class="main">(</span><span class="main">∑</span><span class="bound">one_chain</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="main">(</span><span class="free">one_chain1</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">one_chain</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">)</span> <span class="bound">γ</span><span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">one_chain1</span> <span class="main">⟹</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">chain</span><span class="main">.</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">chain</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span><span class="main">::</span><span class="quoted"><span class="quoted">"int"</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">γ</span><span class="main">::</span><span class="quoted"><span class="quoted">"real<span class="main">⇒</span>real<span class="main">*</span>real"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">one_chain1</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> one_chain_line_integral_def
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">p'</span><span class="main">.</span> <span class="main">(</span>one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">p'</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> iii<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">.</span> <span class="bound">k</span><span class="main">*</span><span class="main">(</span>line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span><span class="main">)</span><span class="main">)</span>
                                                 <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain1</span><span class="main">.</span> <span class="bound">k</span><span class="main">*</span><span class="main">(</span>line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">k</span> <span class="bound">γ</span><span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">)</span>
                                                    <span class="main">⟹</span> <span class="bound">k</span><span class="main">*</span> <span class="main">(</span>line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="skolem">γ</span>
            <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_chain_line_integral_def<span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> zero_line_integral<span class="main">:</span><span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> one_chain_line_integral_def
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">*</span> <span class="main">(</span>line_integral <span class="free">F</span> <span class="free">basis</span> <span class="skolem">γ</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> zero_line_integral cube_line_integ ass
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">.</span>
                       <span class="bound">k</span><span class="main">*</span> <span class="main">(</span>line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="bound">k</span><span class="main">*</span><span class="main">(</span>line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> Groups_Big.comm_monoid_add_class.sum.neutral
              <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">one_chain1</span> <span class="main">-</span> <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">.</span> <span class="bound">k</span><span class="main">*</span> <span class="main">(</span>line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> split_beta<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain1</span><span class="main">.</span> <span class="bound">k</span><span class="main">*</span><span class="main">(</span>line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span>
                                                    <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span> <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="bound">k</span><span class="main">*</span><span class="main">(</span>line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span><span class="main">)</span><span class="main">)</span>  <span class="main">=</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> Groups_Big.sum_diff<span class="main">[</span><span class="operator">OF</span> finite_chain1<span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> Diff_subset <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">f</span> <span class="bound">B</span><span class="main">.</span> <span class="bound">B</span> <span class="main">⊆</span> <span class="free">one_chain1</span> <span class="main">⟹</span> sum <span class="bound">f</span> <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="bound">B</span><span class="main">)</span> <span class="main">=</span> sum <span class="bound">f</span> <span class="free">one_chain1</span> <span class="main">-</span> sum <span class="bound">f</span> <span class="bound">B</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> i ii iii <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> one_chain_line_integral_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>                    
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 0 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">one_chain1</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">subdiv</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 0 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-chain_reparam_chain'_line_integral_smooth_cubes"><span class="command">lemma</span></span> chain_reparam_chain'_line_integral_smooth_cubes<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"chain_reparam_chain' <span class="free">one_chain1</span> <span class="free">one_chain2</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k2</span><span class="main">,</span><span class="bound">γ2</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain2</span><span class="main">.</span> <span class="bound">γ2</span> <span class="keyword1">C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span><span class="main">∀</span><span class="main">(</span><span class="bound">k2</span><span class="main">,</span><span class="bound">γ2</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain2</span><span class="main">.</span> continuous_on <span class="main">(</span>path_image <span class="bound">γ2</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"finite <span class="free">basis</span>"</span></span>                                                                     
    <span class="quoted"><span class="quoted">"finite <span class="free">one_chain1</span>"</span></span>
    <span class="quoted"><span class="quoted">"boundary_chain <span class="free">one_chain1</span>"</span></span>
    <span class="quoted"><span class="quoted">"boundary_chain <span class="free">one_chain2</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain1</span><span class="main">.</span> valid_path <span class="bound">γ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">one_chain1</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">one_chain2</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain1</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">basis</span>"</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="skolem">γ</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain2</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="skolem">b</span><span class="main">}</span> <span class="skolem">γ</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> line_integral_exists_smooth<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">one_chain2</span>›</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="free">one_chain2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="free">basis</span>›</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="free">basis</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> <span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain2</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="bound">b</span><span class="main">}</span> <span class="bound">γ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k2</span><span class="main">,</span><span class="bound">γ2</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain2</span><span class="main">.</span> valid_path <span class="bound">γ2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C1_differentiable_imp_piecewise case_prod_beta valid_path_def<span class="main">)</span>              
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">one_chain1</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">one_chain2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> chain_reparam_chain'_line_integral<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> a b assms<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain1</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> chain_reparam_chain'_line_integral<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> a b assms<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Paths-chain_subdiv_path_pathimg_subset"><span class="command">lemma</span></span> chain_subdiv_path_pathimg_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"chain_subdiv_path <span class="free">γ</span> <span class="free">subdiv</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k'</span><span class="main">,</span><span class="bound">γ'</span><span class="main">)</span><span class="main">∈</span><span class="free">subdiv</span><span class="main">.</span> <span class="main">(</span>path_image <span class="bound">γ'</span><span class="main">)</span> <span class="main">⊆</span> path_image <span class="free">γ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms chain_subdiv_path.simps path_image_rec_join
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> chain_subdiv_path.simps<span class="main">)</span>

<span class="keyword1" id="Paths-reparam_path_image"><span class="command">lemma</span></span> reparam_path_image<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"reparam <span class="free">γ1</span> <span class="free">γ2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"path_image <span class="free">γ1</span> <span class="main">=</span> path_image <span class="free">γ2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reparam_def path_image_def image_def bij_betw_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> equalityD2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Paths-chain_reparam_weak_path_pathimg_subset"><span class="command">lemma</span></span> chain_reparam_weak_path_pathimg_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"chain_reparam_weak_path <span class="free">γ</span> <span class="free">subdiv</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k'</span><span class="main">,</span><span class="bound">γ'</span><span class="main">)</span><span class="main">∈</span><span class="free">subdiv</span><span class="main">.</span> <span class="main">(</span>path_image <span class="bound">γ'</span><span class="main">)</span> <span class="main">⊆</span> path_image <span class="free">γ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> chain_reparam_weak_path_def<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> path_image_rec_join reparam_path_image <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Paths-chain_subdiv_chain_pathimg_subset'"><span class="command">lemma</span></span> chain_subdiv_chain_pathimg_subset'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"chain_subdiv_chain <span class="free">one_chain</span> <span class="free">subdiv</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span><span class="main">∈</span> <span class="free">subdiv</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">" <span class="main">∃</span><span class="bound">k'</span> <span class="bound">γ'</span><span class="main">.</span> <span class="main">(</span><span class="bound">k'</span><span class="main">,</span><span class="bound">γ'</span><span class="main">)</span><span class="main">∈</span> <span class="free">one_chain</span> <span class="main">∧</span> path_image <span class="free">γ</span> <span class="main">⊆</span> path_image <span class="bound">γ'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> chain_subdiv_chain_def  pairwise_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> chain_subdiv_path.cases coeff_cube_to_path.simps path_image_rec_join path_image_reversepath<span class="main">)</span>

<span class="keyword1" id="Paths-chain_subdiv_chain_pathimg_subset"><span class="command">lemma</span></span> chain_subdiv_chain_pathimg_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"chain_subdiv_chain <span class="free">one_chain</span> <span class="free">subdiv</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span>path_image <span class="main">`</span> <span class="main">{</span><span class="bound">γ</span><span class="main">.</span> <span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span> <span class="free">subdiv</span><span class="main">}</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">⋃</span> <span class="main">(</span>path_image <span class="main">`</span> <span class="main">{</span><span class="bound">γ</span><span class="main">.</span> <span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span> <span class="free">one_chain</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> chain_subdiv_chain_def pairwise_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UN_iff assms chain_subdiv_chain_pathimg_subset' subsetCE case_prodI2<span class="main">)</span> 

<span class="keyword1" id="Paths-chain_reparam_chain'_pathimg_subset'"><span class="command">lemma</span></span> chain_reparam_chain'_pathimg_subset'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"chain_reparam_chain' <span class="free">one_chain</span> <span class="free">subdiv</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span><span class="main">∈</span> <span class="free">subdiv</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">" <span class="main">∃</span><span class="bound">k'</span> <span class="bound">γ'</span><span class="main">.</span> <span class="main">(</span><span class="bound">k'</span><span class="main">,</span><span class="bound">γ'</span><span class="main">)</span><span class="main">∈</span> <span class="free">one_chain</span> <span class="main">∧</span> path_image <span class="free">γ</span> <span class="main">⊆</span> path_image <span class="bound">γ'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms chain_reparam_weak_path_pathimg_subset
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> chain_reparam_chain'_def set_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span>  path_image_reversepath case_prodE case_prodD old.prod.exhaust
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.inject rec_join.elims<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> case_prodD coeff_cube_to_path.simps rec_join.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> reversepath_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> surj_pair<span class="main">)</span>

 <span class="keyword1"><span class="command">definition</span></span> <span class="entity">common_reparam_exists</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>int <span class="main">×</span> <span class="main">(</span>real <span class="main">⇒</span> real <span class="main">×</span> real<span class="main">)</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span>int <span class="main">×</span> <span class="main">(</span>real <span class="main">⇒</span> real <span class="main">×</span> real<span class="main">)</span><span class="main">)</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">common_reparam_exists</span> <span class="free"><span class="bound"><span class="entity">one_chain1</span></span></span> <span class="free"><span class="bound"><span class="entity">one_chain2</span></span></span> <span class="main">≡</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">subdiv</span> <span class="bound">ps1</span> <span class="bound">ps2</span><span class="main">.</span>
    chain_reparam_chain' <span class="main">(</span><span class="free"><span class="bound"><span class="entity">one_chain1</span></span></span> <span class="main">-</span> <span class="bound">ps1</span><span class="main">)</span> <span class="bound">subdiv</span> <span class="main">∧</span>
    chain_reparam_chain' <span class="main">(</span><span class="free"><span class="bound"><span class="entity">one_chain2</span></span></span> <span class="main">-</span> <span class="bound">ps2</span><span class="main">)</span> <span class="bound">subdiv</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="bound">subdiv</span><span class="main">.</span>  <span class="bound">γ</span> <span class="keyword1">C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">∧</span>
    boundary_chain <span class="bound">subdiv</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="bound">ps1</span><span class="main">.</span> point_path <span class="bound">γ</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="bound">ps2</span><span class="main">.</span> point_path <span class="bound">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Paths-common_reparam_exists_imp_eq_line_integral"><span class="command">lemma</span></span> common_reparam_exists_imp_eq_line_integral<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> finite_basis<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">basis</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
    <span class="quoted"><span class="quoted">"finite <span class="free">one_chain1</span>"</span></span>
    <span class="quoted"><span class="quoted">"finite <span class="free">one_chain2</span>"</span></span>
    <span class="quoted"><span class="quoted">"boundary_chain <span class="main">(</span><span class="free">one_chain1</span><span class="main">::</span><span class="main">(</span>int <span class="main">×</span> <span class="main">(</span>real <span class="main">⇒</span> real <span class="main">×</span> real<span class="main">)</span><span class="main">)</span> set<span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"boundary_chain <span class="main">(</span><span class="free">one_chain2</span><span class="main">::</span><span class="main">(</span>int <span class="main">×</span> <span class="main">(</span>real <span class="main">⇒</span> real <span class="main">×</span> real<span class="main">)</span><span class="main">)</span> set<span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="main">(</span><span class="bound">k2</span><span class="main">,</span> <span class="bound">γ2</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain2</span><span class="main">.</span> <span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> continuous_on <span class="main">(</span>path_image <span class="bound">γ2</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>common_reparam_exists <span class="free">one_chain1</span> <span class="free">one_chain2</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain1</span><span class="main">.</span>  valid_path <span class="bound">γ</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain2</span><span class="main">.</span>  valid_path <span class="bound">γ</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">one_chain1</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">one_chain2</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain1</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">subdiv</span></span> <span class="skolem"><span class="skolem">ps1</span></span> <span class="skolem"><span class="skolem">ps2</span></span> <span class="keyword2"><span class="keyword">where</span></span> props<span class="main">:</span>
    <span class="quoted"><span class="quoted">"chain_reparam_chain' <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="skolem">ps1</span><span class="main">)</span> <span class="skolem">subdiv</span>"</span></span>
    <span class="quoted"><span class="quoted">"chain_reparam_chain' <span class="main">(</span><span class="free">one_chain2</span> <span class="main">-</span> <span class="skolem">ps2</span><span class="main">)</span> <span class="skolem">subdiv</span> "</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="skolem">subdiv</span><span class="main">.</span>  <span class="bound">γ</span> <span class="keyword1">C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"boundary_chain <span class="skolem">subdiv</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="skolem">ps1</span><span class="main">.</span> point_path <span class="bound">γ</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="skolem">ps2</span><span class="main">.</span> point_path <span class="bound">γ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> common_reparam_exists_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> subdiv_valid<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="skolem">subdiv</span><span class="main">.</span>  valid_path <span class="bound">γ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_path_def<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> props<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> C1_differentiable_imp_piecewise <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> onechain_boundary1<span class="main">:</span> <span class="quoted"><span class="quoted">"boundary_chain <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="skolem">ps1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_chain_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> onechain_boundary2<span class="main">:</span> <span class="quoted"><span class="quoted">"boundary_chain <span class="main">(</span><span class="free">one_chain2</span> <span class="main">-</span> <span class="skolem">ps1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_chain_def<span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k2</span> <span class="skolem">γ2</span> <span class="skolem">b</span>
    <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k2</span><span class="main">,</span> <span class="skolem">γ2</span><span class="main">)</span><span class="main">∈</span><span class="skolem">subdiv</span> "</span></span><span class="quoted"><span class="quoted">" <span class="skolem">b</span><span class="main">∈</span><span class="free">basis</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">k</span> <span class="bound">γ</span><span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">subdiv</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">k'</span> <span class="bound">γ'</span><span class="main">.</span> <span class="main">(</span><span class="bound">k'</span><span class="main">,</span> <span class="bound">γ'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">one_chain2</span> <span class="main">∧</span> path_image <span class="bound">γ</span> <span class="main">⊆</span> path_image <span class="bound">γ'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> chain_reparam_chain'_pathimg_subset' props Diff_subset subsetCE<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>path_image <span class="skolem">γ2</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>6<span class="main">)</span> continuous_on_subset<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?f</span> <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="skolem">b</span><span class="main">)</span>"</span></span><span class="main">]</span> ass
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  subset_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> case_prodD<span class="main">)</span><span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> cont_field<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">basis</span><span class="main">.</span> <span class="main">∀</span><span class="main">(</span><span class="bound">k2</span><span class="main">,</span> <span class="bound">γ2</span><span class="main">)</span><span class="main">∈</span><span class="skolem">subdiv</span><span class="main">.</span> continuous_on <span class="main">(</span>path_image <span class="bound">γ2</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> one_chain1_ps_valid<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="skolem">ps1</span><span class="main">.</span>  valid_path <span class="bound">γ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> one_chain2_ps_valid<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain2</span> <span class="main">-</span> <span class="skolem">ps1</span><span class="main">.</span>  valid_path <span class="bound">γ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="skolem">ps1</span><span class="main">)</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="skolem">subdiv</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> chain_reparam_chain'_line_integral_smooth_cubes<span class="main"><span class="main">[</span></span><span class="operator">OF</span> props<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> props<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> cont_field finite_basis<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> props assms
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">using</span></span> props assms
    <span class="keyword1"><span class="command">using</span></span> onechain_boundary1 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">using</span></span> props assms
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">using</span></span> one_chain1_ps_valid <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="main">(</span><span class="free">one_chain1</span> <span class="main">-</span> <span class="skolem">ps1</span><span class="main">)</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> chain_reparam_chain'_line_integral_smooth_cubes<span class="main"><span class="main">[</span></span><span class="operator">OF</span> props<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> props<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> cont_field finite_basis<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> props assms
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">using</span></span> props assms
    <span class="keyword1"><span class="command">using</span></span> onechain_boundary1 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">using</span></span> props assms
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">using</span></span> one_chain1_ps_valid <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="main">(</span><span class="free">one_chain2</span> <span class="main">-</span> <span class="skolem">ps2</span><span class="main">)</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="skolem">subdiv</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> chain_reparam_chain'_line_integral_smooth_cubes<span class="main"><span class="main">[</span></span><span class="operator">OF</span> props<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> props<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> cont_field finite_basis<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> props assms
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> boundary_chain_diff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> props<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="main">(</span><span class="free">one_chain2</span> <span class="main">-</span> <span class="skolem">ps2</span><span class="main">)</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> chain_reparam_chain'_line_integral_smooth_cubes<span class="main"><span class="main">[</span></span><span class="operator">OF</span> props<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> props<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> cont_field finite_basis<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> props assms
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> boundary_chain_diff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> props<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> line_int_ex_chain1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain1</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="free">basis</span> <span class="bound">γ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 0 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1"</span> finite_basis line_integral_exists_point_path props<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">one_chain1</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="free">basis</span> <span class="free">one_chain2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 0 1 2 3
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2-3<span class="main">)</span> finite_basis one_chain_line_integral_point_paths props<span class="main">(</span>5<span class="main">)</span> props<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">subcube</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real <span class="main">⇒</span> <span class="main">(</span>int <span class="main">×</span> <span class="main">(</span>real <span class="main">⇒</span> real <span class="main">×</span> real<span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>int <span class="main">×</span> <span class="main">(</span>real <span class="main">⇒</span> real <span class="main">×</span> real<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">subcube</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">cube</span></span></span> <span class="main">=</span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">cube</span></span></span><span class="main">,</span> subpath <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">cube</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Paths-subcube_valid_path"><span class="command">lemma</span></span> subcube_valid_path<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="main">(</span>snd <span class="free">cube</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="main">(</span>snd <span class="main">(</span>subcube <span class="free">a</span> <span class="free">b</span> <span class="free">cube</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> valid_path_subpath<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subcube_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Green">
<div class="head">
<h1>Theory Green</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Green
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Paths.html">Paths</a> <a href="Derivs.html">Derivs</a> <a href="Integrals.html">Integrals</a> <a href="General_Utils.html">General_Utils</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Green-frontier_Un_subset_Un_frontier"><span class="command">lemma</span></span> frontier_Un_subset_Un_frontier<span class="main">:</span>
     <span class="quoted"><span class="quoted">"frontier <span class="main">(</span><span class="free">s</span> <span class="main">∪</span> <span class="free">t</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>frontier <span class="free">s</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>frontier <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> frontier_def Un_Diff<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> closure_def interior_def islimpt_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">has_partial_derivative</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>euclidean_space<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>euclidean_space<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">has_partial_derivative</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">base_vec</span></span></span> <span class="free"><span class="bound"><span class="entity">F'</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>
        <span class="main">≡</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>euclidean_space<span class="main">.</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">(</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∙</span> <span class="free"><span class="bound"><span class="entity">base_vec</span></span></span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free"><span class="bound"><span class="entity">base_vec</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∙</span> <span class="free"><span class="bound"><span class="entity">base_vec</span></span></span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free"><span class="bound"><span class="entity">base_vec</span></span></span> <span class="main">)</span><span class="main">)</span>
                <span class="keyword1">has_derivative</span> <span class="free"><span class="bound"><span class="entity">F'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">has_partial_vector_derivative</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>euclidean_space<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>euclidean_space<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">has_partial_vector_derivative</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">base_vec</span></span></span> <span class="free"><span class="bound"><span class="entity">F'</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>
        <span class="main">≡</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">(</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∙</span> <span class="free"><span class="bound"><span class="entity">base_vec</span></span></span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free"><span class="bound"><span class="entity">base_vec</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free"><span class="bound"><span class="entity">base_vec</span></span></span> <span class="main">)</span><span class="main">)</span>
                <span class="keyword1">has_vector_derivative</span> <span class="free"><span class="bound"><span class="entity">F'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∙</span> <span class="free"><span class="bound"><span class="entity">base_vec</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">partially_vector_differentiable</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">partially_vector_differentiable</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">base_vec</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∃</span><span class="bound">F'</span><span class="main">.</span> has_partial_vector_derivative <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">base_vec</span></span></span> <span class="bound">F'</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">partial_vector_derivative</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>euclidean_space<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>euclidean_space<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">partial_vector_derivative</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">base_vec</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>
        <span class="main">≡</span> <span class="main">(</span>vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">(</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∙</span> <span class="free"><span class="bound"><span class="entity">base_vec</span></span></span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free"><span class="bound"><span class="entity">base_vec</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free"><span class="bound"><span class="entity">base_vec</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∙</span> <span class="free"><span class="bound"><span class="entity">base_vec</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Green-partial_vector_derivative_works"><span class="command">lemma</span></span> partial_vector_derivative_works<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"partially_vector_differentiable <span class="free">F</span> <span class="free">base_vec</span> <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"has_partial_vector_derivative <span class="free">F</span> <span class="free">base_vec</span> <span class="main">(</span>partial_vector_derivative <span class="free">F</span> <span class="free">base_vec</span> <span class="free">a</span><span class="main">)</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">F'</span></span> <span class="keyword2"><span class="keyword">where</span></span> F'_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="main">∙</span> <span class="free">base_vec</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">base_vec</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">base_vec</span> <span class="main">)</span><span class="main">)</span>
                            <span class="keyword1">has_vector_derivative</span> <span class="skolem">F'</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="free">a</span> <span class="main">∙</span> <span class="free">base_vec</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms partially_vector_differentiable_def has_partial_vector_derivative_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Derivative.differentiableI_vector<span class="main">[</span><span class="operator">OF</span> F'_prop<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vector_derivative_works partial_vector_derivative_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
        has_partial_vector_derivative_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Green-fundamental_theorem_of_calculus_partial_vector"><span class="command">lemma</span></span> fundamental_theorem_of_calculus_partial_vector<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span><span class="main">::</span> <span class="quoted"><span class="quoted">"real"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">F</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>euclidean_space <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>euclidean_space<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">i</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">j</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">F_j_i</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>euclidean_space <span class="main">⇒</span> real<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a_leq_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    Base_vecs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> Basis"</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">∈</span> Basis"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    no_i_component<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∙</span> <span class="free">i</span> <span class="main">=</span> <span class="main">0</span> "</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    has_partial_deriv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span> <span class="main">∈</span> <span class="free">D</span><span class="main">.</span> has_partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="free">F_j_i</span> <span class="bound">p</span><span class="main">)</span> <span class="bound">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    domain_subset_of_D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">D</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F_j_i</span><span class="main">(</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span>
          <span class="free">F</span><span class="main">(</span><span class="free">b</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span> <span class="main">-</span> <span class="free">F</span><span class="main">(</span><span class="free">a</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?domain</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">v</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">=</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span> <span class="var">?domain</span><span class="main">.</span>  has_partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="free">F_j_i</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> has_partial_deriv domain_subset_of_D
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span> <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">.</span>  <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> <span class="main">(</span><span class="free">F_j_i</span><span class="main">(</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_partial_vector_derivative_def<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted">real</span>
    <span class="keyword3"><span class="command">assume</span></span> range_of_x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="free">b</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> ass2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">z</span></span><span class="main">≥</span><span class="free">a</span><span class="main">.</span> <span class="bound">z</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">z</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span> <span class="main">⟶</span>
                     <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="bound">z</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> <span class="free">F_j_i</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="bound">z</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> <span class="free">F_j_i</span> <span class="main">(</span><span class="skolem">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> "</span></span>
      <span class="keyword1"><span class="command">using</span></span> range_of_x ass2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span> <span class="free">c</span> <span class="main">+</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> <span class="free">F_j_i</span> <span class="main">(</span><span class="skolem">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> inner_left_distrib no_i_component<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="free">c</span> <span class="main">+</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> <span class="free">F_j_i</span> <span class="main">(</span><span class="skolem">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> 0 <span class="keyword2"><span class="keyword">and</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span> <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">.</span>  <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> <span class="main">(</span><span class="free">F_j_i</span><span class="main">(</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_within <span class="bound">x</span> <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> has_vector_derivative_at_within
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F_j_i</span><span class="main">(</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span>
             <span class="free">F</span><span class="main">(</span><span class="free">b</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span> <span class="main">-</span> <span class="free">F</span><span class="main">(</span><span class="free">a</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fundamental_theorem_of_calculus<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span>  <span class="free">F</span><span class="main">(</span><span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="free">F_j_i</span><span class="main">(</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
      a_leq_b
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Green-fundamental_theorem_of_calculus_partial_vector_gen"><span class="command">lemma</span></span> fundamental_theorem_of_calculus_partial_vector_gen<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">k1</span> <span class="free">k2</span><span class="main">::</span> <span class="quoted"><span class="quoted">"real"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">F</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>euclidean_space <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>euclidean_space<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">i</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">F_i</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>euclidean_space <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a_leq_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k1</span> <span class="main">≤</span> <span class="free">k2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    unit_len<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∙</span> <span class="free">i</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    no_i_component<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∙</span> <span class="free">i</span> <span class="main">=</span> <span class="main">0</span> "</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    has_partial_deriv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span> <span class="main">∈</span> <span class="free">D</span><span class="main">.</span> has_partial_vector_derivative <span class="free">F</span> <span class="free">i</span> <span class="main">(</span><span class="free">F_i</span> <span class="bound">p</span><span class="main">)</span> <span class="bound">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    domain_subset_of_D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">v</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">k1</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">k2</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">=</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">D</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F_i</span><span class="main">(</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span>
                                        <span class="free">F</span><span class="main">(</span><span class="free">k2</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span> <span class="main">-</span> <span class="free">F</span><span class="main">(</span><span class="free">k1</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>cbox <span class="free">k1</span> <span class="free">k2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?domain</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">v</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">k1</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">k2</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">=</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span> <span class="var">?domain</span><span class="main">.</span>  has_partial_vector_derivative <span class="free">F</span> <span class="free">i</span> <span class="main">(</span><span class="free">F_i</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> has_partial_deriv domain_subset_of_D
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span> <span class="main">(</span>cbox <span class="free">k1</span> <span class="free">k2</span><span class="main">)</span><span class="main">.</span>  <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> <span class="main">(</span><span class="free">F_i</span><span class="main">(</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_partial_vector_derivative_def<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted">real</span>
    <span class="keyword3"><span class="command">assume</span></span> range_of_x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k1</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="free">k2</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> ass2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">z</span></span><span class="main">≥</span><span class="free">k1</span><span class="main">.</span> <span class="bound">z</span> <span class="main">≤</span> <span class="free">k2</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">z</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span> <span class="main">⟶</span>
                     <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="bound">z</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> <span class="free">F_i</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="bound">z</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> <span class="free">F_i</span> <span class="main">(</span><span class="skolem">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> "</span></span>
      <span class="keyword1"><span class="command">using</span></span> range_of_x ass2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span> <span class="free">c</span> <span class="main">+</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> <span class="free">F_i</span> <span class="main">(</span><span class="skolem">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inner_commute inner_right_distrib no_i_component unit_len<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="free">c</span> <span class="main">+</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> <span class="free">F_i</span> <span class="main">(</span><span class="skolem">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 0 <span class="keyword2"><span class="keyword">and</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span> <span class="main">(</span>cbox <span class="free">k1</span> <span class="free">k2</span><span class="main">)</span><span class="main">.</span>  <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span> <span class="main">)</span> <span class="keyword1">has_vector_derivative</span> <span class="main">(</span><span class="free">F_i</span><span class="main">(</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>at_within <span class="bound">x</span> <span class="main">(</span>cbox <span class="free">k1</span> <span class="free">k2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> has_vector_derivative_at_within
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F_i</span><span class="main">(</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span>
                                        <span class="free">F</span><span class="main">(</span><span class="free">k2</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span> <span class="main">-</span> <span class="free">F</span><span class="main">(</span><span class="free">k1</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>cbox <span class="free">k1</span> <span class="free">k2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fundamental_theorem_of_calculus<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">k1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">k2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span>  <span class="free">F</span><span class="main">(</span><span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="free">F_i</span><span class="main">(</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
      a_leq_b
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Green-add_scale_img"><span class="command">lemma</span></span> add_scale_img<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="main">1</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span> <span class="main">..</span> <span class="free">b</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> affine_ineq image_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> less_eq_real_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">x</span><span class="main">-</span><span class="free">a</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Green-add_scale_img'"><span class="command">lemma</span></span> add_scale_img'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="main">1</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span> <span class="main">..</span> <span class="free">b</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> add_scale_img assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">analytically_valid</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>euclidean_space set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span><span class="main">{</span>euclidean_space<span class="main">,</span>times<span class="main">,</span>one<span class="main">}</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">analytically_valid</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">≡</span>
       <span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">.</span> partially_vector_differentiable <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="bound">a</span><span class="main">)</span> <span class="main">∧</span>
       continuous_on <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">∧</span> <span class="comment1">― ‹TODO: should we replace this with saying that <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>F›</span></span> is partially diffrerentiable on <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>Dy›</span></span>,›</span>
                           <span class="comment1">― ‹i.e. there is a partial derivative on every dimension›</span>
       integrable lborel <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span>partial_vector_derivative <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="bound">p</span> <span class="main">*</span> indicator <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">p</span><span class="main">)</span> <span class="main">∧</span>
       <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span>partial_vector_derivative <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="bound">y</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">+</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="main">∑</span> <span class="bound">b</span> <span class="main">∈</span><span class="main">(</span>Basis <span class="main">-</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
            <span class="main">*</span> <span class="main">(</span>indicator <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span><span class="bound">y</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">+</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="main">∑</span><span class="bound">b</span> <span class="main">∈</span> Basis <span class="main">-</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">}</span><span class="main">.</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> borel_measurable lborel"</span></span>
  <span class="comment1">(*(λx. integral UNIV (λy. ((partial_vector_derivative F i) (y, x)) * (indicator s (y, x)))) ∈ borel_measurable lborel)"*)</span>


<span class="keyword1" id="Green-analytically_valid_imp_part_deriv_integrable_on"><span class="command">lemma</span></span> analytically_valid_imp_part_deriv_integrable_on<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"analytically_valid <span class="main">(</span><span class="free">s</span><span class="main">::</span><span class="main">(</span>real<span class="main">*</span>real<span class="main">)</span> set<span class="main">)</span> <span class="main">(</span><span class="free">f</span><span class="main">::</span><span class="main">(</span>real<span class="main">*</span>real<span class="main">)</span><span class="main">⇒</span> real<span class="main">)</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>partial_vector_derivative <span class="free">f</span> <span class="free">i</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integrable lborel <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> partial_vector_derivative <span class="free">f</span> <span class="free">i</span> <span class="bound">p</span> <span class="main">*</span> indicator <span class="free">s</span> <span class="bound">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  analytically_valid_def indic_ident<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integrable lborel <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">::</span><span class="main">(</span>real<span class="main">*</span>real<span class="main">)</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">p</span> <span class="main">∈</span> <span class="free">s</span> <span class="keyword1">then</span> partial_vector_derivative <span class="free">f</span> <span class="free">i</span> <span class="bound">p</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> indic_ident<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"partial_vector_derivative <span class="free">f</span> <span class="free">i</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> indic_ident<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">s</span> <span class="keyword1">then</span> partial_vector_derivative <span class="free">f</span> <span class="free">i</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">integrable_on</span> UNIV"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Equivalence_Lebesgue_Henstock_Integration.integrable_on_lborel
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>partial_vector_derivative <span class="free">f</span> <span class="free">i</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> integrable_restrict_UNIV
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*******************************************************************************)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">typeII_twoCube</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>real <span class="main">*</span> real<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>real <span class="main">*</span> real<span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">typeII_twoCube</span> <span class="free"><span class="bound"><span class="entity">twoC</span></span></span>
         <span class="main">≡</span> <span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">g1</span> <span class="bound">g2</span><span class="main">.</span> <span class="bound">a</span> <span class="main">&lt;</span> <span class="bound">b</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">a</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span><span class="main">.</span> <span class="bound">g2</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">g1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span>
                       <span class="free"><span class="bound"><span class="entity">twoC</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">g2</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">*</span><span class="bound">a</span> <span class="main">+</span> <span class="bound">x</span><span class="main">*</span><span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">*</span> <span class="main">(</span><span class="bound">g1</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">*</span><span class="bound">a</span> <span class="main">+</span> <span class="bound">x</span><span class="main">*</span><span class="bound">b</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
                                        <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">*</span><span class="bound">a</span> <span class="main">+</span> <span class="bound">x</span><span class="main">*</span><span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                       <span class="bound">g1</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="bound">a</span> <span class="main">..</span> <span class="bound">b</span><span class="main">}</span> <span class="main">∧</span>
                       <span class="bound">g2</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="bound">a</span> <span class="main">..</span> <span class="bound">b</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">unit_cube</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">unit_cube</span> <span class="main">≡</span> cbox <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">,</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cubeImage</span><span class="main">::</span> <span class="quoted"><span class="quoted">"two_cube <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span>real<span class="main">*</span>real<span class="main">)</span> set<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cubeImage</span> <span class="free"><span class="bound"><span class="entity">twoC</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">twoC</span></span></span> <span class="main">`</span> unit_cube<span class="main">)</span>"</span></span>

<span class="keyword1" id="Green-typeII_twoCubeImg"><span class="command">lemma</span></span> typeII_twoCubeImg<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"typeII_twoCube <span class="free">twoC</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">g1</span> <span class="bound">g2</span><span class="main">.</span> <span class="bound">a</span> <span class="main">&lt;</span> <span class="bound">b</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">a</span> <span class="main">..</span> <span class="bound">b</span><span class="main">}</span><span class="main">.</span> <span class="bound">g2</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">g1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span>
                      cubeImage <span class="free">twoC</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">a</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">g2</span> <span class="bound">x</span> <span class="main">..</span> <span class="bound">g1</span> <span class="bound">x</span><span class="main">}</span><span class="main">}</span>
                      <span class="main">∧</span> <span class="free">twoC</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="bound">g2</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="bound">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">b</span><span class="main">)</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">*</span> <span class="bound">g1</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="bound">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">b</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="bound">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span>
                      <span class="main">∧</span> <span class="bound">g1</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="bound">a</span> <span class="main">..</span> <span class="bound">b</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">g2</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="bound">a</span> <span class="main">..</span> <span class="bound">b</span><span class="main">}</span> "</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> typeII_twoCube_def cubeImage_def image_def<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">" <span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">&lt;</span> <span class="bound">b</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">g1</span> <span class="bound">g2</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">a</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span><span class="main">.</span> <span class="bound">g2</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">g1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span>
                            <span class="free">twoC</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="bound">g2</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="bound">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">b</span><span class="main">)</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">*</span> <span class="bound">g1</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="bound">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">b</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="bound">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                            <span class="bound">g1</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="bound">a</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">g2</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="bound">a</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">g1</span></span> <span class="skolem"><span class="skolem">g2</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    twoCisTypeII<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&lt;</span> <span class="skolem">b</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span><span class="main">.</span> <span class="skolem">g2</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">g1</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">twoC</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">g2</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">*</span> <span class="skolem">g1</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">g1</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="skolem">a</span> <span class="main">..</span> <span class="skolem">b</span><span class="main">}</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">g2</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="skolem">a</span> <span class="main">..</span> <span class="skolem">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> ab1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">≤</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> affine_ineq less_eq_real_def mult.commute twoCisTypeII<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> ex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span><span class="main">∈</span>Green.unit_cube<span class="main">.</span>
               <span class="main">(</span><span class="skolem">d</span><span class="main">,</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">(</span><span class="keyword1">case</span> <span class="bound">z</span> <span class="keyword1">of</span>
                <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⇒</span>
                  <span class="main">(</span><span class="skolem">g2</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">-</span> <span class="bound">y</span> <span class="main">*</span> <span class="skolem">g2</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">*</span> <span class="skolem">g1</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">,</span>
                   <span class="skolem">a</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">if</span></span> c_bounds<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≤</span> <span class="skolem">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≤</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> d_bounds<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g2</span> <span class="skolem">c</span> <span class="main">≤</span> <span class="skolem">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≤</span> <span class="skolem">g1</span> <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">c</span> <span class="skolem">d</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> b_minus_a_nzero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> twoCisTypeII<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> x_witness<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k1</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">k1</span><span class="main">)</span><span class="main">*</span><span class="skolem">a</span> <span class="main">+</span> <span class="bound">k1</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">k1</span> <span class="main">∧</span> <span class="bound">k1</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> c_bounds <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">&lt;</span> <span class="skolem">b</span>›</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> sum_sqs_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> y_witness<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k2</span><span class="main">.</span> <span class="skolem">d</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">k2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">g2</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">+</span> <span class="bound">k2</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">g1</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">k2</span> <span class="main">∧</span> <span class="bound">k2</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">g1</span> <span class="skolem">c</span> <span class="main">-</span> <span class="skolem">g2</span> <span class="skolem">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> d_bounds <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?k2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">d</span> <span class="main">-</span> <span class="skolem">g2</span> <span class="skolem">c</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="skolem">g1</span> <span class="skolem">c</span> <span class="main">-</span> <span class="skolem">g2</span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> k2_in_bounds<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="var">?k2</span> <span class="main">∧</span> <span class="var">?k2</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> twoCisTypeII<span class="main">(</span>2<span class="main">)</span> c_bounds d_bounds False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?k2</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">g2</span> <span class="skolem">c</span> <span class="main">+</span> <span class="var">?k2</span> <span class="main">*</span> <span class="skolem">g1</span> <span class="skolem">c</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> False sum_sqs_eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> k2_in_bounds <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>unit_cube<span class="main">.</span> <span class="main">(</span><span class="skolem">d</span><span class="main">,</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="skolem">g2</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">-</span> <span class="bound">y</span> <span class="main">*</span> <span class="skolem">g2</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">*</span> <span class="skolem">g1</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">,</span> <span class="skolem">a</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x_witness y_witness <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> left_diff_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>unit_cube<span class="main">.</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">twoC</span> <span class="bound">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">g2</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">≤</span> <span class="skolem">g1</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> twoCisTypeII ab1 left_diff_distrib ex<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> order.order_iff_strict twoCisTypeII<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">smt</span> affine_ineq atLeastAtMost_iff mult_left_mono twoCisTypeII<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">&lt;</span> <span class="bound">b</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">g1</span> <span class="bound">g2</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">a</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span><span class="main">.</span> <span class="bound">g2</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">g1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span>
                            <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>unit_cube<span class="main">.</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">twoC</span> <span class="bound">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">b</span> <span class="main">∧</span> <span class="bound">g2</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">≤</span> <span class="bound">g1</span> <span class="bound">x</span><span class="main">}</span> <span class="main">∧</span>
                            <span class="free">twoC</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="bound">g2</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="bound">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">b</span><span class="main">)</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">*</span> <span class="bound">g1</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="bound">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">b</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="bound">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                            <span class="bound">g1</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="bound">a</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">g2</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="bound">a</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> twoCisTypeII <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">horizontal_boundary</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"two_cube <span class="main">⇒</span> one_chain"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">horizontal_boundary</span> <span class="free"><span class="bound"><span class="entity">twoC</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">twoC</span></span></span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">twoC</span></span></span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">vertical_boundary</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"two_cube <span class="main">⇒</span> one_chain"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">vertical_boundary</span> <span class="free"><span class="bound"><span class="entity">twoC</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">twoC</span></span></span><span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">twoC</span></span></span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">boundary</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"two_cube <span class="main">⇒</span> one_chain"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">boundary</span> <span class="free"><span class="bound"><span class="entity">twoC</span></span></span> <span class="main">≡</span> horizontal_boundary <span class="free"><span class="bound"><span class="entity">twoC</span></span></span> <span class="main">∪</span> vertical_boundary <span class="free"><span class="bound"><span class="entity">twoC</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">valid_two_cube</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">valid_two_cube</span> <span class="free"><span class="bound"><span class="entity">twoC</span></span></span> <span class="main">≡</span> card <span class="main">(</span>boundary <span class="free"><span class="bound"><span class="entity">twoC</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="numeral">4</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">two_chain_integral</span><span class="main">::</span> <span class="quoted"><span class="quoted">"two_chain <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span>real<span class="main">*</span>real<span class="main">)</span><span class="main">⇒</span><span class="main">(</span>real<span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">two_chain_integral</span> <span class="free"><span class="bound"><span class="entity">twoChain</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">≡</span> <span class="main">∑</span><span class="bound">C</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">twoChain</span></span></span><span class="main">.</span> <span class="main">(</span>integral <span class="main">(</span>cubeImage <span class="bound">C</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">valid_two_chain</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">valid_two_chain</span> <span class="free"><span class="bound"><span class="entity">twoChain</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">twoCube</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">twoChain</span></span></span><span class="main">.</span> valid_two_cube <span class="bound">twoCube</span><span class="main">)</span> <span class="main">∧</span> pairwise <span class="main">(</span><span class="main">λ</span><span class="bound">c1</span> <span class="bound">c2</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>boundary <span class="bound">c1</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>boundary <span class="bound">c2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">twoChain</span></span></span> <span class="main">∧</span> inj_on cubeImage <span class="free"><span class="bound"><span class="entity">twoChain</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">two_chain_boundary</span><span class="main">::</span> <span class="quoted"><span class="quoted">"two_chain <span class="main">⇒</span> one_chain"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">two_chain_boundary</span> <span class="free"><span class="bound"><span class="entity">twoChain</span></span></span> <span class="main">==</span> <span class="main">⋃</span><span class="main">(</span>boundary <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">twoChain</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">gen_division</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">gen_division</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">≡</span> <span class="main">(</span>finite <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">⋃</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">∧</span> pairwise <span class="main">(</span><span class="main">λ</span><span class="bound">X</span> <span class="bound">Y</span><span class="main">.</span> negligible <span class="main">(</span><span class="bound">X</span> <span class="main">∩</span> <span class="bound">Y</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">two_chain_horizontal_boundary</span><span class="main">::</span> <span class="quoted"><span class="quoted">"two_chain <span class="main">⇒</span> one_chain"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">two_chain_horizontal_boundary</span> <span class="free"><span class="bound"><span class="entity">twoChain</span></span></span>  <span class="main">≡</span> <span class="main">⋃</span><span class="main">(</span>horizontal_boundary <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">twoChain</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">two_chain_vertical_boundary</span><span class="main">::</span> <span class="quoted"><span class="quoted">"two_chain <span class="main">⇒</span> one_chain"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">two_chain_vertical_boundary</span> <span class="free"><span class="bound"><span class="entity">twoChain</span></span></span>  <span class="main">≡</span> <span class="main">⋃</span><span class="main">(</span>vertical_boundary <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">twoChain</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">only_horizontal_division</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">only_horizontal_division</span> <span class="free"><span class="bound"><span class="entity">one_chain</span></span></span> <span class="free"><span class="bound"><span class="entity">two_chain</span></span></span> 
      <span class="main">≡</span> <span class="main">∃</span><span class="bound">ℋ</span> <span class="bound">𝒱</span><span class="main">.</span> finite <span class="bound">ℋ</span> <span class="main">∧</span> finite <span class="bound">𝒱</span> <span class="main">∧</span>
               <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">ℋ</span><span class="main">.</span>
                 <span class="main">(</span><span class="main">∃</span><span class="main">(</span><span class="bound">k'</span><span class="main">,</span> <span class="bound">γ'</span><span class="main">)</span> <span class="main">∈</span> two_chain_horizontal_boundary <span class="free"><span class="bound"><span class="entity">two_chain</span></span></span><span class="main">.</span>
                     <span class="main">(</span><span class="main">∃</span><span class="bound">a</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">∃</span><span class="bound">b</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≤</span> <span class="bound">b</span> <span class="main">∧</span> subpath <span class="bound">a</span> <span class="bound">b</span> <span class="bound">γ'</span> <span class="main">=</span> <span class="bound">γ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
               <span class="main">(</span>common_sudiv_exists <span class="main">(</span>two_chain_vertical_boundary <span class="free"><span class="bound"><span class="entity">two_chain</span></span></span><span class="main">)</span> <span class="bound">𝒱</span>
                <span class="main">∨</span> common_reparam_exists <span class="bound">𝒱</span> <span class="main">(</span>two_chain_vertical_boundary <span class="free"><span class="bound"><span class="entity">two_chain</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
               boundary_chain <span class="bound">𝒱</span> <span class="main">∧</span>
               <span class="free"><span class="bound"><span class="entity">one_chain</span></span></span> <span class="main">=</span> <span class="bound">ℋ</span> <span class="main">∪</span> <span class="bound">𝒱</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="bound">𝒱</span><span class="main">.</span> valid_path <span class="bound">γ</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Green-sum_zero_set"><span class="command">lemma</span></span> sum_zero_set<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">s</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sum <span class="free">f</span> <span class="main">(</span><span class="free">s</span> <span class="main">∪</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> sum <span class="free">f</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> IntE sum.union_inter_neutral sup_commute<span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">valid_typeII_division</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">twoChain</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">twoCube</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">twoChain</span></span></span><span class="main">.</span> typeII_twoCube <span class="bound">twoCube</span><span class="main">)</span> <span class="main">∧</span>
                                                <span class="main">(</span>gen_division <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span>cubeImage <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">twoChain</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                                                <span class="main">(</span>valid_two_chain <span class="free"><span class="bound"><span class="entity">twoChain</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Green-two_chain_vertical_boundary_is_boundary_chain"><span class="command">lemma</span></span> two_chain_vertical_boundary_is_boundary_chain<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"boundary_chain <span class="main">(</span>two_chain_vertical_boundary <span class="free">twoChain</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_chain_def two_chain_vertical_boundary_def vertical_boundary_def<span class="main">)</span>

<span class="keyword1" id="Green-two_chain_horizontal_boundary_is_boundary_chain"><span class="command">lemma</span></span> two_chain_horizontal_boundary_is_boundary_chain<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"boundary_chain <span class="main">(</span>two_chain_horizontal_boundary <span class="free">twoChain</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_chain_def two_chain_horizontal_boundary_def horizontal_boundary_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">typeI_twoCube</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"two_cube <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">typeI_twoCube</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">twoC</span></span></span><span class="main">::</span>two_cube<span class="main">)</span>
        <span class="main">≡</span> <span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">g1</span> <span class="bound">g2</span><span class="main">.</span> <span class="bound">a</span> <span class="main">&lt;</span> <span class="bound">b</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">a</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span><span class="main">.</span> <span class="bound">g2</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">g1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span>
                       <span class="free"><span class="bound"><span class="entity">twoC</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">*</span><span class="bound">a</span> <span class="main">+</span> <span class="bound">x</span><span class="main">*</span><span class="bound">b</span><span class="main">,</span>
                                        <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">g2</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">*</span><span class="bound">a</span> <span class="main">+</span> <span class="bound">x</span><span class="main">*</span><span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">*</span> <span class="main">(</span><span class="bound">g1</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">*</span><span class="bound">a</span> <span class="main">+</span> <span class="bound">x</span><span class="main">*</span><span class="bound">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                       <span class="bound">g1</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="bound">a</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span> <span class="main">∧</span>
                       <span class="bound">g2</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="bound">a</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Green-typeI_twoCubeImg"><span class="command">lemma</span></span> typeI_twoCubeImg<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"typeI_twoCube <span class="free">twoC</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">g1</span> <span class="bound">g2</span><span class="main">.</span> <span class="bound">a</span> <span class="main">&lt;</span> <span class="bound">b</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">a</span> <span class="main">..</span> <span class="bound">b</span><span class="main">}</span><span class="main">.</span> <span class="bound">g2</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">g1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span>
                      cubeImage <span class="free">twoC</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">a</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">g2</span> <span class="bound">x</span> <span class="main">..</span> <span class="bound">g1</span> <span class="bound">x</span><span class="main">}</span><span class="main">}</span> <span class="main">∧</span>
                      <span class="free">twoC</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="bound">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">b</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="bound">g2</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="bound">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">b</span><span class="main">)</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">*</span> <span class="bound">g1</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="bound">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                      <span class="bound">g1</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="bound">a</span> <span class="main">..</span> <span class="bound">b</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">g2</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="bound">a</span> <span class="main">..</span> <span class="bound">b</span><span class="main">}</span> "</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">&lt;</span> <span class="bound">b</span> <span class="main">∧</span>
          <span class="main">(</span><span class="main">∃</span><span class="bound">g1</span> <span class="bound">g2</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">a</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span><span class="main">.</span> <span class="bound">g2</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">g1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span>
                   <span class="free">twoC</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="bound">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">b</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="bound">g2</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="bound">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">b</span><span class="main">)</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">*</span> <span class="bound">g1</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="bound">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span>
                   <span class="bound">g1</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="bound">a</span> <span class="main">..</span> <span class="bound">b</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">g2</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="bound">a</span> <span class="main">..</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> typeI_twoCube_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">g1</span></span> <span class="skolem"><span class="skolem">g2</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    twoCisTypeI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&lt;</span> <span class="skolem">b</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span><span class="main">.</span> <span class="skolem">g2</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">g1</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="free">twoC</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">g2</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">*</span> <span class="skolem">g1</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">g1</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="skolem">a</span> <span class="main">..</span> <span class="skolem">b</span><span class="main">}</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">g2</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="skolem">a</span> <span class="main">..</span> <span class="skolem">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> ex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span><span class="main">∈</span>Green.unit_cube<span class="main">.</span>
               <span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">(</span><span class="keyword1">case</span> <span class="bound">z</span> <span class="keyword1">of</span>
                <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⇒</span>
                  <span class="main">(</span><span class="skolem">a</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">,</span>
                   <span class="skolem">g2</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">-</span> <span class="bound">y</span> <span class="main">*</span> <span class="skolem">g2</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">*</span> <span class="skolem">g1</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> c_bounds<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≤</span> <span class="skolem">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≤</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  d_bounds<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g2</span> <span class="skolem">c</span> <span class="main">≤</span> <span class="skolem">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≤</span> <span class="skolem">g1</span> <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">c</span> <span class="skolem">d</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> x_witness<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k1</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">k1</span><span class="main">)</span><span class="main">*</span><span class="skolem">a</span> <span class="main">+</span> <span class="bound">k1</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">k1</span> <span class="main">∧</span> <span class="bound">k1</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?k1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> k1_in_bounds<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> twoCisTypeI<span class="main">(</span>1<span class="main">)</span> c_bounds <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?k1</span><span class="main">)</span><span class="main">*</span><span class="skolem">a</span> <span class="main">+</span> <span class="var">?k1</span> <span class="main">*</span> <span class="skolem">b</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> twoCisTypeI<span class="main">(</span>1<span class="main">)</span> sum_sqs_eq
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> twoCisTypeI k1_in_bounds <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> y_witness<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k2</span><span class="main">.</span> <span class="skolem">d</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">k2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">g2</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">+</span> <span class="bound">k2</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">g1</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">k2</span> <span class="main">∧</span> <span class="bound">k2</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">g1</span> <span class="skolem">c</span> <span class="main">-</span> <span class="skolem">g2</span> <span class="skolem">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> d_bounds <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?k2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">d</span> <span class="main">-</span> <span class="skolem">g2</span> <span class="skolem">c</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="skolem">g1</span> <span class="skolem">c</span> <span class="main">-</span> <span class="skolem">g2</span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> k2_in_bounds<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="var">?k2</span> <span class="main">∧</span> <span class="var">?k2</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> twoCisTypeI<span class="main">(</span>2<span class="main">)</span> c_bounds d_bounds False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?k2</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">g2</span> <span class="skolem">c</span> <span class="main">+</span> <span class="var">?k2</span> <span class="main">*</span> <span class="skolem">g1</span> <span class="skolem">c</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> sum_sqs_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>        
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> k2_in_bounds <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>unit_cube<span class="main">.</span> <span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">=</span>
            <span class="main">(</span><span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">,</span> <span class="skolem">g2</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">-</span> <span class="bound">y</span> <span class="main">*</span> <span class="skolem">g2</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">*</span> <span class="skolem">g1</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x_witness y_witness <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> left_diff_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>unit_cube<span class="main">.</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">twoC</span> <span class="bound">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">g2</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">≤</span> <span class="skolem">g1</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> twoCisTypeI left_diff_distrib ex<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> less_eq_real_def twoCisTypeI<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">smt</span> affine_ineq twoCisTypeI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">smt</span> affine_ineq atLeastAtMost_iff mult_left_mono twoCisTypeI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cubeImage_def image_def <span class="keyword1"><span class="command">using</span></span> twoCisTypeI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Green-typeI_cube_explicit_spec"><span class="command">lemma</span></span> typeI_cube_explicit_spec<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"typeI_twoCube <span class="free">twoC</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">g1</span> <span class="bound">g2</span><span class="main">.</span> <span class="bound">a</span> <span class="main">&lt;</span> <span class="bound">b</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">a</span> <span class="main">..</span> <span class="bound">b</span><span class="main">}</span><span class="main">.</span> <span class="bound">g2</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">g1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span>
                      cubeImage <span class="free">twoC</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">a</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">g2</span> <span class="bound">x</span> <span class="main">..</span> <span class="bound">g1</span> <span class="bound">x</span><span class="main">}</span><span class="main">}</span>
                      <span class="main">∧</span> <span class="free">twoC</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="bound">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">b</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="bound">g2</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="bound">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">b</span><span class="main">)</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">*</span> <span class="bound">g1</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="bound">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                      <span class="main">∧</span> <span class="bound">g1</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="bound">a</span> <span class="main">..</span> <span class="bound">b</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">g2</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="bound">a</span> <span class="main">..</span> <span class="bound">b</span><span class="main">}</span>
                      <span class="main">∧</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span> <span class="main">+</span> <span class="main">(</span><span class="bound">b</span> <span class="main">-</span> <span class="bound">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">,</span> <span class="bound">g2</span> <span class="main">(</span><span class="bound">a</span> <span class="main">+</span> <span class="main">(</span><span class="bound">b</span> <span class="main">-</span> <span class="bound">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                      <span class="main">∧</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span> <span class="bound">g2</span> <span class="bound">b</span> <span class="main">+</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="bound">g1</span> <span class="bound">b</span> <span class="main">-</span> <span class="bound">g2</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                      <span class="main">∧</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span> <span class="main">+</span> <span class="main">(</span><span class="bound">b</span> <span class="main">-</span> <span class="bound">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">,</span> <span class="bound">g1</span> <span class="main">(</span><span class="bound">a</span> <span class="main">+</span> <span class="main">(</span><span class="bound">b</span> <span class="main">-</span> <span class="bound">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                      <span class="main">∧</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">g2</span> <span class="bound">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="bound">g1</span> <span class="bound">a</span> <span class="main">-</span> <span class="bound">g2</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?bottom_edge</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?right_edge</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?top_edge</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?left_edge</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">g1</span></span> <span class="skolem"><span class="skolem">g2</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    twoCisTypeI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&lt;</span> <span class="skolem">b</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> cbox <span class="skolem">a</span> <span class="skolem">b</span><span class="main">.</span> <span class="skolem">g2</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">g1</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"cubeImage <span class="free">twoC</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> cbox <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> cbox <span class="main">(</span><span class="skolem">g2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">g1</span> <span class="bound">x</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">twoC</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">g2</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">*</span> <span class="skolem">g1</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">g1</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="skolem">a</span> <span class="main">..</span> <span class="skolem">b</span><span class="main">}</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">g2</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="skolem">a</span> <span class="main">..</span> <span class="skolem">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> typeI_twoCubeImg<span class="main">[</span><span class="operator">of</span><span class="quoted"><span class="quoted">"<span class="free">twoC</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> bottom_edge_explicit<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?bottom_edge</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">,</span> <span class="skolem">g2</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> twoCisTypeI<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> right_edge_explicit<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?right_edge</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">b</span><span class="main">,</span> <span class="skolem">g2</span> <span class="skolem">b</span> <span class="main">+</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">g1</span> <span class="skolem">b</span> <span class="main">-</span> <span class="skolem">g2</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> twoCisTypeI<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> top_edge_explicit<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?top_edge</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">,</span> <span class="skolem">g1</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> twoCisTypeI<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> left_edge_explicit<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?left_edge</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">g2</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">g1</span> <span class="skolem">a</span> <span class="main">-</span> <span class="skolem">g2</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> twoCisTypeI<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> bottom_edge_explicit right_edge_explicit top_edge_explicit left_edge_explicit twoCisTypeI
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Green-typeI_twoCube_smooth_edges"><span class="command">lemma</span></span> typeI_twoCube_smooth_edges<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"typeI_twoCube <span class="free">twoC</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span> <span class="main">∈</span> boundary <span class="free">twoC</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?bottom_edge</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?right_edge</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?top_edge</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?left_edge</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">g1</span></span> <span class="skolem"><span class="skolem">g2</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    twoCisTypeI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&lt;</span> <span class="skolem">b</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> cbox <span class="skolem">a</span> <span class="skolem">b</span><span class="main">.</span> <span class="skolem">g2</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">g1</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"cubeImage <span class="free">twoC</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> cbox <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> cbox <span class="main">(</span><span class="skolem">g2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">g1</span> <span class="bound">x</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">twoC</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">g2</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">*</span> <span class="skolem">g1</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">g1</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="skolem">a</span> <span class="main">..</span> <span class="skolem">b</span><span class="main">}</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">g2</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="skolem">a</span> <span class="main">..</span> <span class="skolem">b</span><span class="main">}</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">,</span> <span class="skolem">g2</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">b</span><span class="main">,</span> <span class="skolem">g2</span> <span class="skolem">b</span> <span class="main">+</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">g1</span> <span class="skolem">b</span> <span class="main">-</span> <span class="skolem">g2</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">,</span> <span class="skolem">g1</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">g2</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">g1</span> <span class="skolem">a</span> <span class="main">-</span> <span class="skolem">g2</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> typeI_cube_explicit_spec<span class="main">[</span><span class="operator">of</span><span class="quoted"><span class="quoted">"<span class="free">twoC</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> bottom_edge_smooth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">-`</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="skolem">b</span> <span class="main">-</span><span class="skolem">a</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> twoCisTypeI<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Set.vimage_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> finite_vimg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> finite<span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">∩</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">-`</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> scale_shif_smth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> scale_shift_smooth <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> scale_shif_pw_smth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C1_differentiable_imp_piecewise <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> g2_smooth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g2</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> add_scale_img<span class="main">[</span><span class="operator">OF</span> twoCisTypeI<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> twoCisTypeI<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">g2</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> piecewise_C1_differentiable_compose<span class="main">[</span><span class="operator">OF</span> scale_shif_pw_smth g2_smooth finite_vimg<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> o_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">,</span> <span class="skolem">g2</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> all_components_smooth_one_pw_smooth_is_pw_smooth<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">,</span> <span class="skolem">g2</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> real_pair_basis<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> twoCisTypeI<span class="main">(</span>7<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> top_edge_smooth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?top_edge</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">-`</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="skolem">b</span> <span class="main">-</span><span class="skolem">a</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> twoCisTypeI<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Set.vimage_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> finite_vimg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> finite<span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">∩</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">-`</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> scale_shif_smth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> scale_shift_smooth <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> scale_shif_pw_smth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C1_differentiable_imp_piecewise <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> g1_smooth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g1</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> add_scale_img<span class="main">[</span><span class="operator">OF</span> twoCisTypeI<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> twoCisTypeI<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">g1</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> piecewise_C1_differentiable_compose<span class="main">[</span><span class="operator">OF</span> scale_shif_pw_smth g1_smooth finite_vimg<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> o_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">,</span> <span class="skolem">g1</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> all_components_smooth_one_pw_smooth_is_pw_smooth<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">,</span> <span class="skolem">g1</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> real_pair_basis<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> twoCisTypeI<span class="main">(</span>9<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> right_edge_smooth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?right_edge</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">g2</span> <span class="skolem">b</span> <span class="main">+</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">g1</span> <span class="skolem">b</span> <span class="main">-</span> <span class="skolem">g2</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> scale_shift_smooth C1_differentiable_imp_piecewise <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">g2</span> <span class="skolem">b</span> <span class="main">+</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">g1</span> <span class="skolem">b</span> <span class="main">-</span> <span class="skolem">g2</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> C1_differentiable_imp_piecewise <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">b</span><span class="main">,</span> <span class="skolem">g2</span> <span class="skolem">b</span> <span class="main">+</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">g1</span> <span class="skolem">b</span> <span class="main">-</span> <span class="skolem">g2</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> pair_prod_smooth_pw_smooth <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> twoCisTypeI<span class="main">(</span>8<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> left_edge_smooth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?left_edge</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">g2</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">g1</span> <span class="skolem">a</span> <span class="main">-</span> <span class="skolem">g2</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> scale_shift_smooth <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">g2</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">g1</span> <span class="skolem">a</span> <span class="main">-</span> <span class="skolem">g2</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> C1_differentiable_imp_piecewise <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">g2</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">g1</span> <span class="skolem">a</span> <span class="main">-</span> <span class="skolem">g2</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> pair_prod_smooth_pw_smooth <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> twoCisTypeI<span class="main">(</span>10<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">=</span> <span class="var">?bottom_edge</span> <span class="main">∨</span> <span class="free">γ</span> <span class="main">=</span> <span class="var">?right_edge</span> <span class="main">∨</span> <span class="free">γ</span> <span class="main">=</span> <span class="var">?top_edge</span> <span class="main">∨</span> <span class="free">γ</span> <span class="main">=</span> <span class="var">?left_edge</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_def horizontal_boundary_def vertical_boundary_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> left_edge_smooth right_edge_smooth top_edge_smooth bottom_edge_smooth <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Green-two_chain_integral_eq_integral_divisable"><span class="command">lemma</span></span> two_chain_integral_eq_integral_divisable<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f_integrable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">twoCube</span> <span class="main">∈</span> <span class="free">twoChain</span><span class="main">.</span> <span class="free">F</span> <span class="keyword1">integrable_on</span> cubeImage <span class="bound">twoCube</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    gen_division<span class="main">:</span> <span class="quoted"><span class="quoted">"gen_division <span class="free">s</span> <span class="main">(</span>cubeImage <span class="main">`</span> <span class="free">twoChain</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    valid_two_chain<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_two_chain <span class="free">twoChain</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"integral <span class="free">s</span> <span class="free">F</span> <span class="main">=</span> two_chain_integral <span class="free">twoChain</span> <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integral <span class="free">s</span> <span class="free">F</span> <span class="main">=</span> two_chain_integral <span class="free">twoChain</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> two_chain_integral_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> partial_deriv_integrable<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">twoCube</span> <span class="main">∈</span> <span class="free">twoChain</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">F</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="main">(</span>integral <span class="main">(</span>cubeImage <span class="bound">twoCube</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>cubeImage <span class="bound">twoCube</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f_integrable <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> partial_deriv_integrable<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">twoCubeImg</span><span class="main">.</span> <span class="bound">twoCubeImg</span> <span class="main">∈</span> cubeImage <span class="main">`</span> <span class="free">twoChain</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">F</span> <span class="keyword1">has_integral</span> <span class="main">(</span>integral <span class="main">(</span><span class="bound">twoCubeImg</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">twoCubeImg</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Henstock_Kurzweil_Integration.integrable_neg <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">have</span></span> finite_images<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>cubeImage <span class="main">`</span> <span class="free">twoChain</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> gen_division gen_division_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> negligible_images<span class="main">:</span> <span class="quoted"><span class="quoted">"pairwise <span class="main">(</span><span class="main">λ</span><span class="bound">S</span> <span class="bound">S'</span><span class="main">.</span> negligible <span class="main">(</span><span class="bound">S</span> <span class="main">∩</span> <span class="bound">S'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>cubeImage <span class="main">`</span> <span class="free">twoChain</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> gen_division  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gen_division_def pairwise_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> inj<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on cubeImage <span class="free">twoChain</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> valid_two_chain <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_on_def valid_two_chain_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integral <span class="free">s</span> <span class="free">F</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">twoCubeImg</span><span class="main">∈</span>cubeImage <span class="main">`</span> <span class="free">twoChain</span><span class="main">.</span> integral <span class="bound">twoCubeImg</span> <span class="free">F</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> has_integral_Union<span class="main">[</span><span class="operator">OF</span> finite_images partial_deriv_integrable negligible_images<span class="main">]</span> gen_division
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gen_division_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">C</span><span class="main">∈</span><span class="free">twoChain</span><span class="main">.</span> integral <span class="main">(</span>cubeImage <span class="bound">C</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sum.reindex inj <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integral <span class="free">s</span> <span class="free">F</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">C</span><span class="main">∈</span><span class="free">twoChain</span><span class="main">.</span> integral <span class="main">(</span>cubeImage <span class="bound">C</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">only_vertical_division</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">only_vertical_division</span> <span class="free"><span class="bound"><span class="entity">one_chain</span></span></span> <span class="free"><span class="bound"><span class="entity">two_chain</span></span></span> <span class="main">≡</span>
       <span class="main">∃</span><span class="bound">𝒱</span> <span class="bound">ℋ</span><span class="main">.</span> finite <span class="bound">ℋ</span> <span class="main">∧</span> finite <span class="bound">𝒱</span> <span class="main">∧</span>
               <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">𝒱</span><span class="main">.</span>
                 <span class="main">(</span><span class="main">∃</span><span class="main">(</span><span class="bound">k'</span><span class="main">,</span><span class="bound">γ'</span><span class="main">)</span> <span class="main">∈</span> two_chain_vertical_boundary <span class="free"><span class="bound"><span class="entity">two_chain</span></span></span><span class="main">.</span>
                     <span class="main">(</span><span class="main">∃</span><span class="bound">a</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">∃</span><span class="bound">b</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≤</span> <span class="bound">b</span> <span class="main">∧</span> subpath <span class="bound">a</span> <span class="bound">b</span> <span class="bound">γ'</span> <span class="main">=</span> <span class="bound">γ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
               <span class="main">(</span>common_sudiv_exists <span class="main">(</span>two_chain_horizontal_boundary <span class="free"><span class="bound"><span class="entity">two_chain</span></span></span><span class="main">)</span> <span class="bound">ℋ</span>
                <span class="main">∨</span> common_reparam_exists <span class="bound">ℋ</span> <span class="main">(</span>two_chain_horizontal_boundary <span class="free"><span class="bound"><span class="entity">two_chain</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
               boundary_chain <span class="bound">ℋ</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">one_chain</span></span></span> <span class="main">=</span> <span class="bound">𝒱</span> <span class="main">∪</span> <span class="bound">ℋ</span> <span class="main">∧</span>
               <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="bound">ℋ</span><span class="main">.</span> valid_path <span class="bound">γ</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">valid_typeI_division</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">twoChain</span></span></span> 
   <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">twoCube</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">twoChain</span></span></span><span class="main">.</span> typeI_twoCube <span class="bound">twoCube</span><span class="main">)</span> <span class="main">∧</span>
      gen_division <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span>cubeImage <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">twoChain</span></span></span><span class="main">)</span> <span class="main">∧</span> valid_two_chain <span class="free"><span class="bound"><span class="entity">twoChain</span></span></span>"</span></span>


<span class="keyword1" id="Green-field_cont_on_typeI_region_cont_on_edges"><span class="command">lemma</span></span> field_cont_on_typeI_region_cont_on_edges<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> typeI_twoC<span class="main">:</span> <span class="quoted"><span class="quoted">"typeI_twoCube <span class="free">twoC</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> field_cont<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>cubeImage <span class="free">twoC</span><span class="main">)</span> <span class="free">F</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> member_of_boundary<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span> <span class="main">∈</span> boundary <span class="free">twoC</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span><span class="free">γ</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">g1</span></span> <span class="skolem"><span class="skolem">g2</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    twoCisTypeI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&lt;</span> <span class="skolem">b</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> cbox <span class="skolem">a</span> <span class="skolem">b</span><span class="main">.</span> <span class="skolem">g2</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">g1</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"cubeImage <span class="free">twoC</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> cbox <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> cbox <span class="main">(</span><span class="skolem">g2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">g1</span> <span class="bound">x</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">twoC</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">g2</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">*</span> <span class="skolem">g1</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">g1</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="skolem">a</span> <span class="main">..</span> <span class="skolem">b</span><span class="main">}</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">g2</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="skolem">a</span> <span class="main">..</span> <span class="skolem">b</span><span class="main">}</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">,</span> <span class="skolem">g2</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">b</span><span class="main">,</span> <span class="skolem">g2</span> <span class="skolem">b</span> <span class="main">+</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">g1</span> <span class="skolem">b</span> <span class="main">-</span> <span class="skolem">g2</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">,</span> <span class="skolem">g1</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">g2</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">g1</span> <span class="skolem">a</span> <span class="main">-</span> <span class="skolem">g2</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> typeI_twoC <span class="keyword2"><span class="keyword">and</span></span> typeI_cube_explicit_spec<span class="main">[</span><span class="operator">of</span><span class="quoted"><span class="quoted">"<span class="free">twoC</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?bottom_edge</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?right_edge</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?top_edge</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?left_edge</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Dg1</span></span></span> <span class="main">=</span>  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> cbox <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="skolem">g1</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> line_is_pair_img<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Dg1</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="skolem">g1</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span>cbox <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> image_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> field_cont_on_top_edge_image<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="var">?Dg1</span>  <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> continuous_on_subset <span class="main"><span class="main">[</span></span><span class="operator">OF</span> field_cont<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> twoCisTypeI<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> twoCisTypeI<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> top_edge_is_compos_of_scal_and_g1<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="skolem">g1</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> twoCisTypeI  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> Dg1_is_bot_edge_pathimg<span class="main">:</span> <span class="quoted"><span class="quoted">"path_image <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="var">?Dg1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> line_is_pair_img <span class="keyword2"><span class="keyword">and</span></span> top_edge_is_compos_of_scal_and_g1 image_comp path_image_def add_scale_img <span class="keyword2"><span class="keyword">and</span></span> twoCisTypeI<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> cbox_interval<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> cont_on_top<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>path_image <span class="var">?top_edge</span><span class="main">)</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> field_cont_on_top_edge_image <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Dg2</span></span></span> <span class="main">=</span>  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> cbox <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="skolem">g2</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> line_is_pair_img<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Dg2</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="skolem">g2</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span>cbox <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> image_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> field_cont_on_bot_edge_image<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="var">?Dg2</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> continuous_on_subset <span class="main"><span class="main">[</span></span><span class="operator">OF</span> field_cont<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> twoCisTypeI<span class="main">(</span>2<span class="main">)</span> twoCisTypeI<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> bot_edge_is_compos_of_scal_and_g2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="skolem">g2</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> twoCisTypeI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> Dg2_is_bot_edge_pathimg<span class="main">:</span>
    <span class="quoted"><span class="quoted">"path_image <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="var">?Dg2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> line_is_pair_img <span class="keyword2"><span class="keyword">and</span></span> bot_edge_is_compos_of_scal_and_g2 image_comp path_image_def add_scale_img <span class="keyword2"><span class="keyword">and</span></span> twoCisTypeI<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> cbox_interval<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> cont_on_bot<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>path_image <span class="var">?bottom_edge</span><span class="main">)</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> field_cont_on_bot_edge_image <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?D_left_edge</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> cbox <span class="main">(</span><span class="skolem">g2</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span><span class="skolem">g1</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> field_cont_on_left_edge_image<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="var">?D_left_edge</span>  <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> continuous_on_subset <span class="main"><span class="main">[</span></span><span class="operator">OF</span> field_cont<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> twoCisTypeI<span class="main">(</span>1<span class="main">)</span> twoCisTypeI<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g2</span> <span class="skolem">a</span> <span class="main">≤</span> <span class="skolem">g1</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> twoCisTypeI<span class="main">(</span>1<span class="main">)</span> twoCisTypeI<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">g2</span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">g1</span> <span class="skolem">a</span> <span class="main">-</span> <span class="skolem">g2</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">g2</span> <span class="skolem">a</span> <span class="main">..</span> <span class="skolem">g1</span> <span class="skolem">a</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> add_scale_img'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">g2</span> <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g1</span> <span class="skolem">a</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> left_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?D_left_edge</span> <span class="main">=</span> <span class="var">?left_edge</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> twoCisTypeI<span class="main">(</span>10<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subset_iff image_def set_eq_iff Semiring_Normalization.comm_semiring_1_class.semiring_normalization_rules<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> cont_on_left<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>path_image <span class="var">?left_edge</span><span class="main">)</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> field_cont_on_left_edge_image path_image_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> left_eq field_cont_on_left_edge_image path_image_def<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?D_right_edge</span></span></span> <span class="main">=</span>  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> cbox <span class="main">(</span><span class="skolem">g2</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">(</span><span class="skolem">g1</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">b</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> field_cont_on_left_edge_image<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="var">?D_right_edge</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> continuous_on_subset <span class="main"><span class="main">[</span></span><span class="operator">OF</span> field_cont<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> twoCisTypeI<span class="main">(</span>1<span class="main">)</span> twoCisTypeI<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g2</span> <span class="skolem">b</span> <span class="main">≤</span> <span class="skolem">g1</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> twoCisTypeI<span class="main">(</span>1<span class="main">)</span>  twoCisTypeI<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">g2</span> <span class="skolem">b</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">g1</span> <span class="skolem">b</span> <span class="main">-</span> <span class="skolem">g2</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">g2</span> <span class="skolem">b</span> <span class="main">..</span> <span class="skolem">g1</span> <span class="skolem">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> add_scale_img'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">g2</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g1</span> <span class="skolem">b</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> right_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?D_right_edge</span> <span class="main">=</span> <span class="var">?right_edge</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> twoCisTypeI<span class="main">(</span>8<span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subset_iff image_def set_eq_iff Semiring_Normalization.comm_semiring_1_class.semiring_normalization_rules<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> cont_on_right<span class="main">:</span>
    <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>path_image <span class="var">?right_edge</span><span class="main">)</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> field_cont_on_left_edge_image path_image_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> right_eq field_cont_on_left_edge_image path_image_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> all_edge_cases<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">γ</span> <span class="main">=</span> <span class="var">?bottom_edge</span> <span class="main">∨</span> <span class="free">γ</span> <span class="main">=</span> <span class="var">?right_edge</span> <span class="main">∨</span> <span class="free">γ</span> <span class="main">=</span> <span class="var">?top_edge</span> <span class="main">∨</span> <span class="free">γ</span> <span class="main">=</span> <span class="var">?left_edge</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_def horizontal_boundary_def vertical_boundary_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> path_image_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> cont_on_top cont_on_bot cont_on_right cont_on_left all_edge_cases
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Green-typeII_cube_explicit_spec"><span class="command">lemma</span></span> typeII_cube_explicit_spec<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"typeII_twoCube <span class="free">twoC</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">g1</span> <span class="bound">g2</span><span class="main">.</span> <span class="bound">a</span> <span class="main">&lt;</span> <span class="bound">b</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">a</span> <span class="main">..</span> <span class="bound">b</span><span class="main">}</span><span class="main">.</span> <span class="bound">g2</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">g1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span>
                     cubeImage <span class="free">twoC</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">a</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">g2</span> <span class="bound">x</span> <span class="main">..</span> <span class="bound">g1</span> <span class="bound">x</span><span class="main">}</span><span class="main">}</span>
                  <span class="main">∧</span> <span class="free">twoC</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="bound">g2</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="bound">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">b</span><span class="main">)</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">*</span> <span class="bound">g1</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="bound">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">b</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="bound">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">∧</span> <span class="bound">g1</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="bound">a</span> <span class="main">..</span> <span class="bound">b</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">g2</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="bound">a</span> <span class="main">..</span> <span class="bound">b</span><span class="main">}</span>
                  <span class="main">∧</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">g2</span> <span class="main">(</span><span class="bound">a</span> <span class="main">+</span> <span class="main">(</span><span class="bound">b</span> <span class="main">-</span> <span class="bound">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="bound">a</span> <span class="main">+</span> <span class="main">(</span><span class="bound">b</span> <span class="main">-</span> <span class="bound">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">∧</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">g2</span> <span class="bound">b</span> <span class="main">+</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="bound">g1</span> <span class="bound">b</span> <span class="main">-</span> <span class="bound">g2</span> <span class="bound">b</span><span class="main">)</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">∧</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">g1</span> <span class="main">(</span><span class="bound">a</span> <span class="main">+</span> <span class="main">(</span><span class="bound">b</span> <span class="main">-</span> <span class="bound">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="bound">a</span> <span class="main">+</span> <span class="main">(</span><span class="bound">b</span> <span class="main">-</span> <span class="bound">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">∧</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">g2</span> <span class="bound">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="bound">g1</span> <span class="bound">a</span> <span class="main">-</span> <span class="bound">g2</span> <span class="bound">a</span><span class="main">)</span><span class="main">,</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?bottom_edge</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?right_edge</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?top_edge</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?left_edge</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">g1</span></span> <span class="skolem"><span class="skolem">g2</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    twoCisTypeII<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&lt;</span> <span class="skolem">b</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> cbox <span class="skolem">a</span> <span class="skolem">b</span><span class="main">.</span> <span class="skolem">g2</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">g1</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"cubeImage <span class="free">twoC</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> cbox <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> cbox <span class="main">(</span><span class="skolem">g2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">g1</span> <span class="bound">x</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">twoC</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">g2</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">*</span> <span class="skolem">g1</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">g1</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="skolem">a</span> <span class="main">..</span> <span class="skolem">b</span><span class="main">}</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">g2</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="skolem">a</span> <span class="main">..</span> <span class="skolem">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> typeII_twoCubeImg<span class="main">[</span><span class="operator">of</span><span class="quoted"><span class="quoted">"<span class="free">twoC</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> bottom_edge_explicit<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?bottom_edge</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">g2</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> twoCisTypeII<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> right_edge_explicit<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?right_edge</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">g2</span> <span class="skolem">b</span> <span class="main">+</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">g1</span> <span class="skolem">b</span> <span class="main">-</span> <span class="skolem">g2</span> <span class="skolem">b</span><span class="main">)</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> twoCisTypeII<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> top_edge_explicit<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?top_edge</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">g1</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> twoCisTypeII<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> left_edge_explicit<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?left_edge</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">g2</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">g1</span> <span class="skolem">a</span> <span class="main">-</span> <span class="skolem">g2</span> <span class="skolem">a</span><span class="main">)</span><span class="main">,</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> twoCisTypeII<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> bottom_edge_explicit right_edge_explicit top_edge_explicit left_edge_explicit twoCisTypeII
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Green-typeII_twoCube_smooth_edges"><span class="command">lemma</span></span> typeII_twoCube_smooth_edges<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"typeII_twoCube <span class="free">twoC</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span> <span class="main">∈</span> boundary <span class="free">twoC</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?bottom_edge</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?right_edge</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?top_edge</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?left_edge</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">g1</span></span> <span class="skolem"><span class="skolem">g2</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    twoCisTypeII<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&lt;</span> <span class="skolem">b</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> cbox <span class="skolem">a</span> <span class="skolem">b</span><span class="main">.</span> <span class="skolem">g2</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">g1</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"cubeImage <span class="free">twoC</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> cbox <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> cbox <span class="main">(</span><span class="skolem">g2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">g1</span> <span class="bound">x</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">twoC</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">g2</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">*</span> <span class="skolem">g1</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">g1</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="skolem">a</span> <span class="main">..</span> <span class="skolem">b</span><span class="main">}</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">g2</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="skolem">a</span> <span class="main">..</span> <span class="skolem">b</span><span class="main">}</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">g2</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">g2</span> <span class="skolem">b</span> <span class="main">+</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">g1</span> <span class="skolem">b</span> <span class="main">-</span> <span class="skolem">g2</span> <span class="skolem">b</span><span class="main">)</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">g1</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">g2</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">g1</span> <span class="skolem">a</span> <span class="main">-</span> <span class="skolem">g2</span> <span class="skolem">a</span><span class="main">)</span><span class="main">,</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> typeII_cube_explicit_spec<span class="main">[</span><span class="operator">of</span><span class="quoted"><span class="quoted">"<span class="free">twoC</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> bottom_edge_smooth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?bottom_edge</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">-`</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="skolem">b</span> <span class="main">-</span><span class="skolem">a</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> twoCisTypeII<span class="main">(</span>1<span class="main">)</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> finite_vimg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> finite<span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">∩</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">-`</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> scale_shif_pw_smth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> scale_shift_smooth C1_differentiable_imp_piecewise <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> g2_smooth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g2</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> add_scale_img<span class="main">[</span><span class="operator">OF</span> twoCisTypeII<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> twoCisTypeII<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">g2</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> piecewise_C1_differentiable_compose<span class="main">[</span><span class="operator">OF</span> scale_shif_pw_smth g2_smooth finite_vimg<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> o_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span><span class="skolem">g2</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> all_components_smooth_one_pw_smooth_is_pw_smooth<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span><span class="skolem">g2</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_pair_basis<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> twoCisTypeII<span class="main">(</span>7<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> top_edge_smooth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?top_edge</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">-`</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="skolem">b</span> <span class="main">-</span><span class="skolem">a</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> twoCisTypeII<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> finite_vimg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> finite<span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">∩</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">-`</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> scale_shif_pw_smth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> scale_shift_smooth C1_differentiable_imp_piecewise <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> g1_smooth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g1</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> add_scale_img<span class="main">[</span><span class="operator">OF</span> twoCisTypeII<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> twoCisTypeII<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">g1</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> piecewise_C1_differentiable_compose<span class="main">[</span><span class="operator">OF</span> scale_shif_pw_smth g1_smooth finite_vimg<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> o_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span><span class="skolem">g1</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> all_components_smooth_one_pw_smooth_is_pw_smooth<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span><span class="skolem">g1</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_pair_basis<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> twoCisTypeII<span class="main">(</span>9<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> right_edge_smooth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?right_edge</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">g2</span> <span class="skolem">b</span> <span class="main">+</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">g1</span> <span class="skolem">b</span> <span class="main">-</span> <span class="skolem">g2</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C1_differentiable_imp_piecewise<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">g2</span> <span class="skolem">b</span> <span class="main">+</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">g1</span> <span class="skolem">b</span> <span class="main">-</span> <span class="skolem">g2</span> <span class="skolem">b</span><span class="main">)</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> all_components_smooth_one_pw_smooth_is_pw_smooth<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">g2</span> <span class="skolem">b</span> <span class="main">+</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">g1</span> <span class="skolem">b</span> <span class="main">-</span> <span class="skolem">g2</span> <span class="skolem">b</span><span class="main">)</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_pair_basis<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> twoCisTypeII<span class="main">(</span>8<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> left_edge_smooth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?left_edge</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">g2</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">g1</span> <span class="skolem">a</span> <span class="main">-</span> <span class="skolem">g2</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> C1_differentiable_imp_piecewise <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">g2</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">g1</span> <span class="skolem">a</span> <span class="main">-</span> <span class="skolem">g2</span> <span class="skolem">a</span><span class="main">)</span><span class="main">,</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> C1_differentiable_imp_piecewise<span class="main">[</span><span class="operator">OF</span> C1_differentiable_on_pair<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 0 C1_differentiable_on_const<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> twoCisTypeII<span class="main">(</span>10<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">=</span> <span class="var">?bottom_edge</span> <span class="main">∨</span> <span class="free">γ</span> <span class="main">=</span> <span class="var">?right_edge</span> <span class="main">∨</span> <span class="free">γ</span> <span class="main">=</span> <span class="var">?top_edge</span> <span class="main">∨</span> <span class="free">γ</span> <span class="main">=</span> <span class="var">?left_edge</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_def horizontal_boundary_def vertical_boundary_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> left_edge_smooth right_edge_smooth top_edge_smooth bottom_edge_smooth <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Green-field_cont_on_typeII_region_cont_on_edges"><span class="command">lemma</span></span> field_cont_on_typeII_region_cont_on_edges<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> typeII_twoC<span class="main">:</span>
    <span class="quoted"><span class="quoted">"typeII_twoCube <span class="free">twoC</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    field_cont<span class="main">:</span>
    <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>cubeImage <span class="free">twoC</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    member_of_boundary<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span> <span class="main">∈</span> boundary <span class="free">twoC</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span><span class="free">γ</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">g1</span></span> <span class="skolem"><span class="skolem">g2</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    twoCisTypeII<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&lt;</span> <span class="skolem">b</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> cbox <span class="skolem">a</span> <span class="skolem">b</span><span class="main">.</span> <span class="skolem">g2</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">g1</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"cubeImage <span class="free">twoC</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> cbox <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> cbox <span class="main">(</span><span class="skolem">g2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">g1</span> <span class="bound">x</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">twoC</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">g2</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">*</span> <span class="skolem">g1</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">g1</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="skolem">a</span> <span class="main">..</span> <span class="skolem">b</span><span class="main">}</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">g2</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="skolem">a</span> <span class="main">..</span> <span class="skolem">b</span><span class="main">}</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">g2</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">g2</span> <span class="skolem">b</span> <span class="main">+</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">g1</span> <span class="skolem">b</span> <span class="main">-</span> <span class="skolem">g2</span> <span class="skolem">b</span><span class="main">)</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">g1</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">g2</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">g1</span> <span class="skolem">a</span> <span class="main">-</span> <span class="skolem">g2</span> <span class="skolem">a</span><span class="main">)</span><span class="main">,</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> typeII_twoC <span class="keyword2"><span class="keyword">and</span></span> typeII_cube_explicit_spec<span class="main">[</span><span class="operator">of</span><span class="quoted"><span class="quoted">"<span class="free">twoC</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?bottom_edge</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?right_edge</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?top_edge</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?left_edge</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Dg1</span></span></span> <span class="main">=</span>  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> cbox <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">g1</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> line_is_pair_img<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Dg1</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">g1</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span>cbox <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> image_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> field_cont_on_top_edge_image<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="var">?Dg1</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> continuous_on_subset <span class="main"><span class="main">[</span></span><span class="operator">OF</span> field_cont<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> twoCisTypeII<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> twoCisTypeII<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> top_edge_is_compos_of_scal_and_g1<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">g1</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> twoCisTypeII <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> Dg1_is_bot_edge_pathimg<span class="main">:</span>
    <span class="quoted"><span class="quoted">"path_image <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="var">?Dg1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> line_is_pair_img <span class="keyword2"><span class="keyword">and</span></span> top_edge_is_compos_of_scal_and_g1 image_comp path_image_def add_scale_img <span class="keyword2"><span class="keyword">and</span></span> twoCisTypeII<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> cbox_interval<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> cont_on_top<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>path_image <span class="var">?top_edge</span><span class="main">)</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> field_cont_on_top_edge_image <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Dg2</span></span></span> <span class="main">=</span>  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> cbox <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">g2</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> line_is_pair_img<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Dg2</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">g2</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span>cbox <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> image_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> field_cont_on_bot_edge_image<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="var">?Dg2</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> continuous_on_subset <span class="main"><span class="main">[</span></span><span class="operator">OF</span> field_cont<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> twoCisTypeII<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> twoCisTypeII<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> bot_edge_is_compos_of_scal_and_g2<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">g2</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> twoCisTypeII <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> Dg2_is_bot_edge_pathimg<span class="main">:</span> <span class="quoted"><span class="quoted">"path_image <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="var">?Dg2</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> path_image_def
    <span class="keyword1"><span class="command">using</span></span> line_is_pair_img <span class="keyword2"><span class="keyword">and</span></span> bot_edge_is_compos_of_scal_and_g2 image_comp  add_scale_img <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">&lt;</span> <span class="skolem">b</span>›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> box_real<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> cont_on_bot<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>path_image <span class="var">?bottom_edge</span><span class="main">)</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> field_cont_on_bot_edge_image
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?D_left_edge</span></span></span> <span class="main">=</span>  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> cbox <span class="main">(</span><span class="skolem">g2</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span><span class="skolem">g1</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="skolem">a</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> field_cont_on_left_edge_image<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="var">?D_left_edge</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> continuous_on_subset <span class="main"><span class="main">[</span></span><span class="operator">OF</span> field_cont<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> twoCisTypeII<span class="main">(</span>1<span class="main">)</span> twoCisTypeII<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g2</span> <span class="skolem">a</span> <span class="main">≤</span> <span class="skolem">g1</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> twoCisTypeII<span class="main">(</span>1<span class="main">)</span> twoCisTypeII<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">g2</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">g1</span> <span class="skolem">a</span> <span class="main">-</span> <span class="skolem">g2</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">g2</span> <span class="skolem">a</span> <span class="main">..</span> <span class="skolem">g1</span> <span class="skolem">a</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> add_scale_img'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">g2</span> <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g1</span> <span class="skolem">a</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g2</span> <span class="skolem">a</span> <span class="main">≤</span> <span class="skolem">g1</span> <span class="skolem">a</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> left_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?D_left_edge</span> <span class="main">=</span> <span class="var">?left_edge</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> twoCisTypeII<span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> cont_on_left<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>path_image <span class="var">?left_edge</span><span class="main">)</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> field_cont_on_left_edge_image path_image_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> left_eq field_cont_on_left_edge_image path_image_def<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?D_right_edge</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> cbox <span class="main">(</span><span class="skolem">g2</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">(</span><span class="skolem">g1</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> field_cont_on_left_edge_image<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="var">?D_right_edge</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> continuous_on_subset <span class="main"><span class="main">[</span></span><span class="operator">OF</span> field_cont<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> twoCisTypeII<span class="main">(</span>1<span class="main">)</span> twoCisTypeII<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g2</span> <span class="skolem">b</span> <span class="main">≤</span> <span class="skolem">g1</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> twoCisTypeII<span class="main">(</span>1<span class="main">)</span> twoCisTypeII<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">g2</span> <span class="skolem">b</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">g1</span> <span class="skolem">b</span> <span class="main">-</span> <span class="skolem">g2</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">g2</span> <span class="skolem">b</span> <span class="main">..</span> <span class="skolem">g1</span> <span class="skolem">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> add_scale_img'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">g2</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g1</span> <span class="skolem">b</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g2</span> <span class="skolem">b</span> <span class="main">≤</span> <span class="skolem">g1</span> <span class="skolem">b</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> right_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?D_right_edge</span> <span class="main">=</span> <span class="var">?right_edge</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> twoCisTypeII<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> cont_on_right<span class="main">:</span>
    <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>path_image <span class="var">?right_edge</span><span class="main">)</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> field_cont_on_left_edge_image path_image_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> right_eq field_cont_on_left_edge_image path_image_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> all_edge_cases<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">γ</span> <span class="main">=</span> <span class="var">?bottom_edge</span> <span class="main">∨</span> <span class="free">γ</span> <span class="main">=</span> <span class="var">?right_edge</span> <span class="main">∨</span> <span class="free">γ</span> <span class="main">=</span> <span class="var">?top_edge</span> <span class="main">∨</span> <span class="free">γ</span> <span class="main">=</span> <span class="var">?left_edge</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> boundary_def horizontal_boundary_def vertical_boundary_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> path_image_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> cont_on_top cont_on_bot cont_on_right cont_on_left all_edge_cases
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Green-two_cube_boundary_is_boundary"><span class="command">lemma</span></span> two_cube_boundary_is_boundary<span class="main">:</span> <span class="quoted"><span class="quoted">"boundary_chain <span class="main">(</span>boundary <span class="free">C</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_chain_def boundary_def horizontal_boundary_def vertical_boundary_def<span class="main">)</span>

<span class="keyword1" id="Green-common_boundary_subdiv_exists_refl"><span class="command">lemma</span></span> common_boundary_subdiv_exists_refl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span>boundary <span class="free">twoC</span><span class="main">.</span> valid_path <span class="bound">γ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"common_boundary_sudivision_exists <span class="main">(</span>boundary <span class="free">twoC</span><span class="main">)</span> <span class="main">(</span>boundary <span class="free">twoC</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms chain_subdiv_chain_refl common_boundary_sudivision_exists_def two_cube_boundary_is_boundary <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Green-common_boundary_subdiv_exists_refl'"><span class="command">lemma</span></span> common_boundary_subdiv_exists_refl'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">C</span><span class="main">.</span> valid_path <span class="bound">γ</span>"</span></span>
    <span class="quoted"><span class="quoted">"boundary_chain <span class="main">(</span><span class="free">C</span><span class="main">::</span><span class="main">(</span>int <span class="main">×</span> <span class="main">(</span>real <span class="main">⇒</span> real <span class="main">×</span> real<span class="main">)</span><span class="main">)</span> set<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"common_boundary_sudivision_exists <span class="main">(</span><span class="free">C</span><span class="main">)</span> <span class="main">(</span><span class="free">C</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms chain_subdiv_chain_refl common_boundary_sudivision_exists_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Green-gen_common_boundary_subdiv_exists_refl_twochain_boundary"><span class="command">lemma</span></span> gen_common_boundary_subdiv_exists_refl_twochain_boundary<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">C</span><span class="main">.</span> valid_path <span class="bound">γ</span>"</span></span>
    <span class="quoted"><span class="quoted">"boundary_chain <span class="main">(</span><span class="free">C</span><span class="main">::</span><span class="main">(</span>int <span class="main">×</span> <span class="main">(</span>real <span class="main">⇒</span> real <span class="main">×</span> real<span class="main">)</span><span class="main">)</span> set<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"common_sudiv_exists <span class="main">(</span><span class="free">C</span><span class="main">)</span> <span class="main">(</span><span class="free">C</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms chain_subdiv_chain_refl common_boundary_sudivision_exists_def common_subdiv_imp_gen_common_subdiv <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Green-two_chain_boundary_is_boundary_chain"><span class="command">lemma</span></span> two_chain_boundary_is_boundary_chain<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"boundary_chain <span class="main">(</span>two_chain_boundary <span class="free">twoChain</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_chain_def two_chain_boundary_def boundary_def horizontal_boundary_def vertical_boundary_def<span class="main">)</span>

<span class="keyword1" id="Green-typeI_edges_are_valid_paths"><span class="command">lemma</span></span> typeI_edges_are_valid_paths<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"typeI_twoCube <span class="free">twoC</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span> <span class="main">∈</span> boundary <span class="free">twoC</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="free">γ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> typeI_twoCube_smooth_edges<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> C1_differentiable_imp_piecewise
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> valid_path_def<span class="main">)</span>

<span class="keyword1" id="Green-typeII_edges_are_valid_paths"><span class="command">lemma</span></span> typeII_edges_are_valid_paths<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"typeII_twoCube <span class="free">twoC</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span> <span class="main">∈</span> boundary <span class="free">twoC</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="free">γ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> typeII_twoCube_smooth_edges<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> C1_differentiable_imp_piecewise
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> valid_path_def<span class="main">)</span>

<span class="keyword1" id="Green-finite_two_chain_vertical_boundary"><span class="command">lemma</span></span> finite_two_chain_vertical_boundary<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">two_chain</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> two_chain_vertical_boundary_def vertical_boundary_def<span class="main">)</span>

<span class="keyword1" id="Green-finite_two_chain_horizontal_boundary"><span class="command">lemma</span></span> finite_two_chain_horizontal_boundary<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">two_chain</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> two_chain_horizontal_boundary_def horizontal_boundary_def<span class="main">)</span>

<span class="keyword1"><span class="command">locale</span></span> R2 <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">i</span> <span class="free">j</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i_is_x_axis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">,</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    j_is_y_axis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">,</span> <span class="main">1</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Green-analytically_valid_y"><span class="command">lemma</span></span> analytically_valid_y<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"analytically_valid <span class="free">s</span> <span class="free">F</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span>partial_vector_derivative <span class="free">F</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>indicator <span class="free">s</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> borel_measurable lborel"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">,</span> <span class="main">0</span><span class="main">::</span>real<span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">,</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_pair_basis analytically_valid_def i_is_x_axis j_is_y_axis<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Green-analytically_valid_x"><span class="command">lemma</span></span> analytically_valid_x<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"analytically_valid <span class="free">s</span> <span class="free">F</span> <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>partial_vector_derivative <span class="free">F</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>indicator <span class="free">s</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> borel_measurable lborel"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">,</span> <span class="main">0</span><span class="main">::</span>real<span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">,</span> <span class="main">0</span><span class="main">::</span>real<span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_pair_basis analytically_valid_def i_is_x_axis j_is_y_axis<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Green-Greens_thm_type_I"><span class="command">lemma</span></span> Greens_thm_type_I<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">F</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>real<span class="main">*</span>real<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>real <span class="main">*</span> real<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">gamma1</span> <span class="free">gamma2</span> <span class="free">gamma3</span> <span class="free">gamma4</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real <span class="main">⇒</span> <span class="main">(</span>real <span class="main">*</span> real<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">a</span><span class="main">::</span> <span class="quoted"><span class="quoted">"real"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">b</span><span class="main">::</span> <span class="quoted"><span class="quoted">"real"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">g1</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real <span class="main">⇒</span> real<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">g2</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real <span class="main">⇒</span> real<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Dy_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Dy_pair</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">::</span>real<span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> cbox <span class="free">a</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> cbox <span class="main">(</span><span class="free">g2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">g1</span> <span class="bound">x</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    gamma1_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">gamma1</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">,</span> <span class="free">g2</span><span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    gamma1_smooth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">gamma1</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="comment1">(*TODO: This should be piecewise smooth*)</span>
    gamma2_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">gamma2</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">b</span><span class="main">,</span> <span class="free">g2</span><span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="main">+</span> <span class="bound">x</span>  <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">g1</span><span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="main">-</span> <span class="free">g2</span><span class="main">(</span><span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    gamma3_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">gamma3</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">,</span> <span class="free">g1</span><span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    gamma3_smooth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">gamma3</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    gamma4_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">gamma4</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span>  <span class="free">g2</span><span class="main">(</span><span class="free">a</span><span class="main">)</span> <span class="main">+</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">g1</span><span class="main">(</span><span class="free">a</span><span class="main">)</span> <span class="main">-</span> <span class="free">g2</span><span class="main">(</span><span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    F_i_analytically_valid<span class="main">:</span> <span class="quoted"><span class="quoted">"analytically_valid <span class="free">Dy_pair</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="bound">p</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="free">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    g2_leq_g1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> cbox <span class="free">a</span> <span class="free">b</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">g1</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="comment1">(*This is needed otherwise what would Dy be?*)</span>
    a_lt_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">gamma1</span><span class="main">)</span> <span class="main">+</span>
         <span class="main">(</span>line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">gamma2</span><span class="main">)</span> <span class="main">-</span>
         <span class="main">(</span>line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">gamma3</span><span class="main">)</span> <span class="main">-</span>
         <span class="main">(</span>line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">gamma4</span><span class="main">)</span>
                 <span class="main">=</span> <span class="main">(</span>integral <span class="free">Dy_pair</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">-</span> <span class="main">(</span>partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="bound">p</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="free">j</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">gamma4</span>"</span></span>
    <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">gamma3</span>"</span></span>
    <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">gamma2</span>"</span></span>
    <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">gamma1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F_b'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="bound">a</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span>  <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> F_first_is_continuous<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="free">Dy_pair</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="bound">a</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> F_i_analytically_valid
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analytically_valid_def<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="free">Dy_pair</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span>partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="bound">a</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span>  <span class="free">j</span><span class="main">)</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> f_lesbegue_integrable<span class="main">:</span> <span class="quoted"><span class="quoted">"integrable lborel <span class="var">?f</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> F_i_analytically_valid
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analytically_valid_def indic_ident<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> partially_vec_diff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> <span class="free">Dy_pair</span><span class="main">.</span> partially_vector_differentiable <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="bound">a</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="free">j</span> <span class="bound">a</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> F_i_analytically_valid
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analytically_valid_def indicator_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> x_axis_integral_measurable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="var">?f</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> borel_measurable lborel"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="var">?F_b'</span> <span class="bound">p</span><span class="main">)</span> <span class="main">*</span> indicator <span class="main">(</span><span class="free">Dy_pair</span><span class="main">)</span> <span class="bound">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="free">Dy_pair</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span><span class="var">?F_b'</span><span class="main">)</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> indic_ident<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="var">?F_b'</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="var">?F_b'</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">*</span> indicator <span class="main">(</span><span class="free">Dy_pair</span><span class="main">)</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="free">Dy_pair</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span><span class="var">?F_b'</span><span class="main">)</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> analytically_valid_x<span class="main">[</span><span class="operator">OF</span> F_i_analytically_valid<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> indicator_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> F_partially_differentiable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free">Dy_pair</span><span class="main">.</span> has_partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="free">j</span> <span class="main">(</span><span class="var">?F_b'</span> <span class="bound">a</span><span class="main">)</span> <span class="bound">a</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> partial_vector_derivative_works partially_vec_diff
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> g1_g2_continuous<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">g1</span>"</span></span>
    <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">g2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> shift_scale_cont<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> shift_scale_inv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> id"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a_lt_b <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> o_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> img_shift_scale<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">`</span><span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a_lt_b <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> image_iff<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">+</span> <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> le_diff_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">have</span></span> gamma1_y_component<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g2</span><span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">g2</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span><span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g2</span><span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> continuous_on_inner<span class="main">[</span><span class="operator">OF</span> piecewise_C1_differentiable_on_imp_continuous_on<span class="main"><span class="main">[</span></span><span class="operator">OF</span> gamma1_smooth<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">j</span><span class="main">)</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> continuous_on_const<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gamma1_def j_is_y_axis<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g2</span><span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> img_shift_scale continuous_on_compose shift_scale_cont
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">(</span><span class="free">g2</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span><span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> gamma1_y_component <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">g2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a_lt_b <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shift_scale_inv<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> gamma3_y_component<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g1</span><span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">g1</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span><span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g1</span><span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> continuous_on_inner<span class="main">[</span><span class="operator">OF</span> piecewise_C1_differentiable_on_imp_continuous_on<span class="main"><span class="main">[</span></span><span class="operator">OF</span> gamma3_smooth<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">j</span><span class="main">)</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> continuous_on_const<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gamma3_def j_is_y_axis<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g1</span><span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> img_shift_scale continuous_on_compose shift_scale_cont
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">(</span><span class="free">g1</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span><span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> gamma3_y_component <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">g1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a_lt_b <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shift_scale_inv<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> g2_scale_j_contin<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">g2</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span> g1_g2_continuous<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Dg2</span></span></span> <span class="main">=</span>  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> cbox <span class="free">a</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="free">g2</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> line_is_pair_img<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Dg2</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="free">g2</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> image_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> g2_path_continuous<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="free">g2</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span> g1_g2_continuous<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> field_cont_on_gamma1_image<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="var">?Dg2</span>  <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="bound">a</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> continuous_on_subset <span class="main"><span class="main">[</span></span><span class="operator">OF</span> F_first_is_continuous<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Dy_def g2_leq_g1<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> gamma1_is_compos_of_scal_and_g2<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">gamma1</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="free">g2</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> gamma1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> add_scale_img<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="main">1</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span> <span class="main">..</span> <span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> add_scale_img <span class="keyword2"><span class="keyword">and</span></span> a_lt_b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Dg2_is_gamma1_pathimg<span class="main">:</span> <span class="quoted"><span class="quoted">"path_image <span class="free">gamma1</span> <span class="main">=</span> <span class="var">?Dg2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> box_real<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> gamma1_is_compos_of_scal_and_g2 image_comp line_is_pair_img path_image_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> Base_vecs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> Basis"</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">∈</span> Basis"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="free">j</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> real_pair_basis <span class="keyword2"><span class="keyword">and</span></span> i_is_x_axis <span class="keyword2"><span class="keyword">and</span></span> j_is_y_axis <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> gamma1_as_euclid_space_fun<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">gamma1</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">g2</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> i_is_x_axis gamma1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">gamma1</span> <span class="main">=</span> integral <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="free">g2</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span> <span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">gamma1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> line_integral_on_pair_path_strong <span class="main">[</span><span class="operator">OF</span> norm_Basis<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator"><span class="operator">OF</span></span> Base_vecs<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span> _ gamma1_as_euclid_space_fun<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">F</span></span>"</span></span></span><span class="main">]</span> 
      gamma1_def gamma1_smooth g2_scale_j_contin a_lt_b add_scale_img
      Dg2_is_gamma1_pathimg <span class="keyword2"><span class="keyword">and</span></span> field_cont_on_gamma1_image
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pathstart_def pathfinish_def i_is_x_axis<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">gamma1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> gamma2_x_const<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">gamma2</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_is_x_axis gamma2_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">gamma2</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">gamma2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> line_integral_on_pair_straight_path<span class="main">[</span><span class="operator">OF</span> gamma2_x_const<span class="main">]</span> straight_path_diffrentiable_x gamma2_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">gamma2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="free">g2</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>  <span class="main">∙</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> line_is_pair_img <span class="keyword2"><span class="keyword">and</span></span> g2_path_continuous <span class="keyword2"><span class="keyword">and</span></span> field_cont_on_gamma1_image
      Topological_Spaces.continuous_on_compose i_is_x_axis j_is_y_axis
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="free">g2</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>  <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> integrable_continuous <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="free">g2</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>  <span class="main">∙</span> <span class="free">i</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> g1_scale_j_contin<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">g1</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span> g1_g2_continuous<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Dg1</span></span></span> <span class="main">=</span>  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> cbox <span class="free">a</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="free">g1</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> line_is_pair_img<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Dg1</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="free">g1</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">)</span> <span class="main">`</span> <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> image_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> g1_path_continuous<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="free">g1</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span> g1_g2_continuous<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> field_cont_on_gamma3_image<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="var">?Dg1</span>  <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="bound">a</span><span class="main">)</span>  <span class="main">∙</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> continuous_on_subset <span class="main"><span class="main">[</span></span><span class="operator">OF</span> F_first_is_continuous<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Dy_def g2_leq_g1<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> gamma3_is_compos_of_scal_and_g1<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">gamma3</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="free">g1</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> gamma3_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Dg1_is_gamma3_pathimg<span class="main">:</span> <span class="quoted"><span class="quoted">"path_image <span class="free">gamma3</span> <span class="main">=</span> <span class="var">?Dg1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> box_real<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> image_comp line_is_pair_img local.add_scale_img path_image_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> Base_vecs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> Basis"</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">∈</span> Basis"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="free">j</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> real_pair_basis <span class="keyword2"><span class="keyword">and</span></span> i_is_x_axis <span class="keyword2"><span class="keyword">and</span></span> j_is_y_axis <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> gamma3_as_euclid_space_fun<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">gamma3</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span> <span class="main">+</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">g1</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> i_is_x_axis gamma3_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">gamma3</span> <span class="main">=</span> integral <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="free">g1</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span> <span class="main">)</span>"</span></span>
         <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">gamma3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> line_integral_on_pair_path_strong <span class="main">[</span><span class="operator">OF</span> norm_Basis<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator"><span class="operator">OF</span></span> Base_vecs<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span> _ gamma3_as_euclid_space_fun<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">F</span></span>"</span></span></span><span class="main">]</span>
      gamma3_def <span class="keyword2"><span class="keyword">and</span></span> gamma3_smooth <span class="keyword2"><span class="keyword">and</span></span> g1_scale_j_contin <span class="keyword2"><span class="keyword">and</span></span> a_lt_b <span class="keyword2"><span class="keyword">and</span></span> add_scale_img
      Dg1_is_gamma3_pathimg <span class="keyword2"><span class="keyword">and</span></span> field_cont_on_gamma3_image
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pathstart_def pathfinish_def i_is_x_axis<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">gamma3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> gamma4_x_const<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">gamma4</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> gamma4_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_inner_class.inner_add_left inner_not_same_Basis  i_is_x_axis<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">gamma4</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">gamma4</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> line_integral_on_pair_straight_path<span class="main">[</span><span class="operator">OF</span> gamma4_x_const<span class="main">]</span> straight_path_diffrentiable_x gamma4_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">gamma4</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="free">g1</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> line_is_pair_img <span class="keyword2"><span class="keyword">and</span></span> g1_path_continuous <span class="keyword2"><span class="keyword">and</span></span> field_cont_on_gamma3_image
      continuous_on_compose i_is_x_axis j_is_y_axis
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="free">g1</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>  <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> integrable_continuous <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="free">g1</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>  <span class="main">∙</span> <span class="free">i</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> partial_deriv_one_d_integrable<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="var">?F_b'</span><span class="main">(</span><span class="skolem">xc</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> 
        <span class="free">F</span><span class="main">(</span><span class="skolem">xc</span><span class="main">,</span><span class="free">g1</span><span class="main">(</span><span class="skolem">xc</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span> <span class="main">-</span> <span class="free">F</span><span class="main">(</span><span class="skolem">xc</span><span class="main">,</span> <span class="free">g2</span><span class="main">(</span><span class="skolem">xc</span><span class="main">)</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span>cbox <span class="main">(</span><span class="free">g2</span> <span class="skolem">xc</span><span class="main">)</span> <span class="main">(</span><span class="free">g1</span> <span class="skolem">xc</span><span class="main">)</span><span class="main">)</span>"</span></span> 
     <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xc</span> <span class="main">∈</span> cbox <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">xc</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">xc'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span>  <span class="bound">y</span> <span class="main">∈</span> cbox <span class="main">(</span><span class="free">g2</span> <span class="skolem">xc</span><span class="main">)</span> <span class="main">(</span><span class="free">g1</span> <span class="skolem">xc</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">xc'</span> <span class="main">=</span> <span class="skolem">xc</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">Dy_pair</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Dy_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="var">?F_b'</span> <span class="main">(</span><span class="skolem">xc</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="free">F</span><span class="main">(</span><span class="skolem">xc</span><span class="main">,</span> <span class="free">g1</span> <span class="skolem">xc</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span> <span class="main">-</span> <span class="free">F</span><span class="main">(</span><span class="skolem">xc</span><span class="main">,</span> <span class="free">g2</span> <span class="skolem">xc</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span>cbox <span class="main">(</span><span class="free">g2</span> <span class="skolem">xc</span><span class="main">)</span> <span class="main">(</span><span class="free">g1</span> <span class="skolem">xc</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword2"><span class="keyword">and</span></span> Base_vecs <span class="keyword2"><span class="keyword">and</span></span> F_partially_differentiable
        <span class="keyword2"><span class="keyword">and</span></span> Dy_def <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> g2_leq_g1
        <span class="keyword2"><span class="keyword">and</span></span> fundamental_theorem_of_calculus_partial_vector
        <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">g2</span> <span class="skolem">xc</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="skolem">xc</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xc</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Dy_pair</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?F_b'</span>"</span></span> <span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  Groups.ab_semigroup_add_class.add.commute i_is_x_axis j_is_y_axis<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> partial_deriv_integrable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?F_b'</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="free">Dy_pair</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> F_i_analytically_valid analytically_valid_imp_part_deriv_integrable_on<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"integral <span class="free">Dy_pair</span> <span class="var">?F_b'</span>
           <span class="main">=</span> integral <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral <span class="main">(</span>cbox <span class="main">(</span><span class="free">g2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">g1</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="var">?F_b'</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> x_axis_gauge_integrable<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="var">?f</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">integrable_on</span> UNIV"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted">real</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> cbox <span class="free">a</span> <span class="free">b</span> <span class="main">⟶</span>  <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="var">?f</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Dy_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f_integrable_x_not_in_range<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> cbox <span class="free">a</span> <span class="free">b</span> <span class="main">⟶</span>  <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="var">?f</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">integrable_on</span> UNIV"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> integrable_0<span class="main">)</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F_b'_oneD</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">y</span> <span class="main">∈</span> <span class="main">(</span>cbox <span class="main">(</span><span class="free">g2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span> <span class="free">g1</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="var">?F_b'</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> f_value_x_in_range<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> cbox <span class="free">a</span> <span class="free">b</span><span class="main">.</span> <span class="var">?F_b'_oneD</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="var">?f</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Dy_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> cbox <span class="free">a</span> <span class="free">b</span><span class="main">.</span> <span class="var">?F_b'_oneD</span> <span class="bound">x</span> <span class="keyword1">integrable_on</span> UNIV"</span></span>
        <span class="keyword1"><span class="command">using</span></span> has_integral_integrable integrable_restrict_UNIV partial_deriv_one_d_integrable <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f_integrable_x_in_range<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> cbox <span class="free">a</span> <span class="free">b</span> <span class="main">⟶</span>  <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="var">?f</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">integrable_on</span> UNIV"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f_value_x_in_range <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="var">?f</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">integrable_on</span> UNIV"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f_integrable_x_not_in_range <span class="keyword2"><span class="keyword">and</span></span> f_integrable_x_in_range <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> arg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">Dy_pair</span> <span class="keyword1">then</span> partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="free">F</span> <span class="bound">a</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="free">j</span> <span class="bound">a</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">Dy_pair</span> <span class="keyword1">then</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">Dy_pair</span> <span class="keyword1">then</span> partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="free">F</span> <span class="bound">a</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="free">j</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> arg2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Dy_pair</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">∈</span>Basis<span class="main">.</span> <span class="free">a</span> <span class="main">∙</span> <span class="bound">i</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∙</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">∈</span>Basis<span class="main">.</span> <span class="free">g2</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">i</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">∙</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∙</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">g1</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">i</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Dy_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> arg3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">Dy_pair</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">Dy_pair</span> <span class="keyword1">then</span> partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="free">F</span> <span class="bound">a</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="free">j</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="bound">x</span>
                           <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="free">F</span> <span class="bound">a</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="free">j</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> arg4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">⟹</span>
                            <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral <span class="main">(</span>cbox <span class="main">(</span><span class="free">g2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">g1</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="keyword1">if</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">Dy_pair</span> <span class="keyword1">then</span> partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="free">F</span> <span class="bound">a</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="free">j</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span>
                                      <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral <span class="main">(</span>cbox <span class="main">(</span><span class="free">g2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">g1</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="free">F</span> <span class="bound">a</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="free">j</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Dy_def<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Henstock_Kurzweil_Integration.integral_cong atLeastAtMost_iff<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> gauge_integral_Fubini_curve_bounded_region_x
        <span class="main">[</span><span class="operator">OF</span> f_lesbegue_integrable x_axis_gauge_integrable x_axis_integral_measurable arg arg2<span class="main">]</span>
        Henstock_Kurzweil_Integration.integral_cong<span class="main">[</span><span class="operator">OF</span> arg3<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">Dy_pair</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span><span class="main">]</span>
        Henstock_Kurzweil_Integration.integral_cong<span class="main">[</span><span class="operator">OF</span> arg4<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"cbox <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>integral <span class="free">Dy_pair</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="var">?F_b'</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>
        <span class="main">=</span> integral <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="free">g1</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>  <span class="main">∙</span> <span class="free">i</span> <span class="main">-</span> <span class="free">F</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="free">g2</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>  <span class="main">∙</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 4 Henstock_Kurzweil_Integration.integral_cong partial_deriv_one_d_integrable integrable_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> integral_unique<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">gamma1</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">gamma2</span><span class="main">)</span> <span class="main">-</span>
          <span class="main">(</span>line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">gamma3</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">gamma4</span><span class="main">)</span>
        <span class="main">=</span> <span class="main">(</span>integral <span class="free">Dy_pair</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">-</span> <span class="main">(</span><span class="var">?F_b'</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"0"</span><span class="main">(</span>1<span class="main">)</span> <span class="quoted">"1"</span><span class="main">(</span>1<span class="main">)</span> <span class="quoted">"2"</span><span class="main">(</span>1<span class="main">)</span> <span class="quoted">"3"</span><span class="main">(</span>1<span class="main">)</span> 5 <span class="quoted">"6"</span> <span class="quoted">"7"</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Henstock_Kurzweil_Integration.integral_diff<span class="main">)</span>    
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> Greens_thm_type_II<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">F</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>real<span class="main">*</span>real<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>real <span class="main">*</span> real<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">gamma4</span> <span class="free">gamma3</span> <span class="free">gamma2</span> <span class="free">gamma1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real <span class="main">⇒</span> <span class="main">(</span>real <span class="main">*</span> real<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">a</span><span class="main">::</span> <span class="quoted"><span class="quoted">"real"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">b</span><span class="main">::</span> <span class="quoted"><span class="quoted">"real"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">g1</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real <span class="main">⇒</span> real<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">g2</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real <span class="main">⇒</span> real<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Dx_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Dx_pair</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">::</span>real<span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> cbox <span class="free">a</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∈</span> cbox <span class="main">(</span><span class="free">g2</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span><span class="free">g1</span> <span class="bound">y</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    gamma4_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">gamma4</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span><span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    gamma4_smooth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">gamma4</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="comment1">(*TODO: This should be piecewise smooth*)</span>
    gamma3_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">gamma3</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span><span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="main">+</span> <span class="bound">x</span>  <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">g1</span><span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="main">-</span> <span class="free">g2</span><span class="main">(</span><span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    gamma2_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">gamma2</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">g1</span><span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    gamma2_smooth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">gamma2</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    gamma1_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">gamma1</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span><span class="main">(</span><span class="free">a</span><span class="main">)</span> <span class="main">+</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">g1</span><span class="main">(</span><span class="free">a</span><span class="main">)</span> <span class="main">-</span> <span class="free">g2</span><span class="main">(</span><span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    F_j_analytically_valid<span class="main">:</span> <span class="quoted"><span class="quoted">"analytically_valid <span class="free">Dx_pair</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="bound">p</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="free">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    g2_leq_g1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> cbox <span class="free">a</span> <span class="free">b</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">g1</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="comment1">(*This is needed otherwise what would Dy be?*)</span>
    a_lt_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span>line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">gamma4</span><span class="main">)</span> <span class="main">-</span>
         <span class="main">(</span>line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">gamma3</span><span class="main">)</span> <span class="main">+</span>
         <span class="main">(</span>line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">gamma2</span><span class="main">)</span> <span class="main">+</span>
         <span class="main">(</span>line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">gamma1</span><span class="main">)</span>
                 <span class="main">=</span> <span class="main">(</span>integral <span class="free">Dx_pair</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span>partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="bound">a</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span>  <span class="free">i</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">gamma4</span>"</span></span>
    <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">gamma3</span>"</span></span>
    <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">gamma2</span>"</span></span>
    <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">gamma1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F_a'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="bound">a</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span>  <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> F_first_is_continuous<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="free">Dx_pair</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="bound">a</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> F_j_analytically_valid
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analytically_valid_def<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="free">Dx_pair</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span>partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="bound">a</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span>  <span class="free">i</span><span class="main">)</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> f_lesbegue_integrable<span class="main">:</span> <span class="quoted"><span class="quoted">"integrable lborel <span class="var">?f</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> F_j_analytically_valid
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analytically_valid_def indic_ident<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> partially_vec_diff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> <span class="free">Dx_pair</span><span class="main">.</span> partially_vector_differentiable <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="bound">a</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="free">i</span> <span class="bound">a</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> F_j_analytically_valid
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analytically_valid_def indicator_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="var">?F_a'</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">*</span> indicator <span class="main">(</span><span class="free">Dx_pair</span><span class="main">)</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="free">Dx_pair</span><span class="main">)</span> <span class="keyword1">then</span> <span class="var">?F_a'</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> indic_ident<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="var">?F_a'</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> y_axis_integral_measurable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral UNIV <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="var">?f</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> borel_measurable lborel"</span></span>
    <span class="keyword1"><span class="command">using</span></span> analytically_valid_y<span class="main">[</span><span class="operator">OF</span> F_j_analytically_valid<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> indicator_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> F_partially_differentiable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free">Dx_pair</span><span class="main">.</span> has_partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="var">?F_a'</span> <span class="bound">a</span><span class="main">)</span> <span class="bound">a</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> partial_vector_derivative_works partially_vec_diff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> g1_g2_continuous<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">g1</span>"</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">g2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> shift_scale_cont<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> shift_scale_inv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> id"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a_lt_b <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> o_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> img_shift_scale<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">`</span><span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> image_iff<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">+</span> <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> a_lt_b <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> mult_le_cancel_left affine_ineq<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g2</span><span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> continuous_on_inner<span class="main">[</span><span class="operator">OF</span> piecewise_C1_differentiable_on_imp_continuous_on<span class="main"><span class="main">[</span></span><span class="operator">OF</span> gamma4_smooth<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">i</span><span class="main">)</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> continuous_on_const<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gamma4_def i_is_x_axis<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g2</span><span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> img_shift_scale continuous_on_compose shift_scale_cont <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">g2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a_lt_b <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shift_scale_inv<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g1</span><span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> continuous_on_inner<span class="main">[</span><span class="operator">OF</span> piecewise_C1_differentiable_on_imp_continuous_on<span class="main"><span class="main">[</span></span><span class="operator">OF</span> gamma2_smooth<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">i</span><span class="main">)</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> continuous_on_const<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gamma2_def i_is_x_axis<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g1</span><span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> img_shift_scale continuous_on_compose shift_scale_cont <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">g1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a_lt_b <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shift_scale_inv<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> g2_scale_i_contin<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span> <span class="bound">x</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span> g1_g2_continuous<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Dg2</span></span></span> <span class="main">=</span>  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> cbox <span class="free">a</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">(</span><span class="free">g2</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> line_is_pair_img<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Dg2</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">)</span> <span class="main">`</span> <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> image_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> g2_path_continuous<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span> g1_g2_continuous<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> field_cont_on_gamma4_image<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="var">?Dg2</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="bound">a</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> continuous_on_subset <span class="main"><span class="main">[</span></span><span class="operator">OF</span> F_first_is_continuous<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Dx_def g2_leq_g1<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> gamma4_is_compos_of_scal_and_g2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">gamma4</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">g2</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> gamma4_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> add_scale_img<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="main">1</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span> <span class="main">..</span> <span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> add_scale_img <span class="keyword2"><span class="keyword">and</span></span> a_lt_b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Dg2_is_gamma4_pathimg<span class="main">:</span> <span class="quoted"><span class="quoted">"path_image <span class="free">gamma4</span> <span class="main">=</span> <span class="var">?Dg2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> line_is_pair_img <span class="keyword2"><span class="keyword">and</span></span> gamma4_is_compos_of_scal_and_g2 image_comp path_image_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> cbox_interval<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> Base_vecs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> Basis"</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">∈</span> Basis"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="free">j</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> real_pair_basis <span class="keyword2"><span class="keyword">and</span></span> i_is_x_axis <span class="keyword2"><span class="keyword">and</span></span> j_is_y_axis <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> gamma4_as_euclid_space_fun<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">gamma4</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">j</span> <span class="main">+</span> <span class="main">(</span><span class="free">g2</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> j_is_y_axis gamma4_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">gamma4</span><span class="main">)</span> <span class="main">=</span> integral <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="free">g2</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">gamma4</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> line_integral_on_pair_path_strong <span class="main">[</span><span class="operator">OF</span> norm_Basis<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator"><span class="operator">OF</span></span> Base_vecs<span class="main"><span class="main"><span class="main">(</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span> _ gamma4_as_euclid_space_fun<span class="main">]</span>
      gamma4_def gamma4_smooth g2_scale_i_contin a_lt_b add_scale_img
      Dg2_is_gamma4_pathimg <span class="keyword2"><span class="keyword">and</span></span> field_cont_on_gamma4_image
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pathstart_def pathfinish_def j_is_y_axis<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">gamma4</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> gamma3_y_const<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">gamma3</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">j</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gamma3_def j_is_y_axis<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">gamma3</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">gamma3</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> line_integral_on_pair_straight_path<span class="main">[</span><span class="operator">OF</span> gamma3_y_const<span class="main">]</span> straight_path_diffrentiable_y gamma3_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">gamma3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="free">g2</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Collect_mono_iff continuous_on_compose2 continuous_on_eq field_cont_on_gamma4_image g2_path_continuous line_is_pair_img<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="free">g2</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span>  <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> integrable_continuous <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> g1_scale_i_contin<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">g1</span> <span class="bound">x</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span> g1_g2_continuous<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Dg1</span></span></span> <span class="main">=</span>  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> cbox <span class="free">a</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">(</span><span class="free">g1</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> line_is_pair_img<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Dg1</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">g1</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">)</span> <span class="main">`</span> <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> image_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> g1_path_continuous<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">g1</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span> g1_g2_continuous<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> field_cont_on_gamma2_image<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="var">?Dg1</span>  <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="bound">a</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> continuous_on_subset <span class="main"><span class="main">[</span></span><span class="operator">OF</span> F_first_is_continuous<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Dx_def g2_leq_g1<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">gamma2</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">g1</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> gamma2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Dg1_is_gamma2_pathimg<span class="main">:</span> <span class="quoted"><span class="quoted">"path_image <span class="free">gamma2</span> <span class="main">=</span> <span class="var">?Dg1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> line_is_pair_img image_comp path_image_def add_scale_img
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> cbox_interval<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> Base_vecs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> Basis"</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">∈</span> Basis"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="free">j</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> real_pair_basis <span class="keyword2"><span class="keyword">and</span></span> i_is_x_axis <span class="keyword2"><span class="keyword">and</span></span> j_is_y_axis <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> gamma2_as_euclid_space_fun<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">gamma2</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">j</span> <span class="main">+</span> <span class="main">(</span><span class="free">g1</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> j_is_y_axis gamma2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">gamma2</span><span class="main">)</span> <span class="main">=</span> integral <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="free">g1</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">gamma2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> line_integral_on_pair_path_strong <span class="main">[</span><span class="operator">OF</span> norm_Basis<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator"><span class="operator">OF</span></span> Base_vecs<span class="main"><span class="main"><span class="main">(</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span> _ gamma2_as_euclid_space_fun<span class="main">]</span>
      gamma2_def <span class="keyword2"><span class="keyword">and</span></span> gamma2_smooth <span class="keyword2"><span class="keyword">and</span></span> g1_scale_i_contin <span class="keyword2"><span class="keyword">and</span></span> a_lt_b <span class="keyword2"><span class="keyword">and</span></span> add_scale_img
      Dg1_is_gamma2_pathimg <span class="keyword2"><span class="keyword">and</span></span> field_cont_on_gamma2_image
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pathstart_def pathfinish_def j_is_y_axis<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">gamma2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> gamma1_y_const<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">gamma1</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">j</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> gamma1_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_inner_class.inner_add_left
        euclidean_space_class.inner_not_same_Basis j_is_y_axis<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">gamma1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">gamma1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> line_integral_on_pair_straight_path<span class="main">[</span><span class="operator">OF</span> gamma1_y_const<span class="main">]</span> straight_path_diffrentiable_y gamma1_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">gamma1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="free">g1</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Collect_mono_iff continuous_on_compose2 continuous_on_eq field_cont_on_gamma2_image g1_path_continuous line_is_pair_img<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="free">g1</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> integrable_continuous <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="free">g1</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> partial_deriv_one_d_integrable<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="var">?F_a'</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="skolem">xc</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="free">F</span><span class="main">(</span><span class="free">g1</span><span class="main">(</span><span class="skolem">xc</span><span class="main">)</span><span class="main">,</span> <span class="skolem">xc</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span> <span class="main">-</span> <span class="free">F</span><span class="main">(</span><span class="free">g2</span><span class="main">(</span><span class="skolem">xc</span><span class="main">)</span><span class="main">,</span> <span class="skolem">xc</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span>cbox <span class="main">(</span><span class="free">g2</span> <span class="skolem">xc</span><span class="main">)</span> <span class="main">(</span><span class="free">g1</span> <span class="skolem">xc</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xc</span> <span class="main">∈</span> cbox <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">xc</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">xc'</span><span class="main">)</span><span class="main">.</span>  <span class="bound">y</span> <span class="main">∈</span> cbox <span class="main">(</span><span class="free">g2</span> <span class="skolem">xc</span><span class="main">)</span> <span class="main">(</span><span class="free">g1</span> <span class="skolem">xc</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">xc'</span> <span class="main">=</span> <span class="skolem">xc</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">Dx_pair</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Dx_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword2"><span class="keyword">and</span></span> Base_vecs <span class="keyword2"><span class="keyword">and</span></span> F_partially_differentiable
        <span class="keyword2"><span class="keyword">and</span></span> Dx_def <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> g2_leq_g1
        <span class="keyword2"><span class="keyword">and</span></span> fundamental_theorem_of_calculus_partial_vector
        <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">g2</span> <span class="skolem">xc</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="skolem">xc</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xc</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Dx_pair</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?F_a'</span>"</span></span> <span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  Groups.ab_semigroup_add_class.add.commute i_is_x_axis j_is_y_axis<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="keyword1">integrable_on</span> UNIV"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_lesbegue_integrable integrable_on_lborel<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> partial_deriv_integrable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?F_a'</span> <span class="keyword1">integrable_on</span> <span class="free">Dx_pair</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> integrable_restrict_UNIV <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"integral <span class="free">Dx_pair</span> <span class="var">?F_a'</span> <span class="main">=</span> integral <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral <span class="main">(</span>cbox <span class="main">(</span><span class="free">g2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">g1</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="var">?F_a'</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> y_axis_gauge_integrable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="var">?f</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">integrable_on</span> UNIV"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F_a'_oneD</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">y</span> <span class="main">∈</span> <span class="main">(</span>cbox <span class="main">(</span><span class="free">g2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span> <span class="free">g1</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> <span class="var">?F_a'</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> cbox <span class="free">a</span> <span class="free">b</span> <span class="main">⟶</span>  <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="var">?f</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Dx_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f_integrable_x_not_in_range<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> cbox <span class="free">a</span> <span class="free">b</span> <span class="main">⟶</span>  <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="var">?f</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">integrable_on</span> UNIV"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> integrable_0<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> cbox <span class="free">a</span> <span class="free">b</span><span class="main">.</span> <span class="var">?F_a'_oneD</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="var">?f</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> g2_leq_g1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Dx_def<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> cbox <span class="free">a</span> <span class="free">b</span><span class="main">.</span> <span class="var">?F_a'_oneD</span> <span class="bound">x</span> <span class="keyword1">integrable_on</span> UNIV"</span></span>
        <span class="keyword1"><span class="command">using</span></span> has_integral_integrable integrable_restrict_UNIV partial_deriv_one_d_integrable <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> cbox <span class="free">a</span> <span class="free">b</span> <span class="main">⟶</span>  <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="var">?f</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">integrable_on</span> UNIV"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="var">?f</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">integrable_on</span> UNIV"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f_integrable_x_not_in_range <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> arg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">Dx_pair</span> <span class="keyword1">then</span> partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="free">F</span> <span class="bound">a</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="free">i</span> <span class="bound">a</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">Dx_pair</span> <span class="keyword1">then</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">Dx_pair</span> <span class="keyword1">then</span> partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="free">F</span> <span class="bound">a</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="free">i</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> arg2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Dx_pair</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">∈</span>Basis<span class="main">.</span> <span class="free">a</span> <span class="main">∙</span> <span class="bound">i</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∙</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">∈</span>Basis<span class="main">.</span> <span class="free">g2</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">i</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">∙</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∙</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">g1</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">i</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Dx_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> arg3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">Dx_pair</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">Dx_pair</span> <span class="keyword1">then</span> partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="free">F</span> <span class="bound">a</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="free">i</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="bound">x</span>
                           <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="free">F</span> <span class="bound">a</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="free">i</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> arg4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">⟹</span>
                      <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral <span class="main">(</span>cbox <span class="main">(</span><span class="free">g2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">g1</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="keyword1">if</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">Dx_pair</span> <span class="keyword1">then</span> partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="free">F</span> <span class="bound">a</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span>
                      <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral <span class="main">(</span>cbox <span class="main">(</span><span class="free">g2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">g1</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="free">F</span> <span class="bound">a</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Dx_def<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Henstock_Kurzweil_Integration.integral_cong atLeastAtMost_iff<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> gauge_integral_Fubini_curve_bounded_region_y
        <span class="main">[</span><span class="operator">OF</span> f_lesbegue_integrable y_axis_gauge_integrable y_axis_integral_measurable arg arg2<span class="main">]</span>
        Henstock_Kurzweil_Integration.integral_cong<span class="main">[</span><span class="operator">OF</span> arg3<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">Dx_pair</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span><span class="main">]</span>
        Henstock_Kurzweil_Integration.integral_cong<span class="main">[</span><span class="operator">OF</span> arg4<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"cbox <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>integral <span class="free">Dx_pair</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="var">?F_a'</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
        <span class="main">=</span> integral <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="free">g1</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span> <span class="main">-</span> <span class="free">F</span><span class="main">(</span><span class="free">g2</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 4 Henstock_Kurzweil_Integration.integral_cong partial_deriv_one_d_integrable integrable_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> integral_unique<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integral <span class="free">Dx_pair</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">-</span> <span class="main">(</span><span class="var">?F_a'</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>
              <span class="main">=</span> <span class="main">-</span> integral <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="free">g1</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span> <span class="main">-</span> <span class="free">F</span><span class="main">(</span><span class="free">g2</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> partial_deriv_integrable <span class="keyword2"><span class="keyword">and</span></span> integral_neg <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"integral <span class="free">Dx_pair</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">-</span> <span class="main">(</span><span class="var">?F_a'</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>
                <span class="main">=</span> integral <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span> <span class="free">F</span><span class="main">(</span><span class="free">g2</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span> <span class="main">-</span> <span class="free">F</span><span class="main">(</span><span class="free">g1</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 6 7  
      <span class="keyword2"><span class="keyword">and</span></span> integral_neg <span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="free">g1</span> <span class="bound">x</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span> <span class="main">-</span> <span class="free">F</span><span class="main">(</span><span class="free">g2</span> <span class="bound">x</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">gamma4</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">gamma3</span><span class="main">)</span> <span class="main">-</span>
        <span class="main">(</span>line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">gamma2</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">gamma1</span><span class="main">)</span>
        <span class="main">=</span> <span class="main">(</span>integral <span class="free">Dx_pair</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">-</span><span class="main">(</span><span class="var">?F_a'</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 0 1 2 3 5 6 7
      Henstock_Kurzweil_Integration.integral_diff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="free">g2</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span>  <span class="main">∙</span> <span class="free">j</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"cbox <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="free">g1</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span>line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">gamma4</span><span class="main">)</span> <span class="main">-</span>
         <span class="main">(</span>line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">gamma3</span><span class="main">)</span> <span class="main">+</span>
         <span class="main">(</span>line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">gamma2</span><span class="main">)</span> <span class="main">+</span>
         <span class="main">(</span>line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">gamma1</span><span class="main">)</span>
                 <span class="main">=</span> <span class="main">(</span>integral <span class="free">Dx_pair</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="var">?F_a'</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹integral <span class="free">Dx_pair</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">-</span> <span class="var">?F_a'</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> integral <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="free">g1</span> <span class="bound">x</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span> <span class="main">-</span> <span class="free">F</span><span class="main">(</span><span class="free">g2</span> <span class="bound">x</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹integral <span class="free">Dx_pair</span> <span class="var">?F_a'</span> <span class="main">=</span> integral <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="free">g1</span> <span class="bound">x</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span> <span class="main">-</span> <span class="free">F</span><span class="main">(</span><span class="free">g2</span> <span class="bound">x</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> green_typeII_cube <span class="main">=</span>  R2 <span class="main">+</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">twoC</span> <span class="free">F</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> 
    two_cube<span class="main">:</span> <span class="quoted"><span class="quoted">"typeII_twoCube <span class="free">twoC</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    valid_two_cube<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_two_cube <span class="free">twoC</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    f_analytically_valid<span class="main">:</span> <span class="quoted"><span class="quoted">"analytically_valid <span class="main">(</span>cubeImage <span class="free">twoC</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="free">i</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Green-GreenThm_typeII_twoCube"><span class="command">lemma</span></span> GreenThm_typeII_twoCube<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"integral <span class="main">(</span>cubeImage <span class="free">twoC</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="free">i</span>  <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">(</span>boundary <span class="free">twoC</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> boundary <span class="free">twoC</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">γ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?bottom_edge</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?right_edge</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?top_edge</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?left_edge</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> line_integral_around_boundary<span class="main">:</span> 
      <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">(</span>boundary <span class="free">twoC</span><span class="main">)</span> <span class="main">=</span>  
         line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="var">?bottom_edge</span> <span class="main">+</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="var">?right_edge</span>
         <span class="main">-</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="var">?top_edge</span> <span class="main">-</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="var">?left_edge</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_chain_line_integral_def horizontal_boundary_def vertical_boundary_def boundary_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> finite1<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sum_step1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">=</span>
                       line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sum.insert_remove <span class="main">[</span><span class="operator">OF</span> finite1<span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> valid_two_cube
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> one_chain_line_integral_def horizontal_boundary_def vertical_boundary_def boundary_def valid_two_cube_def<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> card_insert_if <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> three_distinct_edges<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> valid_two_cube
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_chain_line_integral_def horizontal_boundary_def vertical_boundary_def boundary_def valid_two_cube_def<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> card_insert_if <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> finite2<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sum_step2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">=</span>
                       <span class="main">(</span><span class="main">-</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sum.insert_remove <span class="main">[</span><span class="operator">OF</span> finite2<span class="main">]</span> three_distinct_edges
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> card_insert_if <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> two_distinct_edges<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> three_distinct_edges
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_chain_line_integral_def horizontal_boundary_def vertical_boundary_def boundary_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> finite3<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sum_step3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">=</span>
                       <span class="main">(</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sum.insert_remove <span class="main">[</span><span class="operator">OF</span> finite2<span class="main">]</span> three_distinct_edges
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> card_insert_if <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">=</span>
                  line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sum_step1 sum_step2 sum_step3  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">g1</span></span> <span class="skolem"><span class="skolem">g2</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    twoCisTypeII<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&lt;</span> <span class="skolem">b</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> cbox <span class="skolem">a</span> <span class="skolem">b</span><span class="main">.</span> <span class="skolem">g2</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">g1</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"cubeImage <span class="free">twoC</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> cbox <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> cbox <span class="main">(</span><span class="skolem">g2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">g1</span> <span class="bound">x</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">twoC</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">g2</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">*</span> <span class="skolem">g1</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">g1</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="skolem">a</span> <span class="main">..</span> <span class="skolem">b</span><span class="main">}</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">g2</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="skolem">a</span> <span class="main">..</span> <span class="skolem">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> two_cube <span class="keyword2"><span class="keyword">and</span></span> typeII_twoCubeImg<span class="main">[</span><span class="operator">of</span><span class="quoted"><span class="quoted">"<span class="free">twoC</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> left_edge_explicit<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?left_edge</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">g2</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> twoCisTypeII<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> left_edge_smooth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?left_edge</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">-`</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="skolem">b</span> <span class="main">-</span><span class="skolem">a</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> twoCisTypeII<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Set.vimage_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> finite_vimg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> finite<span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">∩</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">-`</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> scale_shif_smth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> scale_shift_smooth <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> scale_shif_pw_smth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C1_differentiable_imp_piecewise <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> g2_smooth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g2</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> add_scale_img<span class="main">[</span><span class="operator">OF</span> twoCisTypeII<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> twoCisTypeII<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">g2</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> piecewise_C1_differentiable_compose<span class="main">[</span><span class="operator">OF</span> scale_shif_pw_smth g2_smooth finite_vimg<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> o_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span><span class="skolem">g2</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> all_components_smooth_one_pw_smooth_is_pw_smooth<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span><span class="skolem">g2</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_pair_basis<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> left_edge_explicit <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> top_edge_explicit<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?top_edge</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">g2</span> <span class="skolem">b</span> <span class="main">+</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">g1</span> <span class="skolem">b</span> <span class="main">-</span> <span class="skolem">g2</span> <span class="skolem">b</span><span class="main">)</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> right_edge_explicit<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?right_edge</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">g1</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> twoCisTypeII<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> right_edge_smooth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?right_edge</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">-`</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="skolem">b</span> <span class="main">-</span><span class="skolem">a</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> twoCisTypeII<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Set.vimage_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> finite_vimg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> finite<span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">∩</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">-`</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> scale_shif_pw_smth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> C1_differentiable_imp_piecewise <span class="main">[</span><span class="operator">OF</span> scale_shift_smooth<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> g1_smooth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g1</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> add_scale_img<span class="main">[</span><span class="operator">OF</span> twoCisTypeII<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> twoCisTypeII<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">g1</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> piecewise_C1_differentiable_compose<span class="main">[</span><span class="operator">OF</span> scale_shif_pw_smth g1_smooth finite_vimg<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> o_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span><span class="skolem">g1</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> all_components_smooth_one_pw_smooth_is_pw_smooth<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span><span class="skolem">g1</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_pair_basis<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> right_edge_explicit <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> bottom_edge_explicit<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?bottom_edge</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">g2</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">g1</span> <span class="skolem">a</span> <span class="main">-</span> <span class="skolem">g2</span> <span class="skolem">a</span><span class="main">)</span><span class="main">,</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> twoCisTypeII<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integral <span class="main">(</span>cubeImage <span class="free">twoC</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="free">i</span>  <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">(</span>boundary <span class="free">twoC</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Greens_thm_type_II<span class="main">[</span><span class="operator">OF</span> twoCisTypeII<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span>3<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span> left_edge_explicit left_edge_smooth
        top_edge_explicit right_edge_explicit right_edge_smooth
        bottom_edge_explicit f_analytically_valid
        twoCisTypeII<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span>2<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span> twoCisTypeII<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span>1<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span><span class="main">]</span>
      line_integral_around_boundary
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="skolem">γ</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">γ</span><span class="main">)</span> <span class="main">∈</span> boundary <span class="free">twoC</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">γ</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Greens_thm_type_II<span class="main">[</span><span class="operator">OF</span> twoCisTypeII<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span>3<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span> left_edge_explicit left_edge_smooth
          top_edge_explicit right_edge_explicit right_edge_smooth
          bottom_edge_explicit f_analytically_valid
          twoCisTypeII<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span>2<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span> twoCisTypeII<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span>1<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span><span class="main">]</span> line_integral_around_boundary
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="skolem">γ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_def horizontal_boundary_def vertical_boundary_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> boundary <span class="free">twoC</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">γ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Green-line_integral_exists_on_typeII_Cube_boundaries'"><span class="command">lemma</span></span> line_integral_exists_on_typeII_Cube_boundaries'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span> <span class="main">∈</span> boundary <span class="free">twoC</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">γ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms GreenThm_typeII_twoCube<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> green_typeII_chain <span class="main">=</span>  R2 <span class="main">+</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">F</span> <span class="free">two_chain</span> <span class="free">s</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> valid_typeII_div<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_typeII_division <span class="free">s</span> <span class="free">two_chain</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          F_anal_valid<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">twoC</span> <span class="main">∈</span> <span class="free">two_chain</span><span class="main">.</span> analytically_valid <span class="main">(</span>cubeImage <span class="bound">twoC</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="free">i</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Green-two_chain_valid_valid_cubes"><span class="command">lemma</span></span> two_chain_valid_valid_cubes<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">two_cube</span> <span class="main">∈</span> <span class="free">two_chain</span><span class="main">.</span> valid_two_cube <span class="bound">two_cube</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> valid_typeII_div
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_two_chain_def<span class="main">)</span>

<span class="keyword1" id="Green-typeII_chain_line_integral_exists_boundary'"><span class="command">lemma</span></span> typeII_chain_line_integral_exists_boundary'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">γ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> integ_exis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> two_chain_boundary <span class="free">two_chain</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">γ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> green_typeII_cube.line_integral_exists_on_typeII_Cube_boundaries'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">j</span></span><span class="main">]</span> F_anal_valid valid_typeII_div 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  two_chain_boundary_def<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> R2_axioms green_typeII_cube_axioms_def green_typeII_cube_def two_chain_valid_valid_cubes <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> integ_exis_vert<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">γ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> two_chain_boundary_def two_chain_vertical_boundary_def boundary_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Green-typeII_chain_line_integral_exists_boundary''"><span class="command">lemma</span></span> typeII_chain_line_integral_exists_boundary''<span class="main">:</span>
     <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">γ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> integ_exis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> two_chain_boundary <span class="free">two_chain</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">γ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> green_typeII_cube.line_integral_exists_on_typeII_Cube_boundaries'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">j</span></span><span class="main">]</span> valid_typeII_div
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> two_chain_boundary_def boundary_def<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> F_anal_valid R2_axioms green_typeII_cube_axioms_def green_typeII_cube_def two_chain_valid_valid_cubes <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> integ_exis_vert<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">γ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> two_chain_boundary_def two_chain_horizontal_boundary_def boundary_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Green-typeII_cube_line_integral_exists_boundary"><span class="command">lemma</span></span> typeII_cube_line_integral_exists_boundary<span class="main">:</span>
     <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> two_chain_boundary <span class="free">two_chain</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">γ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> valid_typeII_div typeII_chain_line_integral_exists_boundary' typeII_chain_line_integral_exists_boundary''
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> two_chain_boundary_def two_chain_horizontal_boundary_def two_chain_vertical_boundary_def<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> boundary_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Green-type_II_chain_horiz_bound_valid"><span class="command">lemma</span></span> type_II_chain_horiz_bound_valid<span class="main">:</span>
     <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">.</span> valid_path <span class="bound">γ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> valid_typeII_div typeII_edges_are_valid_paths
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> two_chain_boundary_def two_chain_horizontal_boundary_def boundary_def<span class="main">)</span>

<span class="keyword1" id="Green-type_II_chain_vert_bound_valid"><span class="command">lemma</span></span> type_II_chain_vert_bound_valid<span class="main">:</span> <span class="comment1">(*This and the previous one need to be used in all proofs*)</span>
     <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">.</span> valid_path <span class="bound">γ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> typeII_edges_are_valid_paths valid_typeII_div
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> two_chain_boundary_def two_chain_vertical_boundary_def boundary_def<span class="main">)</span>

<span class="keyword1" id="Green-members_of_only_horiz_div_line_integrable'"><span class="command">lemma</span></span> members_of_only_horiz_div_line_integrable'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"only_horizontal_division <span class="free">one_chain</span> <span class="free">two_chain</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span><span class="main">::</span>int<span class="main">,</span> <span class="free">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span><span class="main">::</span>int<span class="main">,</span> <span class="free">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain</span>"</span></span>
    <span class="quoted"><span class="quoted">"finite <span class="free">two_chain</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">two_cube</span> <span class="main">∈</span> <span class="free">two_chain</span><span class="main">.</span> valid_two_cube <span class="bound">two_cube</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">γ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> integ_exis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> two_chain_boundary <span class="free">two_chain</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">γ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> typeII_cube_line_integral_exists_boundary <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> integ_exis_vert<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">γ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> typeII_chain_line_integral_exists_boundary' assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> integ_exis_horiz<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">k</span> <span class="bound">γ</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="main">(</span><span class="bound">k'</span><span class="main">,</span> <span class="bound">γ'</span><span class="main">)</span> <span class="main">∈</span> two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">.</span> <span class="main">∃</span><span class="bound">a</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">∃</span><span class="bound">b</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≤</span> <span class="bound">b</span> <span class="main">∧</span> subpath <span class="bound">a</span> <span class="bound">b</span> <span class="bound">γ'</span> <span class="main">=</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">⟹</span>
                            line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">γ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> integ_exis type_II_chain_horiz_bound_valid
    <span class="keyword1"><span class="command">using</span></span> line_integral_exists_subpath<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">j</span><span class="main">}</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> two_chain_boundary_def two_chain_horizontal_boundary_def
        two_chain_vertical_boundary_def boundary_def<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ℋ</span></span> <span class="skolem"><span class="skolem">𝒱</span></span> <span class="keyword2"><span class="keyword">where</span></span> hv_props<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">ℋ</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">ℋ</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="main">(</span><span class="bound">k'</span><span class="main">,</span> <span class="bound">γ'</span><span class="main">)</span> <span class="main">∈</span> two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">.</span>
            <span class="main">(</span><span class="main">∃</span><span class="bound">a</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">∃</span><span class="bound">b</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≤</span> <span class="bound">b</span> <span class="main">∧</span> subpath <span class="bound">a</span> <span class="bound">b</span> <span class="bound">γ'</span> <span class="main">=</span> <span class="bound">γ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="free">one_chain</span> <span class="main">=</span> <span class="skolem">ℋ</span> <span class="main">∪</span> <span class="skolem">𝒱</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>common_sudiv_exists <span class="main">(</span>two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">)</span> <span class="skolem">𝒱</span><span class="main">)</span>
          <span class="main">∨</span> common_reparam_exists <span class="skolem">𝒱</span> <span class="main">(</span>two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"finite <span class="skolem">𝒱</span>"</span></span>
    <span class="quoted"><span class="quoted">"boundary_chain <span class="skolem">𝒱</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="skolem">𝒱</span><span class="main">.</span> valid_path <span class="bound">γ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> only_horizontal_division_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> finite_j<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="free">j</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">γ</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"common_sudiv_exists <span class="main">(</span>two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">)</span> <span class="skolem">𝒱</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> gen_common_subdivision_imp_eq_line_integral<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> True two_chain_vertical_boundary_is_boundary_chain hv_props<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> integ_exis_vert finite_two_chain_vertical_boundary<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> hv_props<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> finite_j<span class="main">]</span>
        integ_exis_horiz<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">γ</span>"</span></span><span class="main">]</span> assms<span class="main">(</span>3<span class="main">)</span> case_prod_conv hv_props<span class="main">(</span>2<span class="main">)</span> hv_props<span class="main">(</span>3<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">⊆</span> Basis"</span></span> <span class="keyword1"><span class="command">using</span></span> j_is_y_axis real_pair_basis <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="main">(</span><span class="bound">k2</span><span class="main">,</span> <span class="bound">γ2</span><span class="main">)</span><span class="main">∈</span>two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">.</span> <span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="main">{</span><span class="free">j</span><span class="main">}</span><span class="main">.</span> continuous_on <span class="main">(</span>path_image <span class="bound">γ2</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> F_anal_valid field_cont_on_typeII_region_cont_on_edges valid_typeII_div
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analytically_valid_def two_chain_vertical_boundary_def boundary_def path_image_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">γ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> common_reparam_exists_imp_eq_line_integral<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> finite_j hv_props<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> 
           finite_two_chain_vertical_boundary<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> hv_props<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> two_chain_vertical_boundary_is_boundary_chain ii _ hv_props<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> type_II_chain_vert_bound_valid<span class="main">]</span>
        integ_exis_horiz<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">γ</span>"</span></span><span class="main">]</span> assms<span class="main">(</span>3<span class="main">)</span> hv_props False 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Green-GreenThm_typeII_twoChain"><span class="command">lemma</span></span> GreenThm_typeII_twoChain<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"two_chain_integral <span class="free">two_chain</span> <span class="main">(</span>partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="bound">a</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span>  <span class="free">i</span><span class="main">)</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">(</span>two_chain_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> two_chain_boundary_def one_chain_line_integral_def two_chain_integral_def<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F_a'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="bound">a</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span>  <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">g</span><span class="main">)</span><span class="main">∈</span> boundary <span class="skolem">twoCube</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">=</span> integral <span class="main">(</span>cubeImage <span class="skolem">twoCube</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="var">?F_a'</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">twoCube</span> <span class="main">∈</span> <span class="free">two_chain</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">twoCube</span>
    <span class="keyword1"><span class="command">using</span></span> green_typeII_cube.GreenThm_typeII_twoCube<span class="main">(</span>1<span class="main">)</span> valid_typeII_div F_anal_valid one_chain_line_integral_def valid_two_chain_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R2_axioms green_typeII_cube_axioms_def green_typeII_cube_def that<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> double_sum_eq_sum<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">twoCube</span><span class="main">∈</span><span class="main">(</span><span class="free">two_chain</span><span class="main">)</span><span class="main">.</span><span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">g</span><span class="main">)</span><span class="main">∈</span> boundary <span class="bound">twoCube</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span>
                     <span class="main">=</span>  <span class="main">(</span><span class="main">∑</span><span class="bound">twoCube</span><span class="main">∈</span><span class="main">(</span><span class="free">two_chain</span><span class="main">)</span><span class="main">.</span> integral <span class="main">(</span>cubeImage <span class="bound">twoCube</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="var">?F_a'</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Finite_Cartesian_Product.sum_cong_aux <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> pairwise_disjoint_boundaries<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span> <span class="main">(</span>boundary <span class="main">`</span> <span class="free">two_chain</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span> <span class="main">(</span>boundary <span class="main">`</span> <span class="free">two_chain</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∩</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> valid_typeII_div <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  image_def valid_two_chain_def pairwise_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> finite_boundaries<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">B</span> <span class="main">∈</span> <span class="main">(</span>boundary<span class="main">`</span> <span class="free">two_chain</span><span class="main">)</span><span class="main">.</span> finite <span class="bound">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> valid_typeII_div image_iff <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_two_cube_def valid_two_chain_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> boundary_inj<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on boundary <span class="free">two_chain</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> valid_typeII_div <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_two_cube_def valid_two_chain_def pairwise_def inj_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="free">two_chain</span><span class="main">.</span> boundary <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">=</span>
                      <span class="main">(</span><span class="main">∑</span><span class="bound">twoCube</span><span class="main">∈</span><span class="main">(</span><span class="free">two_chain</span><span class="main">)</span><span class="main">.</span><span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">g</span><span class="main">)</span><span class="main">∈</span> boundary <span class="bound">twoCube</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sum.reindex<span class="main">[</span><span class="operator">OF</span> boundary_inj<span class="main">,</span>  <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">g</span><span class="main">)</span><span class="main">∈</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> sum.Union_disjoint<span class="main">[</span><span class="operator">OF</span> finite_boundaries
        pairwise_disjoint_boundaries<span class="main">,</span>
        <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">)</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">g</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">C</span><span class="main">∈</span><span class="free">two_chain</span><span class="main">.</span> integral <span class="main">(</span>cubeImage <span class="bound">C</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="var">?F_a'</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="free">two_chain</span><span class="main">.</span> boundary <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> double_sum_eq_sum  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Green-GreenThm_typeII_divisible"><span class="command">lemma</span></span> GreenThm_typeII_divisible<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> 
    gen_division<span class="main">:</span> <span class="quoted"><span class="quoted">"gen_division <span class="free">s</span> <span class="main">(</span>cubeImage <span class="main">`</span> <span class="free">two_chain</span><span class="main">)</span>"</span></span>    <span class="comment1">(*This should follow from the assumption that images are not negligible*)</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"integral <span class="free">s</span> <span class="main">(</span>partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">(</span>two_chain_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F_a'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integral <span class="free">s</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="var">?F_a'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> two_chain_integral <span class="free">two_chain</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="var">?F_a'</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> two_chain_integral_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> partial_deriv_integrable<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?F_a'</span> <span class="keyword1">has_integral</span> <span class="main">(</span>integral <span class="main">(</span>cubeImage <span class="skolem">twoCube</span><span class="main">)</span> <span class="var">?F_a'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>cubeImage <span class="skolem">twoCube</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">twoCube</span> <span class="main">∈</span> <span class="free">two_chain</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">twoCube</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analytically_valid_imp_part_deriv_integrable_on F_anal_valid integrable_integral that<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> partial_deriv_integrable<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">twoCubeImg</span><span class="main">.</span> <span class="bound">twoCubeImg</span> <span class="main">∈</span> cubeImage <span class="main">`</span> <span class="free">two_chain</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="var">?F_a'</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="main">(</span>integral <span class="main">(</span><span class="bound">twoCubeImg</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="var">?F_a'</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">twoCubeImg</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> integrable_neg <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">have</span></span> finite_images<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>cubeImage <span class="main">`</span> <span class="free">two_chain</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> gen_division gen_division_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> negligible_images<span class="main">:</span> <span class="quoted"><span class="quoted">"pairwise <span class="main">(</span><span class="main">λ</span><span class="bound">S</span> <span class="bound">S'</span><span class="main">.</span> negligible <span class="main">(</span><span class="bound">S</span> <span class="main">∩</span> <span class="bound">S'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>cubeImage <span class="main">`</span> <span class="free">two_chain</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> gen_division <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gen_division_def pairwise_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on cubeImage <span class="free">two_chain</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> valid_typeII_div valid_two_chain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">twoCubeImg</span><span class="main">∈</span>cubeImage <span class="main">`</span> <span class="free">two_chain</span><span class="main">.</span> integral <span class="bound">twoCubeImg</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="var">?F_a'</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>
             <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">C</span><span class="main">∈</span><span class="free">two_chain</span><span class="main">.</span> integral <span class="main">(</span>cubeImage <span class="bound">C</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="var">?F_a'</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sum.reindex <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integral <span class="free">s</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="var">?F_a'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">C</span><span class="main">∈</span><span class="free">two_chain</span><span class="main">.</span> integral <span class="main">(</span>cubeImage <span class="bound">C</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="var">?F_a'</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> has_integral_Union<span class="main">[</span><span class="operator">OF</span> finite_images partial_deriv_integrable negligible_images<span class="main">]</span> gen_division
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gen_division_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> GreenThm_typeII_twoChain F_anal_valid
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Green-GreenThm_typeII_divisible_region_boundary_gen"><span class="command">lemma</span></span> GreenThm_typeII_divisible_region_boundary_gen<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> only_horizontal_division<span class="main">:</span> <span class="quoted"><span class="quoted">"only_horizontal_division <span class="free">γ</span> <span class="free">two_chain</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"integral <span class="free">s</span> <span class="main">(</span>partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">γ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F_a'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="comment1">(*Proving that line_integral on the x axis is 0 for the vertical 1-cubes*)</span>
  <span class="keyword1"><span class="command">have</span></span> horiz_line_integral_zero<span class="main">:</span>
    <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">(</span>two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_chain_line_integral_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">(</span>snd <span class="skolem">oneCube</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">oneCube</span> <span class="main">∈</span> two_chain_horizontal_boundary<span class="main">(</span><span class="free">two_chain</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">oneCube</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> that <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y1</span></span> <span class="skolem"><span class="skolem">y2</span></span> <span class="skolem"><span class="skolem">k</span></span> 
        <span class="keyword2"><span class="keyword">where</span></span> horiz_edge_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">oneCube</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">y2</span><span class="main">)</span> <span class="main">+</span> <span class="bound">t</span> <span class="main">*</span> <span class="skolem">y1</span><span class="main">,</span> <span class="skolem">x</span><span class="main">::</span>real<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> valid_typeII_div
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> typeII_twoCube_def two_chain_horizontal_boundary_def horizontal_boundary_def<span class="main">)</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?horiz_edge</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>snd <span class="skolem">oneCube</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> horiz_edge_y_const<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="var">?horiz_edge</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> horiz_edge_def real_inner_class.inner_add_left
            euclidean_space_class.inner_not_same_Basis j_is_y_axis<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> horiz_edge_is_straight_path<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?horiz_edge</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="skolem">y2</span> <span class="main">+</span> <span class="bound">t</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">y1</span> <span class="main">-</span> <span class="skolem">y2</span><span class="main">)</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> horiz_edge_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="var">?horiz_edge</span> <span class="keyword1">differentiable</span> <span class="keyword1">at</span> <span class="bound">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> horiz_edge_is_straight_path straight_path_diffrentiable_y
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_commute_abs<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">(</span>snd <span class="skolem">oneCube</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> line_integral_on_pair_straight_path<span class="main">(</span>1<span class="main">)</span> j_is_y_axis real_pair_basis horiz_edge_y_const
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sum.neutral<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
    <span class="comment1">(*then, the x axis line_integral on the boundaries of the twoCube is equal to the line_integral on the horizontal boundaries of the twoCube ⟶ 1*)</span>
  <span class="keyword1"><span class="command">have</span></span> boundary_is_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>two_chain_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> two_chain_boundary_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> finite_UN_I<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">two_chain</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> valid_typeII_div finite_image_iff gen_division_def valid_two_chain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">two_chain</span> <span class="main">⟹</span> finite <span class="main">(</span>boundary <span class="bound">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_def horizontal_boundary_def vertical_boundary_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> boundary_is_vert_hor<span class="main">:</span>
     <span class="quoted"><span class="quoted">"two_chain_boundary <span class="free">two_chain</span> <span class="main">=</span>
      <span class="main">(</span>two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">)</span> <span class="main">∪</span>
      <span class="main">(</span>two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> two_chain_boundary_def two_chain_vertical_boundary_def two_chain_horizontal_boundary_def
        boundary_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> hor_vert_finite<span class="main">:</span>
    <span class="quoted"><span class="quoted">"finite <span class="main">(</span>two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"finite <span class="main">(</span>two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> boundary_is_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> horiz_verti_disjoint<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">)</span> <span class="main">∩</span>
     <span class="main">(</span>two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> two_chain_vertical_boundary_def two_chain_horizontal_boundary_def horizontal_boundary_def
        vertical_boundary_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="free">two_chain</span><span class="main">.</span> <span class="main">{</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="free">two_chain</span><span class="main">.</span> <span class="main">{</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="bound">x</span> <span class="main">(</span><span class="bound">z</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="bound">x</span> <span class="main">(</span><span class="bound">z</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">twoCube</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">twoCube</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="main">∩</span>
            <span class="main">{</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="skolem">twoCube2</span> <span class="main">(</span><span class="bound">z</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="skolem">twoCube2</span> <span class="main">(</span><span class="bound">z</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">twoCube</span><span class="main">∈</span><span class="free">two_chain</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">twoCube2</span><span class="main">∈</span><span class="free">two_chain</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">twoCube</span> <span class="skolem">twoCube2</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">twoCube</span> <span class="main">=</span> <span class="skolem">twoCube2</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">have</span></span> card_4<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">twoCube2</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">twoCube2</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">twoCube2</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">twoCube2</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="numeral">4</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> valid_typeII_div valid_two_chain_def that<span class="main">(</span>2<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_def vertical_boundary_def horizontal_boundary_def valid_two_cube_def<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> card_4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> True card_insert_if <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> valid_typeII_div valid_two_chain_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_def vertical_boundary_def horizontal_boundary_def pairwise_def <span class="quoted"><span class="quoted">‹<span class="skolem">twoCube</span> <span class="main">≠</span> <span class="skolem">twoCube2</span>›</span></span> that<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">twoCube</span><span class="main">.</span> <span class="main">{</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">twoCube</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">twoCube</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">two_chain</span><span class="main">)</span>
                                          <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">twoCube</span><span class="main">.</span> <span class="main">{</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="bound">twoCube</span> <span class="main">(</span><span class="bound">z</span><span class="main">,</span> <span class="main">0</span><span class="main">::</span>real<span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="bound">twoCube</span> <span class="main">(</span><span class="bound">z</span><span class="main">,</span> <span class="main">1</span><span class="main">::</span>real<span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">two_chain</span><span class="main">)</span>
                                              <span class="main">=</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Union_disjoint<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">(</span>two_chain_boundary <span class="free">two_chain</span><span class="main">)</span>
       <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">(</span>two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">)</span> <span class="main">+</span>
         one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">(</span>two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> boundary_is_vert_hor horiz_verti_disjoint
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hor_vert_finite sum.union_disjoint one_chain_line_integral_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> y_axis_line_integral_is_only_vertical<span class="main">:</span>
    <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">(</span>two_chain_boundary <span class="free">two_chain</span><span class="main">)</span>
                         <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">(</span>two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> horiz_line_integral_zero
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="comment1">(*Since γ ⊆ the boundary of the 2-chain and the horizontal boundaries are ⊆ γ, then there is some ℋ ⊆ ∂<span class="hidden">⇩</span><sub>H</sub>(2-𝒞) such that γ = ℋ ∪ ∂<span class="hidden">⇩</span><sub>v</sub>(2-𝒞)*)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ℋ</span></span> <span class="skolem"><span class="skolem">𝒱</span></span> <span class="keyword2"><span class="keyword">where</span></span> hv_props<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">ℋ</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">ℋ</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="main">(</span><span class="bound">k'</span><span class="main">,</span> <span class="bound">γ'</span><span class="main">)</span> <span class="main">∈</span> two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">.</span>
                      <span class="main">(</span><span class="main">∃</span><span class="bound">a</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span>
                            <span class="main">∃</span><span class="bound">b</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span>
                                <span class="bound">a</span> <span class="main">≤</span> <span class="bound">b</span> <span class="main">∧</span> subpath <span class="bound">a</span> <span class="bound">b</span> <span class="bound">γ'</span> <span class="main">=</span> <span class="bound">γ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">=</span> <span class="skolem">ℋ</span> <span class="main">∪</span> <span class="skolem">𝒱</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>common_sudiv_exists <span class="main">(</span>two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">)</span> <span class="skolem">𝒱</span>
      <span class="main">∨</span> common_reparam_exists <span class="skolem">𝒱</span> <span class="main">(</span>two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"finite <span class="skolem">𝒱</span>"</span></span>
    <span class="quoted"><span class="quoted">"boundary_chain <span class="skolem">𝒱</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="skolem">𝒱</span><span class="main">.</span> valid_path <span class="bound">γ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> only_horizontal_division
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  only_horizontal_division_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="free">j</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> eq_integrals<span class="main">:</span> <span class="quoted"><span class="quoted">" one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="skolem">𝒱</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">(</span>two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"common_sudiv_exists <span class="main">(</span>two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">)</span> <span class="skolem">𝒱</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> gen_common_subdivision_imp_eq_line_integral<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> True two_chain_vertical_boundary_is_boundary_chain hv_props<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> _ hor_vert_finite<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> hv_props<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span>
        typeII_chain_line_integral_exists_boundary'
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> integ_exis_vert<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">γ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> typeII_chain_line_integral_exists_boundary' assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_two_chain_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> integ_exis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> two_chain_boundary <span class="free">two_chain</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">γ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> typeII_cube_line_integral_exists_boundary <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> valid_paths<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">.</span> valid_path <span class="bound">γ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> typeII_edges_are_valid_paths valid_typeII_div
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> two_chain_boundary_def two_chain_horizontal_boundary_def boundary_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> integ_exis_horiz<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">k</span> <span class="bound">γ</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="main">(</span><span class="bound">k'</span><span class="main">,</span> <span class="bound">γ'</span><span class="main">)</span><span class="main">∈</span>two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">.</span> <span class="main">∃</span><span class="bound">a</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">∃</span><span class="bound">b</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≤</span> <span class="bound">b</span> <span class="main">∧</span> subpath <span class="bound">a</span> <span class="bound">b</span> <span class="bound">γ'</span> <span class="main">=</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">⟹</span>
                line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">γ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> integ_exis valid_paths line_integral_exists_subpath<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">j</span><span class="main">}</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> two_chain_boundary_def two_chain_horizontal_boundary_def
          two_chain_vertical_boundary_def boundary_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> finite_j<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="free">j</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">⊆</span> Basis"</span></span> <span class="keyword1"><span class="command">using</span></span> j_is_y_axis real_pair_basis <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="main">(</span><span class="bound">k2</span><span class="main">,</span> <span class="bound">γ2</span><span class="main">)</span><span class="main">∈</span>two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">.</span> <span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="main">{</span><span class="free">j</span><span class="main">}</span><span class="main">.</span> continuous_on <span class="main">(</span>path_image <span class="bound">γ2</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> valid_typeII_div field_cont_on_typeII_region_cont_on_edges F_anal_valid
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analytically_valid_def two_chain_vertical_boundary_def boundary_def path_image_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="skolem">𝒱</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">(</span>two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> hv_props<span class="main">(</span>4<span class="main">)</span> False common_reparam_exists_imp_eq_line_integral<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> finite_j hv_props<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> hor_vert_finite<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> hv_props<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> two_chain_vertical_boundary_is_boundary_chain ii 
          _ hv_props<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> type_II_chain_vert_bound_valid<span class="main">]</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
    <span class="comment1">(*Since ℋ ⊆ ∂<span class="hidden">⇩</span><sub>H</sub>(2-𝒞), then the line_integral on the x axis along ℋ is 0, and from 1 Q.E.D. *)</span>
  <span class="keyword1"><span class="command">have</span></span> line_integral_on_path<span class="main">:</span>
    <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">γ</span> <span class="main">=</span>
     one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">(</span>two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> one_chain_line_integral_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">(</span>snd <span class="skolem">oneCube</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> oneCube<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">oneCube</span> <span class="main">∈</span> <span class="skolem">ℋ</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">oneCube</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="skolem"><span class="skolem">γ</span></span> <span class="keyword2"><span class="keyword">where</span></span> k_gamma<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">γ</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">oneCube</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> prod.collapse <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k'</span></span> <span class="skolem"><span class="skolem">γ'</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> kp_gammap<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k'</span><span class="main">::</span>int<span class="main">,</span> <span class="skolem">γ'</span><span class="main">)</span> <span class="main">∈</span> two_chain_horizontal_boundary <span class="free">two_chain</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="main">1</span><span class="main">}</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
        <span class="quoted"><span class="quoted">"subpath <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">γ'</span> <span class="main">=</span> <span class="skolem">γ</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> hv_props oneCube
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> case_prodE split_conv<span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y1</span></span> <span class="skolem"><span class="skolem">y2</span></span> <span class="keyword2"><span class="keyword">where</span></span> horiz_edge_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k'</span><span class="main">,</span><span class="skolem">γ'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">k'</span><span class="main">,</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">y2</span><span class="main">)</span> <span class="main">+</span> <span class="bound">t</span> <span class="main">*</span> <span class="skolem">y1</span><span class="main">,</span> <span class="skolem">x</span><span class="main">::</span>real<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> valid_typeII_div kp_gammap
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> typeII_twoCube_def two_chain_horizontal_boundary_def horizontal_boundary_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> horiz_edge_y_const<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">γ</span> <span class="main">(</span><span class="bound">t</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> horiz_edge_def kp_gammap<span class="main">(</span>4<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_inner_class.inner_add_left
            euclidean_space_class.inner_not_same_Basis j_is_y_axis subpath_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> horiz_edge_is_straight_path<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="skolem">γ</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">*</span><span class="skolem">y2</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">*</span><span class="skolem">y2</span><span class="main">)</span> <span class="main">+</span>  <span class="skolem">a</span><span class="main">*</span><span class="skolem">y1</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="skolem">b</span><span class="main">-</span><span class="skolem">a</span><span class="main">)</span><span class="main">*</span><span class="skolem">y1</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span><span class="main">*</span><span class="skolem">y2</span><span class="main">)</span><span class="main">*</span><span class="bound">t</span><span class="main">,</span> <span class="skolem">x</span><span class="main">::</span>real<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span><span class="main">::</span><span class="quoted">real</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span><span class="main">*</span><span class="skolem">t</span> <span class="main">+</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">y2</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="skolem">b</span><span class="main">-</span><span class="skolem">a</span><span class="main">)</span><span class="main">*</span><span class="skolem">t</span> <span class="main">+</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">y1</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span><span class="main">*</span><span class="skolem">t</span> <span class="main">+</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">y2</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="skolem">b</span><span class="main">-</span><span class="skolem">a</span><span class="main">)</span><span class="main">*</span><span class="skolem">t</span> <span class="main">+</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">y1</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">γ</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span><span class="main">*</span><span class="bound">t</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">y2</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="skolem">b</span><span class="main">-</span><span class="skolem">a</span><span class="main">)</span><span class="main">*</span><span class="bound">t</span> <span class="main">+</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">y1</span><span class="main">,</span> <span class="skolem">x</span><span class="main">::</span>real<span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> horiz_edge_def Product_Type.snd_conv Product_Type.fst_conv kp_gammap<span class="main">(</span>4<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subpath_def diff_diff_eq<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">*</span><span class="skolem">y2</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span><span class="main">*</span><span class="skolem">y2</span><span class="main">*</span><span class="bound">t</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">*</span><span class="skolem">y2</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="skolem">b</span><span class="main">-</span><span class="skolem">a</span><span class="main">)</span><span class="main">*</span><span class="skolem">y1</span><span class="main">*</span><span class="bound">t</span> <span class="main">+</span> <span class="skolem">a</span><span class="main">*</span><span class="skolem">y1</span><span class="main">)</span><span class="main">,</span> <span class="skolem">x</span><span class="main">::</span>real<span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ring_class.ring_distribs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> Groups.diff_diff_eq left_diff_distrib<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">*</span><span class="skolem">y2</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">*</span><span class="skolem">y2</span><span class="main">)</span> <span class="main">+</span>  <span class="skolem">a</span><span class="main">*</span><span class="skolem">y1</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="skolem">b</span><span class="main">-</span><span class="skolem">a</span><span class="main">)</span><span class="main">*</span><span class="skolem">y1</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span><span class="main">*</span><span class="skolem">y2</span><span class="main">)</span><span class="main">*</span><span class="bound">t</span><span class="main">,</span> <span class="skolem">x</span><span class="main">::</span>real<span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> left_diff_distrib<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">γ</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">*</span><span class="skolem">y2</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">*</span><span class="skolem">y2</span><span class="main">)</span> <span class="main">+</span>  <span class="skolem">a</span><span class="main">*</span><span class="skolem">y1</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="skolem">b</span><span class="main">-</span><span class="skolem">a</span><span class="main">)</span><span class="main">*</span><span class="skolem">y1</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span><span class="main">*</span><span class="skolem">y2</span><span class="main">)</span><span class="main">*</span><span class="bound">t</span><span class="main">,</span> <span class="skolem">x</span><span class="main">::</span>real<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">(</span>snd <span class="skolem">oneCube</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">γ</span> <span class="keyword1">differentiable</span> <span class="keyword1">at</span> <span class="bound">x</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> horiz_edge_is_straight_path straight_path_diffrentiable_y<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="skolem">γ</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> horiz_edge_y_const line_integral_on_pair_straight_path<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> Product_Type.snd_conv k_gamma <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">ℋ</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">)</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">γ</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⇒</span> real_of_int <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⇒</span> real_of_int <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> hv_props<span class="main">(</span>1<span class="main">)</span> hv_props<span class="main">(</span>3<span class="main">)</span> hv_props<span class="main">(</span>5<span class="main">)</span> sum_zero_set hor_vert_finite<span class="main">(</span>1<span class="main">)</span> eq_integrals
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_chain_line_integral_def sum_zero_set<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">γ</span> <span class="main">=</span>
                           one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">(</span>two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> line_integral_on_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">γ</span> <span class="main">=</span>
                           one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">(</span>two_chain_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> y_axis_line_integral_is_only_vertical <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> valid_typeII_div GreenThm_typeII_divisible <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Green-GreenThm_typeII_divisible_region_boundary"><span class="command">lemma</span></span> GreenThm_typeII_divisible_region_boundary<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    two_cubes_trace_vertical_boundaries<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"two_chain_vertical_boundary <span class="free">two_chain</span> <span class="main">⊆</span> <span class="free">γ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    boundary_of_region_is_subset_of_partition_boundary<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">⊆</span> two_chain_boundary <span class="free">two_chain</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"integral <span class="free">s</span> <span class="main">(</span>partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">γ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F_a'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="comment1">(*Proving that line_integral on the x axis is 0 for the vertical 1-cubes*)</span>
  <span class="keyword1"><span class="command">have</span></span> horiz_line_integral_zero<span class="main">:</span>
    <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">(</span>two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_chain_line_integral_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">(</span>snd <span class="skolem">oneCube</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> one<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">oneCube</span> <span class="main">∈</span> two_chain_horizontal_boundary<span class="main">(</span><span class="free">two_chain</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">oneCube</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y1</span></span> <span class="skolem"><span class="skolem">y2</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> horiz_edge_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">oneCube</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">y2</span><span class="main">)</span> <span class="main">+</span> <span class="bound">t</span> <span class="main">*</span> <span class="skolem">y1</span><span class="main">,</span> <span class="skolem">x</span><span class="main">::</span>real<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> valid_typeII_div one
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> typeII_twoCube_def two_chain_horizontal_boundary_def horizontal_boundary_def<span class="main">)</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?horiz_edge</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>snd <span class="skolem">oneCube</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> horiz_edge_y_const<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="var">?horiz_edge</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> horiz_edge_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_inner_class.inner_add_left
            euclidean_space_class.inner_not_same_Basis j_is_y_axis<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> horiz_edge_is_straight_path<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="var">?horiz_edge</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="skolem">y2</span> <span class="main">+</span> <span class="bound">t</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">y1</span> <span class="main">-</span> <span class="skolem">y2</span><span class="main">)</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_diff_eq diff_add_eq mult.commute right_diff_distrib horiz_edge_def<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">(</span>snd <span class="skolem">oneCube</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> horiz_edge_is_straight_path horiz_edge_y_const line_integral_on_pair_straight_path<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> mult.commute straight_path_diffrentiable_y<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod.case_eq_if<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
    <span class="comment1">(*then, the x axis line_integral on the boundaries of the twoCube is equal to the line_integral on the horizontal boundaries of the twoCube ⟶ 1*)</span>
  <span class="keyword1"><span class="command">have</span></span> boundary_is_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>two_chain_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> two_chain_boundary_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> finite_UN_I<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">two_chain</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> valid_typeII_div finite_image_iff gen_division_def valid_two_chain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">two_chain</span> <span class="main">⟹</span> finite <span class="main">(</span>boundary <span class="bound">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_def horizontal_boundary_def vertical_boundary_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> boundary_is_vert_hor<span class="main">:</span>
    <span class="quoted"><span class="quoted">"two_chain_boundary <span class="free">two_chain</span> <span class="main">=</span> <span class="main">(</span>two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> two_chain_boundary_def two_chain_vertical_boundary_def two_chain_horizontal_boundary_def boundary_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> hor_vert_finite<span class="main">:</span>
    <span class="quoted"><span class="quoted">"finite <span class="main">(</span>two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"finite <span class="main">(</span>two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> boundary_is_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> horiz_verti_disjoint<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> two_chain_vertical_boundary_def two_chain_horizontal_boundary_def horizontal_boundary_def
        vertical_boundary_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="free">two_chain</span><span class="main">.</span> <span class="main">{</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="free">two_chain</span><span class="main">.</span> <span class="main">{</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="bound">x</span> <span class="main">(</span><span class="bound">z</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="bound">x</span> <span class="main">(</span><span class="bound">z</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">twoCube</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">twoCube</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="main">∩</span>
            <span class="main">{</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">twoCube2</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">twoCube2</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">twoCube</span><span class="main">∈</span><span class="free">two_chain</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">twoCube2</span><span class="main">∈</span><span class="free">two_chain</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">twoCube</span> <span class="skolem">twoCube2</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">twoCube</span> <span class="main">=</span> <span class="skolem">twoCube2</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">twoCube2</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">twoCube2</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">twoCube2</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">twoCube2</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="numeral">4</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> valid_typeII_div valid_two_chain_def that<span class="main">(</span>2<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_def vertical_boundary_def horizontal_boundary_def valid_two_cube_def<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> True card_insert_if <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> valid_typeII_div valid_two_chain_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_def vertical_boundary_def horizontal_boundary_def pairwise_def <span class="quoted"><span class="quoted">‹<span class="skolem">twoCube</span> <span class="main">≠</span> <span class="skolem">twoCube2</span>›</span></span> that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> that<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">twoCube</span><span class="main">.</span> <span class="main">{</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">twoCube</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">twoCube</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">two_chain</span><span class="main">)</span>
                                          <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">twoCube</span><span class="main">.</span> <span class="main">{</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="bound">twoCube</span> <span class="main">(</span><span class="bound">z</span><span class="main">,</span> <span class="main">0</span><span class="main">::</span>real<span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="bound">twoCube</span> <span class="main">(</span><span class="bound">z</span><span class="main">,</span> <span class="main">1</span><span class="main">::</span>real<span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">two_chain</span><span class="main">)</span>
                                              <span class="main">=</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Complete_Lattices.Union_disjoint<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">(</span>two_chain_boundary <span class="free">two_chain</span><span class="main">)</span>
        <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">(</span>two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">)</span> <span class="main">+</span>
          one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">(</span>two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> boundary_is_vert_hor horiz_verti_disjoint
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_chain_line_integral_def hor_vert_finite sum.union_disjoint<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> y_axis_line_integral_is_only_vertical<span class="main">:</span>
    <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">(</span>two_chain_boundary <span class="free">two_chain</span><span class="main">)</span>
     <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">(</span>two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> horiz_line_integral_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="comment1">(*Since γ ⊆ the boundary of the 2-chain and the horizontal boundaries are ⊆ γ, then there is some ℋ ⊆ ∂<span class="hidden">⇩</span><sub>H</sub>(2-𝒞) such that γ = ℋ ∪ ∂<span class="hidden">⇩</span><sub>v</sub>(2-𝒞)*)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ℋ</span><span class="main">.</span> <span class="bound">ℋ</span> <span class="main">⊆</span> <span class="main">(</span>two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">)</span> <span class="main">∧</span>
             <span class="free">γ</span> <span class="main">=</span> <span class="bound">ℋ</span> <span class="main">∪</span> <span class="main">(</span>two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ℋ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">-</span> <span class="main">(</span>two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ℋ</span> <span class="main">⊆</span> two_chain_horizontal_boundary <span class="free">two_chain</span> <span class="main">∧</span> <span class="free">γ</span> <span class="main">=</span> <span class="var">?ℋ</span> <span class="main">∪</span> two_chain_vertical_boundary <span class="free">two_chain</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> two_cubes_trace_vertical_boundaries
        boundary_of_region_is_subset_of_partition_boundary boundary_is_vert_hor
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ℋ</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    h_props<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ℋ</span> <span class="main">⊆</span> <span class="main">(</span>two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">=</span> <span class="skolem">ℋ</span> <span class="main">∪</span> <span class="main">(</span>two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> h_vert_disj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ℋ</span> <span class="main">∩</span> <span class="main">(</span>two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> horiz_verti_disjoint h_props<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> h_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">ℋ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> hor_vert_finite h_props<span class="main">(</span>1<span class="main">)</span> Finite_Set.rev_finite_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> line_integral_on_path<span class="main">:</span>
    <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">γ</span> <span class="main">=</span>
     one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="skolem">ℋ</span> <span class="main">+</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">(</span>two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_chain_line_integral_def  h_props sum.union_disjoint<span class="main"><span class="main">[</span></span><span class="operator">OF</span> h_finite hor_vert_finite<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span> h_vert_disj<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="comment1">(*Since ℋ ⊆ ∂<span class="hidden">⇩</span><sub>H</sub>(2-𝒞), then the line_integral on the x axis along ℋ is 0, and from 1 Q.E.D. *)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="skolem">ℋ</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_chain_line_integral_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">(</span>snd <span class="skolem">oneCube</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> oneCube<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">oneCube</span> <span class="main">∈</span> two_chain_horizontal_boundary<span class="main">(</span><span class="free">two_chain</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">oneCube</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y1</span></span> <span class="skolem"><span class="skolem">y2</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> horiz_edge_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">oneCube</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">y2</span><span class="main">)</span> <span class="main">+</span> <span class="bound">t</span> <span class="main">*</span> <span class="skolem">y1</span><span class="main">,</span> <span class="skolem">x</span><span class="main">::</span>real<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> valid_typeII_div oneCube
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> typeII_twoCube_def two_chain_horizontal_boundary_def horizontal_boundary_def<span class="main">)</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?horiz_edge</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>snd <span class="skolem">oneCube</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> horiz_edge_y_const<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="var">?horiz_edge</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> j_is_y_axis horiz_edge_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> horiz_edge_is_straight_path<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="var">?horiz_edge</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="skolem">y2</span> <span class="main">+</span> <span class="bound">t</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">y1</span> <span class="main">-</span> <span class="skolem">y2</span><span class="main">)</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_diff_eq diff_add_eq mult.commute right_diff_distrib horiz_edge_def<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">(</span>snd <span class="skolem">oneCube</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> horiz_edge_is_straight_path j_is_y_axis line_integral_on_pair_straight_path<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> mult.commute straight_path_diffrentiable_y<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">oneCube</span> <span class="main">∈</span> <span class="skolem">ℋ</span><span class="main">.</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">(</span>snd <span class="bound">oneCube</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> h_props <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">ℋ</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">)</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">ℋ</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">γ</span> <span class="main">=</span>
                           one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">(</span>two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> line_integral_on_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">γ</span> <span class="main">=</span>
             one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">(</span>two_chain_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> y_axis_line_integral_is_only_vertical <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> valid_typeII_div GreenThm_typeII_divisible <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> green_typeI_cube <span class="main">=</span>  R2 <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">twoC</span> <span class="free">F</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> 
    two_cube<span class="main">:</span> <span class="quoted"><span class="quoted">"typeI_twoCube <span class="free">twoC</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    valid_two_cube<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_two_cube <span class="free">twoC</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    f_analytically_valid<span class="main">:</span> <span class="quoted"><span class="quoted">"analytically_valid <span class="main">(</span>cubeImage <span class="free">twoC</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="free">j</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Green-GreenThm_typeI_twoCube"><span class="command">lemma</span></span> GreenThm_typeI_twoCube<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"integral <span class="main">(</span>cubeImage <span class="free">twoC</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">-</span> partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="free">F</span> <span class="bound">p</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="free">j</span>  <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">(</span>boundary <span class="free">twoC</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> boundary <span class="free">twoC</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">γ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?bottom_edge</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?right_edge</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?top_edge</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?left_edge</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> line_integral_around_boundary<span class="main">:</span>
    <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">(</span>boundary <span class="free">twoC</span><span class="main">)</span> <span class="main">=</span> 
     line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="var">?bottom_edge</span> <span class="main">+</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="var">?right_edge</span>
     <span class="main">-</span>  line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="var">?top_edge</span> <span class="main">-</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="var">?left_edge</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_chain_line_integral_def horizontal_boundary_def vertical_boundary_def boundary_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> finite1<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> sum_step1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">=</span>
                       line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sum.insert_remove <span class="main">[</span><span class="operator">OF</span> finite1<span class="main">]</span> valid_two_cube
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> horizontal_boundary_def vertical_boundary_def boundary_def valid_two_cube_def card_insert_if <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> three_distinct_edges<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> valid_two_cube
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_chain_line_integral_def horizontal_boundary_def vertical_boundary_def boundary_def valid_two_cube_def<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> card_insert_if <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> finite2<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> sum_step2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">=</span>
                          <span class="main">(</span><span class="main">-</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sum.insert_remove <span class="main">[</span><span class="operator">OF</span> finite2<span class="main">]</span> three_distinct_edges
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> card_insert_if <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> two_distinct_edges<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> three_distinct_edges
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_chain_line_integral_def horizontal_boundary_def vertical_boundary_def boundary_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> finite3<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> sum_step3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">=</span>
                          <span class="main">(</span>line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sum.insert_remove <span class="main">[</span><span class="operator">OF</span> finite2<span class="main">]</span> three_distinct_edges 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> card_insert_if <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">=</span>
                               line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sum_step1 sum_step2 sum_step3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">g1</span></span> <span class="skolem"><span class="skolem">g2</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    twoCisTypeI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&lt;</span> <span class="skolem">b</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> cbox <span class="skolem">a</span> <span class="skolem">b</span><span class="main">.</span> <span class="skolem">g2</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">g1</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"cubeImage <span class="free">twoC</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> cbox <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> cbox <span class="main">(</span><span class="skolem">g2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">g1</span> <span class="bound">x</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">twoC</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">g2</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">*</span> <span class="skolem">g1</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">g1</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="skolem">a</span> <span class="main">..</span> <span class="skolem">b</span><span class="main">}</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">g2</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="skolem">a</span> <span class="main">..</span> <span class="skolem">b</span><span class="main">}</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">,</span> <span class="skolem">g2</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">b</span><span class="main">,</span> <span class="skolem">g2</span> <span class="skolem">b</span> <span class="main">+</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">g1</span> <span class="skolem">b</span> <span class="main">-</span> <span class="skolem">g2</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">,</span> <span class="skolem">g1</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span><span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">g2</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">g1</span> <span class="skolem">a</span> <span class="main">-</span> <span class="skolem">g2</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> two_cube <span class="keyword2"><span class="keyword">and</span></span> typeI_cube_explicit_spec<span class="main">[</span><span class="operator">of</span><span class="quoted"><span class="quoted">"<span class="free">twoC</span>"</span></span><span class="main">]</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> bottom_edge_smooth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> typeI_twoCube_smooth_edges two_cube boundary_def vertical_boundary_def horizontal_boundary_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> top_edge_smooth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?top_edge</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> typeI_twoCube_smooth_edges two_cube boundary_def vertical_boundary_def horizontal_boundary_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integral <span class="main">(</span>cubeImage <span class="free">twoC</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">-</span> partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="free">F</span> <span class="bound">p</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="free">j</span>  <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">(</span>boundary <span class="free">twoC</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Greens_thm_type_I<span class="main">[</span><span class="operator">OF</span> twoCisTypeI<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span>3<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span> twoCisTypeI<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span>7<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span> bottom_edge_smooth
        twoCisTypeI<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span>8<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span> twoCisTypeI<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span>9<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span> top_edge_smooth
        twoCisTypeI<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span>10<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span> f_analytically_valid twoCisTypeI<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span>2<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span> twoCisTypeI<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span>1<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span><span class="main">]</span>
        line_integral_around_boundary
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">twoC</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Greens_thm_type_I<span class="main">[</span><span class="operator">OF</span> twoCisTypeI<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span>3<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span> twoCisTypeI<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span>7<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span> bottom_edge_smooth
        twoCisTypeI<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span>8<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span> twoCisTypeI<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span>9<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span> top_edge_smooth
        twoCisTypeI<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span>10<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span> f_analytically_valid twoCisTypeI<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span>2<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span> twoCisTypeI<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span>1<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span><span class="main">]</span>
      line_integral_around_boundary
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="skolem">γ</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">γ</span><span class="main">)</span> <span class="main">∈</span> boundary <span class="free">twoC</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">γ</span>
    <span class="keyword1"><span class="command">using</span></span> that  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_def horizontal_boundary_def vertical_boundary_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> boundary <span class="free">twoC</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">γ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Green-line_integral_exists_on_typeI_Cube_boundaries'"><span class="command">lemma</span></span> line_integral_exists_on_typeI_Cube_boundaries'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span> <span class="main">∈</span> boundary <span class="free">twoC</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">γ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms two_cube valid_two_cube f_analytically_valid GreenThm_typeI_twoCube<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> green_typeI_chain <span class="main">=</span> R2 <span class="main">+</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">F</span> <span class="free">two_chain</span> <span class="free">s</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> valid_typeI_div<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_typeI_division <span class="free">s</span> <span class="free">two_chain</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          F_anal_valid<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">twoC</span> <span class="main">∈</span> <span class="free">two_chain</span><span class="main">.</span> analytically_valid <span class="main">(</span>cubeImage <span class="bound">twoC</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="free">j</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Green-two_chain_valid_valid_cubes"><span class="command">lemma</span></span> two_chain_valid_valid_cubes<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">two_cube</span> <span class="main">∈</span> <span class="free">two_chain</span><span class="main">.</span> valid_two_cube <span class="bound">two_cube</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> valid_typeI_div
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_two_chain_def<span class="main">)</span>

<span class="keyword1" id="Green-typeI_cube_line_integral_exists_boundary'"><span class="command">lemma</span></span> typeI_cube_line_integral_exists_boundary'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">two_cube</span> <span class="main">∈</span> <span class="free">two_chain</span><span class="main">.</span> typeI_twoCube <span class="bound">two_cube</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">twoC</span> <span class="main">∈</span> <span class="free">two_chain</span><span class="main">.</span> analytically_valid <span class="main">(</span>cubeImage <span class="bound">twoC</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">two_cube</span> <span class="main">∈</span> <span class="free">two_chain</span><span class="main">.</span> valid_two_cube <span class="bound">two_cube</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">γ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> integ_exis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> two_chain_boundary <span class="free">two_chain</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">γ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> green_typeI_cube.line_integral_exists_on_typeI_Cube_boundaries'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">j</span></span><span class="main">]</span> assms
    <span class="keyword1"><span class="command">using</span></span> R2_axioms green_typeI_cube_axioms_def green_typeI_cube_def two_chain_boundary_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> integ_exis_vert<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">γ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> two_chain_boundary_def two_chain_vertical_boundary_def boundary_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Green-typeI_cube_line_integral_exists_boundary''"><span class="command">lemma</span></span> typeI_cube_line_integral_exists_boundary''<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">γ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> integ_exis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> two_chain_boundary <span class="free">two_chain</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">γ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> green_typeI_cube.line_integral_exists_on_typeI_Cube_boundaries'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">j</span></span><span class="main">]</span> valid_typeI_div
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> two_chain_boundary_def boundary_def<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> F_anal_valid R2_axioms green_typeI_cube_axioms_def green_typeI_cube_def two_chain_valid_valid_cubes <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> integ_exis_horiz<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">γ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> two_chain_boundary_def two_chain_horizontal_boundary_def boundary_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Green-typeI_cube_line_integral_exists_boundary"><span class="command">lemma</span></span> typeI_cube_line_integral_exists_boundary<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> two_chain_boundary <span class="free">two_chain</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">γ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span>  typeI_cube_line_integral_exists_boundary' typeI_cube_line_integral_exists_boundary''
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> two_chain_boundary_def two_chain_horizontal_boundary_def two_chain_vertical_boundary_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> R2_axioms green_typeI_chain.F_anal_valid green_typeI_chain_axioms green_typeI_cube.line_integral_exists_on_typeI_Cube_boundaries' green_typeI_cube_axioms_def green_typeI_cube_def two_chain_valid_valid_cubes valid_typeI_div<span class="main">)</span>

<span class="keyword1" id="Green-type_I_chain_horiz_bound_valid"><span class="command">lemma</span></span> type_I_chain_horiz_bound_valid<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">.</span> valid_path <span class="bound">γ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> typeI_edges_are_valid_paths valid_typeI_div
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> two_chain_boundary_def two_chain_horizontal_boundary_def boundary_def<span class="main">)</span>

<span class="keyword1" id="Green-type_I_chain_vert_bound_valid"><span class="command">lemma</span></span> type_I_chain_vert_bound_valid<span class="main">:</span> <span class="comment1">(*This and the previous one need to be used in all proofs*)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">two_cube</span> <span class="main">∈</span> <span class="free">two_chain</span><span class="main">.</span> typeI_twoCube <span class="bound">two_cube</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">.</span> valid_path <span class="bound">γ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> typeI_edges_are_valid_paths assms<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> two_chain_boundary_def two_chain_vertical_boundary_def boundary_def<span class="main">)</span>

<span class="keyword1" id="Green-members_of_only_vertical_div_line_integrable'"><span class="command">lemma</span></span> members_of_only_vertical_div_line_integrable'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"only_vertical_division <span class="free">one_chain</span> <span class="free">two_chain</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span><span class="main">::</span>int<span class="main">,</span> <span class="free">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span><span class="main">::</span>int<span class="main">,</span> <span class="free">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain</span>"</span></span>
    <span class="quoted"><span class="quoted">"finite <span class="free">two_chain</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">γ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> integ_exis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> two_chain_boundary <span class="free">two_chain</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">γ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> typeI_cube_line_integral_exists_boundary <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> integ_exis_horiz<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">γ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> typeI_cube_line_integral_exists_boundary'' assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> valid_paths<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">.</span> valid_path <span class="bound">γ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> type_I_chain_vert_bound_valid valid_typeI_div <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">have</span></span> integ_exis_vert<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">k</span> <span class="bound">γ</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="main">(</span><span class="bound">k'</span><span class="main">,</span> <span class="bound">γ'</span><span class="main">)</span><span class="main">∈</span>two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">.</span> <span class="main">∃</span><span class="bound">a</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">∃</span><span class="bound">b</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≤</span> <span class="bound">b</span> <span class="main">∧</span> subpath <span class="bound">a</span> <span class="bound">b</span> <span class="bound">γ'</span> <span class="main">=</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">⟹</span>
                            line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">γ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> integ_exis valid_paths line_integral_exists_subpath<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">i</span><span class="main">}</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> two_chain_boundary_def two_chain_horizontal_boundary_def
        two_chain_vertical_boundary_def boundary_def<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ℋ</span></span> <span class="skolem"><span class="skolem">𝒱</span></span> <span class="keyword2"><span class="keyword">where</span></span> hv_props<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">𝒱</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">𝒱</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="main">(</span><span class="bound">k'</span><span class="main">,</span> <span class="bound">γ'</span><span class="main">)</span> <span class="main">∈</span> two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">.</span>
                        <span class="main">(</span><span class="main">∃</span><span class="bound">a</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">∃</span><span class="bound">b</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≤</span> <span class="bound">b</span> <span class="main">∧</span> subpath <span class="bound">a</span> <span class="bound">b</span> <span class="bound">γ'</span> <span class="main">=</span> <span class="bound">γ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="free">one_chain</span> <span class="main">=</span> <span class="skolem">ℋ</span> <span class="main">∪</span> <span class="skolem">𝒱</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span>common_sudiv_exists <span class="main">(</span>two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">)</span> <span class="skolem">ℋ</span><span class="main">)</span>
         <span class="main">∨</span> common_reparam_exists <span class="skolem">ℋ</span> <span class="main">(</span>two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"finite <span class="skolem">ℋ</span>"</span></span>
        <span class="quoted"><span class="quoted">"boundary_chain <span class="skolem">ℋ</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="skolem">ℋ</span><span class="main">.</span> valid_path <span class="bound">γ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> only_vertical_division_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> finite_i<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="free">i</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">γ</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"common_sudiv_exists <span class="main">(</span>two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">)</span> <span class="skolem">ℋ</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> gen_common_subdivision_imp_eq_line_integral<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> True two_chain_horizontal_boundary_is_boundary_chain hv_props<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> integ_exis_horiz finite_two_chain_horizontal_boundary<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> hv_props<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> finite_i<span class="main">]</span>
        integ_exis_vert<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">γ</span>"</span></span><span class="main">]</span> assms<span class="main">(</span>3<span class="main">)</span> case_prod_conv hv_props<span class="main">(</span>2<span class="main">)</span> hv_props<span class="main">(</span>3<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">⊆</span> Basis"</span></span> <span class="keyword1"><span class="command">using</span></span> i_is_x_axis real_pair_basis <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="main">(</span><span class="bound">k2</span><span class="main">,</span> <span class="bound">γ2</span><span class="main">)</span><span class="main">∈</span>two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">.</span> <span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="main">{</span><span class="free">i</span><span class="main">}</span><span class="main">.</span> continuous_on <span class="main">(</span>path_image <span class="bound">γ2</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms field_cont_on_typeI_region_cont_on_edges F_anal_valid valid_typeI_div
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analytically_valid_def two_chain_horizontal_boundary_def boundary_def path_image_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">γ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> common_reparam_exists_imp_eq_line_integral<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> finite_i hv_props<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> finite_two_chain_horizontal_boundary<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> hv_props<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> two_chain_horizontal_boundary_is_boundary_chain ii 
            _ hv_props<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> type_I_chain_horiz_bound_valid<span class="main">]</span>
        integ_exis_vert<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">γ</span>"</span></span><span class="main">]</span> False
        assms<span class="main">(</span>3<span class="main">)</span> hv_props<span class="main">(</span>2-4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Green-GreenThm_typeI_two_chain"><span class="command">lemma</span></span> GreenThm_typeI_two_chain<span class="main">:</span>
   <span class="quoted"><span class="quoted">"two_chain_integral <span class="free">two_chain</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">-</span> partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="free">j</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">(</span>two_chain_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> two_chain_boundary_def one_chain_line_integral_def two_chain_integral_def<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F_b'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> all_two_cubes_have_four_distict_edges<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">twoCube</span> <span class="main">∈</span> <span class="free">two_chain</span><span class="main">.</span> card <span class="main">(</span>boundary <span class="bound">twoCube</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">4</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> valid_typeI_div valid_two_chain_def valid_two_cube_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> no_shared_edges_have_similar_orientations<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">twoCube1</span> <span class="main">∈</span> <span class="free">two_chain</span><span class="main">.</span> <span class="main">∀</span><span class="bound">twoCube2</span> <span class="main">∈</span> <span class="free">two_chain</span><span class="main">.</span>  <span class="bound">twoCube1</span> <span class="main">≠</span> <span class="bound">twoCube2</span> <span class="main">⟶</span>
                          boundary <span class="bound">twoCube1</span> <span class="main">∩</span> boundary <span class="bound">twoCube2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> valid_typeI_div valid_two_chain_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pairwise_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">g</span><span class="main">)</span><span class="main">∈</span> boundary <span class="skolem">twoCube</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">=</span> integral <span class="main">(</span>cubeImage <span class="skolem">twoCube</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">-</span> <span class="var">?F_b'</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">twoCube</span> <span class="main">∈</span> <span class="free">two_chain</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">twoCube</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> analytically_val<span class="main">:</span> <span class="quoted"><span class="quoted">" analytically_valid <span class="main">(</span>cubeImage <span class="skolem">twoCube</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="free">j</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that F_anal_valid <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span><span class="main">∈</span>boundary <span class="skolem">twoCube</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">=</span> integral <span class="main">(</span>cubeImage <span class="skolem">twoCube</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">-</span> <span class="var">?F_b'</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> green_typeI_cube.GreenThm_typeI_twoCube
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_chain_line_integral_def<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R2_axioms analytically_val green_typeI_cube_axioms_def green_typeI_cube_def that two_chain_valid_valid_cubes valid_typeI_div<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> double_sum_eq_sum<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">twoCube</span><span class="main">∈</span><span class="main">(</span><span class="free">two_chain</span><span class="main">)</span><span class="main">.</span><span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">g</span><span class="main">)</span><span class="main">∈</span> boundary <span class="bound">twoCube</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span>
                     <span class="main">=</span>  <span class="main">(</span><span class="main">∑</span><span class="bound">twoCube</span><span class="main">∈</span><span class="main">(</span><span class="free">two_chain</span><span class="main">)</span><span class="main">.</span> integral <span class="main">(</span>cubeImage <span class="bound">twoCube</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">-</span> <span class="var">?F_b'</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Finite_Cartesian_Product.sum_cong_aux <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> pairwise_disjoint_boundaries<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span> <span class="main">(</span>boundary <span class="main">`</span> <span class="free">two_chain</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span> <span class="main">(</span>boundary <span class="main">`</span> <span class="free">two_chain</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∩</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> no_shared_edges_have_similar_orientations
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_def disjoint_iff_not_equal<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> finite_boundaries<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">B</span> <span class="main">∈</span> <span class="main">(</span>boundary<span class="main">`</span> <span class="free">two_chain</span><span class="main">)</span><span class="main">.</span> finite <span class="bound">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> all_two_cubes_have_four_distict_edges
    <span class="keyword1"><span class="command">using</span></span> image_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> boundary_inj<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on boundary <span class="free">two_chain</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span>  all_two_cubes_have_four_distict_edges <span class="keyword2"><span class="keyword">and</span></span> no_shared_edges_have_similar_orientations
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="main">(</span><span class="main">⋃</span><span class="main">(</span>boundary<span class="main">`</span> <span class="free">two_chain</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> 
        <span class="main">=</span> <span class="main">(</span>sum <span class="main">∘</span> sum<span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">)</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">(</span>boundary <span class="main">`</span> <span class="free">two_chain</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sum.Union_disjoint<span class="main">[</span><span class="operator">OF</span> finite_boundaries pairwise_disjoint_boundaries<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">twoCube</span><span class="main">∈</span><span class="main">(</span><span class="free">two_chain</span><span class="main">)</span><span class="main">.</span><span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">g</span><span class="main">)</span><span class="main">∈</span> boundary <span class="bound">twoCube</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sum.reindex<span class="main">[</span><span class="operator">OF</span> boundary_inj<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">g</span><span class="main">)</span><span class="main">∈</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">C</span><span class="main">∈</span><span class="free">two_chain</span><span class="main">.</span> <span class="main">-</span> integral <span class="main">(</span>cubeImage <span class="bound">C</span><span class="main">)</span> <span class="main">(</span>partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="free">two_chain</span><span class="main">.</span> boundary <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⇒</span> real_of_int <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> double_sum_eq_sum <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Green-GreenThm_typeI_divisible"><span class="command">lemma</span></span> GreenThm_typeI_divisible<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> gen_division<span class="main">:</span> <span class="quoted"><span class="quoted">"gen_division <span class="free">s</span> <span class="main">(</span>cubeImage <span class="main">`</span> <span class="free">two_chain</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"integral <span class="free">s</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="bound">a</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="free">j</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">(</span>two_chain_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F_b'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="bound">a</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integral <span class="free">s</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="var">?F_b'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> two_chain_integral <span class="free">two_chain</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">-</span> <span class="var">?F_b'</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> two_chain_integral_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">f</span><span class="main">∈</span><span class="free">two_chain</span><span class="main">.</span> integral <span class="main">(</span>cubeImage <span class="bound">f</span><span class="main">)</span> <span class="main">(</span>partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="free">F</span> <span class="bound">p</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> integral <span class="free">s</span> <span class="main">(</span>partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="free">F</span> <span class="bound">p</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="free">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> analytically_valid_imp_part_deriv_integrable_on F_anal_valid gen_division two_chain_integral_def two_chain_integral_eq_integral_divisable valid_typeI_div<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> integral <span class="free">s</span> <span class="main">(</span>partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="free">F</span> <span class="bound">a</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">C</span><span class="main">∈</span><span class="free">two_chain</span><span class="main">.</span> <span class="main">-</span> integral <span class="main">(</span>cubeImage <span class="bound">C</span><span class="main">)</span> <span class="main">(</span>partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="free">F</span> <span class="bound">a</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_negf<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> GreenThm_typeI_two_chain assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Green-GreenThm_typeI_divisible_region_boundary"><span class="command">lemma</span></span> GreenThm_typeI_divisible_region_boundary<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> 
    gen_division<span class="main">:</span> <span class="quoted"><span class="quoted">"gen_division <span class="free">s</span> <span class="main">(</span>cubeImage <span class="main">`</span> <span class="free">two_chain</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    two_cubes_trace_horizontal_boundaries<span class="main">:</span>
    <span class="quoted"><span class="quoted">"two_chain_horizontal_boundary <span class="free">two_chain</span> <span class="main">⊆</span> <span class="free">γ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    boundary_of_region_is_subset_of_partition_boundary<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">⊆</span> two_chain_boundary <span class="free">two_chain</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"integral <span class="free">s</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="bound">a</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="free">j</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">γ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F_b'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="bound">a</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> all_two_cubes_have_four_distict_edges<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">twoCube</span> <span class="main">∈</span> <span class="free">two_chain</span><span class="main">.</span> card <span class="main">(</span>boundary <span class="bound">twoCube</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">4</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> valid_typeI_div valid_two_chain_def valid_two_cube_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> no_shared_edges_have_similar_orientations<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">twoCube1</span> <span class="main">∈</span> <span class="free">two_chain</span><span class="main">.</span> <span class="main">∀</span><span class="bound">twoCube2</span> <span class="main">∈</span> <span class="free">two_chain</span><span class="main">.</span>
        <span class="bound">twoCube1</span> <span class="main">≠</span> <span class="bound">twoCube2</span> <span class="main">⟶</span> boundary <span class="bound">twoCube1</span> <span class="main">∩</span> boundary <span class="bound">twoCube2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> valid_typeI_div valid_two_chain_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pairwise_def<span class="main">)</span>
      <span class="comment1">(*Proving that line_integral on the x axis is 0 for the vertical 1-cubes*)</span>
  <span class="keyword1"><span class="command">have</span></span> vert_line_integral_zero<span class="main">:</span>
    <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">(</span>two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_chain_line_integral_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">(</span>snd <span class="skolem">oneCube</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> oneCube<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">oneCube</span> <span class="main">∈</span> two_chain_vertical_boundary<span class="main">(</span><span class="free">two_chain</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">oneCube</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y1</span></span> <span class="skolem"><span class="skolem">y2</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> vert_edge_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">oneCube</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span><span class="skolem">x</span><span class="main">::</span>real<span class="main">,</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">y2</span><span class="main">)</span> <span class="main">+</span> <span class="bound">t</span> <span class="main">*</span> <span class="skolem">y1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> valid_typeI_div oneCube
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> typeI_twoCube_def two_chain_vertical_boundary_def vertical_boundary_def<span class="main">)</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?vert_edge</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>snd <span class="skolem">oneCube</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> vert_edge_x_const<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="var">?vert_edge</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_is_x_axis vert_edge_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> vert_edge_is_straight_path<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?vert_edge</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y2</span> <span class="main">+</span> <span class="bound">t</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">y1</span> <span class="main">-</span> <span class="skolem">y2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> vert_edge_def Product_Type.snd_conv
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute right_diff_distrib'<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_is_x_axis line_integral_on_pair_straight_path<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> mult.commute straight_path_diffrentiable_x vert_edge_is_straight_path<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> comm_monoid_add_class.sum.neutral <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod.case_eq_if<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
    <span class="comment1">(*then, the x axis line_integral on the boundaries of the twoCube is equal to the line_integral on the horizontal boundaries of the twoCube ⟶ 1*)</span>
  <span class="keyword1"><span class="command">have</span></span> boundary_is_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>two_chain_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> two_chain_boundary_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> all_two_cubes_have_four_distict_edges card.infinite finite_UN_I finite_imageD 
              gen_division gen_division_def zero_neq_numeral valid_typeI_div valid_two_chain_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> boundary_is_vert_hor<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>two_chain_boundary <span class="free">two_chain</span><span class="main">)</span> <span class="main">=</span>
                              <span class="main">(</span>two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">)</span> <span class="main">∪</span>
                              <span class="main">(</span>two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> two_chain_boundary_def two_chain_vertical_boundary_def two_chain_horizontal_boundary_def
        boundary_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> hor_vert_finite<span class="main">:</span>
    <span class="quoted"><span class="quoted">"finite <span class="main">(</span>two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"finite <span class="main">(</span>two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> boundary_is_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> horiz_verti_disjoint<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> two_chain_vertical_boundary_def two_chain_horizontal_boundary_def horizontal_boundary_def
        vertical_boundary_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="free">two_chain</span><span class="main">.</span> <span class="main">{</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="free">two_chain</span><span class="main">.</span> <span class="main">{</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="bound">x</span> <span class="main">(</span><span class="bound">z</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="bound">x</span> <span class="main">(</span><span class="bound">z</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">twoCube</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">twoCube</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="main">∩</span>
            <span class="main">{</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="skolem">twoCube2</span> <span class="main">(</span><span class="bound">z</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="skolem">twoCube2</span> <span class="main">(</span><span class="bound">z</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">twoCube</span><span class="main">∈</span><span class="free">two_chain</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">twoCube2</span><span class="main">∈</span><span class="free">two_chain</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">twoCube</span> <span class="skolem">twoCube2</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">twoCube</span> <span class="main">=</span> <span class="skolem">twoCube2</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">twoCube2</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">twoCube2</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">twoCube2</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">twoCube2</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="numeral">4</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> all_two_cubes_have_four_distict_edges that<span class="main">(</span>2<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_def vertical_boundary_def horizontal_boundary_def<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> True card_insert_if <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> no_shared_edges_have_similar_orientations
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> that boundary_def vertical_boundary_def horizontal_boundary_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">twoCube</span><span class="main">.</span> <span class="main">{</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">twoCube</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">twoCube</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">two_chain</span><span class="main">)</span>
               <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">twoCube</span><span class="main">.</span> <span class="main">{</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">twoCube</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="bound">twoCube</span> <span class="main">(</span><span class="bound">z</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">two_chain</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Complete_Lattices.Union_disjoint <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">(</span>two_chain_boundary <span class="free">two_chain</span><span class="main">)</span>
        <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">(</span>two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">)</span> <span class="main">+</span>
          one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">(</span>two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> boundary_is_vert_hor horiz_verti_disjoint
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_chain_line_integral_def hor_vert_finite sum.union_disjoint<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> x_axis_line_integral_is_only_horizontal<span class="main">:</span>
    <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">(</span>two_chain_boundary <span class="free">two_chain</span><span class="main">)</span>
     <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">(</span>two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> vert_line_integral_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="comment1">(*Since γ ⊆ the boundary of the 2-chain and the horizontal boundaries are ⊆ γ, then there is some 𝒱 ⊆ ∂<span class="hidden">⇩</span><sub>V</sub>(2-𝒞) such that γ = 𝒱 ∪ ∂<span class="hidden">⇩</span><sub>H</sub>(2-𝒞)*)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">𝒱</span><span class="main">.</span> <span class="bound">𝒱</span> <span class="main">⊆</span> <span class="main">(</span>two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">)</span> <span class="main">∧</span> <span class="free">γ</span> <span class="main">=</span> <span class="bound">𝒱</span> <span class="main">∪</span> <span class="main">(</span>two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?𝒱</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">-</span> <span class="main">(</span>two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?𝒱</span> <span class="main">⊆</span> two_chain_vertical_boundary <span class="free">two_chain</span> <span class="main">∧</span> <span class="free">γ</span> <span class="main">=</span> <span class="var">?𝒱</span> <span class="main">∪</span> two_chain_horizontal_boundary <span class="free">two_chain</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> two_cubes_trace_horizontal_boundaries
        boundary_of_region_is_subset_of_partition_boundary boundary_is_vert_hor
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">𝒱</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    v_props<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒱</span> <span class="main">⊆</span> <span class="main">(</span>two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">=</span> <span class="skolem">𝒱</span> <span class="main">∪</span> <span class="main">(</span>two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> v_horiz_disj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">𝒱</span> <span class="main">∩</span> <span class="main">(</span>two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> horiz_verti_disjoint v_props<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> v_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">𝒱</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> hor_vert_finite v_props<span class="main">(</span>1<span class="main">)</span> Finite_Set.rev_finite_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> line_integral_on_path<span class="main">:</span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">γ</span> <span class="main">=</span>
                               one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="skolem">𝒱</span> <span class="main">+</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">(</span>two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_chain_line_integral_def v_props sum.union_disjoint<span class="main"><span class="main">[</span></span><span class="operator">OF</span> v_finite hor_vert_finite<span class="main"><span class="main"><span class="main">(</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span> v_horiz_disj<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="comment1">(*Since 𝒱 ⊆ ∂<span class="hidden">⇩</span><sub>V</sub>(2-𝒞), then the line_integral on the x axis along ℋ is 0, and from 1 Q.E.D. *)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="skolem">𝒱</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_chain_line_integral_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">(</span>snd <span class="skolem">oneCube</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> oneCube<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">oneCube</span> <span class="main">∈</span> two_chain_vertical_boundary<span class="main">(</span><span class="free">two_chain</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">oneCube</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y1</span></span> <span class="skolem"><span class="skolem">y2</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> vert_edge_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">oneCube</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span><span class="skolem">x</span><span class="main">::</span>real<span class="main">,</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">y2</span><span class="main">)</span> <span class="main">+</span> <span class="bound">t</span> <span class="main">*</span> <span class="skolem">y1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> valid_typeI_div oneCube
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> typeI_twoCube_def two_chain_vertical_boundary_def vertical_boundary_def<span class="main">)</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?vert_edge</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>snd <span class="skolem">oneCube</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> vert_edge_x_const<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="var">?vert_edge</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_is_x_axis vert_edge_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> vert_edge_is_straight_path<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="var">?vert_edge</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y2</span> <span class="main">+</span> <span class="bound">t</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">y1</span> <span class="main">-</span> <span class="skolem">y2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vert_edge_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="var">?vert_edge</span> <span class="keyword1">differentiable</span> <span class="keyword1">at</span> <span class="bound">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.commute vert_edge_is_straight_path straight_path_diffrentiable_x<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">(</span>snd <span class="skolem">oneCube</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> line_integral_on_pair_straight_path<span class="main">(</span>1<span class="main">)</span> vert_edge_x_const <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">oneCube</span> <span class="main">∈</span> <span class="skolem">𝒱</span><span class="main">.</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">(</span>snd <span class="bound">oneCube</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> v_props <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">𝒱</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> comm_monoid_add_class.sum.neutral <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod.case_eq_if<span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">γ</span> <span class="main">=</span>
             one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">(</span>two_chain_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> x_axis_line_integral_is_only_horizontal <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> line_integral_on_path<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> GreenThm_typeI_divisible <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Green-GreenThm_typeI_divisible_region_boundary_gen"><span class="command">lemma</span></span> GreenThm_typeI_divisible_region_boundary_gen<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> valid_typeI_div<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_typeI_division <span class="free">s</span> <span class="free">two_chain</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    f_analytically_valid<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">twoC</span> <span class="main">∈</span> <span class="free">two_chain</span><span class="main">.</span> analytically_valid <span class="main">(</span>cubeImage <span class="bound">twoC</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="bound">a</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="free">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    only_vertical_division<span class="main">:</span>
    <span class="quoted"><span class="quoted">"only_vertical_division <span class="free">γ</span> <span class="free">two_chain</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"integral <span class="free">s</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="bound">a</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="free">j</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">γ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F_b'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="bound">a</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> all_two_cubes_have_four_distict_edges<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">twoCube</span> <span class="main">∈</span> <span class="free">two_chain</span><span class="main">.</span> card <span class="main">(</span>boundary <span class="bound">twoCube</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">4</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> valid_typeI_div valid_two_chain_def valid_two_cube_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> no_shared_edges_have_similar_orientations<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">twoCube1</span> <span class="main">∈</span> <span class="free">two_chain</span><span class="main">.</span> <span class="main">∀</span><span class="bound">twoCube2</span> <span class="main">∈</span> <span class="free">two_chain</span><span class="main">.</span>
         <span class="bound">twoCube1</span> <span class="main">≠</span> <span class="bound">twoCube2</span> <span class="main">⟶</span> boundary <span class="bound">twoCube1</span> <span class="main">∩</span> boundary <span class="bound">twoCube2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> valid_typeI_div valid_two_chain_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pairwise_def<span class="main">)</span>
      <span class="comment1">(*Proving that line_integral on the x axis is 0 for the vertical 1-cubes*)</span>
  <span class="keyword1"><span class="command">have</span></span> vert_line_integral_zero<span class="main">:</span>
    <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">(</span>two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_chain_line_integral_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">(</span>snd <span class="skolem">oneCube</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> oneCube<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">oneCube</span> <span class="main">∈</span> two_chain_vertical_boundary<span class="main">(</span><span class="free">two_chain</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">oneCube</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y1</span></span> <span class="skolem"><span class="skolem">y2</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> vert_edge_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">oneCube</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span><span class="skolem">x</span><span class="main">::</span>real<span class="main">,</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">y2</span><span class="main">)</span> <span class="main">+</span> <span class="bound">t</span> <span class="main">*</span> <span class="skolem">y1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> valid_typeI_div oneCube
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> typeI_twoCube_def two_chain_vertical_boundary_def vertical_boundary_def<span class="main">)</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?vert_edge</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>snd <span class="skolem">oneCube</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> vert_edge_x_const<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="var">?vert_edge</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_is_x_axis vert_edge_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> vert_edge_is_straight_path<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?vert_edge</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y2</span> <span class="main">+</span> <span class="bound">t</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">y1</span> <span class="main">-</span> <span class="skolem">y2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vert_edge_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_is_x_axis line_integral_on_pair_straight_path<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> mult.commute straight_path_diffrentiable_x vert_edge_is_straight_path<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> comm_monoid_add_class.sum.neutral <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod.case_eq_if<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
    <span class="comment1">(*then, the x axis line_integral on the boundaries of the twoCube is equal to the line_integral on the horizontal boundaries of the twoCube ⟶ 1*)</span>
  <span class="keyword1"><span class="command">have</span></span> boundary_is_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>two_chain_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> two_chain_boundary_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> finite_UN_I<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">two_chain</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> finite_imageD gen_division_def valid_two_chain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">two_chain</span> <span class="main">⟹</span> finite <span class="main">(</span>boundary <span class="bound">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_def horizontal_boundary_def vertical_boundary_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> boundary_is_vert_hor<span class="main">:</span> <span class="quoted"><span class="quoted">"two_chain_boundary <span class="free">two_chain</span> <span class="main">=</span>
                              <span class="main">(</span>two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> two_chain_boundary_def two_chain_vertical_boundary_def two_chain_horizontal_boundary_def boundary_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> hor_vert_finite<span class="main">:</span>
    <span class="quoted"><span class="quoted">"finite <span class="main">(</span>two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"finite <span class="main">(</span>two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> boundary_is_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> horiz_verti_disjoint<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> two_chain_vertical_boundary_def two_chain_horizontal_boundary_def horizontal_boundary_def
        vertical_boundary_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="free">two_chain</span><span class="main">.</span> <span class="main">{</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> 
        <span class="main">∩</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="free">two_chain</span><span class="main">.</span> <span class="main">{</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">twoCube</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">twoCube</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="main">∩</span>
            <span class="main">{</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">twoCube2</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">twoCube2</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">twoCube</span> <span class="main">∈</span> <span class="free">two_chain</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">twoCube2</span> <span class="main">∈</span> <span class="free">two_chain</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">twoCube</span> <span class="skolem">twoCube2</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">twoCube</span> <span class="main">=</span> <span class="skolem">twoCube2</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">twoCube2</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="skolem">twoCube2</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">twoCube2</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">twoCube2</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="numeral">4</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> all_two_cubes_have_four_distict_edges that<span class="main">(</span>2<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_def vertical_boundary_def horizontal_boundary_def<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> card_insert_if True <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> no_shared_edges_have_similar_orientations
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> that boundary_def vertical_boundary_def horizontal_boundary_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">twoCube</span><span class="main">.</span> <span class="main">{</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">twoCube</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">twoCube</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">two_chain</span><span class="main">)</span>
               <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">twoCube</span><span class="main">.</span> <span class="main">{</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">twoCube</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">twoCube</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">two_chain</span><span class="main">)</span>
                 <span class="main">=</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Complete_Lattices.Union_disjoint <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">(</span>two_chain_boundary <span class="free">two_chain</span><span class="main">)</span>
         <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">(</span>two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">)</span> <span class="main">+</span>
           one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">(</span>two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> boundary_is_vert_hor horiz_verti_disjoint
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_chain_line_integral_def hor_vert_finite sum.union_disjoint<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> x_axis_line_integral_is_only_horizontal<span class="main">:</span>
    <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">(</span>two_chain_boundary <span class="free">two_chain</span><span class="main">)</span>
     <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">(</span>two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> vert_line_integral_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="comment1">(*Since γ ⊆ the boundary of the 2-chain and the horizontal boundaries are ⊆ γ, then there is some 𝒱 ⊆ ∂<span class="hidden">⇩</span><sub>V</sub>(2-𝒞) such that γ = 𝒱 ∪ ∂<span class="hidden">⇩</span><sub>H</sub>(2-𝒞)*)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ℋ</span></span> <span class="skolem"><span class="skolem">𝒱</span></span> <span class="keyword2"><span class="keyword">where</span></span> hv_props<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">𝒱</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">𝒱</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="main">(</span><span class="bound">k'</span><span class="main">,</span> <span class="bound">γ'</span><span class="main">)</span> <span class="main">∈</span> two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">.</span>
        <span class="main">(</span><span class="main">∃</span><span class="bound">a</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">∃</span><span class="bound">b</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≤</span> <span class="bound">b</span> <span class="main">∧</span> subpath <span class="bound">a</span> <span class="bound">b</span> <span class="bound">γ'</span> <span class="main">=</span> <span class="bound">γ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">=</span> <span class="skolem">ℋ</span> <span class="main">∪</span> <span class="skolem">𝒱</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>common_sudiv_exists <span class="main">(</span>two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">)</span> <span class="skolem">ℋ</span><span class="main">)</span>
     <span class="main">∨</span> common_reparam_exists <span class="skolem">ℋ</span> <span class="main">(</span>two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"finite <span class="skolem">ℋ</span>"</span></span>
    <span class="quoted"><span class="quoted">"boundary_chain <span class="skolem">ℋ</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="skolem">ℋ</span><span class="main">.</span> valid_path <span class="bound">γ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> only_vertical_division <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  only_vertical_division_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="free">i</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> eq_integrals<span class="main">:</span> <span class="quoted"><span class="quoted">" one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="skolem">ℋ</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">(</span>two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"common_sudiv_exists <span class="main">(</span>two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">)</span> <span class="skolem">ℋ</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> gen_common_subdivision_imp_eq_line_integral<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> True two_chain_horizontal_boundary_is_boundary_chain hv_props<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> _ hor_vert_finite<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> hv_props<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span>
        typeI_cube_line_integral_exists_boundary''
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> integ_exis_horiz<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">γ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> typeI_cube_line_integral_exists_boundary'' assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_two_chain_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> integ_exis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> two_chain_boundary <span class="free">two_chain</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">γ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> typeI_cube_line_integral_exists_boundary <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> valid_paths<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span> <span class="main">∈</span> two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">.</span> valid_path <span class="bound">γ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> typeI_edges_are_valid_paths assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> two_chain_boundary_def two_chain_vertical_boundary_def boundary_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> integ_exis_vert<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">k</span> <span class="bound">γ</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="main">(</span><span class="bound">k'</span><span class="main">,</span> <span class="bound">γ'</span><span class="main">)</span> <span class="main">∈</span> two_chain_vertical_boundary <span class="free">two_chain</span><span class="main">.</span> <span class="main">∃</span><span class="bound">a</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">∃</span><span class="bound">b</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≤</span> <span class="bound">b</span> <span class="main">∧</span> subpath <span class="bound">a</span> <span class="bound">b</span> <span class="bound">γ'</span> <span class="main">=</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">⟹</span>
                                    line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">γ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> integ_exis valid_paths line_integral_exists_subpath<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">i</span><span class="main">}</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> two_chain_boundary_def two_chain_vertical_boundary_def
          two_chain_horizontal_boundary_def boundary_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> finite_i<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="free">i</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">⊆</span> Basis"</span></span> <span class="keyword1"><span class="command">using</span></span> i_is_x_axis real_pair_basis <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="main">(</span><span class="bound">k2</span><span class="main">,</span> <span class="bound">γ2</span><span class="main">)</span><span class="main">∈</span>two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">.</span> <span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="main">{</span><span class="free">i</span><span class="main">}</span><span class="main">.</span> continuous_on <span class="main">(</span>path_image <span class="bound">γ2</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> field_cont_on_typeI_region_cont_on_edges assms<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analytically_valid_def two_chain_horizontal_boundary_def boundary_def path_image_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"common_reparam_exists <span class="skolem">ℋ</span> <span class="main">(</span>two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> hv_props<span class="main">(</span>4<span class="main">)</span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="skolem">ℋ</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">(</span>two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> common_reparam_exists_imp_eq_line_integral<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> finite_i hv_props<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> hor_vert_finite<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> hv_props<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> two_chain_horizontal_boundary_is_boundary_chain ii * hv_props<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> type_I_chain_horiz_bound_valid<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
    <span class="comment1">(*Since 𝒱 ⊆ ∂<span class="hidden">⇩</span><sub>H</sub>(2-𝒞), then the line_integral on the x axis along 𝒱 is 0, and from 1 Q.E.D. *)</span>
  <span class="keyword1"><span class="command">have</span></span> line_integral_on_path<span class="main">:</span>
    <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">γ</span> <span class="main">=</span>
     one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">(</span>two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_chain_line_integral_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">(</span>snd <span class="skolem">oneCube</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> oneCube<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">oneCube</span> <span class="main">∈</span> <span class="skolem">𝒱</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">oneCube</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="skolem"><span class="skolem">γ</span></span> <span class="keyword2"><span class="keyword">where</span></span> k_gamma<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">γ</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">oneCube</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> coeff_cube_to_path.cases<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k'</span></span> <span class="skolem"><span class="skolem">γ'</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> kp_gammap<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k'</span><span class="main">::</span>int<span class="main">,</span> <span class="skolem">γ'</span><span class="main">)</span> <span class="main">∈</span> two_chain_vertical_boundary <span class="free">two_chain</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="main">1</span><span class="main">}</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
        <span class="quoted"><span class="quoted">"subpath <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">γ'</span> <span class="main">=</span> <span class="skolem">γ</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> hv_props oneCube
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> case_prodE split_conv<span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y1</span></span> <span class="skolem"><span class="skolem">y2</span></span> <span class="keyword2"><span class="keyword">where</span></span> vert_edge_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k'</span><span class="main">,</span><span class="skolem">γ'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">k'</span><span class="main">,</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span><span class="skolem">x</span><span class="main">::</span>real<span class="main">,</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">y2</span><span class="main">)</span> <span class="main">+</span> <span class="bound">t</span> <span class="main">*</span> <span class="skolem">y1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> valid_typeI_div kp_gammap
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> typeI_twoCube_def two_chain_vertical_boundary_def vertical_boundary_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> vert_edge_x_const<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">γ</span> <span class="main">(</span><span class="bound">t</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Pair_inject fstI i_is_x_axis inner_Pair_0<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> kp_gammap<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> real_inner_1_right subpath_def vert_edge_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">γ</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span><span class="skolem">x</span><span class="main">::</span>real<span class="main">,</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span><span class="main">*</span><span class="bound">t</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">y2</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="skolem">b</span><span class="main">-</span><span class="skolem">a</span><span class="main">)</span><span class="main">*</span><span class="bound">t</span> <span class="main">+</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">y1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> vert_edge_def Product_Type.snd_conv Product_Type.fst_conv kp_gammap<span class="main">(</span>4<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subpath_def diff_diff_eq<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span><span class="skolem">x</span><span class="main">::</span>real<span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">*</span><span class="skolem">y2</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">*</span><span class="skolem">y2</span><span class="main">)</span> <span class="main">+</span>  <span class="skolem">a</span><span class="main">*</span><span class="skolem">y1</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="skolem">b</span><span class="main">-</span><span class="skolem">a</span><span class="main">)</span><span class="main">*</span><span class="skolem">y1</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span><span class="main">*</span><span class="skolem">y2</span><span class="main">)</span><span class="main">*</span><span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> vert_edge_is_straight_path<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="skolem">γ</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span><span class="skolem">x</span><span class="main">::</span>real<span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">*</span><span class="skolem">y2</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">*</span><span class="skolem">y2</span><span class="main">)</span> <span class="main">+</span>  <span class="skolem">a</span><span class="main">*</span><span class="skolem">y1</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="skolem">b</span><span class="main">-</span><span class="skolem">a</span><span class="main">)</span><span class="main">*</span><span class="skolem">y1</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span><span class="main">*</span><span class="skolem">y2</span><span class="main">)</span><span class="main">*</span><span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">(</span>snd <span class="skolem">oneCube</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">γ</span> <span class="keyword1">differentiable</span> <span class="keyword1">at</span> <span class="bound">x</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> straight_path_diffrentiable_x vert_edge_is_straight_path<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="skolem">γ</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> line_integral_on_pair_straight_path<span class="main">(</span>1<span class="main">)</span> vert_edge_x_const <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> Product_Type.snd_conv k_gamma <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">𝒱</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">)</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">γ</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⇒</span> real_of_int <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span>two_chain_horizontal_boundary <span class="free">two_chain</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⇒</span> of_int <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> hv_props<span class="main">(</span>1<span class="main">)</span> hv_props<span class="main">(</span>3<span class="main">)</span> hv_props<span class="main">(</span>5<span class="main">)</span> sum_zero_set hor_vert_finite<span class="main">(</span>2<span class="main">)</span> eq_integrals
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_chain_line_integral_def<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Un_commute sum_zero_set<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">γ</span> <span class="main">=</span>
             one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">(</span>two_chain_boundary <span class="free">two_chain</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> x_axis_line_integral_is_only_horizontal line_integral_on_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms GreenThm_typeI_divisible <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> green_typeI_typeII_chain <span class="main">=</span> R2<span class="main">:</span> R2 <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">j</span></span> <span class="main">+</span> T1<span class="main">:</span> green_typeI_chain <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">j</span></span> <span class="quoted"><span class="free">F</span></span> <span class="quoted"><span class="free">two_chain_typeI</span></span> <span class="main">+</span> T2<span class="main">:</span> green_typeII_chain <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">j</span></span> <span class="quoted"><span class="free">F</span></span> <span class="quoted"><span class="free">two_chain_typeII</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">i</span> <span class="free">j</span> <span class="free">F</span> <span class="free">two_chain_typeI</span> <span class="free">two_chain_typeII</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Green-GreenThm_typeI_typeII_divisible_region_boundary"><span class="command">lemma</span></span> GreenThm_typeI_typeII_divisible_region_boundary<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> 
    gen_divisions<span class="main">:</span> <span class="quoted"><span class="quoted">"gen_division <span class="free">s</span> <span class="main">(</span>cubeImage <span class="main">`</span> <span class="free">two_chain_typeI</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"gen_division <span class="free">s</span> <span class="main">(</span>cubeImage <span class="main">`</span> <span class="free">two_chain_typeII</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    typeI_two_cubes_trace_horizontal_boundaries<span class="main">:</span>
    <span class="quoted"><span class="quoted">"two_chain_horizontal_boundary <span class="free">two_chain_typeI</span> <span class="main">⊆</span> <span class="free">γ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    typeII_two_cubes_trace_vertical_boundaries<span class="main">:</span>
    <span class="quoted"><span class="quoted">"two_chain_vertical_boundary <span class="free">two_chain_typeII</span> <span class="main">⊆</span> <span class="free">γ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    boundary_of_region_is_subset_of_partition_boundaries<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">⊆</span> two_chain_boundary <span class="free">two_chain_typeI</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">γ</span> <span class="main">⊆</span> two_chain_boundary <span class="free">two_chain_typeII</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"integral <span class="free">s</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="free">F</span> <span class="bound">a</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="free">i</span> <span class="bound">x</span> <span class="main">-</span> partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="free">F</span> <span class="bound">a</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="free">j</span> <span class="bound">x</span><span class="main">)</span>
         <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">}</span> <span class="free">γ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F_b'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="free">F</span> <span class="bound">a</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F_a'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="free">F</span> <span class="bound">a</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> typeI_regions_integral<span class="main">:</span> <span class="quoted"><span class="quoted">"integral <span class="free">s</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="free">F</span> <span class="bound">a</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="free">j</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">γ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> T1.GreenThm_typeI_divisible_region_boundary
        gen_divisions<span class="main">(</span>1<span class="main">)</span> typeI_two_cubes_trace_horizontal_boundaries
        boundary_of_region_is_subset_of_partition_boundaries<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> typeII_regions_integral<span class="main">:</span> <span class="quoted"><span class="quoted">"integral <span class="free">s</span> <span class="main">(</span>partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">γ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> T2.GreenThm_typeII_divisible_region_boundary gen_divisions<span class="main">(</span>2<span class="main">)</span>
         typeII_two_cubes_trace_vertical_boundaries
        boundary_of_region_is_subset_of_partition_boundaries<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> integral_dis<span class="main">:</span> <span class="quoted"><span class="quoted">"integral <span class="free">s</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="var">?F_a'</span> <span class="bound">x</span> <span class="main">-</span> <span class="var">?F_b'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> integral <span class="free">s</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="var">?F_a'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> integral <span class="free">s</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="var">?F_b'</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">twoCube</span> <span class="main">∈</span> <span class="free">two_chain_typeII</span><span class="main">.</span> <span class="main">(</span><span class="var">?F_a'</span> <span class="keyword1">has_integral</span> integral <span class="main">(</span>cubeImage <span class="bound">twoCube</span><span class="main">)</span> <span class="var">?F_a'</span><span class="main">)</span> <span class="main">(</span>cubeImage <span class="bound">twoCube</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analytically_valid_imp_part_deriv_integrable_on T2.F_anal_valid has_integral_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="main">(</span>cubeImage <span class="main">`</span> <span class="free">two_chain_typeII</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="var">?F_a'</span> <span class="keyword1">has_integral</span> integral <span class="bound">u</span> <span class="var">?F_a'</span><span class="main">)</span> <span class="bound">u</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?F_a'</span> <span class="keyword1">has_integral</span> <span class="main">(</span><span class="main">∑</span><span class="bound">img</span><span class="main">∈</span>cubeImage <span class="main">`</span> <span class="free">two_chain_typeII</span><span class="main">.</span> integral <span class="bound">img</span> <span class="var">?F_a'</span><span class="main">)</span><span class="main">)</span> <span class="free">s</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> gen_divisions<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> gen_division_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> has_integral_Union<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> F_a'_integrable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?F_a'</span> <span class="keyword1">integrable_on</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">twoCube</span> <span class="main">∈</span> <span class="free">two_chain_typeI</span><span class="main">.</span> <span class="main">(</span><span class="var">?F_b'</span> <span class="keyword1">has_integral</span> integral <span class="main">(</span>cubeImage <span class="bound">twoCube</span><span class="main">)</span> <span class="var">?F_b'</span><span class="main">)</span> <span class="main">(</span>cubeImage <span class="bound">twoCube</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> analytically_valid_imp_part_deriv_integrable_on T1.F_anal_valid <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="main">(</span>cubeImage <span class="main">`</span> <span class="free">two_chain_typeI</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="var">?F_b'</span> <span class="keyword1">has_integral</span> integral <span class="bound">u</span> <span class="var">?F_b'</span><span class="main">)</span> <span class="bound">u</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?F_b'</span> <span class="keyword1">has_integral</span> <span class="main">(</span><span class="main">∑</span><span class="bound">img</span><span class="main">∈</span>cubeImage <span class="main">`</span> <span class="free">two_chain_typeI</span><span class="main">.</span> integral <span class="bound">img</span> <span class="var">?F_b'</span><span class="main">)</span><span class="main">)</span> <span class="free">s</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> gen_divisions<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> gen_division_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> has_integral_Union<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> F_a'_integrable Henstock_Kurzweil_Integration.integral_diff has_integral_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> line_integral_dist<span class="main">:</span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">}</span> <span class="free">γ</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">γ</span> <span class="main">+</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">γ</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_chain_line_integral_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">}</span> <span class="skolem">g</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="skolem">g</span> <span class="main">+</span>  <span class="skolem">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="skolem">g</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> kg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">g</span><span class="main">)</span> <span class="main">∈</span> <span class="free">γ</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">g</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">twoCube_typeI</span></span> <span class="keyword2"><span class="keyword">where</span></span> twoCube_typeI_props<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="skolem">twoCube_typeI</span> <span class="main">∈</span> <span class="free">two_chain_typeI</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">∈</span> boundary <span class="skolem">twoCube_typeI</span>"</span></span>
        <span class="quoted"><span class="quoted">"typeI_twoCube <span class="skolem">twoCube_typeI</span>"</span></span>
        <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>cubeImage <span class="skolem">twoCube_typeI</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> boundary_of_region_is_subset_of_partition_boundaries<span class="main">(</span>1<span class="main">)</span> two_chain_boundary_def T1.valid_typeI_div
          T1.F_anal_valid kg
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analytically_valid_def<span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">twoCube_typeII</span></span> <span class="keyword2"><span class="keyword">where</span></span> twoCube_typeII_props<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="skolem">twoCube_typeII</span> <span class="main">∈</span> <span class="free">two_chain_typeII</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span><span class="main">,</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">∈</span> boundary <span class="skolem">twoCube_typeII</span>"</span></span>
        <span class="quoted"><span class="quoted">"typeII_twoCube <span class="skolem">twoCube_typeII</span>"</span></span>
        <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>cubeImage <span class="skolem">twoCube_typeII</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> boundary_of_region_is_subset_of_partition_boundaries<span class="main">(</span>2<span class="main">)</span> two_chain_boundary_def T2.valid_typeII_div
          kg T2.F_anal_valid
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analytically_valid_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">}</span> <span class="skolem">g</span> <span class="main">=</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="skolem">g</span> <span class="main">+</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="skolem">g</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> int_exists_i<span class="main">:</span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="skolem">g</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> T1.typeI_cube_line_integral_exists_boundary assms kg
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_two_chain_def<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> int_exists_j<span class="main">:</span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="skolem">g</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> T2.typeII_cube_line_integral_exists_boundary assms kg
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_two_chain_def<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> line_integral_sum_gen<span class="main">[</span><span class="operator">OF</span> finite int_exists_i int_exists_j<span class="main">]</span> R2.i_is_x_axis R2.j_is_y_axis
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">}</span> <span class="skolem">g</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="skolem">g</span> <span class="main">+</span> <span class="skolem">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="skolem">g</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_left<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> line_integral_distrib<span class="main">:</span> 
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">g</span><span class="main">)</span><span class="main">∈</span><span class="free">γ</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">=</span>
           <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">g</span><span class="main">)</span><span class="main">∈</span><span class="free">γ</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">g</span> <span class="main">+</span>  <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sum.cong split_cong<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">)</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">)</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                                     <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">+</span>  <span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">)</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> comm_monoid_add_class.sum.distrib <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span><span class="main">∈</span><span class="free">γ</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span><span class="main">∈</span><span class="free">γ</span><span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">)</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span><span class="main">∈</span><span class="free">γ</span><span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">)</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> comm_monoid_add_class.sum.distrib<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span><span class="main">.</span>  <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span><span class="main">.</span>  <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">γ</span></span><span class="main">]</span>
        line_integral_distrib
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> integral_dis line_integral_dist typeI_regions_integral typeII_regions_integral
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Green-GreenThm_typeI_typeII_divisible_region'"><span class="command">lemma</span></span> GreenThm_typeI_typeII_divisible_region'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> 
    only_vertical_division<span class="main">:</span>
    <span class="quoted"><span class="quoted">"only_vertical_division <span class="free">one_chain_typeI</span> <span class="free">two_chain_typeI</span>"</span></span>
    <span class="quoted"><span class="quoted">"boundary_chain <span class="free">one_chain_typeI</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    only_horizontal_division<span class="main">:</span>
    <span class="quoted"><span class="quoted">"only_horizontal_division <span class="free">one_chain_typeII</span> <span class="free">two_chain_typeII</span>"</span></span>
    <span class="quoted"><span class="quoted">"boundary_chain <span class="free">one_chain_typeII</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    typeI_and_typII_one_chains_have_gen_common_subdiv<span class="main">:</span>
    <span class="quoted"><span class="quoted">"common_sudiv_exists <span class="free">one_chain_typeI</span> <span class="free">one_chain_typeII</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"integral <span class="free">s</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="free">i</span> <span class="bound">x</span> <span class="main">-</span> partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="free">j</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">}</span> <span class="free">one_chain_typeI</span>"</span></span>
    <span class="quoted"><span class="quoted">"integral <span class="free">s</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="free">i</span> <span class="bound">x</span> <span class="main">-</span> partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="free">j</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">}</span> <span class="free">one_chain_typeII</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F_b'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F_a'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> one_chain_i_integrals<span class="main">:</span>
    <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">one_chain_typeI</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">one_chain_typeII</span> <span class="main">∧</span>
              <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain_typeI</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∧</span>
              <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain_typeII</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">γ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">two_chain_typeI</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> T1.valid_typeI_div finite_image_iff
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gen_division_def valid_two_chain_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain_typeI</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">γ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> T1.members_of_only_vertical_div_line_integrable' assms 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>two_chain_horizontal_boundary <span class="free">two_chain_typeI</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> T1.valid_typeI_div finite_imageD finite_two_chain_horizontal_boundary gen_division_def valid_two_chain_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">one_chain_typeI</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> only_vertical_division<span class="main">(</span>1<span class="main">)</span> only_vertical_division_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">one_chain_typeII</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> only_horizontal_division<span class="main">(</span>1<span class="main">)</span> only_horizontal_division_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">one_chain_typeI</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">one_chain_typeII</span>"</span></span>
               <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain_typeII</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">γ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> gen_common_subdivision_imp_eq_line_integral<span class="main">[</span><span class="operator">OF</span> typeI_and_typII_one_chains_have_gen_common_subdiv
          only_vertical_division<span class="main"><span class="main"><span class="main">(</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span> only_horizontal_division<span class="main"><span class="main"><span class="main">(</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main">]</span> ii 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> one_chain_j_integrals<span class="main">:</span>
    <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">one_chain_typeII</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">one_chain_typeI</span> <span class="main">∧</span>
              <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain_typeII</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∧</span>
              <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain_typeI</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">γ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">two_chain_typeII</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> T2.valid_typeII_div finite_image_iff
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gen_division_def valid_two_chain_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain_typeII</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">γ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> T2.members_of_only_horiz_div_line_integrable' assms T2.two_chain_valid_valid_cubes <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> typeII_and_typI_one_chains_have_common_subdiv<span class="main">:</span> <span class="quoted"><span class="quoted">"common_sudiv_exists <span class="free">one_chain_typeII</span> <span class="free">one_chain_typeI</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> common_sudiv_exists_comm typeI_and_typII_one_chains_have_gen_common_subdiv<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> iv<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">one_chain_typeI</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> only_vertical_division<span class="main">(</span>1<span class="main">)</span> only_vertical_division_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> iv'<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">one_chain_typeII</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> only_horizontal_division<span class="main">(</span>1<span class="main">)</span> only_horizontal_division_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">one_chain_typeII</span> <span class="main">=</span>
                     one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">one_chain_typeI</span>"</span></span>
                    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain_typeI</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">γ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> gen_common_subdivision_imp_eq_line_integral<span class="main">[</span><span class="operator">OF</span> typeII_and_typI_one_chains_have_common_subdiv
          only_horizontal_division<span class="main"><span class="main"><span class="main">(</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span> only_vertical_division<span class="main"><span class="main"><span class="main">(</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span> ii<span class="main">]</span> ii 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> typeI_regions_integral<span class="main">:</span>
    <span class="quoted"><span class="quoted">"integral <span class="free">s</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="var">?F_b'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">one_chain_typeI</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> T1.GreenThm_typeI_divisible_region_boundary_gen T1.valid_typeI_div
          T1.F_anal_valid  only_vertical_division<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> typeII_regions_integral<span class="main">:</span>
    <span class="quoted"><span class="quoted">"integral <span class="free">s</span> <span class="var">?F_a'</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">one_chain_typeII</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> T2.GreenThm_typeII_divisible_region_boundary_gen T2.valid_typeII_div
        T2.F_anal_valid  only_horizontal_division<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> line_integral_dist<span class="main">:</span>
    <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">}</span> <span class="free">one_chain_typeI</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">one_chain_typeI</span> <span class="main">+</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">one_chain_typeI</span> <span class="main">∧</span>
     one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">}</span> <span class="free">one_chain_typeII</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">one_chain_typeII</span> <span class="main">+</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">one_chain_typeII</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_chain_line_integral_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> line_integral_distrib<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">g</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain_typeI</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">=</span>
       <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">g</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain_typeI</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">g</span> <span class="main">+</span>  <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">∧</span>
       <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">g</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain_typeII</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">=</span>
       <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">g</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain_typeII</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">g</span> <span class="main">+</span>  <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">}</span> <span class="skolem">g</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="skolem">g</span> <span class="main">+</span>  <span class="skolem">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="skolem">g</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">g</span><span class="main">)</span> <span class="main">∈</span> <span class="free">one_chain_typeII</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">g</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="skolem">g</span>"</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="skolem">g</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> one_chain_i_integrals one_chain_j_integrals that <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R2.i_is_x_axis R2.j_is_y_axis<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">}</span> <span class="skolem">g</span> <span class="main">=</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="skolem">g</span> <span class="main">+</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="skolem">g</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insert_is_Un line_integral_sum_gen<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">}</span> <span class="skolem">g</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="skolem">g</span> <span class="main">+</span> <span class="skolem">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="skolem">g</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_left<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">}</span> <span class="skolem">g</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="skolem">g</span> <span class="main">+</span>  <span class="skolem">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="skolem">g</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">g</span><span class="main">)</span> <span class="main">∈</span> <span class="free">one_chain_typeI</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">g</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">}</span> <span class="skolem">g</span> <span class="main">=</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="skolem">g</span> <span class="main">+</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="skolem">g</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> that disjoint_insert<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> finite.emptyI finite.insertI R2.i_is_x_axis inf_bot_right insert_absorb insert_commute insert_is_Un R2.j_is_y_axis line_integral_sum_gen<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> one_chain_i_integrals one_chain_j_integrals prod.case_eq_if singleton_inject snd_conv<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">}</span> <span class="skolem">g</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="skolem">g</span> <span class="main">+</span> <span class="skolem">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="skolem">g</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_left<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> 0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> sum.cong split_cong<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">,</span> <span class="bound">g</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain_typeI</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain_typeI</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">,</span> <span class="bound">g</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain_typeI</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">∧</span>
          <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">,</span> <span class="bound">g</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain_typeII</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain_typeII</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">,</span> <span class="bound">g</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain_typeII</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">,</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">,</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                                  <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">,</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">+</span>  <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> comm_monoid_add_class.sum.distrib <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">one_chain_typeI</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">,</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">,</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                    <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">one_chain_typeI</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">,</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⇒</span><span class="main">(</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">g</span> <span class="main">+</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">one_chain_typeII</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
            <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">one_chain_typeII</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⇒</span><span class="main">(</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">g</span> <span class="main">+</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> sum.distrib<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span><span class="main">.</span>  <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span><span class="main">.</span>  <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">one_chain_typeI</span>"</span></span><span class="main">]</span>
          sum.distrib<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span><span class="main">.</span>  <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span><span class="main">.</span>  <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">one_chain_typeII</span>"</span></span><span class="main">]</span>
          line_integral_distrib 1
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> integral_dis<span class="main">:</span> <span class="quoted"><span class="quoted">"integral <span class="free">s</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="var">?F_a'</span> <span class="bound">x</span> <span class="main">-</span> <span class="var">?F_b'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> integral <span class="free">s</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="var">?F_a'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> integral <span class="free">s</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="var">?F_b'</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?F_a'</span> <span class="keyword1">has_integral</span> integral <span class="main">(</span>cubeImage <span class="skolem">twoCube</span><span class="main">)</span> <span class="var">?F_a'</span><span class="main">)</span> <span class="main">(</span>cubeImage <span class="skolem">twoCube</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">twoCube</span> <span class="main">∈</span> <span class="free">two_chain_typeII</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">twoCube</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analytically_valid_imp_part_deriv_integrable_on T2.F_anal_valid has_integral_integrable_integral that<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="main">(</span>cubeImage <span class="main">`</span> <span class="free">two_chain_typeII</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="var">?F_a'</span> <span class="keyword1">has_integral</span> integral <span class="bound">u</span> <span class="var">?F_a'</span><span class="main">)</span> <span class="bound">u</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?F_a'</span> <span class="keyword1">has_integral</span> <span class="main">(</span><span class="main">∑</span><span class="bound">img</span><span class="main">∈</span>cubeImage <span class="main">`</span> <span class="free">two_chain_typeII</span><span class="main">.</span> integral <span class="bound">img</span> <span class="var">?F_a'</span><span class="main">)</span><span class="main">)</span> <span class="free">s</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> T2.valid_typeII_div <span class="keyword1"><span class="command">unfolding</span></span> gen_division_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> has_integral_Union<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> F_a'_integrable<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?F_a'</span> <span class="keyword1">integrable_on</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">twoCube</span> <span class="main">∈</span> <span class="free">two_chain_typeI</span><span class="main">.</span> <span class="main">(</span><span class="var">?F_b'</span> <span class="keyword1">has_integral</span> integral <span class="main">(</span>cubeImage <span class="bound">twoCube</span><span class="main">)</span> <span class="var">?F_b'</span><span class="main">)</span> <span class="main">(</span>cubeImage <span class="bound">twoCube</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> analytically_valid_imp_part_deriv_integrable_on T1.F_anal_valid <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="main">(</span>cubeImage <span class="main">`</span> <span class="free">two_chain_typeI</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="var">?F_b'</span> <span class="keyword1">has_integral</span> integral <span class="bound">u</span> <span class="var">?F_b'</span><span class="main">)</span> <span class="bound">u</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?F_b'</span> <span class="keyword1">has_integral</span> <span class="main">(</span><span class="main">∑</span><span class="bound">img</span><span class="main">∈</span>cubeImage <span class="main">`</span> <span class="free">two_chain_typeI</span><span class="main">.</span> integral <span class="bound">img</span> <span class="var">?F_b'</span><span class="main">)</span><span class="main">)</span> <span class="free">s</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> T1.valid_typeI_div <span class="keyword1"><span class="command">unfolding</span></span> gen_division_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> has_integral_Union<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> F_a'_integrable Henstock_Kurzweil_Integration.integral_diff has_integral_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integral <span class="free">s</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="var">?F_a'</span> <span class="bound">x</span> <span class="main">-</span> <span class="var">?F_b'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">}</span> <span class="free">one_chain_typeI</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> one_chain_j_integrals integral_dis line_integral_dist typeI_regions_integral typeII_regions_integral
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integral <span class="free">s</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="var">?F_a'</span> <span class="bound">x</span> <span class="main">-</span> <span class="var">?F_b'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">}</span> <span class="free">one_chain_typeII</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> one_chain_i_integrals integral_dis line_integral_dist typeI_regions_integral typeII_regions_integral
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Green-GreenThm_typeI_typeII_divisible_region"><span class="command">lemma</span></span> GreenThm_typeI_typeII_divisible_region<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> only_vertical_division<span class="main">:</span>
    <span class="quoted"><span class="quoted">"only_vertical_division <span class="free">one_chain_typeI</span> <span class="free">two_chain_typeI</span>"</span></span>
    <span class="quoted"><span class="quoted">"boundary_chain <span class="free">one_chain_typeI</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    only_horizontal_division<span class="main">:</span>
    <span class="quoted"><span class="quoted">"only_horizontal_division <span class="free">one_chain_typeII</span> <span class="free">two_chain_typeII</span>"</span></span>
    <span class="quoted"><span class="quoted">"boundary_chain <span class="free">one_chain_typeII</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    typeI_and_typII_one_chains_have_common_subdiv<span class="main">:</span>
    <span class="quoted"><span class="quoted">"common_boundary_sudivision_exists <span class="free">one_chain_typeI</span> <span class="free">one_chain_typeII</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"integral <span class="free">s</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="free">i</span> <span class="bound">x</span> <span class="main">-</span> partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="free">j</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">}</span> <span class="free">one_chain_typeI</span>"</span></span>
    <span class="quoted"><span class="quoted">"integral <span class="free">s</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="free">i</span> <span class="bound">x</span> <span class="main">-</span> partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="free">j</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">}</span> <span class="free">one_chain_typeII</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> GreenThm_typeI_typeII_divisible_region' only_vertical_division only_horizontal_division common_subdiv_imp_gen_common_subdiv<span class="main">[</span><span class="operator">OF</span> typeI_and_typII_one_chains_have_common_subdiv<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Green-GreenThm_typeI_typeII_divisible_region_finite_holes"><span class="command">lemma</span></span> GreenThm_typeI_typeII_divisible_region_finite_holes<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> valid_cube_boundary<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span>boundary <span class="free">C</span><span class="main">.</span> valid_path <span class="bound">γ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    only_vertical_division<span class="main">:</span>
    <span class="quoted"><span class="quoted">"only_vertical_division <span class="main">(</span>boundary <span class="free">C</span><span class="main">)</span> <span class="free">two_chain_typeI</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    only_horizontal_division<span class="main">:</span>
    <span class="quoted"><span class="quoted">"only_horizontal_division <span class="main">(</span>boundary <span class="free">C</span><span class="main">)</span> <span class="free">two_chain_typeII</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    s_is_oneCube<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> cubeImage <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"integral <span class="main">(</span>cubeImage <span class="free">C</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="free">i</span> <span class="bound">x</span> <span class="main">-</span> partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="free">j</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span>
                     one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">}</span> <span class="main">(</span>boundary <span class="free">C</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> GreenThm_typeI_typeII_divisible_region<span class="main">[</span><span class="operator">OF</span> only_vertical_division
      two_cube_boundary_is_boundary only_horizontal_division two_cube_boundary_is_boundary
      common_boundary_subdiv_exists_refl<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator"><span class="operator">OF</span></span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main">]</span> s_is_oneCube
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Green-GreenThm_typeI_typeII_divisible_region_equivallent_boundary"><span class="command">lemma</span></span> GreenThm_typeI_typeII_divisible_region_equivallent_boundary<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> 
    gen_divisions<span class="main">:</span> <span class="quoted"><span class="quoted">"gen_division <span class="free">s</span> <span class="main">(</span>cubeImage <span class="main">`</span> <span class="free">two_chain_typeI</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"gen_division <span class="free">s</span> <span class="main">(</span>cubeImage <span class="main">`</span> <span class="free">two_chain_typeII</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    typeI_two_cubes_trace_horizontal_boundaries<span class="main">:</span>
    <span class="quoted"><span class="quoted">"two_chain_horizontal_boundary <span class="free">two_chain_typeI</span> <span class="main">⊆</span> <span class="free">one_chain_typeI</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    typeII_two_cubes_trace_vertical_boundaries<span class="main">:</span>
    <span class="quoted"><span class="quoted">"two_chain_vertical_boundary <span class="free">two_chain_typeII</span> <span class="main">⊆</span> <span class="free">one_chain_typeII</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    boundary_of_region_is_subset_of_partition_boundaries<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">one_chain_typeI</span> <span class="main">⊆</span> two_chain_boundary <span class="free">two_chain_typeI</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">one_chain_typeII</span> <span class="main">⊆</span> two_chain_boundary <span class="free">two_chain_typeII</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    typeI_and_typII_one_chains_have_common_subdiv<span class="main">:</span>
    <span class="quoted"><span class="quoted">"common_boundary_sudivision_exists <span class="free">one_chain_typeI</span> <span class="free">one_chain_typeII</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"integral <span class="free">s</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="free">i</span> <span class="bound">x</span> <span class="main">-</span> partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="free">j</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">}</span> <span class="free">one_chain_typeI</span>"</span></span>
    <span class="quoted"><span class="quoted">"integral <span class="free">s</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="free">i</span> <span class="bound">x</span> <span class="main">-</span> partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="free">j</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">}</span> <span class="free">one_chain_typeII</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F_b'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F_a'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> one_chain_i_integrals<span class="main">:</span>
    <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">one_chain_typeI</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">one_chain_typeII</span> <span class="main">∧</span>
              <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain_typeI</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∧</span>
              <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain_typeII</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">γ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"boundary_chain <span class="free">one_chain_typeI</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> two_chain_boundary_is_boundary_chain boundary_chain_def
        boundary_of_region_is_subset_of_partition_boundaries<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> i'<span class="main">:</span> <span class="quoted"><span class="quoted">"boundary_chain <span class="free">one_chain_typeII</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> two_chain_boundary_is_boundary_chain boundary_chain_def
        boundary_of_region_is_subset_of_partition_boundaries<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span> <span class="bound">γ</span><span class="main">.</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain_typeI</span> <span class="main">⟹</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">γ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> T1.typeI_cube_line_integral_exists_boundary assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_two_chain_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain_typeI</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">γ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>two_chain_boundary <span class="free">two_chain_typeI</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> two_chain_boundary_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> finite_UN_I<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">two_chain_typeI</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> T1.valid_typeI_div finite_imageD gen_division_def valid_two_chain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">two_chain_typeI</span> <span class="main">⟹</span> finite <span class="main">(</span>boundary <span class="bound">a</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_def horizontal_boundary_def vertical_boundary_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">one_chain_typeI</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> boundary_of_region_is_subset_of_partition_boundaries<span class="main">(</span>1<span class="main">)</span> finite_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>two_chain_boundary <span class="free">two_chain_typeII</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> two_chain_boundary_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> finite_UN_I<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">two_chain_typeII</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> T2.valid_typeII_div finite_imageD gen_division_def valid_two_chain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">two_chain_typeII</span> <span class="main">⟹</span> finite <span class="main">(</span>boundary <span class="bound">a</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_def horizontal_boundary_def vertical_boundary_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">one_chain_typeII</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> boundary_of_region_is_subset_of_partition_boundaries<span class="main">(</span>2<span class="main">)</span> finite_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">one_chain_typeI</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">one_chain_typeII</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain_typeII</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">γ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ii common_subdivision_imp_eq_line_integral<span class="main">[</span><span class="operator">OF</span> typeI_and_typII_one_chains_have_common_subdiv
          i i' ii<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> one_chain_j_integrals<span class="main">:</span>
    <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">one_chain_typeI</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">one_chain_typeII</span> <span class="main">∧</span>
              <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain_typeI</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∧</span>
              <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain_typeII</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">γ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"boundary_chain <span class="free">one_chain_typeI</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i'<span class="main">:</span> <span class="quoted"><span class="quoted">"boundary_chain <span class="free">one_chain_typeII</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> two_chain_boundary_is_boundary_chain boundary_of_region_is_subset_of_partition_boundaries
      <span class="keyword1"><span class="command">unfolding</span></span> boundary_chain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="skolem">γ</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain_typeII</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">γ</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> F_is_continuous<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">twoC</span> <span class="main">∈</span> <span class="free">two_chain_typeII</span><span class="main">.</span> continuous_on <span class="main">(</span>cubeImage <span class="bound">twoC</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="bound">a</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> T2.F_anal_valid <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analytically_valid_def<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="skolem">γ</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> that T2.valid_typeII_div
          boundary_of_region_is_subset_of_partition_boundaries<span class="main">(</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> green_typeII_cube.line_integral_exists_on_typeII_Cube_boundaries' assms valid_two_chain_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> two_chain_boundary_def<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> T2.typeII_cube_line_integral_exists_boundary case_prodD subset_iff that two_chain_boundary_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain_typeII</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">γ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>two_chain_boundary <span class="free">two_chain_typeI</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> two_chain_boundary_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> finite_UN_I<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">two_chain_typeI</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> T1.valid_typeI_div finite_imageD gen_division_def valid_two_chain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">two_chain_typeI</span> <span class="main">⟹</span> finite <span class="main">(</span>boundary <span class="bound">a</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_def horizontal_boundary_def vertical_boundary_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> iv<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">one_chain_typeI</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> boundary_of_region_is_subset_of_partition_boundaries<span class="main">(</span>1<span class="main">)</span> finite_subset
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>two_chain_boundary <span class="free">two_chain_typeII</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> two_chain_boundary_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> finite_UN_I<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">two_chain_typeII</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> T2.valid_typeII_div finite_imageD gen_division_def valid_two_chain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">two_chain_typeII</span> <span class="main">⟹</span> finite <span class="main">(</span>boundary <span class="bound">a</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_def horizontal_boundary_def vertical_boundary_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> iv'<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">one_chain_typeII</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> boundary_of_region_is_subset_of_partition_boundaries<span class="main">(</span>2<span class="main">)</span> finite_subset
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> typeII_and_typI_one_chains_have_common_subdiv<span class="main">:</span>
      <span class="quoted"><span class="quoted">"common_boundary_sudivision_exists <span class="free">one_chain_typeII</span> <span class="free">one_chain_typeI</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> typeI_and_typII_one_chains_have_common_subdiv
        common_boundary_sudivision_commutative
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">one_chain_typeI</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">one_chain_typeII</span>"</span></span> 
          <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain_typeI</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">γ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> common_subdivision_imp_eq_line_integral<span class="main">[</span><span class="operator">OF</span> typeII_and_typI_one_chains_have_common_subdiv
          i' i ii iv' iv<span class="main">]</span> ii
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> typeI_regions_integral<span class="main">:</span>
    <span class="quoted"><span class="quoted">"integral <span class="free">s</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="var">?F_b'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">one_chain_typeI</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> T1.GreenThm_typeI_divisible_region_boundary gen_divisions<span class="main">(</span>1<span class="main">)</span>
         typeI_two_cubes_trace_horizontal_boundaries
        boundary_of_region_is_subset_of_partition_boundaries<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> typeII_regions_integral<span class="main">:</span>
    <span class="quoted"><span class="quoted">"integral <span class="free">s</span> <span class="var">?F_a'</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">one_chain_typeII</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> T2.GreenThm_typeII_divisible_region_boundary gen_divisions<span class="main">(</span>2<span class="main">)</span> 
        typeII_two_cubes_trace_vertical_boundaries
        boundary_of_region_is_subset_of_partition_boundaries<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> line_integral_dist<span class="main">:</span>
    <span class="quoted"><span class="quoted">"one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">}</span> <span class="free">one_chain_typeI</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">one_chain_typeI</span> <span class="main">+</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">one_chain_typeI</span> <span class="main">∧</span>
     one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">}</span> <span class="free">one_chain_typeII</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">one_chain_typeII</span> <span class="main">+</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="free">one_chain_typeII</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_chain_line_integral_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> line_integral_distrib<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">g</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain_typeI</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">=</span>
       <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">g</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain_typeI</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">g</span> <span class="main">+</span>  <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">∧</span>
       <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">g</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain_typeII</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">=</span>
       <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">g</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain_typeII</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">g</span> <span class="main">+</span>  <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">}</span> <span class="skolem">g</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="skolem">g</span> <span class="main">+</span>  <span class="skolem">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="skolem">g</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">g</span><span class="main">)</span> <span class="main">∈</span> <span class="free">one_chain_typeII</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">g</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">}</span> <span class="skolem">g</span> <span class="main">=</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="skolem">g</span> <span class="main">+</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="skolem">g</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> line_integral_all<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">}</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="bound">i</span><span class="main">}</span> <span class="skolem">g</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> one_chain_i_integrals one_chain_j_integrals that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> line_integral_sum_gen<span class="main">[</span><span class="operator">OF</span> finite<span class="main">]</span> R2.i_is_x_axis R2.j_is_y_axis line_integral_all <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">}</span> <span class="skolem">g</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="skolem">g</span> <span class="main">+</span> <span class="skolem">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="skolem">g</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_left<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">}</span> <span class="skolem">g</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="skolem">g</span> <span class="main">+</span>  <span class="skolem">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="skolem">g</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span><span class="main">,</span><span class="skolem">g</span><span class="main">)</span> <span class="main">∈</span> <span class="free">one_chain_typeI</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">g</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> line_integral_all<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">}</span><span class="main">.</span> line_integral_exists <span class="free">F</span> <span class="main">{</span><span class="bound">i</span><span class="main">}</span> <span class="skolem">g</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> one_chain_i_integrals one_chain_j_integrals that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">}</span> <span class="skolem">g</span> <span class="main">=</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="skolem">g</span> <span class="main">+</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="skolem">g</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> line_integral_sum_gen<span class="main">[</span><span class="operator">OF</span> finite<span class="main">]</span> R2.i_is_x_axis R2.j_is_y_axis line_integral_all <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">}</span> <span class="skolem">g</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="skolem">g</span> <span class="main">+</span> <span class="skolem">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="skolem">g</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_left<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> 0  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> sum.cong split_cong<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">,</span> <span class="bound">g</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain_typeI</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain_typeI</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">,</span> <span class="bound">g</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain_typeI</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">∧</span>
          <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">,</span> <span class="bound">g</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain_typeII</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain_typeII</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">,</span> <span class="bound">g</span><span class="main">)</span><span class="main">∈</span><span class="free">one_chain_typeII</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">,</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">,</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                                  <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">,</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">+</span>  <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> comm_monoid_add_class.sum.distrib <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">one_chain_typeI</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">,</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">,</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                    <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">one_chain_typeI</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">,</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⇒</span><span class="main">(</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">g</span> <span class="main">+</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">one_chain_typeII</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
            <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">one_chain_typeII</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⇒</span><span class="main">(</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">g</span> <span class="main">+</span> <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> sum.distrib<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span><span class="main">.</span>  <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span><span class="main">.</span>  <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">one_chain_typeI</span>"</span></span><span class="main">]</span>
          sum.distrib<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span><span class="main">.</span>  <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">g</span><span class="main">)</span><span class="main">.</span>  <span class="bound">k</span> <span class="main">*</span> line_integral <span class="free">F</span> <span class="main">{</span><span class="free">j</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">one_chain_typeII</span>"</span></span><span class="main">]</span>
          line_integral_distrib
          1
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> integral_dis<span class="main">:</span> <span class="quoted"><span class="quoted">"integral <span class="free">s</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="var">?F_a'</span> <span class="bound">x</span> <span class="main">-</span> <span class="var">?F_b'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> integral <span class="free">s</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="var">?F_a'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> integral <span class="free">s</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="var">?F_b'</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?F_a'</span> <span class="keyword1">has_integral</span> <span class="main">(</span><span class="main">∑</span><span class="bound">img</span><span class="main">∈</span>cubeImage <span class="main">`</span> <span class="free">two_chain_typeII</span><span class="main">.</span> integral <span class="bound">img</span> <span class="var">?F_a'</span><span class="main">)</span><span class="main">)</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?F_a'</span> <span class="keyword1">has_integral</span> integral <span class="main">(</span>cubeImage <span class="skolem">twoCube</span><span class="main">)</span> <span class="var">?F_a'</span><span class="main">)</span> <span class="main">(</span>cubeImage <span class="skolem">twoCube</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">twoCube</span> <span class="main">∈</span> <span class="free">two_chain_typeII</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">twoCube</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analytically_valid_imp_part_deriv_integrable_on T2.F_anal_valid has_integral_integrable_integral that<span class="main">)</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="main">(</span>cubeImage <span class="main">`</span> <span class="free">two_chain_typeII</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="var">?F_a'</span> <span class="keyword1">has_integral</span> integral <span class="bound">u</span> <span class="var">?F_a'</span><span class="main">)</span> <span class="bound">u</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> gen_divisions<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> gen_division_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> has_integral_Union<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> F_a'_integrable<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?F_a'</span> <span class="keyword1">integrable_on</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?F_b'</span> <span class="keyword1">has_integral</span> <span class="main">(</span><span class="main">∑</span><span class="bound">img</span><span class="main">∈</span>cubeImage <span class="main">`</span> <span class="free">two_chain_typeI</span><span class="main">.</span> integral <span class="bound">img</span> <span class="var">?F_b'</span><span class="main">)</span><span class="main">)</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">twoCube</span> <span class="main">∈</span> <span class="free">two_chain_typeI</span><span class="main">.</span> <span class="main">(</span><span class="var">?F_b'</span> <span class="keyword1">has_integral</span> integral <span class="main">(</span>cubeImage <span class="bound">twoCube</span><span class="main">)</span> <span class="var">?F_b'</span><span class="main">)</span> <span class="main">(</span>cubeImage <span class="bound">twoCube</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analytically_valid_imp_part_deriv_integrable_on T1.F_anal_valid has_integral_integrable_integral<span class="main">)</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="main">(</span>cubeImage <span class="main">`</span> <span class="free">two_chain_typeI</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="var">?F_b'</span> <span class="keyword1">has_integral</span> integral <span class="bound">u</span> <span class="var">?F_b'</span><span class="main">)</span> <span class="bound">u</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> gen_divisions<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> gen_division_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> has_integral_Union<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> F_a'_integrable Henstock_Kurzweil_Integration.integral_diff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integral <span class="free">s</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="var">?F_a'</span> <span class="bound">x</span> <span class="main">-</span> <span class="var">?F_b'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">}</span> <span class="free">one_chain_typeI</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> one_chain_j_integrals integral_dis line_integral_dist typeI_regions_integral typeII_regions_integral
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integral <span class="free">s</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="var">?F_a'</span> <span class="bound">x</span> <span class="main">-</span> <span class="var">?F_b'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">}</span> <span class="free">one_chain_typeII</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> one_chain_i_integrals integral_dis line_integral_dist typeI_regions_integral typeII_regions_integral
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SymmetricR2Shapes">
<div class="head">
<h1>Theory SymmetricR2Shapes</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> SymmetricR2Shapes
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Green.html">Green</a>
<span class="keyword2"><span class="keyword">begin</span></span> 

<span class="keyword1"><span class="command">context</span></span> R2
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="SymmetricR2Shapes-valid_path_valid_swap"><span class="command">lemma</span></span> valid_path_valid_swap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">::</span>real<span class="main">,</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">::</span>real<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="main">(</span>prod.swap <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">,</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> o_def valid_path_def piecewise_C1_differentiable_on_def swap_simp
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">,</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">using</span></span> continuous_on_Pair continuous_on_componentwise<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">,</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_pair_basis valid_path_def piecewise_C1_differentiable_on_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">S</span><span class="main">.</span> finite <span class="bound">S</span> <span class="main">∧</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">,</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="bound">S</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">,</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="skolem">S</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_pair_basis valid_path_def piecewise_C1_differentiable_on_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> S assms
      <span class="keyword1"><span class="command">using</span></span> C1_diff_components_2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">,</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_pair_basis <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> S assms
      <span class="keyword1"><span class="command">using</span></span> C1_diff_components_2 <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">)</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> _ S<span class="main">]</span> real_pair_basis <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">,</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="skolem">S</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 0 1 C1_differentiable_on_components<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">,</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_pair_basis valid_path_def piecewise_C1_differentiable_on_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SymmetricR2Shapes-pair_fun_components"><span class="command">lemma</span></span> pair_fun_components<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">C</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">,</span> <span class="free">C</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_is_x_axis inner_Pair_0 j_is_y_axis<span class="main">)</span>

<span class="keyword1" id="SymmetricR2Shapes-swap_pair_fun"><span class="command">lemma</span></span> swap_pair_fun<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> prod.swap <span class="main">(</span><span class="free">C</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">C</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">,</span> <span class="free">C</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod.swap_def i_is_x_axis inner_Pair_0 j_is_y_axis<span class="main">)</span>

<span class="keyword1" id="SymmetricR2Shapes-swap_pair_fun'"><span class="command">lemma</span></span> swap_pair_fun'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> prod.swap <span class="main">(</span><span class="free">C</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">C</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">,</span> <span class="free">C</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod.swap_def i_is_x_axis inner_Pair_0 j_is_y_axis<span class="main">)</span>

<span class="keyword1" id="SymmetricR2Shapes-swap_pair_fun''"><span class="command">lemma</span></span> swap_pair_fun''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> prod.swap <span class="main">(</span><span class="free">C</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">C</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">,</span> <span class="free">C</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod.swap_def i_is_x_axis inner_Pair_0 j_is_y_axis<span class="main">)</span>

<span class="keyword1" id="SymmetricR2Shapes-swap_pair_fun'''"><span class="command">lemma</span></span> swap_pair_fun'''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> prod.swap <span class="main">(</span><span class="free">C</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">C</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">j</span><span class="main">,</span> <span class="free">C</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod.swap_def i_is_x_axis inner_Pair_0 j_is_y_axis<span class="main">)</span>

<span class="keyword1" id="SymmetricR2Shapes-swap_valid_boundaries"><span class="command">lemma</span></span> swap_valid_boundaries<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span>boundary <span class="free">C</span><span class="main">.</span> valid_path <span class="bound">γ</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span><span class="main">∈</span>boundary <span class="main">(</span>prod.swap <span class="keyword1">o</span> <span class="free">C</span> <span class="keyword1">o</span> prod.swap<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="free">γ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
    valid_path_valid_swap<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">C</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">C</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">j</span>"</span></span><span class="main">]</span> pair_fun_components<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">C</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span>
    pair_fun_components<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">C</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span>           
    valid_path_valid_swap<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">C</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">C</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">j</span>"</span></span><span class="main">]</span> pair_fun_components<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">C</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span>
    pair_fun_components<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">C</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span>           
    valid_path_valid_swap<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">C</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">C</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">j</span>"</span></span><span class="main">]</span> pair_fun_components<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">C</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span>
    pair_fun_components<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">C</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span>           
    valid_path_valid_swap<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">C</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">C</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">j</span>"</span></span><span class="main">]</span> pair_fun_components<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">C</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span>
    pair_fun_components<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">C</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span>           
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_def horizontal_boundary_def vertical_boundary_def
       o_def real_pair_basis swap_pair_fun swap_pair_fun' swap_pair_fun'' swap_pair_fun'''<span class="main">)</span>

<span class="keyword1" id="SymmetricR2Shapes-prod_comp_eq"><span class="command">lemma</span></span> prod_comp_eq<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> prod.swap <span class="keyword1">o</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"prod.swap <span class="keyword1">o</span> <span class="free">f</span>  <span class="main">=</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> swap_comp_swap assms
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="SymmetricR2Shapes-swap_typeI_is_typeII"><span class="command">lemma</span></span> swap_typeI_is_typeII<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"typeI_twoCube <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"typeII_twoCube <span class="main">(</span>prod.swap <span class="keyword1">o</span> <span class="free">C</span> <span class="keyword1">o</span> prod.swap<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> typeI_twoCube_def typeII_twoCube_def<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">g1</span></span> <span class="skolem"><span class="skolem">g2</span></span> <span class="keyword2"><span class="keyword">where</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">a</span> <span class="main">&lt;</span> <span class="skolem">b</span> "</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span><span class="main">.</span> <span class="skolem">g2</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">g1</span> <span class="bound">x</span><span class="main">)</span> "</span></span>
    <span class="quoted"><span class="quoted">"cubeImage <span class="free">C</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">g2</span> <span class="bound">x</span><span class="main">..</span><span class="skolem">g1</span> <span class="bound">x</span><span class="main">}</span><span class="main">}</span> "</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">g2</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">*</span> <span class="skolem">g1</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> "</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">g1</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span> "</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">g2</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> typeI_cube_explicit_spec<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">&lt;</span> <span class="bound">b</span> <span class="main">∧</span>
              <span class="main">(</span><span class="main">∃</span><span class="bound">g1</span> <span class="bound">g2</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">a</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span><span class="main">.</span> <span class="bound">g2</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">g1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span>
                  prod.swap <span class="main">∘</span> <span class="free">C</span> <span class="main">∘</span> prod.swap <span class="main">=</span>
                  <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="bound">g2</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="bound">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">b</span><span class="main">)</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">*</span> <span class="bound">g1</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="bound">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">b</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="bound">a</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                  <span class="bound">g1</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="bound">a</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">g2</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="bound">a</span><span class="main">..</span><span class="bound">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod.swap_def o_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SymmetricR2Shapes-valid_cube_valid_swap"><span class="command">lemma</span></span> valid_cube_valid_swap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_two_cube <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valid_two_cube <span class="main">(</span>prod.swap <span class="keyword1">o</span> <span class="free">C</span> <span class="keyword1">o</span> prod.swap<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> valid_two_cube_def boundary_def horizontal_boundary_def vertical_boundary_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> card_insert_if  <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> swap_swap<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="SymmetricR2Shapes-twoChainVertDiv_of_itself"><span class="command">lemma</span></span> twoChainVertDiv_of_itself<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">C</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="main">(</span>two_chain_boundary <span class="free">C</span><span class="main">)</span><span class="main">.</span> valid_path <span class="bound">γ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"only_vertical_division <span class="main">(</span>two_chain_boundary <span class="free">C</span><span class="main">)</span> <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> only_vertical_division_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">𝒱</span> <span class="bound">ℋ</span><span class="main">.</span> finite <span class="bound">ℋ</span> <span class="main">∧</span> finite <span class="bound">𝒱</span> <span class="main">∧</span>
              <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="bound">𝒱</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>two_chain_vertical_boundary <span class="free">C</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k'</span><span class="main">,</span> <span class="bound">γ'</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">∃</span><span class="bound">a</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">∃</span><span class="bound">b</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≤</span> <span class="bound">b</span> <span class="main">∧</span> subpath <span class="bound">a</span> <span class="bound">b</span> <span class="bound">γ'</span> <span class="main">=</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∧</span>
              <span class="main">(</span>common_sudiv_exists <span class="main">(</span>two_chain_horizontal_boundary <span class="free">C</span><span class="main">)</span> <span class="bound">ℋ</span> <span class="main">∨</span>
               common_reparam_exists <span class="bound">ℋ</span> <span class="main">(</span>two_chain_horizontal_boundary <span class="free">C</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
              boundary_chain <span class="bound">ℋ</span> <span class="main">∧</span> two_chain_boundary <span class="free">C</span> <span class="main">=</span> <span class="bound">𝒱</span> <span class="main">∪</span> <span class="bound">ℋ</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="bound">ℋ</span><span class="main">.</span> valid_path <span class="bound">γ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ℋ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"two_chain_horizontal_boundary <span class="free">C</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="var">?ℋ</span><span class="main">.</span> valid_path <span class="bound">γ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> two_chain_horizontal_boundary_def two_chain_boundary_def boundary_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> two_chain_vertical_boundary <span class="free">C</span> <span class="main">⟹</span>
                  <span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>two_chain_vertical_boundary <span class="free">C</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k'</span><span class="main">,</span> <span class="bound">γ'</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">∃</span><span class="bound">a</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">∃</span><span class="bound">c</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≤</span> <span class="bound">c</span> <span class="main">∧</span> subpath <span class="bound">a</span> <span class="bound">c</span> <span class="bound">γ'</span> <span class="main">=</span> <span class="bound">b</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> atLeastAtMost_iff case_prod_conv le_numeral_extra<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> order_refl subpath_trivial<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"common_sudiv_exists <span class="var">?ℋ</span> <span class="var">?ℋ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> gen_common_boundary_subdiv_exists_refl_twochain_boundary<span class="main">[</span><span class="operator">OF</span> 0 two_chain_horizontal_boundary_is_boundary_chain<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"boundary_chain <span class="var">?ℋ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> two_chain_horizontal_boundary_is_boundary_chain <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> two_chain_boundary <span class="free">C</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∉</span> <span class="var">?ℋ</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> two_chain_vertical_boundary <span class="free">C</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> two_chain_boundary_def two_chain_horizontal_boundary_def two_chain_vertical_boundary_def boundary_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> two_chain_vertical_boundary <span class="free">C</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> two_chain_boundary <span class="free">C</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?ℋ</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> two_chain_boundary <span class="free">C</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> two_chain_boundary_def two_chain_horizontal_boundary_def two_chain_vertical_boundary_def boundary_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?ℋ</span> <span class="main">⟹</span> valid_path <span class="bound">b</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?ℋ</span> <span class="main">∧</span>
           finite <span class="main">(</span>two_chain_vertical_boundary <span class="free">C</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>two_chain_vertical_boundary <span class="free">C</span><span class="main">.</span>
               <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>two_chain_vertical_boundary <span class="free">C</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k'</span><span class="main">,</span> <span class="bound">γ'</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">∃</span><span class="bound">a</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">∃</span><span class="bound">b</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≤</span> <span class="bound">b</span> <span class="main">∧</span> subpath <span class="bound">a</span> <span class="bound">b</span> <span class="bound">γ'</span> <span class="main">=</span> <span class="bound">γ</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span>common_sudiv_exists <span class="var">?ℋ</span> <span class="var">?ℋ</span> <span class="main">∨</span>
            common_reparam_exists <span class="var">?ℋ</span> <span class="var">?ℋ</span><span class="main">)</span> <span class="main">∧</span>
           boundary_chain <span class="var">?ℋ</span> <span class="main">∧</span> two_chain_boundary <span class="free">C</span> <span class="main">=</span> two_chain_vertical_boundary <span class="free">C</span> <span class="main">∪</span> <span class="var">?ℋ</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span><span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="var">?ℋ</span><span class="main">.</span> valid_path <span class="bound">γ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_two_chain_horizontal_boundary<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span> finite_two_chain_vertical_boundary<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">x_coord</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">x_coord</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">t</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="SymmetricR2Shapes-x_coord_smooth"><span class="command">lemma</span></span> x_coord_smooth<span class="main">:</span> <span class="quoted"><span class="quoted">"x_coord <span class="keyword1">C1_differentiable_on</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x_coord_def<span class="main">)</span>

<span class="keyword1" id="SymmetricR2Shapes-x_coord_bounds"><span class="command">lemma</span></span> x_coord_bounds<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">≤</span> x_coord <span class="free">x</span> <span class="main">∧</span> x_coord <span class="free">x</span> <span class="main">≤</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x_coord_def<span class="main">)</span>

<span class="keyword1" id="SymmetricR2Shapes-x_coord_img"><span class="command">lemma</span></span> x_coord_img<span class="main">:</span> <span class="quoted"><span class="quoted">"x_coord <span class="main">`</span> <span class="main">{</span><span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">..</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x_coord_def image_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

<span class="keyword1" id="SymmetricR2Shapes-x_coord_back_img"><span class="command">lemma</span></span> x_coord_back_img<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">∩</span> x_coord <span class="main">-`</span> <span class="main">{</span><span class="free">x</span><span class="main">::</span>real<span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_vimageI inj_on_def x_coord_def<span class="main">)</span>


<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">rot_x</span> <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">::</span>real <span class="keyword1">else</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span> <span class="main">+</span><span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">::</span>real<span class="main">)</span>"</span></span>

<span class="keyword1" id="SymmetricR2Shapes-rot_x_ivl"><span class="command">lemma</span></span> rot_x_ivl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> rot_x <span class="free">x</span> <span class="free">y</span> <span class="main">∧</span> rot_x <span class="free">x</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">a</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">1</span>  <span class="main">⟹</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">&lt;</span> <span class="bound">a</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">a</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">a</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">1</span>  <span class="main">⟹</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">&lt;</span> <span class="bound">a</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">-</span><span class="bound">a</span> <span class="main">≤</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">sos</span> <span class="quoted">"((((A&lt;0 * A&lt;1) * R&lt;1) + (R&lt;1 * (R&lt;1/4 * [2*a + 1]^2))))"</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">1</span>  <span class="main">⟹</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">&lt;</span> <span class="bound">a</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">a</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="bound">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">sos</span> <span class="quoted">"((((A&lt;0 * A&lt;1) * R&lt;1) + (((A&lt;=0 * (A&lt;1 * R&lt;1)) * (R&lt;2/3 * [1]^2)) + (((A&lt;=0 * (A&lt;=2 * R&lt;1)) * (R&lt;2/3 * [1]^2)) + ((A&lt;=0 * (A&lt;=2 * (A&lt;0 * R&lt;1))) * (R&lt;2/3 * [1]^2))))))"</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">a</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">⟹</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">&lt;</span> <span class="bound">a</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">a</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 0 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">y</span> <span class="main">*</span> <span class="numeral">4</span> <span class="main">≤</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="numeral">4</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span> <span class="main">(</span><span class="free">x</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">+</span> <span class="main">(</span><span class="free">x</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">sos</span> <span class="quoted">"((((A&lt;0 * R&lt;1) + ((A&lt;=0 * R&lt;1) * (R&lt;2 * [1]^2)))) &amp; (((A&lt;0 * R&lt;1) + ((A&lt;=0 * R&lt;1) * (R&lt;1/2 * [1]^2)))))"</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> linorder_class.not_le<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">sos</span> <span class="quoted">"(((A&lt;0 * R&lt;1) + (((A&lt;=2 * (A&lt;=3 * R&lt;1)) * (R&lt;1 * [1]^2)) + (((A&lt;=1 * R&lt;1) * (R&lt;1 * [1]^2)) + ((A&lt;=0 * (A&lt;=1 * R&lt;1)) * (R&lt;2 * [1]^2))))))"</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">sos</span> <span class="quoted">"(((A&lt;0 * R&lt;1) + (((A&lt;=2 * R&lt;1) * (R&lt;1 * [1]^2)) + (((A&lt;=1 * (A&lt;=3 * R&lt;1)) * (R&lt;1 * [1]^2)) + ((A&lt;=0 * (A&lt;=2 * R&lt;1)) * (R&lt;2 * [1]^2))))))"</span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> i<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">::</span>real<span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main">]</span> affine_ineq
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> *<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="CircExample">
<div class="head">
<h1>Theory CircExample</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The Circle Example›</span></span>

<span class="keyword1"><span class="command">theory</span></span> CircExample
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Green.html">Green</a> <a href="SymmetricR2Shapes.html">SymmetricR2Shapes</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">locale</span></span> circle <span class="main">=</span> R2 <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">d</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> d_gt_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">d</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">circle_y</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">circle_y</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> sqrt <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">4</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">circle_cube</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">circle_cube</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="free">d</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">y</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">4</span> <span class="main">-</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="bound">x</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="CircExample-circle_cube_nice"><span class="command">lemma</span></span> circle_cube_nice<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"circle_cube <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free">d</span> <span class="main">*</span> x_coord <span class="bound">x</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">y</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> circle_y <span class="main">(</span>x_coord <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> circle_cube_def circle_y_def x_coord_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rot_circle_cube</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rot_circle_cube</span> <span class="main">=</span> prod.swap <span class="main">∘</span> <span class="main">(</span>circle_cube<span class="main">)</span> <span class="main">∘</span> prod.swap"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">rot_y</span> <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">t1</span></span></span><span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span> circle_y <span class="main">(</span>x_coord <span class="main">(</span>rot_x <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">::</span>real<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">x_coord_inv</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::</span>real<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1" id="CircExample-x_coord_inv_1"><span class="command">lemma</span></span> x_coord_inv_1<span class="main">:</span> <span class="quoted"><span class="quoted">"x_coord_inv <span class="main">(</span>x_coord <span class="main">(</span><span class="free">x</span><span class="main">::</span>real<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x_coord_inv_def x_coord_def<span class="main">)</span>

<span class="keyword1" id="CircExample-x_coord_inv_2"><span class="command">lemma</span></span> x_coord_inv_2<span class="main">:</span> <span class="quoted"><span class="quoted">"x_coord <span class="main">(</span>x_coord_inv <span class="main">(</span><span class="free">x</span><span class="main">::</span>real<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x_coord_inv_def x_coord_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">circle_y_inv</span> <span class="main">=</span> circle_y"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">rot_x''</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::</span>real<span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">::</span>real<span class="main">)</span> <span class="main">≡</span> <span class="main">(</span>x_coord_inv <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> circle_y <span class="main">(</span>x_coord <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="CircExample-circle_y_bounds"><span class="command">lemma</span></span> circle_y_bounds<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main">::</span>real<span class="main">)</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> circle_y <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"circle_y <span class="free">x</span> <span class="main">≤</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> circle_y_def real_sqrt_ge_0_iff
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">1</span><span class="main">/</span><span class="numeral">4</span> <span class="main">-</span> <span class="free">x</span> <span class="main">*</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">sos</span> <span class="quoted">"(((A&lt;0 * R&lt;1) + ((A&lt;=0 * (A&lt;=1 * R&lt;1)) * (R&lt;1 * [1]^2))))"</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">4</span> <span class="main">-</span> <span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> real_le_lsqrt<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">sos</span> <span class="quoted">"(((A&lt;0 * R&lt;1) + ((A&lt;=0 * (A&lt;=1 * R&lt;1)) * (R&lt;1 * [1]^2))))"</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="CircExample-circle_y_x_coord_bounds"><span class="command">lemma</span></span> circle_y_x_coord_bounds<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main">::</span>real<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> circle_y <span class="main">(</span>x_coord <span class="free">x</span><span class="main">)</span> <span class="main">∧</span> circle_y <span class="main">(</span>x_coord <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> circle_y_bounds<span class="main">[</span><span class="operator">OF</span> x_coord_bounds<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator"><span class="operator">OF</span></span> assms<span class="main"><span class="main"><span class="main">]</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="CircExample-rot_x_ivl"><span class="command">lemma</span></span> rot_x_ivl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> rot_x'' <span class="free">x</span> <span class="free">y</span> <span class="main">∧</span> rot_x'' <span class="free">x</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">::</span>real<span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">a</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">≤</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">≤</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">y</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="bound">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">sos</span> <span class="quoted">"(((A&lt;0 * R&lt;1) + (((A&lt;=4 * R&lt;1) * (R&lt;1/2 * [1]^2)) + (((A&lt;=1 * (A&lt;=5 * R&lt;1)) * (R&lt;1 * [1]^2)) + ((A&lt;=0 * (A&lt;=4 * R&lt;1)) * (R&lt;1 * [1]^2))))))"</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> rot_x'' <span class="free">x</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms circle_y_x_coord_bounds <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x_coord_inv_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">::</span>real<span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">a</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">≤</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">⟹</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">y</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="bound">a</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">sos</span> <span class="quoted">"(((A&lt;0 * R&lt;1) + (((A&lt;=5 * R&lt;1) * (R&lt;1/2 * [1]^2)) + (((A&lt;=1 * (A&lt;=4 * R&lt;1)) * (R&lt;1 * [1]^2)) + ((A&lt;=0 * (A&lt;=5 * R&lt;1)) * (R&lt;1 * [1]^2))))))"</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rot_x'' <span class="free">x</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms circle_y_x_coord_bounds <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x_coord_inv_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">rot_y''</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::</span>real<span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">::</span>real<span class="main">)</span> <span class="main">≡</span> <span class="main">(</span>x_coord <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span> <span class="main">(</span>circle_y <span class="main">(</span>x_coord <span class="main">(</span>rot_x'' <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>  <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> 

<span class="keyword1" id="CircExample-rot_y_ivl"><span class="command">lemma</span></span> rot_y_ivl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> rot_y'' <span class="free">x</span> <span class="free">y</span> <span class="main">∧</span> rot_y'' <span class="free">x</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> rot_y'' <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>x_coord <span class="free">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">a</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">a</span> <span class="main">+</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">0</span> <span class="main">≤</span> <span class="bound">a</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> sqrt <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">4</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="numeral">4</span><span class="main">)</span> <span class="main">+</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="numeral">4</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="numeral">4</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="numeral">4</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> real_le_rsqrt<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> power2_eq_square mult_left_le_one_le<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">sos</span> <span class="quoted">"(((A&lt;0 * R&lt;1) + ((A&lt;=0 * (A&lt;=1 * (A&lt;=2 * (A&lt;=3 * R&lt;1)))) * (R&lt;4 * [1]^2))))"</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">x</span> <span class="main">-</span> <span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="main">¦</span> <span class="main">=</span> <span class="free">x</span> <span class="main">-</span> <span class="free">x</span> <span class="main">*</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">sos</span> <span class="quoted">"(() &amp; (((((A&lt;0 * A&lt;1) * R&lt;1) + ((A&lt;=0 * (A&lt;=1 * (A&lt;1 * R&lt;1))) * (R&lt;1 * [1]^2)))) &amp; ((((A&lt;0 * A&lt;1) * R&lt;1) + ((A&lt;=0 * (A&lt;=1 * (A&lt;1 * R&lt;1))) * (R&lt;1 * [1]^2))))))"</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> x_coord <span class="free">x</span> <span class="main">+</span> <span class="main">(</span>circle_y <span class="main">(</span>x_coord <span class="main">(</span>rot_x'' <span class="free">x</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x_coord_inv_2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> circle_y_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span> rw x_coord_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> True i <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">::</span>real<span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">a</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">b</span>  <span class="main">⟹</span> <span class="main">(</span><span class="main">0</span> <span class="main">≤</span> <span class="bound">a</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">b</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> circle_y <span class="main">(</span>x_coord <span class="main">(</span>x_coord_inv <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">y</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> circle_y <span class="main">(</span>x_coord <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">x</span> <span class="main">-</span> <span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="main">¦</span> <span class="main">=</span> <span class="free">x</span> <span class="main">-</span> <span class="free">x</span> <span class="main">*</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">sos</span> <span class="quoted">"(() &amp; (((((A&lt;0 * A&lt;1) * R&lt;1) + ((A&lt;=0 * (A&lt;=1 * (A&lt;1 * R&lt;1))) * (R&lt;1 * [1]^2)))) &amp; ((((A&lt;0 * A&lt;1) * R&lt;1) + ((A&lt;=0 * (A&lt;=1 * (A&lt;1 * R&lt;1))) * (R&lt;1 * [1]^2))))))"</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">⟹</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">≤</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">y</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">sos</span> <span class="quoted">"(((A&lt;0 * R&lt;1) + (((A&lt;=4 * R&lt;1) * (R&lt;1/2 * [1]^2)) + (((A&lt;=1 * (A&lt;=5 * R&lt;1)) * (R&lt;1 * [1]^2)) + ((A&lt;=0 * (A&lt;=4 * R&lt;1)) * (R&lt;1 * [1]^2))))))"</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">y</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> circle_y <span class="main">(</span>x_coord <span class="free">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> circle_y_x_coord_bounds assms<span class="main">(</span>1-2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">⟹</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">y</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> assms
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">sos</span> <span class="quoted">"(((A&lt;0 * R&lt;1) + (((A&lt;=5 * R&lt;1) * (R&lt;1/2 * [1]^2)) + (((A&lt;=1 * (A&lt;=4 * R&lt;1)) * (R&lt;1 * [1]^2)) + ((A&lt;=0 * (A&lt;=5 * R&lt;1)) * (R&lt;1 * [1]^2))))))"</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">y</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> circle_y <span class="main">(</span>x_coord <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> circle_y_x_coord_bounds assms<span class="main">(</span>1-2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> circle_y <span class="main">(</span>x_coord <span class="main">(</span>x_coord_inv <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">y</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> circle_y <span class="main">(</span>x_coord <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> circle_y_bounds<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> x_coord_inv_2<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">a</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">a</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rot_y'' <span class="free">x</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>x_coord <span class="free">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">a</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">a</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">⟹</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">≤</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">y</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">sos</span> <span class="quoted">"(((A&lt;0 * R&lt;1) + (((A&lt;=4 * R&lt;1) * (R&lt;1/2 * [1]^2)) + (((A&lt;=1 * (A&lt;=5 * R&lt;1)) * (R&lt;1 * [1]^2)) + ((A&lt;=0 * (A&lt;=4 * R&lt;1)) * (R&lt;1 * [1]^2))))))"</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">y</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> circle_y <span class="main">(</span>x_coord <span class="free">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> circle_y_x_coord_bounds assms<span class="main">(</span>1-2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">⟹</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">y</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">sos</span> <span class="quoted">"(((A&lt;0 * R&lt;1) + (((A&lt;=5 * R&lt;1) * (R&lt;1/2 * [1]^2)) + (((A&lt;=1 * (A&lt;=4 * R&lt;1)) * (R&lt;1 * [1]^2)) + ((A&lt;=0 * (A&lt;=5 * R&lt;1)) * (R&lt;1 * [1]^2))))))"</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">y</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> circle_y <span class="main">(</span>x_coord <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> circle_y_x_coord_bounds assms<span class="main">(</span>1-2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> circle_y <span class="main">(</span>x_coord <span class="main">(</span>x_coord_inv <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">y</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> circle_y <span class="main">(</span>x_coord <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> circle_y_bounds<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> x_coord_inv_2<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True i<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">::</span>real<span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">a</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">≤</span> <span class="bound">b</span>  <span class="main">⟹</span> <span class="main">(</span><span class="bound">a</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">b</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">4</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="numeral">4</span><span class="main">)</span> <span class="main">+</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="numeral">4</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="numeral">4</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="numeral">4</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms False 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x_coord_def<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">sos</span> <span class="quoted">"(((A&lt;0 * R&lt;1) + (((A&lt;=0 * (A&lt;=1 * (A&lt;=2 * R&lt;1))) * (R&lt;2 * [1]^2)) + ((A&lt;=0 * (A&lt;=1 * (A&lt;=2 * (A&lt;=3 * R&lt;1)))) * (R&lt;2 * [1]^2)))))"</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> sqrt <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">4</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="numeral">4</span><span class="main">)</span> <span class="main">+</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="numeral">4</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="numeral">4</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="numeral">4</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> real_sqrt_le_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> sqrt <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">4</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="numeral">4</span><span class="main">)</span> <span class="main">+</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="numeral">4</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="numeral">4</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="numeral">4</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms False <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x_coord_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">x</span> <span class="main">-</span> <span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="main">¦</span> <span class="main">=</span> <span class="free">x</span> <span class="main">-</span> <span class="free">x</span> <span class="main">*</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">sos</span> <span class="quoted">"(() &amp; (((((A&lt;0 * A&lt;1) * R&lt;1) + ((A&lt;=0 * (A&lt;=1 * (A&lt;1 * R&lt;1))) * (R&lt;1 * [1]^2)))) &amp; ((((A&lt;0 * A&lt;1) * R&lt;1) + ((A&lt;=0 * (A&lt;=1 * (A&lt;1 * R&lt;1))) * (R&lt;1 * [1]^2))))))"</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"x_coord <span class="free">x</span> <span class="main">≤</span> circle_y <span class="main">(</span>x_coord <span class="main">(</span>x_coord_inv <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">y</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> circle_y <span class="main">(</span>x_coord <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">unfolding</span></span> x_coord_inv_2
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> circle_y_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span> rw x_coord_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> False i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="CircExample-circle_eq_rot_circle"><span class="command">lemma</span></span> circle_eq_rot_circle<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>circle_cube <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>rot_circle_cube <span class="main">(</span>rot_y'' <span class="free">x</span> <span class="free">y</span><span class="main">,</span> rot_x'' <span class="free">x</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">have</span></span> rw<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">1</span><span class="main">/</span><span class="numeral">4</span> <span class="main">-</span> x_coord <span class="free">x</span> <span class="main">*</span> x_coord <span class="free">x</span><span class="main">¦</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="numeral">4</span> <span class="main">-</span> x_coord <span class="free">x</span> <span class="main">*</span> x_coord <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> abs_of_nonneg<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms mult_left_le <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x_coord_def <span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>circle_cube <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>rot_circle_cube <span class="main">(</span>rot_y'' <span class="free">x</span> <span class="free">y</span><span class="main">,</span> rot_x'' <span class="free">x</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms d_gt_0
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> circle_cube_nice rot_circle_cube_def x_coord_inv_2 circle_y_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span> rw<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x_coord_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">sos</span> <span class="quoted">"(((((A&lt;0 * A&lt;1) * ((A&lt;0 * A&lt;1) * R&lt;1)) + (([~4*d^2] * A=0) + (((A&lt;=1 * (A&lt;=2 * (A&lt;=3 * R&lt;1))) * (R&lt;8 * [d]^2)) + ((A&lt;=1 * (A&lt;=2 * (A&lt;=3 * (A&lt;1 * R&lt;1)))) * (R&lt;8 * [d]^2)))))) &amp; ((((A&lt;0 * A&lt;1) * ((A&lt;0 * A&lt;1) * R&lt;1)) + (([~4*d^2] * A=0) + (((A&lt;=0 * (A&lt;=2 * (A&lt;=3 * R&lt;1))) * (R&lt;8 * [d]^2)) + ((A&lt;=0 * (A&lt;=2 * (A&lt;=3 * (A&lt;1 * R&lt;1)))) * (R&lt;8 * [d]^2)))))))"</span><span class="main">)</span> <span class="comment1">(*Be patient: it takes a bit of time, still better than creeping its proof manually.*)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>circle_cube <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>rot_circle_cube <span class="main">(</span>rot_y'' <span class="free">x</span> <span class="free">y</span><span class="main">,</span> rot_x'' <span class="free">x</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> circle_cube_def rot_circle_cube_def x_coord_inv_def circle_y_def x_coord_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="CircExample-rot_circle_eq_circle"><span class="command">lemma</span></span> rot_circle_eq_circle<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rot_circle_cube <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>circle_cube <span class="main">(</span>rot_x'' <span class="free">y</span> <span class="free">x</span><span class="main">,</span> rot_y'' <span class="free">y</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>rot_circle_cube <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>circle_cube <span class="main">(</span>rot_x'' <span class="free">y</span> <span class="free">x</span><span class="main">,</span> rot_y'' <span class="free">y</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> circle_cube_def rot_circle_cube_def x_coord_inv_def circle_y_def x_coord_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> rw<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">1</span><span class="main">/</span><span class="numeral">4</span> <span class="main">-</span> x_coord <span class="free">y</span> <span class="main">*</span> x_coord <span class="free">y</span><span class="main">¦</span> <span class="main">=</span>  <span class="main">1</span><span class="main">/</span><span class="numeral">4</span> <span class="main">-</span> x_coord <span class="free">y</span> <span class="main">*</span> x_coord <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> abs_of_nonneg<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms mult_left_le <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x_coord_def <span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>rot_circle_cube <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>circle_cube <span class="main">(</span>rot_x'' <span class="free">y</span> <span class="free">x</span><span class="main">,</span> rot_y'' <span class="free">y</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms d_gt_0
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> circle_cube_nice rot_circle_cube_def x_coord_inv_2 circle_y_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span> rw<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x_coord_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">sos</span> <span class="quoted">"(((((A&lt;0 * A&lt;1) * ((A&lt;0 * A&lt;1) * R&lt;1)) + (([~4*d^2] * A=0) + (((A&lt;=0 * (A&lt;=1 * (A&lt;=3 * R&lt;1))) * (R&lt;8 * [d]^2)) + ((A&lt;=0 * (A&lt;=1 * (A&lt;=3 * (A&lt;1 * R&lt;1)))) * (R&lt;8 * [d]^2)))))) &amp; ((((A&lt;0 * A&lt;1) * ((A&lt;0 * A&lt;1) * R&lt;1)) + (([~4*d^2] * A=0) + (((A&lt;=0 * (A&lt;=1 * (A&lt;=2 * R&lt;1))) * (R&lt;8 * [d]^2)) + ((A&lt;=0 * (A&lt;=1 * (A&lt;=2 * (A&lt;1 * R&lt;1)))) * (R&lt;8 * [d]^2)))))))"</span><span class="main">)</span> <span class="comment1">(*Be patient: it takes a bit of time, still better than creeping its proof manually.*)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="CircExample-rot_img_eq"><span class="command">lemma</span></span> rot_img_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cubeImage <span class="main">(</span>circle_cube <span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>cubeImage <span class="main">(</span>rot_circle_cube<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cubeImage_def image_def cbox_def real_pair_basis<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> rot_y_ivl rot_x_ivl assms circle_eq_rot_circle rot_circle_eq_circle<span class="main">)</span><span class="main"><span class="keyword3">+</span></span> 

<span class="keyword1" id="CircExample-rot_circle_div_circle"><span class="command">lemma</span></span> rot_circle_div_circle<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">d</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"gen_division <span class="main">(</span>cubeImage circle_cube<span class="main">)</span> <span class="main">(</span>cubeImage <span class="main">`</span> <span class="main">{</span>rot_circle_cube<span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> rot_img_eq<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gen_division_def<span class="main">)</span>

<span class="keyword1" id="CircExample-circle_cube_boundary_valid"><span class="command">lemma</span></span> circle_cube_boundary_valid<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span><span class="main">∈</span>boundary circle_cube"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="free">γ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> f01<span class="main">:</span> <span class="quoted"><span class="quoted">"finite<span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">unfolding</span></span> boundary_def horizontal_boundary_def vertical_boundary_def circle_cube_def valid_path_def piecewise_C1_differentiable_on_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">safe</span> <span class="main">(</span><span class="operator">rule</span> <span class="dynamic"><span class="dynamic">derivative_intros</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span> f01 exI ballI conjI refl <span class="main"><span class="keyword3">|</span></span> <span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="CircExample-rot_circle_cube_boundary_valid"><span class="command">lemma</span></span> rot_circle_cube_boundary_valid<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span><span class="main">∈</span>boundary rot_circle_cube"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="free">γ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms swap_valid_boundaries circle_cube_boundary_valid
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rot_circle_cube_def<span class="main">)</span>

<span class="keyword1" id="CircExample-diff_divide_cancel"><span class="command">lemma</span></span> diff_divide_cancel<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">z</span><span class="main">::</span><span class="quoted">real</span> <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≠</span> <span class="main">0</span>  <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">z</span> <span class="main">-</span> <span class="free">a</span> <span class="main">*</span> <span class="main">(</span><span class="free">b</span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

<span class="keyword1" id="CircExample-circle_cube_is_type_I"><span class="command">lemma</span></span> circle_cube_is_type_I<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"typeI_twoCube circle_cube"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> typeI_twoCube_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI ballI<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f01<span class="main">:</span> <span class="quoted"><span class="quoted">"finite<span class="main">{</span><span class="main">-</span><span class="free">d</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span><span class="free">d</span><span class="main">/</span><span class="numeral">2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">d</span><span class="main">/</span><span class="numeral">2</span> <span class="main">&lt;</span> <span class="free">d</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">d</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">4</span> <span class="main">-</span> <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="free">d</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="free">d</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">-</span> <span class="free">d</span><span class="main">/</span><span class="numeral">2</span><span class="main">..</span><span class="free">d</span><span class="main">/</span><span class="numeral">2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> piecewise_C1_differentiable_on_def   
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ballI refl f01 <span class="dynamic"><span class="dynamic">derivative_intros</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span> <span class="main"><span class="keyword3">|</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">sos</span>
   <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span><span class="free">d</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">4</span> <span class="main">-</span> <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="free">d</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="free">d</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">-</span> <span class="free">d</span><span class="main">/</span><span class="numeral">2</span><span class="main">..</span><span class="free">d</span><span class="main">/</span><span class="numeral">2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> piecewise_C1_differentiable_on_def   
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ballI refl f01 <span class="dynamic"><span class="dynamic">derivative_intros</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span> <span class="main"><span class="keyword3">|</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">sos</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free">d</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">4</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">/</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">4</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">/</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">-</span> <span class="free">d</span><span class="main">/</span><span class="numeral">2</span><span class="main">..</span><span class="free">d</span><span class="main">/</span><span class="numeral">2</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">≤</span> <span class="main">(</span><span class="free">d</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> real_sqrt_le_iff that <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mult_right_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> assms * <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> power2_eq_square<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> circle_cube_def <span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> diff_divide_cancel<span class="main">)</span>

<span class="keyword1" id="CircExample-rot_circle_cube_is_type_II"><span class="command">lemma</span></span> rot_circle_cube_is_type_II<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"typeII_twoCube rot_circle_cube"</span></span>
  <span class="keyword1"><span class="command">using</span></span> d_gt_0 swap_typeI_is_typeII circle_cube_is_type_I
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rot_circle_cube_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">circle_bot_edge</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">circle_bot_edge</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>x_coord <span class="bound">t</span> <span class="main">*</span> <span class="free">d</span><span class="main">,</span> <span class="main">-</span> <span class="free">d</span> <span class="main">*</span> circle_y <span class="main">(</span>x_coord <span class="bound">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">circle_top_edge</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">circle_top_edge</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>x_coord <span class="bound">t</span> <span class="main">*</span> <span class="free">d</span><span class="main">,</span> <span class="free">d</span> <span class="main">*</span> circle_y <span class="main">(</span>x_coord <span class="bound">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">circle_right_edge</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">circle_right_edge</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="free">d</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">circle_left_edge</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">circle_left_edge</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="free">d</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="CircExample-circle_cube_boundary_explicit"><span class="command">lemma</span></span> circle_cube_boundary_explicit<span class="main">:</span>
    <span class="quoted"><span class="quoted">"boundary circle_cube <span class="main">=</span> <span class="main">{</span>circle_left_edge<span class="main">,</span>circle_right_edge<span class="main">,</span>circle_bot_edge<span class="main">,</span>circle_top_edge<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_two_cube_def boundary_def horizontal_boundary_def vertical_boundary_def circle_cube_def 
      circle_top_edge_def circle_bot_edge_def circle_cube_nice x_coord_def circle_y_def
      circle_left_edge_def circle_right_edge_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rot_circle_right_edge</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rot_circle_right_edge</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="free">d</span> <span class="main">*</span> circle_y <span class="main">(</span>x_coord <span class="bound">t</span><span class="main">)</span><span class="main">,</span> x_coord <span class="bound">t</span> <span class="main">*</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rot_circle_left_edge</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rot_circle_left_edge</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span> <span class="free">d</span> <span class="main">*</span> circle_y <span class="main">(</span>x_coord <span class="bound">t</span><span class="main">)</span><span class="main">,</span> x_coord <span class="bound">t</span> <span class="main">*</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rot_circle_top_edge</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rot_circle_top_edge</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">d</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rot_circle_bot_edge</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rot_circle_bot_edge</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="main">-</span> <span class="main">(</span><span class="free">d</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="CircExample-rot_circle_cube_boundary_explicit"><span class="command">lemma</span></span> rot_circle_cube_boundary_explicit<span class="main">:</span>
    <span class="quoted"><span class="quoted">"boundary <span class="main">(</span>rot_circle_cube<span class="main">)</span> <span class="main">=</span>
           <span class="main">{</span>rot_circle_top_edge<span class="main">,</span>rot_circle_bot_edge<span class="main">,</span>rot_circle_right_edge<span class="main">,</span>rot_circle_left_edge<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rot_circle_cube_def valid_two_cube_def boundary_def horizontal_boundary_def vertical_boundary_def circle_cube_def
      rot_circle_right_edge_def rot_circle_left_edge_def x_coord_def circle_y_def rot_circle_top_edge_def rot_circle_bot_edge_def<span class="main">)</span>

<span class="keyword1" id="CircExample-rot_circle_cube_vertical_boundary_explicit"><span class="command">lemma</span></span> rot_circle_cube_vertical_boundary_explicit<span class="main">:</span>
    <span class="quoted"><span class="quoted">"vertical_boundary rot_circle_cube <span class="main">=</span> <span class="main">{</span>rot_circle_right_edge<span class="main">,</span>rot_circle_left_edge<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rot_circle_cube_def valid_two_cube_def vertical_boundary_def circle_cube_def
      rot_circle_right_edge_def rot_circle_left_edge_def x_coord_def circle_y_def<span class="main">)</span>

<span class="keyword1" id="CircExample-circ_left_edge_neq_top"><span class="command">lemma</span></span> circ_left_edge_neq_top<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="free">d</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="free">d</span><span class="main">,</span> <span class="free">d</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">4</span> <span class="main">-</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> add_diff_cancel_right' d_gt_0 mult.commute mult_cancel_left order_less_irrefl prod.inject<span class="main">)</span>

<span class="keyword1" id="CircExample-circle_cube_valid_two_cube"><span class="command">lemma</span></span> circle_cube_valid_two_cube<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_two_cube <span class="main">(</span>circle_cube<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_two_cube_def boundary_def horizontal_boundary_def vertical_boundary_def circle_cube_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> iv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="free">d</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="free">d</span><span class="main">,</span> <span class="free">d</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">4</span> <span class="main">-</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> d_gt_0  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> add_diff_cancel_right' add_uminus_conv_diff cancel_comm_monoid_add_class.diff_cancel less_eq_real_def linorder_not_le mult.left_neutral prod.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="free">d</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="free">d</span><span class="main">,</span> <span class="main">-</span> <span class="main">(</span><span class="free">d</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">4</span> <span class="main">-</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> d_gt_0  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> diff_0 equal_neg_zero mult_zero_left nonzero_mult_div_cancel_left order_less_irrefl prod.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> times_divide_eq_right zero_neq_numeral<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" card <span class="main">{</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="free">d</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="free">d</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="free">d</span><span class="main">,</span> <span class="main">-</span> <span class="main">(</span><span class="free">d</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">4</span> <span class="main">-</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
                   <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="free">d</span><span class="main">,</span> <span class="free">d</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">4</span> <span class="main">-</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="numeral">4</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> iv v <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="CircExample-rot_circle_cube_valid_two_cube"><span class="command">lemma</span></span> rot_circle_cube_valid_two_cube<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valid_two_cube rot_circle_cube"</span></span>
  <span class="keyword1"><span class="command">using</span></span> valid_cube_valid_swap circle_cube_valid_two_cube d_gt_0 rot_circle_cube_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">circle_arc_0</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">circle_arc_0</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">t</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="CircExample-circle_top_bot_edges_neq'"><span class="command">lemma</span></span> circle_top_bot_edges_neq' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"circle_top_edge <span class="main">≠</span> circle_bot_edge"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> circle_top_edge_def circle_bot_edge_def<span class="main">)</span>

<span class="keyword1" id="CircExample-rot_circle_top_left_edges_neq"><span class="command">lemma</span></span> rot_circle_top_left_edges_neq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rot_circle_top_edge <span class="main">≠</span> rot_circle_left_edge"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rot_circle_left_edge_def rot_circle_top_edge_def x_coord_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> cancel_comm_monoid_add_class.diff_cancel d_gt_0 divide_eq_0_iff mult_zero_left order_less_irrefl prod.sel<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> zero_neq_numeral<span class="main">)</span>

<span class="keyword1" id="CircExample-rot_circle_bot_left_edges_neq"><span class="command">lemma</span></span> rot_circle_bot_left_edges_neq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rot_circle_bot_edge <span class="main">≠</span> rot_circle_left_edge"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rot_circle_left_edge_def rot_circle_bot_edge_def x_coord_def<span class="main">)</span>

<span class="keyword1" id="CircExample-rot_circle_top_right_edges_neq"><span class="command">lemma</span></span> rot_circle_top_right_edges_neq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rot_circle_top_edge <span class="main">≠</span> rot_circle_right_edge"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rot_circle_right_edge_def rot_circle_top_edge_def x_coord_def<span class="main">)</span>

<span class="keyword1" id="CircExample-rot_circle_bot_right_edges_neq"><span class="command">lemma</span></span> rot_circle_bot_right_edges_neq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rot_circle_bot_edge <span class="main">≠</span> rot_circle_right_edge"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rot_circle_right_edge_def rot_circle_bot_edge_def x_coord_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> cancel_comm_monoid_add_class.diff_cancel d_gt_0 divide_eq_0_iff mult_zero_left neg_0_equal_iff_equal order_less_irrefl prod.sel<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> zero_neq_numeral<span class="main">)</span>

<span class="keyword1" id="CircExample-rot_circle_right_top_edges_neq'"><span class="command">lemma</span></span> rot_circle_right_top_edges_neq' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rot_circle_right_edge <span class="main">≠</span> rot_circle_left_edge"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rot_circle_left_edge_def rot_circle_right_edge_def<span class="main">)</span>

<span class="keyword1" id="CircExample-rot_circle_left_bot_edges_neq"><span class="command">lemma</span></span> rot_circle_left_bot_edges_neq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rot_circle_left_edge <span class="main">≠</span> rot_circle_top_edge"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rot_circle_top_edge_def rot_circle_left_edge_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> cancel_comm_monoid_add_class.diff_cancel d_gt_0 mult.commute mult_zero_right nonzero_mult_div_cancel_left order_less_irrefl prod.sel<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> times_divide_eq_right x_coord_def zero_neq_numeral<span class="main">)</span>

<span class="keyword1" id="CircExample-circle_right_top_edges_neq"><span class="command">lemma</span></span> circle_right_top_edges_neq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"circle_right_edge <span class="main">≠</span> circle_top_edge"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"circle_right_edge <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span><span class="free">d</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">,</span> <span class="main">0</span><span class="main">::</span>real<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> circle.circle_right_edge_def circle_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> circle.circle_top_edge_def circle_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="CircExample-circle_left_bot_edges_neq"><span class="command">lemma</span></span> circle_left_bot_edges_neq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"circle_left_edge <span class="main">≠</span> circle_bot_edge"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"circle_bot_edge <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span>x_coord <span class="bound">r</span> <span class="main">*</span> <span class="free">d</span><span class="main">,</span> <span class="main">-</span> <span class="free">d</span> <span class="main">*</span> circle_y <span class="main">(</span>x_coord <span class="bound">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> circle.circle_bot_edge_def circle_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> circle_left_edge_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="CircExample-circle_left_top_edges_neq"><span class="command">lemma</span></span> circle_left_top_edges_neq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"circle_left_edge <span class="main">≠</span> circle_top_edge"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">r</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="free">d</span><span class="main">,</span> <span class="free">d</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">4</span> <span class="main">-</span> <span class="main">(</span><span class="bound">r</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">r</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="free">d</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circ_left_edge_neq_top<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">d</span> <span class="main">*</span> <span class="bound">r</span> <span class="main">≠</span> <span class="main">-</span> <span class="main">(</span><span class="free">d</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">r</span> <span class="bound">ra</span><span class="main">.</span> <span class="main">(</span>x_coord <span class="main">(</span>x_coord_inv <span class="bound">r</span><span class="main">)</span> <span class="main">*</span> <span class="free">d</span><span class="main">,</span> <span class="free">d</span> <span class="main">*</span> circle_y <span class="main">(</span>x_coord <span class="main">(</span>x_coord_inv <span class="bound">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>x_coord <span class="bound">ra</span> <span class="main">*</span> <span class="free">d</span><span class="main">,</span> <span class="free">d</span> <span class="main">*</span> circle_y <span class="main">(</span>x_coord <span class="bound">ra</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="free">d</span> <span class="main">*</span> circle_y <span class="bound">r</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span>x_coord <span class="bound">r</span> <span class="main">*</span> <span class="free">d</span><span class="main">,</span> <span class="free">d</span> <span class="main">*</span> circle_y <span class="main">(</span>x_coord <span class="bound">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="free">d</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.commute prod.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> x_coord_inv_2<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> circle_left_edge_def circle_top_edge_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="CircExample-circle_right_bot_edges_neq"><span class="command">lemma</span></span> circle_right_bot_edges_neq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"circle_right_edge <span class="main">≠</span> circle_bot_edge"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Pair_inject circle_bot_edge_def d_gt_0 circle.circle_right_edge_def circle_axioms mult_le_cancel_iff1 x_coord_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">circle_polar</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">circle_polar</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">d</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>  <span class="main">*</span> cos <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free">d</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> sin <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="CircExample-circle_polar_smooth"><span class="command">lemma</span></span> circle_polar_smooth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>circle_polar<span class="main">)</span> <span class="keyword1">C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj <span class="main">(</span><span class="main">(*)</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> finite <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">∩</span> <span class="main">(*)</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">-`</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_vimageI<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">d</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>  <span class="main">*</span> cos <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="bound">t</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free">d</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> sin <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> * <span class="dynamic"><span class="dynamic">derivative_intros</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> eq_smooth_gen<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> circle_polar_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">custom_arccos</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">-</span><span class="main">1</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">1</span> <span class="keyword1">then</span> arccos <span class="bound">x</span> <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span> <span class="keyword1">then</span> <span class="main">-</span><span class="bound">x</span> <span class="main">+</span> pi <span class="keyword1">else</span> <span class="main">1</span> <span class="main">-</span><span class="bound">x</span> <span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="CircExample-cont_custom_arccos"><span class="command">lemma</span></span> cont_custom_arccos<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">-</span><span class="main">1</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="free">S</span> custom_arccos"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span><span class="main">{</span><span class="main">-</span><span class="main">1</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{}</span><span class="main">)</span> custom_arccos"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> continuous_on_cases <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> continuous_on_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="CircExample-custom_arccos_has_deriv"><span class="command">lemma</span></span> custom_arccos_has_deriv<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">DERIV</span> custom_arccos <span class="free">x</span> <span class="main">:&gt;</span> inverse <span class="main">(</span><span class="main">-</span> sqrt <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> x1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">x</span><span class="main">¦</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&lt;</span> <span class="main">1</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_less_iff abs_square_less_1 assms<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> DERIV_inverse_function <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">cos</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> a<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">-</span></span><span class="main"><span class="main">1</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> b<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> x1 <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> <span class="main"><span class="keyword3">|</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sin_arccos<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms x1 cont_custom_arccos <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">-</span><span class="main">1</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span><span class="main">]</span> 
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> continuous_on_eq_continuous_at greaterThanLessThan_subseteq_atLeastAtMost_iff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">declare</span></span> 
  custom_arccos_has_deriv<span class="main">[</span><span class="operator">THEN</span> DERIV_chain2<span class="main">,</span> <span class="operator">derivative_intros</span><span class="main">]</span>
  custom_arccos_has_deriv<span class="main">[</span><span class="operator">THEN</span> DERIV_chain2<span class="main">,</span> <span class="operator">unfolded</span> has_field_derivative_def<span class="main">,</span> <span class="operator">derivative_intros</span><span class="main">]</span>

<span class="keyword1" id="CircExample-circle_boundary_reparams"><span class="command">lemma</span></span> circle_boundary_reparams<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> rot_circ_left_edge_reparam_polar_circ_split<span class="main">:</span>
    <span class="quoted"><span class="quoted">"reparam <span class="main">(</span>rec_join <span class="main">[</span><span class="main">(</span>rot_circle_left_edge<span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>rec_join <span class="main">[</span><span class="main">(</span>subcube <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> circle_polar<span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subcube <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="numeral">3</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> circle_polar<span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?P1</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> circ_top_edge_reparam_polar_circ_split<span class="main">:</span>
    <span class="quoted"><span class="quoted">"reparam <span class="main">(</span>rec_join <span class="main">[</span><span class="main">(</span>circle_top_edge<span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>rec_join <span class="main">[</span><span class="main">(</span>subcube <span class="main">0</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> circle_polar<span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subcube <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> circle_polar<span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?P2</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> circ_bot_edge_reparam_polar_circ_split<span class="main">:</span>
    <span class="quoted"><span class="quoted">"reparam <span class="main">(</span>rec_join <span class="main">[</span><span class="main">(</span>circle_bot_edge<span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>rec_join <span class="main">[</span><span class="main">(</span>subcube <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="numeral">3</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> circle_polar<span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subcube <span class="main">(</span><span class="numeral">3</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span> <span class="main">1</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> circle_polar<span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?P3</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> rot_circ_right_edge_reparam_polar_circ_split<span class="main">:</span>
    <span class="quoted"><span class="quoted">"reparam <span class="main">(</span>rec_join <span class="main">[</span><span class="main">(</span>rot_circle_right_edge<span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>rec_join <span class="main">[</span><span class="main">(</span>subcube <span class="main">(</span><span class="numeral">3</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span> <span class="main">1</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> circle_polar<span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>subcube <span class="main">0</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> circle_polar<span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?P4</span></span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?φ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(*)</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span>pi<span class="main">)</span> <span class="main">∘</span> custom_arccos <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> x_coord <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?LHS1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="free">d</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">4</span> <span class="main">-</span> x_coord <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> x_coord <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> x_coord <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?RHS1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">≤</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free">d</span> <span class="main">*</span> cos <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span><span class="main">/</span><span class="numeral">4</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="free">d</span> <span class="main">*</span> sin <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span><span class="main">/</span><span class="numeral">4</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>
                        <span class="keyword1">else</span> <span class="main">(</span><span class="free">d</span> <span class="main">*</span> cos <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="numeral">4</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="free">d</span> <span class="main">*</span> sin <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="numeral">4</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="var">?φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?LHS2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>x_coord <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">d</span><span class="main">,</span> <span class="free">d</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">4</span> <span class="main">-</span> x_coord <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> x_coord <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?RHS2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">≤</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free">d</span> <span class="main">*</span> cos <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">*</span> pi<span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="free">d</span> <span class="main">*</span> sin <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">*</span> pi<span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="free">d</span> <span class="main">*</span> cos <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="numeral">4</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="free">d</span> <span class="main">*</span> sin <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="numeral">4</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="var">?φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?LHS3</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>x_coord <span class="bound">x</span> <span class="main">*</span> <span class="free">d</span><span class="main">,</span> <span class="main">-</span> <span class="main">(</span><span class="free">d</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">4</span> <span class="main">-</span> x_coord <span class="bound">x</span> <span class="main">*</span> x_coord <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?RHS3</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">≤</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free">d</span> <span class="main">*</span> cos <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span><span class="main">/</span><span class="numeral">4</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="free">d</span> <span class="main">*</span> sin <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span><span class="main">/</span><span class="numeral">4</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> 
                  <span class="keyword1">else</span> <span class="main">(</span><span class="free">d</span> <span class="main">*</span> cos <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="numeral">4</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="free">d</span> <span class="main">*</span> sin <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="numeral">4</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?LHS4</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">d</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">4</span> <span class="main">-</span> x_coord <span class="bound">x</span> <span class="main">*</span> x_coord <span class="bound">x</span><span class="main">)</span><span class="main">,</span> x_coord <span class="bound">x</span> <span class="main">*</span> <span class="free">d</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?RHS4</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">≤</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free">d</span> <span class="main">*</span> cos <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span><span class="main">/</span><span class="numeral">4</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="free">d</span> <span class="main">*</span> sin <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span><span class="main">/</span><span class="numeral">4</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> 
                 <span class="keyword1">else</span> <span class="main">(</span><span class="free">d</span> <span class="main">*</span> cos <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> pi<span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="free">d</span> <span class="main">*</span> sin <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> pi<span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> phi_diff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?φ</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> piecewise_C1_differentiable_on_def
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="var">?φ</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> x_coord_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> continuous_on_compose cont_custom_arccos <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?φ</span> <span class="keyword1">C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> x_coord_def piecewise_C1_differentiable_on_def C1_differentiable_on_def valid_path_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="keyword3">|</span></span> <span class="operator">rule</span> has_vector_derivative_pair_within DERIV_image_chain <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span> exI ballI conjI 
          <span class="main"><span class="keyword3">|</span></span> <span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> <span class="main"><span class="keyword3">|</span></span> <span class="operator">sos</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s</span><span class="main">.</span> finite <span class="bound">s</span> <span class="main">∧</span> <span class="var">?φ</span> <span class="keyword1">C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">-</span> <span class="bound">s</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> inj<span class="main">:</span> <span class="quoted"><span class="quoted">"inj <span class="var">?φ</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> comp_inj_on inj_on_cases inj_on_arccos<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_on_def x_coord_def<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> pi_ge_zero <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">smt</span> arccos<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> arccos_lbound<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">⟦</span><span class="main">0</span> <span class="main">≤</span> <span class="bound">x</span><span class="main">;</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">1</span><span class="main">⟧</span> <span class="main">⟹</span> finite <span class="main">(</span><span class="var">?φ</span> <span class="main">-`</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_vimageI<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?φ</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?φ</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x_coord_def <span class="dynamic"><span class="dynamic">divide_simps</span></span> arccos_lbound arccos_bounded<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arccos <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> cos <span class="main">(</span><span class="skolem">x</span> <span class="main">*</span> pi<span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">*</span> pi"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> arccos_cos<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">⊆</span> <span class="var">?φ</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> x_coord_def o_def image_def<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> cos <span class="main">(</span><span class="improper">x</span> <span class="main">*</span> pi<span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> bij_phi<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="var">?φ</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def <span class="keyword1"><span class="command">using</span></span> inj inj_on_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">have</span></span> phi01<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?φ</span> <span class="main">-`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subset_iff x_coord_def <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">1</span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"cos <span class="main">(</span>pi <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> arccos <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span>sin <span class="main">(</span>arccos <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> minus_sin_cos_eq<span class="main">[</span><span class="operator">symmetric</span><span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?x</span> <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"arccos <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">)</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> sqrt <span class="main">(</span><span class="numeral">4</span><span class="main">*</span><span class="skolem">x</span> <span class="main">-</span> <span class="numeral">4</span><span class="main">*</span><span class="skolem">x</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.assoc real_sqrt_four real_sqrt_mult right_diff_distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sqrt <span class="main">(</span><span class="main">1</span>  <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> iii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> cos <span class="main">(</span>arcsin <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="numeral">2</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span>  sin <span class="main">(</span>arccos <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> arccos_minus<span class="main">[</span><span class="operator">OF</span> i<span class="main">]</span>  <span class="keyword1"><span class="command">unfolding</span></span> minus_diff_eq sin_pi_minus
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cos_arcsin i power2_eq_square sin_arccos<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?LHS1</span> <span class="skolem">x</span> <span class="main">=</span> <span class="var">?RHS1</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> d_gt_0 i x <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x_coord_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diff_divide_distrib add_divide_distrib right_diff_distrib mult.commute ii<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> cos_sin_eq<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?x</span> <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> arccos <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">)</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cos_sin_eq<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?x</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> arccos <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span> right_diff_distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?LHS2</span> <span class="skolem">x</span> <span class="main">=</span> <span class="var">?RHS2</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x d_gt_0 iii <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x_coord_def diff_divide_distrib <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"cos <span class="main">(</span>pi <span class="main">/</span> <span class="numeral">2</span> <span class="main">-</span> arccos <span class="main">(</span><span class="skolem">x</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> cos <span class="main">(</span>pi <span class="main">/</span> <span class="numeral">2</span> <span class="main">-</span> arccos <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> arccos_minus arccos_cos2 arccos_lbound cos_arccos cos_ge_minus_one cos_le_one i<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> i<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> pi_def pi_half<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"cos <span class="main">(</span>arccos <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> pi <span class="main">*</span> <span class="numeral">3</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> cos <span class="main">(</span><span class="main">(</span>pi <span class="main">/</span> <span class="numeral">2</span> <span class="main">-</span> arccos <span class="main">(</span><span class="skolem">x</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> arccos_minus<span class="main">[</span><span class="operator">OF</span> i<span class="main">]</span>  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute add.commute<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cos <span class="main">(</span>pi <span class="main">/</span> <span class="numeral">2</span> <span class="main">-</span> arccos <span class="main">(</span><span class="skolem">x</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cos_periodic <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="main">(</span><span class="main">-</span> pi <span class="main">-</span> arccos <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> cos <span class="main">(</span><span class="main">-</span> <span class="main">(</span>pi <span class="main">+</span> arccos <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> minus_add<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> b <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"pi"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> a <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"arccos <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">)</span>"</span></span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cos <span class="main">(</span><span class="main">(</span>pi <span class="main">+</span> arccos <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> cos_minus <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cos <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi <span class="main">-</span> arccos <span class="main">(</span><span class="skolem">x</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> arccos_minus<span class="main">[</span><span class="operator">OF</span> i<span class="main">]</span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute add.commute<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cos <span class="main">(</span>arccos <span class="main">(</span><span class="skolem">x</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> cos_2pi_minus <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"cos <span class="main">(</span><span class="main">-</span> pi <span class="main">-</span> arccos <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> cos_arccos<span class="main">[</span><span class="operator">OF</span> i<span class="main">]</span> mult.commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">have</span></span> cosm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> cos <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> pi<span class="main">*</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> cos <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cos_periodic eq_diff_eq' mult.commute<span class="main">)</span> 
    <span class="keyword1"><span class="command">have</span></span> 34<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?LHS3</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="var">?RHS3</span>  <span class="main">∘</span> <span class="var">?φ</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="var">?LHS4</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="var">?RHS4</span> <span class="main">∘</span> <span class="var">?φ</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> d_gt_0 x a b c iii cos_periodic <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"pi <span class="main">/</span> <span class="numeral">2</span> <span class="main">-</span> arccos <span class="main">(</span><span class="skolem">x</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span><span class="main">]</span> 
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x_coord_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span> diff_divide_distrib power2_eq_square<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sin_cos_eq cosm<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> d <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> right_diff_distrib<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> cos_minus<span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> 1 2 34
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> * <span class="main">=</span> this
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?P1</span></span></span> <span class="var"><span class="quoted"><span class="var">?P2</span></span></span> <span class="var"><span class="quoted"><span class="var">?P3</span></span></span> <span class="var"><span class="quoted"><span class="var">?P4</span></span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subcube_def circle_bot_edge_def circle_top_edge_def circle_polar_def reversepath_def 
               subpath_def joinpaths_def circle_y_def rot_circle_left_edge_def rot_circle_right_edge_def<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> reparam_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ballI exI conjI impI phi_diff bij_phi phi01 fin * <span class="main"><span class="keyword3">|</span></span> <span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x_coord_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">circle_cube_boundary_to_polarcircle</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">circle_cube_boundary_to_polarcircle</span> <span class="free"><span class="bound"><span class="entity">γ</span></span></span> <span class="main">≡</span>
     <span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">γ</span></span></span> <span class="main">=</span> <span class="main">(</span>circle_top_edge<span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span>
           <span class="main">{</span>subcube <span class="main">0</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> circle_polar<span class="main">)</span><span class="main">,</span> subcube <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> circle_polar<span class="main">)</span><span class="main">}</span>
     <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">γ</span></span></span> <span class="main">=</span> <span class="main">(</span>circle_bot_edge<span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span>
           <span class="main">{</span>subcube <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="numeral">3</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> circle_polar<span class="main">)</span><span class="main">,</span> subcube <span class="main">(</span><span class="numeral">3</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span> <span class="main">1</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> circle_polar<span class="main">)</span><span class="main">}</span>
     <span class="keyword1">else</span> <span class="main">{}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rot_circle_cube_boundary_to_polarcircle</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rot_circle_cube_boundary_to_polarcircle</span> <span class="free"><span class="bound"><span class="entity">γ</span></span></span> <span class="main">≡</span>
     <span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">γ</span></span></span> <span class="main">=</span> <span class="main">(</span>rot_circle_left_edge <span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span>
           <span class="main">{</span>subcube <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span>  <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> circle_polar<span class="main">)</span><span class="main">,</span> subcube <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="numeral">3</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> circle_polar<span class="main">)</span><span class="main">}</span>
     <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">γ</span></span></span> <span class="main">=</span> <span class="main">(</span>rot_circle_right_edge<span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span>
           <span class="main">{</span>subcube <span class="main">(</span><span class="numeral">3</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span> <span class="main">1</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> circle_polar<span class="main">)</span><span class="main">,</span> subcube <span class="main">0</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> circle_polar<span class="main">)</span><span class="main">}</span>
     <span class="keyword1">else</span> <span class="main">{}</span>"</span></span>

<span class="keyword1" id="CircExample-circle_arcs_neq"><span class="command">lemma</span></span> circle_arcs_neq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">+</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subcube <span class="free">k</span> <span class="free">m</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> circle_polar<span class="main">)</span> <span class="main">≠</span> subcube <span class="free">n</span> <span class="free">q</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> circle_polar<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subcube_def subpath_def circle_polar_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="free">k</span><span class="main">)</span> <span class="main">≠</span> cos<span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cos_eq
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="free">k</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="free">n</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">m</span> <span class="main">*</span> pi"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="free">n</span> <span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">m</span> <span class="main">*</span> pi"</span></span>
        <span class="keyword1"><span class="command">using</span></span> distrib_left that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> left_diff_distrib mult.commute<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⌊</span><span class="free">k</span> <span class="main">-</span> <span class="free">n</span><span class="main">⌋</span> <span class="main">=</span> <span class="main">0</span> "</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> floor_eq_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">-</span> <span class="free">n</span> <span class="main">∉</span> <span class="main">ℤ</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> frac_eq_0_iff<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> frac_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> that a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="free">k</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="free">n</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">m</span> <span class="main">*</span> pi"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="free">n</span> <span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">m</span> <span class="main">*</span> pi"</span></span>
        <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_left<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⌊</span><span class="free">k</span> <span class="main">+</span> <span class="free">n</span><span class="main">⌋</span> <span class="main">=</span> <span class="main">0</span> "</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> floor_eq_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">+</span> <span class="free">n</span> <span class="main">∉</span> <span class="main">ℤ</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Ints_def assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> that a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">d</span> <span class="main">*</span> cos <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">m</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="free">d</span> <span class="main">*</span> sin <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">m</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span>  <span class="main">≠</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">d</span> <span class="main">*</span> cos <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">q</span> <span class="main">-</span> <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="free">d</span> <span class="main">*</span> sin <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">q</span> <span class="main">-</span> <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> d_gt_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">d</span> <span class="main">*</span> cos <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">m</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="free">d</span> <span class="main">*</span> sin <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">m</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">d</span> <span class="main">*</span> cos <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">q</span> <span class="main">-</span> <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="free">d</span> <span class="main">*</span> sin <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">q</span> <span class="main">-</span> <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="CircExample-circle_arcs_neq_2"><span class="command">lemma</span></span> circle_arcs_neq_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> kn12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">+</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">+</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="numeral">3</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subcube <span class="free">k</span> <span class="free">m</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> circle_polar<span class="main">)</span> <span class="main">≠</span> subcube <span class="free">n</span> <span class="free">q</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> circle_polar<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subcube_def subpath_def circle_polar_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sin <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="free">k</span><span class="main">)</span> <span class="main">≠</span> sin<span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sin_eq
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="free">k</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="free">n</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">m</span> <span class="main">*</span> pi"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">m</span> <span class="main">*</span> pi"</span></span>
        <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> left_diff_distrib mult.commute<span class="main">)</span>                      
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⌊</span><span class="free">k</span> <span class="main">-</span> <span class="free">n</span><span class="main">⌋</span> <span class="main">=</span> <span class="main">0</span> "</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> floor_eq_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">-</span> <span class="free">n</span> <span class="main">∉</span>  <span class="main">ℤ</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> frac_eq_0_iff<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> frac_def <span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> that a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="free">k</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="free">n</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">m</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> pi"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">pi</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">pi</span> <span class="main">⟹</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">pi</span> <span class="main">*</span> <span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="free">n</span> <span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">m</span> <span class="main">*</span> <span class="bound">pi</span> <span class="main">+</span> <span class="bound">pi</span> <span class="main">⟹</span> <span class="skolem">m</span> <span class="main">=</span> <span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">sos</span> <span class="quoted">"(((((A&lt;0 * A&lt;1) * R&lt;1) + ([1/2] * A=0))) &amp; ((((A&lt;0 * A&lt;1) * R&lt;1) + ([~1/2] * A=0))))"</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">m</span> <span class="main">*</span> pi <span class="main">+</span> pi"</span></span>
        <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i<span class="main">[</span><span class="operator">OF</span> pi_gt_zero<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⌊</span><span class="free">k</span> <span class="main">+</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">⌋</span> <span class="main">=</span> <span class="main">0</span> "</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> floor_eq_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">+</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">∉</span> <span class="main">ℤ</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ints_cases add.commute add.left_neutral add_diff_cancel_left' add_diff_eq kn12 floor_of_int of_int_0 order_less_irrefl<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> that a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">d</span> <span class="main">*</span> cos <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">m</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="free">d</span> <span class="main">*</span> sin <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">m</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span>  <span class="main">≠</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">d</span> <span class="main">*</span> cos <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">q</span> <span class="main">-</span> <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="free">d</span> <span class="main">*</span> sin <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">q</span> <span class="main">-</span> <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> d_gt_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">d</span> <span class="main">*</span> cos <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">m</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="free">d</span> <span class="main">*</span> sin <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">m</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">d</span> <span class="main">*</span> cos <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">q</span> <span class="main">-</span> <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="free">d</span> <span class="main">*</span> sin <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">q</span> <span class="main">-</span> <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="CircExample-circle_cube_is_only_horizontal_div_of_rot"><span class="command">lemma</span></span> circle_cube_is_only_horizontal_div_of_rot<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"only_horizontal_division <span class="main">(</span>boundary <span class="main">(</span>circle_cube<span class="main">)</span><span class="main">)</span> <span class="main">{</span>rot_circle_cube<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> only_horizontal_division_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{}</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI ballI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>boundary circle_cube<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> circle.circle_cube_boundary_explicit circle_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"boundary_chain <span class="main">(</span>boundary circle_cube<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> two_cube_boundary_is_boundary<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> boundary circle_cube <span class="main">⟹</span> <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⇒</span> valid_path <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> circle_cube_boundary_valid <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?𝒱</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>boundary <span class="main">(</span>circle_cube<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?pi</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>circle_left_edge<span class="main">,</span> circle_right_edge<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?pj</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>rot_circle_top_edge<span class="main">,</span> rot_circle_bot_edge<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"circle_cube_boundary_to_polarcircle"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?one_chaini</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"boundary <span class="main">(</span>circle_cube<span class="main">)</span> <span class="main">-</span> <span class="var">?pi</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"common_reparam_exists <span class="var">?𝒱</span> <span class="main">(</span>two_chain_vertical_boundary <span class="main">{</span>rot_circle_cube<span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> common_reparam_exists_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?subdiv</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span>subcube <span class="main">0</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> circle_polar<span class="main">)</span><span class="main">)</span><span class="main">,</span>
                    <span class="main">(</span>subcube <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> circle_polar<span class="main">)</span><span class="main">)</span><span class="main">,</span>
                    <span class="main">(</span>subcube <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="numeral">3</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> circle_polar<span class="main">)</span><span class="main">)</span><span class="main">,</span>
                    <span class="main">(</span>subcube <span class="main">(</span><span class="numeral">3</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span> <span class="main">1</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> circle_polar<span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="var">?subdiv</span><span class="main">.</span> <span class="bound">γ</span> <span class="keyword1">C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> subpath_smooth<span class="main">[</span><span class="operator">OF</span> circle_polar_smooth<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subcube_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="var">?subdiv</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"boundary_chain <span class="var">?subdiv</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_chain_def subcube_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"chain_reparam_chain' <span class="main">(</span>boundary <span class="main">(</span>circle_cube<span class="main">)</span> <span class="main">-</span> <span class="var">?pi</span><span class="main">)</span> <span class="var">?subdiv</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> chain_reparam_chain'_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI impI<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span><span class="var">?f</span> <span class="main">`</span> <span class="var">?one_chaini</span><span class="main">)</span> <span class="main">=</span> <span class="var">?subdiv</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> circle_cube_boundary_to_polarcircle_def circle_cube_boundary_explicit<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> circle_top_bot_edges_neq' <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>subcube <span class="main">0</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> circle_polar<span class="main">)</span><span class="main">,</span> subcube <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> circle_polar<span class="main">)</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"chain_reparam_weak_path <span class="main">(</span>coeff_cube_to_path <span class="main">(</span>circle_top_edge<span class="main">)</span><span class="main">)</span> <span class="main">{</span>subcube <span class="main">0</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> circle_polar<span class="main">)</span><span class="main">,</span> subcube <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> circle_polar<span class="main">)</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> chain_reparam_weak_path_def
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"valid_chain_list <span class="var">?l</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subcube_def circle_top_edge_def  x_coord_def circle_y_def pathfinish_def pathstart_def
              reversepath_def subpath_def joinpaths_def<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"reparam <span class="main">(</span>coeff_cube_to_path circle_top_edge<span class="main">)</span> <span class="main">(</span>rec_join <span class="var">?l</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> circ_top_edge_reparam_polar_circ_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"distinct <span class="var">?l</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> neq_commute<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> circle_arcs_neq<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>                                                     
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"chain_reparam_weak_path <span class="main">(</span>coeff_cube_to_path <span class="main">(</span>circle_bot_edge<span class="main">)</span><span class="main">)</span> <span class="main">{</span>subcube <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="numeral">3</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> circle_polar<span class="main">)</span><span class="main">,</span> subcube <span class="main">(</span><span class="numeral">3</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span> <span class="main">1</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> circle_polar<span class="main">)</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> chain_reparam_weak_path_def
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>subcube <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="numeral">3</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> circle_polar<span class="main">)</span><span class="main">,</span> subcube <span class="main">(</span><span class="numeral">3</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span> <span class="main">1</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> circle_polar<span class="main">)</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_chain_list <span class="var">?l</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subcube_def circle_top_edge_def  x_coord_def circle_y_def pathfinish_def pathstart_def
              reversepath_def subpath_def joinpaths_def<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"reparam <span class="main">(</span>rec_join <span class="main">[</span>circle_bot_edge<span class="main">]</span><span class="main">)</span> <span class="main">(</span>rec_join <span class="var">?l</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> circ_bot_edge_reparam_polar_circ_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"subcube <span class="main">(</span><span class="numeral">3</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span> <span class="main">1</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> circle_polar<span class="main">)</span> <span class="main">≠</span> subcube <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="numeral">3</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> circle_polar<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> circle_arcs_neq_2<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> d_gt_0<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="var">?l</span> <span class="main">=</span> <span class="main">{</span>subcube <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="numeral">3</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> circle_polar<span class="main">)</span><span class="main">,</span> subcube <span class="main">(</span><span class="numeral">3</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span> <span class="main">1</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> circle_polar<span class="main">)</span><span class="main">}</span> <span class="main">∧</span>
                            distinct <span class="var">?l</span> <span class="main">∧</span> reparam <span class="main">(</span>coeff_cube_to_path <span class="main">(</span>circle_bot_edge<span class="main">)</span><span class="main">)</span> <span class="main">(</span>rec_join <span class="var">?l</span><span class="main">)</span> <span class="main">∧</span> valid_chain_list <span class="var">?l</span> <span class="main">∧</span> <span class="var">?l</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a b c <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">cube</span><span class="main">∈</span><span class="var">?one_chaini</span><span class="main">.</span> chain_reparam_weak_path <span class="main">(</span>rec_join <span class="main">[</span><span class="bound">cube</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="var">?f</span> <span class="bound">cube</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  circle_cube_boundary_to_polarcircle_def UNION_eq circle_cube_boundary_explicit<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">p</span><span class="main">∈</span><span class="var">?one_chaini</span><span class="main">.</span> <span class="main">∀</span><span class="bound">p'</span><span class="main">∈</span><span class="var">?one_chaini</span><span class="main">.</span> <span class="bound">p</span> <span class="main">≠</span> <span class="bound">p'</span> <span class="main">⟶</span> <span class="var">?f</span> <span class="bound">p</span> <span class="main">∩</span> <span class="var">?f</span> <span class="bound">p'</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> circle_arcs_neq circle_arcs_neq_2 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> circle_cube_boundary_to_polarcircle_def UNION_eq circle_cube_boundary_explicit neq_commute d_gt_0<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> circle_top_bot_edges_neq' d_gt_0 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">smt</span> atLeastAtMost_iff divide_less_eq_1_pos zero_less_divide_1_iff<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">smt</span> atLeastAtMost_iff divide_less_eq_1_pos zero_less_divide_iff<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">smt</span> atLeastAtMost_iff divide_cancel_left divide_less_eq_1_pos field_sum_of_halves zero_less_divide_1_iff<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="var">?one_chaini</span><span class="main">.</span> finite <span class="main">(</span><span class="var">?f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> circle_cube_boundary_to_polarcircle_def circle_cube_boundary_explicit<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="var">?pi</span><span class="main">.</span> point_path <span class="bound">γ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> d_gt_0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> point_path_def circle_left_edge_def circle_right_edge_def<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"rot_circle_cube_boundary_to_polarcircle"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?one_chain2.0</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"two_chain_vertical_boundary <span class="main">{</span>rot_circle_cube<span class="main">}</span> <span class="main">-</span> <span class="var">?pj</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"chain_reparam_chain' <span class="main">(</span>two_chain_vertical_boundary <span class="main">{</span>rot_circle_cube<span class="main">}</span> <span class="main">-</span> <span class="var">?pj</span><span class="main">)</span> <span class="var">?subdiv</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> chain_reparam_chain'_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> rw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?one_chain2.0</span> <span class="main">=</span> <span class="main">{</span>rot_circle_left_edge<span class="main">,</span> rot_circle_right_edge<span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rot_circle_cube_vertical_boundary_explicit two_chain_vertical_boundary_def<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span><span class="var">?f</span> <span class="main">`</span> <span class="var">?one_chain2.0</span><span class="main">)</span> <span class="main">=</span> <span class="var">?subdiv</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> rot_circle_right_top_edges_neq'
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rot_circle_cube_boundary_to_polarcircle_def rw<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">cube</span><span class="main">∈</span><span class="var">?one_chain2.0</span><span class="main">.</span> chain_reparam_weak_path <span class="main">(</span>rec_join <span class="main">[</span><span class="bound">cube</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="var">?f</span> <span class="bound">cube</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rot_circle_cube_boundary_to_polarcircle_def rw<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>subcube <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> circle_polar<span class="main">)</span><span class="main">,</span> subcube <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="numeral">3</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> circle_polar<span class="main">)</span><span class="main">]</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"chain_reparam_weak_path <span class="main">(</span>coeff_cube_to_path <span class="main">(</span>rot_circle_left_edge<span class="main">)</span><span class="main">)</span> <span class="main">{</span>subcube <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> circle_polar<span class="main">)</span><span class="main">,</span> subcube <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="numeral">3</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> circle_polar<span class="main">)</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> chain_reparam_weak_path_def
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"valid_chain_list <span class="var">?l</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subcube_def pathfinish_def pathstart_def reversepath_def subpath_def joinpaths_def<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"reparam <span class="main">(</span>coeff_cube_to_path rot_circle_left_edge<span class="main">)</span> <span class="main">(</span>rec_join <span class="var">?l</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> rot_circ_left_edge_reparam_polar_circ_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"distinct <span class="var">?l</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> neq_commute<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> circle_arcs_neq<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"chain_reparam_weak_path <span class="main">(</span>coeff_cube_to_path <span class="main">(</span>rot_circle_right_edge<span class="main">)</span><span class="main">)</span> <span class="main">{</span>subcube <span class="main">(</span><span class="numeral">3</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span> <span class="main">1</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> circle_polar<span class="main">)</span><span class="main">,</span> subcube <span class="main">0</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> circle_polar<span class="main">)</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> chain_reparam_weak_path_def
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI<span class="main">)</span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>subcube <span class="main">(</span><span class="numeral">3</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span> <span class="main">1</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> circle_polar<span class="main">)</span><span class="main">,</span> subcube <span class="main">0</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> circle_polar<span class="main">)</span><span class="main">]</span>"</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"valid_chain_list <span class="var">?l</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span>  <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> circle_polar_def subcube_def pathfinish_def pathstart_def
                reversepath_def subpath_def joinpaths_def<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"reparam <span class="main">(</span>coeff_cube_to_path rot_circle_right_edge<span class="main">)</span> <span class="main">(</span>rec_join <span class="var">?l</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> rot_circ_right_edge_reparam_polar_circ_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"distinct <span class="var">?l</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> circle_arcs_neq<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">p</span><span class="main">∈</span><span class="var">?one_chain2.0</span><span class="main">.</span> <span class="main">∀</span><span class="bound">p'</span><span class="main">∈</span><span class="var">?one_chain2.0</span><span class="main">.</span> <span class="bound">p</span> <span class="main">≠</span> <span class="bound">p'</span> <span class="main">⟶</span> <span class="var">?f</span> <span class="bound">p</span> <span class="main">∩</span> <span class="var">?f</span> <span class="bound">p'</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> circle_arcs_neq circle_arcs_neq_2 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rot_circle_cube_boundary_to_polarcircle_def neq_commute<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> add.right_neutral divide_less_eq_1_pos dual_order.order_iff_strict num.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> one_less_numeral_iff prod.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> prod.sel<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> semiring_norm<span class="main"><span class="main">(</span></span>68<span class="main"><span class="main">)</span></span> subcube_def zero_less_divide_1_iff zero_less_numeral<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">smt</span> field_sum_of_halves<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="var">?one_chain2.0</span><span class="main">.</span> finite <span class="main">(</span><span class="var">?f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rot_circle_cube_boundary_to_polarcircle_def UNION_eq rw<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="var">?pj</span><span class="main">.</span> point_path <span class="bound">γ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> d_gt_0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> point_path_def rot_circle_top_edge_def rot_circle_bot_edge_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"common_sudiv_exists <span class="main">(</span>two_chain_vertical_boundary <span class="main">{</span>rot_circle_cube<span class="main">}</span><span class="main">)</span> <span class="main">(</span>boundary circle_cube<span class="main">)</span> <span class="main">∨</span>
             common_reparam_exists <span class="main">(</span>boundary circle_cube<span class="main">)</span> <span class="main">(</span>two_chain_vertical_boundary <span class="main">{</span>rot_circle_cube<span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="CircExample-GreenThm_cirlce"><span class="command">lemma</span></span> GreenThm_cirlce<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">twoC</span><span class="main">∈</span><span class="main">{</span>circle_cube<span class="main">}</span><span class="main">.</span> analytically_valid <span class="main">(</span>cubeImage <span class="bound">twoC</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="free">j</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">twoC</span><span class="main">∈</span><span class="main">{</span>rot_circle_cube<span class="main">}</span><span class="main">.</span> analytically_valid <span class="main">(</span>cubeImage <span class="bound">twoC</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"integral <span class="main">(</span>cubeImage <span class="main">(</span>circle_cube<span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="free">i</span> <span class="bound">x</span> <span class="main">-</span> partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="free">j</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span>
                     one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">}</span> <span class="main">(</span>boundary <span class="main">(</span>circle_cube<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> green_typeI_typeII_chain.GreenThm_typeI_typeII_divisible_region_finite_holes<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span>cubeImage <span class="main"><span class="main">(</span></span>circle_cube<span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">i</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">j</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">F</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span>circle_cube<span class="main"><span class="main">}</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span>rot_circle_cube<span class="main"><span class="main">}</span></span>"</span></span></span><span class="main"><span class="main">,</span></span>
                            <span class="operator">OF</span> _ _ _ circle_cube_is_only_horizontal_div_of_rot _<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> boundary circle_cube <span class="main">⟹</span> valid_path <span class="bound">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> circle_cube_boundary_valid <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"green_typeI_typeII_chain <span class="main">(</span>cubeImage circle_cube<span class="main">)</span> <span class="free">i</span> <span class="free">j</span> <span class="free">F</span> <span class="main">{</span>circle_cube<span class="main">}</span> <span class="main">{</span>rot_circle_cube<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> green_typeI_typeII_chain_def green_typeI_chain_def green_typeII_chain_def green_typeI_chain_axioms_def green_typeII_chain_axioms_def
               <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> circle_cube_is_type_I rot_circle_cube_is_type_II d_gt_0 R2_axioms<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"gen_division <span class="main">(</span>cubeImage circle_cube<span class="main">)</span> <span class="main">{</span>cubeImage circle_cube<span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gen_division_def<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"gen_division <span class="main">(</span>cubeImage <span class="main">(</span>circle_cube<span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">{</span>cubeImage rot_circle_cube<span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> rot_circle_div_circle d_gt_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"valid_two_chain <span class="main">{</span>rot_circle_cube<span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"valid_two_chain <span class="main">{</span>circle_cube<span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_two_chain_def<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> rot_circle_cube_valid_two_cube circle_cube_valid_two_cube assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"only_vertical_division <span class="main">(</span>boundary <span class="main">(</span>circle_cube<span class="main">)</span><span class="main">)</span> <span class="main">{</span>circle_cube<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> twoChainVertDiv_of_itself<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>circle_cube<span class="main">}</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> two_chain_boundary_def<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> circle_cube_boundary_valid
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="DiamExample">
<div class="head">
<h1>Theory DiamExample</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The Diamond Example›</span></span>

<span class="keyword1"><span class="command">theory</span></span> DiamExample
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Green.html">Green</a> <a href="SymmetricR2Shapes.html">SymmetricR2Shapes</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="DiamExample-abs_if'"><span class="command">lemma</span></span> abs_if'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>abs_if<span class="main">,</span>ordered_ab_group_add<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">a</span><span class="main">¦</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">a</span> <span class="main">≤</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">-</span> <span class="free">a</span> <span class="keyword1">else</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_if dual_order.order_iff_strict<span class="main">)</span>

<span class="keyword1"><span class="command">locale</span></span> diamond <span class="main">=</span> R2 <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">d</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> d_gt_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">d</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">diamond_y_gen</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">diamond_y_gen</span> <span class="main">≡</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span>  <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">¦</span><span class="bound">t</span><span class="main">¦</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">diamond_cube_gen</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>real <span class="main">*</span> real<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>real <span class="main">*</span> real<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">diamond_cube_gen</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free">d</span> <span class="main">*</span> x_coord <span class="bound">x</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">y</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">d</span> <span class="main">*</span> diamond_y_gen <span class="main">(</span>x_coord <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="DiamExample-diamond_y_gen_valid"><span class="command">lemma</span></span> diamond_y_gen_valid<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"diamond_y_gen <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> piecewise_C1_differentiable_on_def diamond_y_gen_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI exI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">-</span> <span class="main">¦</span><span class="bound">t</span><span class="main">¦</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite<span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">-</span> <span class="main">¦</span><span class="bound">t</span><span class="main">¦</span><span class="main">)</span> <span class="keyword1">C1_differentiable_on</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">derivative_intros</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="DiamExample-diamond_cube_gen_boundary_valid"><span class="command">lemma</span></span> diamond_cube_gen_boundary_valid<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span><span class="main">∈</span>boundary <span class="main">(</span>diamond_cube_gen<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="free">γ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_path_def boundary_def horizontal_boundary_def vertical_boundary_def diamond_cube_gen_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> rw2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> diamond_y_gen <span class="main">(</span>x_coord <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> diamond_y_gen <span class="keyword1">o</span> x_coord"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> <span class="main">[</span><span class="operator">derivative_intros</span><span class="main">]</span> <span class="main">=</span> C1_differentiable_on_pair pair_prod_smooth_pw_smooth scale_piecewise_C1_differentiable_on piecewise_C1_differentiable_neg piecewise_C1_differentiable_compose diamond_y_gen_valid
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">d</span> <span class="main">*</span> x_coord <span class="bound">x</span><span class="main">,</span> <span class="main">-</span> <span class="main">(</span><span class="free">d</span> <span class="main">*</span> diamond_y_gen <span class="main">(</span>x_coord <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_intros</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x_coord_smooth rw2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_intros</span></span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x_coord_img x_coord_back_img C1_differentiable_imp_piecewise<span class="main"><span class="main">[</span></span><span class="operator">OF</span> x_coord_smooth<span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">d</span> <span class="main">*</span> x_coord <span class="bound">x</span><span class="main">,</span> <span class="free">d</span> <span class="main">*</span> diamond_y_gen <span class="main">(</span>x_coord <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_intros</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x_coord_smooth rw2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_intros</span></span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x_coord_img x_coord_back_img C1_differentiable_imp_piecewise<span class="main"><span class="main">[</span></span><span class="operator">OF</span> x_coord_smooth<span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">diamond_x</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">diamond_x</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="bound">t</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="free">d</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">diamond_y</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">diamond_y</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="free">d</span><span class="main">/</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">¦</span><span class="bound">t</span><span class="main">¦</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">diamond_cube</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">diamond_cube</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>diamond_x <span class="bound">x</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">y</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>diamond_y <span class="main">(</span>diamond_x <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rot_diamond_cube</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rot_diamond_cube</span> <span class="main">=</span> prod.swap <span class="keyword1">o</span> <span class="main">(</span>diamond_cube<span class="main">)</span> <span class="keyword1">o</span> prod.swap"</span></span>

<span class="keyword1" id="DiamExample-diamond_eq_characterisations"><span class="command">lemma</span></span> diamond_eq_characterisations<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"diamond_cube <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span><span class="main">=</span> diamond_cube_gen <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diamond_cube_def diamond_cube_gen_def diamond_x_def x_coord_def diamond_y_def diamond_y_gen_def d_gt_0 <span class="dynamic"><span class="dynamic">field_simps</span></span> mult_le_0_iff abs_if <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>

<span class="keyword1" id="DiamExample-diamond_eq_characterisations_fun"><span class="command">lemma</span></span> diamond_eq_characterisations_fun<span class="main">:</span> <span class="quoted"><span class="quoted">"diamond_cube <span class="main">=</span> diamond_cube_gen"</span></span>
  <span class="keyword1"><span class="command">using</span></span> diamond_eq_characterisations <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="DiamExample-diamond_y_valid"><span class="command">lemma</span></span> diamond_y_valid<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"diamond_y <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">-</span><span class="free">d</span><span class="main">/</span><span class="numeral">2</span><span class="main">..</span><span class="free">d</span><span class="main">/</span><span class="numeral">2</span><span class="main">}</span>"</span></span>         <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span><span class="main">)</span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> diamond_y <span class="bound">x</span><span class="main">)</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">-</span><span class="free">d</span><span class="main">/</span><span class="numeral">2</span><span class="main">..</span><span class="free">d</span><span class="main">/</span><span class="numeral">2</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> f0<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> piecewise_C1_differentiable_on_def diamond_y_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> f0 <span class="dynamic"><span class="dynamic">continuous_intros</span></span> <span class="dynamic"><span class="dynamic">derivative_intros</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="DiamExample-diamond_cube_boundary_valid"><span class="command">lemma</span></span> diamond_cube_boundary_valid<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span> <span class="main">∈</span> boundary <span class="main">(</span>diamond_cube<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="free">γ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> diamond_cube_gen_boundary_valid assms d_gt_0
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diamond_eq_characterisations_fun<span class="main">)</span>

<span class="keyword1" id="DiamExample-diamond_cube_is_type_I"><span class="command">lemma</span></span> diamond_cube_is_type_I<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"typeI_twoCube <span class="main">(</span>diamond_cube<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> typeI_twoCube_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI ballI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">d</span><span class="main">/</span><span class="numeral">2</span> <span class="main">&lt;</span> <span class="free">d</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> d_gt_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">-</span> <span class="free">d</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">..</span><span class="free">d</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">-</span> diamond_y <span class="bound">x</span> <span class="main">≤</span> diamond_y <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> diamond_y_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> f0<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"diamond_y <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">-</span> <span class="free">d</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">..</span><span class="free">d</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">}</span>"</span></span>
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> diamond_y <span class="bound">x</span><span class="main">)</span> <span class="keyword1">piecewise_C1_differentiable_on</span> <span class="main">{</span><span class="main">-</span> <span class="free">d</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">..</span><span class="free">d</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> diamond_y_def piecewise_C1_differentiable_on_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> conjI exI f0 <span class="dynamic"><span class="dynamic">continuous_intros</span></span> <span class="dynamic"><span class="dynamic">derivative_intros</span></span> <span class="main"><span class="keyword3">|</span></span> <span class="operator">force</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"diamond_cube <span class="main">=</span>
    <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="free">d</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">d</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">,</span>
         <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="main">-</span> diamond_y <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="free">d</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">d</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
         <span class="bound">y</span> <span class="main">*</span> diamond_y <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="free">d</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">d</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> diamond_cube_def diamond_x_def diamond_y_def <span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="DiamExample-diamond_cube_valid_two_cube"><span class="command">lemma</span></span> diamond_cube_valid_two_cube<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valid_two_cube <span class="main">(</span>diamond_cube<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_two_cube_def boundary_def horizontal_boundary_def vertical_boundary_def diamond_cube_def 
      diamond_x_def card_insert_if<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> cancel_comm_monoid_add_class.diff_cancel d_gt_0 mult.commute mult_2 mult_zero_right order_less_irrefl prod.inject field_sum_of_halves<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> add_diff_cancel_right' d_gt_0 mult_cancel_left mult_zero_right order_less_irrefl prod.inject<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="DiamExample-rot_diamond_cube_boundary_valid"><span class="command">lemma</span></span> rot_diamond_cube_boundary_valid<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span><span class="main">,</span><span class="free">γ</span><span class="main">)</span><span class="main">∈</span>boundary <span class="main">(</span>rot_diamond_cube<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valid_path <span class="free">γ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> d_gt_0 swap_valid_boundaries diamond_cube_boundary_valid
  <span class="keyword1"><span class="command">using</span></span> assms diamond_cube_is_type_I rot_diamond_cube_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="DiamExample-rot_diamond_cube_is_type_II"><span class="command">lemma</span></span> rot_diamond_cube_is_type_II<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"typeII_twoCube <span class="main">(</span>rot_diamond_cube<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> d_gt_0 swap_typeI_is_typeII diamond_cube_is_type_I
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rot_diamond_cube_def<span class="main">)</span>

<span class="keyword1" id="DiamExample-rot_diamond_cube_valid_two_cube"><span class="command">lemma</span></span> rot_diamond_cube_valid_two_cube<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_two_cube <span class="main">(</span>rot_diamond_cube<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> valid_cube_valid_swap diamond_cube_valid_two_cube d_gt_0 rot_diamond_cube_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">diamond_top_edges</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">diamond_top_edges</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>diamond_x <span class="bound">x</span><span class="main">,</span> diamond_y <span class="main">(</span>diamond_x <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">diamond_bot_edges</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">diamond_bot_edges</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">,</span>  <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>diamond_x <span class="bound">x</span><span class="main">,</span> <span class="main">-</span> diamond_y <span class="main">(</span>diamond_x <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="DiamExample-diamond_cube_boundary_explicit"><span class="command">lemma</span></span> diamond_cube_boundary_explicit<span class="main">:</span>
    <span class="quoted"><span class="quoted">"boundary <span class="main">(</span>diamond_cube <span class="main">)</span> <span class="main">=</span>
           <span class="main">{</span>diamond_top_edges<span class="main">,</span>
           diamond_bot_edges<span class="main">,</span>
    <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span>diamond_x <span class="main">0</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">y</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> diamond_y <span class="main">(</span>diamond_x <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
     <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span>diamond_x <span class="main">1</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">y</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> diamond_y <span class="main">(</span>diamond_x <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> diamond_top_edges_def diamond_bot_edges_def valid_two_cube_def boundary_def horizontal_boundary_def vertical_boundary_def diamond_cube_def Un_iff <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">diamond_top_left_edge</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">diamond_top_left_edge</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>diamond_x <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">,</span>  <span class="main">(</span>diamond_x <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="free">d</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">diamond_top_right_edge</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">diamond_top_right_edge</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>diamond_x <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span>  <span class="main">(</span><span class="main">-</span><span class="main">(</span>diamond_x <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="free">d</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">diamond_bot_left_edge</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">diamond_bot_left_edge</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>diamond_x <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="main">-</span> <span class="main">(</span>diamond_x <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">d</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">diamond_bot_right_edge</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">diamond_bot_right_edge</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>diamond_x <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">-</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span>diamond_x <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="free">d</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="DiamExample-diamond_edges_are_valid"><span class="command">lemma</span></span> diamond_edges_are_valid<span class="main">:</span>
   <span class="quoted"><span class="quoted">"valid_path <span class="main">(</span>snd <span class="main">(</span>diamond_top_left_edge<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"valid_path <span class="main">(</span>snd <span class="main">(</span>diamond_top_right_edge<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"valid_path <span class="main">(</span>snd <span class="main">(</span>diamond_bot_left_edge<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"valid_path <span class="main">(</span>snd <span class="main">(</span>diamond_bot_right_edge<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_path_def diamond_top_left_edge_def diamond_bot_right_edge_def diamond_bot_left_edge_def diamond_top_right_edge_def diamond_x_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">diamond_cube_boundary_to_subdiv</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">diamond_cube_boundary_to_subdiv</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">gamma</span></span></span><span class="main">::</span><span class="main">(</span>int <span class="main">×</span> <span class="main">(</span>real <span class="main">⇒</span> real <span class="main">×</span> real<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≡</span>
 <span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">gamma</span></span></span> <span class="main">=</span> diamond_top_edges<span class="main">)</span> <span class="keyword1">then</span>
       <span class="main">{</span>diamond_top_left_edge<span class="main">,</span> diamond_top_right_edge<span class="main">}</span>
 <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">gamma</span></span></span> <span class="main">=</span> diamond_bot_edges<span class="main">)</span> <span class="keyword1">then</span>
   <span class="main">{</span>diamond_bot_left_edge<span class="main">,</span> diamond_bot_right_edge<span class="main">}</span>
 <span class="keyword1">else</span> <span class="main">{}</span>"</span></span>

<span class="keyword1" id="DiamExample-rot_diam_edge_1"><span class="command">lemma</span></span> rot_diam_edge_1<span class="main">:</span>
     <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">x</span><span class="main">::</span>real<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> diamond_y <span class="main">(</span>diamond_x <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">*</span> diamond_y <span class="main">(</span>diamond_x <span class="main">0</span><span class="main">)</span><span class="main">,</span> diamond_x <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> diamond_y <span class="main">(</span>diamond_x <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span>  <span class="main">(</span>diamond_y <span class="main">(</span>diamond_x <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> diamond_x <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">diamond_left_edges</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">diamond_left_edges</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span> diamond_y <span class="main">(</span>diamond_x <span class="bound">y</span><span class="main">)</span><span class="main">,</span> diamond_x <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">diamond_right_edges</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">diamond_right_edges</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span> diamond_y <span class="main">(</span>diamond_x <span class="bound">y</span><span class="main">)</span><span class="main">,</span> diamond_x <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="DiamExample-rot_diamond_cube_boundary_explicit"><span class="command">lemma</span></span> rot_diamond_cube_boundary_explicit<span class="main">:</span>
     <span class="quoted"><span class="quoted">"boundary <span class="main">(</span>rot_diamond_cube<span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> diamond_y <span class="main">(</span>diamond_x <span class="main">0</span><span class="main">)</span><span class="main">,</span> diamond_x <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
                                     <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> diamond_y <span class="main">(</span>diamond_x <span class="main">1</span><span class="main">)</span><span class="main">,</span> diamond_x <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
                                     diamond_left_edges<span class="main">,</span> diamond_right_edges<span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"boundary <span class="main">(</span>rot_diamond_cube<span class="main">)</span> <span class="main">=</span> <span class="main">{</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> diamond_y <span class="main">(</span>diamond_x <span class="main">0</span><span class="main">)</span><span class="main">,</span> diamond_x <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
              <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> diamond_y <span class="main">(</span>diamond_x <span class="main">1</span><span class="main">)</span><span class="main">,</span> diamond_x <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
              <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">0</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> diamond_y <span class="main">(</span>diamond_x <span class="bound">y</span><span class="main">)</span><span class="main">,</span> diamond_x <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
              <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> diamond_y <span class="main">(</span>diamond_x <span class="bound">y</span><span class="main">)</span><span class="main">,</span> diamond_x <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> valid_two_cube_def boundary_def horizontal_boundary_def vertical_boundary_def rot_diamond_cube_def diamond_cube_def o_def swap_simp Un_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diamond_left_edges_def diamond_right_edges_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="DiamExample-rot_diamond_cube_vertical_boundary_explicit"><span class="command">lemma</span></span> rot_diamond_cube_vertical_boundary_explicit<span class="main">:</span>
     <span class="quoted"><span class="quoted">"vertical_boundary <span class="main">(</span>rot_diamond_cube<span class="main">)</span> <span class="main">=</span> <span class="main">{</span>diamond_left_edges<span class="main">,</span> diamond_right_edges<span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vertical_boundary <span class="main">(</span>rot_diamond_cube<span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">0</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> diamond_y <span class="main">(</span>diamond_x <span class="bound">y</span><span class="main">)</span><span class="main">,</span> diamond_x <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
                                                <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> diamond_y <span class="main">(</span>diamond_x <span class="bound">y</span><span class="main">)</span><span class="main">,</span> diamond_x <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> valid_two_cube_def boundary_def horizontal_boundary_def vertical_boundary_def rot_diamond_cube_def diamond_cube_def o_def swap_simp Un_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diamond_left_edges_def diamond_right_edges_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rot_diamond_cube_boundary_to_subdiv</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rot_diamond_cube_boundary_to_subdiv</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">gamma</span></span></span><span class="main">::</span><span class="main">(</span>int <span class="main">×</span> <span class="main">(</span>real <span class="main">⇒</span> real <span class="main">×</span> real<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≡</span>
     <span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">gamma</span></span></span> <span class="main">=</span> diamond_left_edges <span class="main">)</span> <span class="keyword1">then</span> <span class="main">{</span>diamond_bot_left_edge <span class="main">,</span> diamond_top_left_edge<span class="main">}</span>
     <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">gamma</span></span></span> <span class="main">=</span> diamond_right_edges<span class="main">)</span> <span class="keyword1">then</span> <span class="main">{</span>diamond_bot_right_edge<span class="main">,</span> diamond_top_right_edge<span class="main">}</span>
     <span class="keyword1">else</span> <span class="main">{}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">diamond_boundaries_reparam_map</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">diamond_boundaries_reparam_map</span> <span class="main">≡</span> id"</span></span>

<span class="keyword1" id="DiamExample-diamond_boundaries_reparam_map_bij"><span class="command">lemma</span></span> diamond_boundaries_reparam_map_bij<span class="main">:</span>
     <span class="quoted"><span class="quoted">"bij <span class="main">(</span>diamond_boundaries_reparam_map<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bij_def full_SetCompr_eq<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> diamond_boundaries_reparam_map_def<span class="main">)</span>

<span class="keyword1" id="DiamExample-diamond_bot_edges_neq_diamond_top_edges"><span class="command">lemma</span></span> diamond_bot_edges_neq_diamond_top_edges<span class="main">:</span>
     <span class="quoted"><span class="quoted">"diamond_bot_edges <span class="main">≠</span>  diamond_top_edges"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diamond_bot_edges_def diamond_top_edges_def<span class="main">)</span>

<span class="keyword1" id="DiamExample-diamond_top_left_edge_neq_diamond_top_right_edge"><span class="command">lemma</span></span> diamond_top_left_edge_neq_diamond_top_right_edge<span class="main">:</span>
     <span class="quoted"><span class="quoted">"diamond_top_left_edge <span class="main">≠</span> diamond_top_right_edge"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diamond_top_left_edge_def diamond_top_right_edge_def diamond_x_def diamond_y_def<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> d_gt_0
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> diff_zero div_0 divide_divide_eq_right order_less_irrefl prod.inject field_sum_of_halves<span class="main">)</span>

<span class="keyword1" id="DiamExample-neqs1"><span class="command">lemma</span></span> neqs1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>diamond_x <span class="bound">x</span><span class="main">,</span> diamond_y <span class="main">(</span>diamond_x <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>diamond_x <span class="bound">x</span><span class="main">,</span> <span class="main">-</span> diamond_y <span class="main">(</span>diamond_x <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span> diamond_y <span class="main">(</span>diamond_x <span class="bound">y</span><span class="main">)</span><span class="main">,</span> diamond_x <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span>diamond_y <span class="main">(</span>diamond_x <span class="bound">y</span><span class="main">)</span><span class="main">,</span> diamond_x <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>diamond_x<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> diamond_x<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="free">d</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>diamond_x<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">-</span> diamond_x<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="free">d</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>diamond_x<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="free">d</span><span class="main">/</span><span class="numeral">2</span> <span class="main">-</span> diamond_x<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>diamond_x<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> diamond_x<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="free">d</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>diamond_x<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">-</span> diamond_x<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="free">d</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>diamond_x<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> diamond_x<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="free">d</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>diamond_x<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> diamond_x<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="free">d</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>diamond_x<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="free">d</span><span class="main">/</span><span class="numeral">2</span> <span class="main">-</span> diamond_x<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> d_gt_0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> diamond_x_def diamond_y_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> fun_cong <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="DiamExample-neqs2"><span class="command">lemma</span></span> neqs2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>diamond_x <span class="bound">x</span><span class="main">,</span> diamond_y <span class="main">(</span>diamond_x <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> diamond_y <span class="main">(</span>diamond_x <span class="main">1</span><span class="main">)</span><span class="main">,</span> diamond_x <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>diamond_x <span class="bound">x</span><span class="main">,</span> <span class="main">-</span> diamond_y <span class="main">(</span>diamond_x <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> diamond_y <span class="main">(</span>diamond_x <span class="main">0</span><span class="main">)</span><span class="main">,</span> diamond_x <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> d_gt_0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> diamond_x_def diamond_y_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> fun_cong <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="DiamExample-diamond_cube_is_only_horizontal_div_of_rot"><span class="command">lemma</span></span> diamond_cube_is_only_horizontal_div_of_rot<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"only_horizontal_division <span class="main">(</span>boundary <span class="main">(</span>diamond_cube<span class="main">)</span><span class="main">)</span> <span class="main">{</span>rot_diamond_cube<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> only_horizontal_division_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{}</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI ballI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>boundary diamond_cube<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_def horizontal_boundary_def vertical_boundary_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"boundary_chain <span class="main">(</span>boundary diamond_cube<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> two_cube_boundary_is_boundary<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> boundary diamond_cube <span class="main">⟹</span> <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⇒</span> valid_path <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> diamond_cube_boundary_valid <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?𝒱</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>boundary <span class="main">(</span>diamond_cube<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="var">?𝒱</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_def horizontal_boundary_def vertical_boundary_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"boundary_chain <span class="var">?𝒱</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> two_cube_boundary_is_boundary <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?subdiv</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>diamond_top_left_edge<span class="main">,</span> diamond_top_right_edge<span class="main">,</span> diamond_bot_left_edge<span class="main">,</span> diamond_bot_right_edge<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?pi</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> diamond_y <span class="main">(</span>diamond_x <span class="main">0</span><span class="main">)</span><span class="main">,</span> diamond_x <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
              <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> diamond_y <span class="main">(</span>diamond_x <span class="main">1</span><span class="main">)</span><span class="main">,</span> diamond_x <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?pj</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span>diamond_x <span class="main">0</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">y</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> diamond_y <span class="main">(</span>diamond_x <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
              <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span>diamond_x <span class="main">1</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">y</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> diamond_y <span class="main">(</span>diamond_x <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"diamond_cube_boundary_to_subdiv"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"common_sudiv_exists <span class="main">(</span>two_chain_vertical_boundary <span class="main">{</span>rot_diamond_cube<span class="main">}</span><span class="main">)</span> <span class="var">?𝒱</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> common_sudiv_exists_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"chain_subdiv_chain <span class="main">(</span>boundary <span class="main">(</span>diamond_cube<span class="main">)</span> <span class="main">-</span> <span class="var">?pj</span><span class="main">)</span> <span class="var">?subdiv</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> chain_subdiv_chain_character
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>boundary <span class="main">(</span>diamond_cube<span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="var">?pj</span> <span class="main">=</span> <span class="main">{</span>diamond_top_edges<span class="main">,</span> diamond_bot_edges<span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diamond_cube_boundary_explicit diamond_x_def diamond_top_edges_def diamond_bot_edges_def<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> abs_zero cancel_comm_monoid_add_class.diff_cancel diamond_x_def diamond_y_def diff_0 minus_diff_eq mult.commute mult_zero_right prod.inject neqs2<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> cancel_comm_monoid_add_class.diff_cancel d_gt_0 divide_eq_0_iff linorder_not_le mult.commute mult_zero_right order_refl prod.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> zero_neq_numeral<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span><span class="var">?f</span> <span class="main">`</span> <span class="main">(</span>boundary <span class="main">(</span>diamond_cube<span class="main">)</span> <span class="main">-</span> <span class="var">?pj</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="var">?subdiv</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diamond_top_edges_def diamond_bot_edges_def diamond_cube_boundary_to_subdiv_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"chain_subdiv_path <span class="main">(</span>reversepath <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>diamond_x <span class="bound">x</span><span class="main">,</span> diamond_y <span class="main">(</span>diamond_x <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                 <span class="main">{</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>diamond_x<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> diamond_x<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="free">d</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
                  <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>diamond_x<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="free">d</span><span class="main">/</span><span class="numeral">2</span> <span class="main">-</span> diamond_x<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>diamond_x<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="free">d</span><span class="main">/</span><span class="numeral">2</span> <span class="main">-</span> diamond_x<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?G</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>diamond_x<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> diamond_x<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="free">d</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">[</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="var">?F</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="var">?G</span><span class="main">)</span><span class="main">]</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> d_gt_0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> diamond_x_def diamond_y_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> fun_cong<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> rj<span class="main">:</span> <span class="quoted"><span class="quoted">"rec_join <span class="main">[</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="var">?F</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="var">?G</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> reversepath <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>diamond_x <span class="bound">x</span><span class="main">,</span> diamond_y <span class="main">(</span>diamond_x <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> d_gt_0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subpath_def diamond_x_def diamond_y_def joinpaths_def reversepath_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pathstart <span class="var">?F</span> <span class="main">=</span> pathfinish <span class="var">?G</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> d_gt_0 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subpath_def diamond_x_def diamond_y_def pathfinish_def pathstart_def<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> val<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_chain_list <span class="main">[</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="var">?F</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="var">?G</span><span class="main">)</span><span class="main">]</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  join_subpaths_middle<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> chain_subdiv_path.I <span class="main">[</span><span class="operator">OF</span> dist rj val<span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_commute<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"chain_subdiv_path <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>diamond_x <span class="bound">x</span><span class="main">,</span> <span class="main">-</span> diamond_y <span class="main">(</span>diamond_x <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                           <span class="main">{</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>diamond_x<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">-</span> diamond_x<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="free">d</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
                            <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>diamond_x<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> diamond_x<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="free">d</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>diamond_x<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">-</span> diamond_x<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="free">d</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?G</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>diamond_x<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> diamond_x<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="free">d</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="var">?F</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="var">?G</span><span class="main">)</span><span class="main">]</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> d_gt_0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> diamond_x_def diamond_y_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> fun_cong<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> rj<span class="main">:</span> <span class="quoted"><span class="quoted">"rec_join <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="var">?F</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="var">?G</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>diamond_x <span class="bound">x</span><span class="main">,</span> <span class="main">-</span> diamond_y <span class="main">(</span>diamond_x <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> d_gt_0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subpath_def diamond_x_def diamond_y_def joinpaths_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pathfinish <span class="var">?F</span> <span class="main">=</span> pathstart <span class="var">?G</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> d_gt_0 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subpath_def diamond_x_def diamond_y_def pathfinish_def pathstart_def<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> val<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_chain_list <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="var">?F</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="var">?G</span><span class="main">)</span><span class="main">]</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  join_subpaths_middle<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> chain_subdiv_path.I <span class="main">[</span><span class="operator">OF</span> dist rj val<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> **<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span>boundary <span class="main">(</span>diamond_cube<span class="main">)</span> <span class="main">-</span> <span class="var">?pj</span><span class="main">.</span>
            <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span> <span class="keyword1">then</span> chain_subdiv_path <span class="bound">γ</span> <span class="main">(</span><span class="var">?f</span> <span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">)</span>
            <span class="keyword1">else</span> chain_subdiv_path <span class="main">(</span>reversepath <span class="bound">γ</span><span class="main">)</span> <span class="main">(</span><span class="var">?f</span> <span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>boundary <span class="main">(</span>diamond_cube<span class="main">)</span> <span class="main">-</span> <span class="var">?pj</span><span class="main">.</span> <span class="main">∀</span><span class="bound">p'</span><span class="main">∈</span>boundary <span class="main">(</span>diamond_cube<span class="main">)</span> <span class="main">-</span> <span class="var">?pj</span><span class="main">.</span>
                                      <span class="bound">p</span> <span class="main">≠</span> <span class="bound">p'</span> <span class="main">⟶</span> <span class="var">?f</span> <span class="bound">p</span> <span class="main">∩</span> <span class="var">?f</span> <span class="bound">p'</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>boundary <span class="main">(</span>diamond_cube<span class="main">)</span> <span class="main">-</span> <span class="var">?pj</span><span class="main">.</span> finite <span class="main">(</span><span class="var">?f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diamond_cube_boundary_to_subdiv_def UNION_eq 1 diamond_top_edges_def diamond_bot_edges_def diamond_bot_left_edge_def diamond_bot_right_edge_def diamond_top_left_edge_def diamond_top_right_edge_def neqs1<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> <span class="main">⋃</span> <span class="main">(</span><span class="bound">f</span> <span class="main">`</span> <span class="main">{</span>rot_diamond_cube<span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="bound">f</span> <span class="main">(</span>rot_diamond_cube<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"chain_subdiv_chain <span class="main">(</span>two_chain_vertical_boundary <span class="main">{</span>rot_diamond_cube<span class="main">}</span> <span class="main">-</span> <span class="var">?pi</span><span class="main">)</span> <span class="var">?subdiv</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> chain_subdiv_chain_character two_chain_vertical_boundary_def *
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI<span class="main">)</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"rot_diamond_cube_boundary_to_subdiv"</span></span>
      <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vertical_boundary <span class="main">(</span>rot_diamond_cube<span class="main">)</span> <span class="main">-</span> <span class="var">?pi</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span>diamond_left_edges<span class="main">,</span> diamond_right_edges<span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rot_diamond_cube_vertical_boundary_explicit  diamond_left_edges_def diamond_right_edges_def<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> add.inverse_inverse add_diff_cancel_right' diff_numeral_special<span class="main"><span class="main">(</span></span>11<span class="main"><span class="main">)</span></span> mult.left_neutral mult.right_neutral prod.inject neqs1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> uminus_add_conv_diff<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> diff_0 mult.left_neutral mult_minus_left mult_zero_right prod.inject neqs1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span><span class="var">?f</span> <span class="main">`</span> <span class="main">(</span>vertical_boundary <span class="main">(</span>rot_diamond_cube<span class="main">)</span> <span class="main">-</span> <span class="var">?pi</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="var">?subdiv</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rot_diamond_cube_boundary_to_subdiv_def 1 UNION_eq subpath_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_eq_iff diamond_right_edges_def diamond_left_edges_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"chain_subdiv_path <span class="main">(</span>reversepath <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span> diamond_y <span class="main">(</span>diamond_x <span class="bound">y</span><span class="main">)</span><span class="main">,</span> diamond_x <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                           <span class="main">{</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>diamond_x<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">-</span> diamond_x<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="free">d</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
                            <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>diamond_x<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> diamond_x<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="free">d</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>diamond_x<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">-</span> diamond_x<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="free">d</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?G</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>diamond_x<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> diamond_x<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="free">d</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">[</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="var">?G</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="var">?F</span><span class="main">)</span><span class="main">]</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> d_gt_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> rj<span class="main">:</span> <span class="quoted"><span class="quoted">"rec_join <span class="main">[</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="var">?G</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="var">?F</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> reversepath <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span> diamond_y <span class="main">(</span>diamond_x <span class="bound">y</span><span class="main">)</span><span class="main">,</span> diamond_x <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> d_gt_0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subpath_def diamond_x_def diamond_y_def joinpaths_def reversepath_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pathstart <span class="var">?G</span> <span class="main">=</span> pathstart <span class="var">?F</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> d_gt_0 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subpath_def diamond_x_def diamond_y_def pathstart_def<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> val<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_chain_list <span class="main">[</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="var">?G</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="var">?F</span><span class="main">)</span><span class="main">]</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  join_subpaths_middle<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> chain_subdiv_path.I <span class="main">[</span><span class="operator">OF</span> dist rj val<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_commute<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"chain_subdiv_path <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span>diamond_y <span class="main">(</span>diamond_x <span class="bound">y</span><span class="main">)</span><span class="main">,</span> diamond_x <span class="bound">y</span><span class="main">)</span><span class="main">)</span>
                           <span class="main">{</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>diamond_x<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> diamond_x<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="free">d</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
                            <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>diamond_x<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="free">d</span><span class="main">/</span><span class="numeral">2</span> <span class="main">-</span> diamond_x<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>diamond_x<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="free">d</span><span class="main">/</span><span class="numeral">2</span> <span class="main">-</span> diamond_x<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?G</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>diamond_x<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> diamond_x<span class="main">(</span><span class="bound">x</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="free">d</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="var">?G</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="var">?F</span><span class="main">)</span><span class="main">]</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> rj<span class="main">:</span> <span class="quoted"><span class="quoted">"rec_join <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="var">?G</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="var">?F</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span>diamond_y <span class="main">(</span>diamond_x <span class="bound">y</span><span class="main">)</span><span class="main">,</span> diamond_x <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> d_gt_0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subpath_def diamond_x_def diamond_y_def joinpaths_def reversepath_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pathfinish <span class="var">?F</span> <span class="main">=</span> pathfinish <span class="var">?G</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> d_gt_0 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subpath_def diamond_x_def diamond_y_def pathfinish_def pathstart_def<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> val<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_chain_list <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="var">?G</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="var">?F</span><span class="main">)</span><span class="main">]</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  join_subpaths_middle<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> chain_subdiv_path.I <span class="main">[</span><span class="operator">OF</span> dist rj val<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span>vertical_boundary <span class="main">(</span>rot_diamond_cube<span class="main">)</span> <span class="main">-</span> <span class="var">?pi</span><span class="main">.</span>
                           <span class="keyword1">if</span> <span class="bound">k</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> chain_subdiv_path <span class="bound">γ</span> <span class="main">(</span><span class="var">?f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">)</span>
                           <span class="keyword1">else</span> chain_subdiv_path <span class="main">(</span>reversepath <span class="bound">γ</span><span class="main">)</span> <span class="main">(</span><span class="var">?f</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>vertical_boundary <span class="main">(</span>rot_diamond_cube<span class="main">)</span> <span class="main">-</span> <span class="var">?pi</span><span class="main">.</span>
                         <span class="main">∀</span><span class="bound">p'</span><span class="main">∈</span>vertical_boundary <span class="main">(</span>rot_diamond_cube<span class="main">)</span> <span class="main">-</span> <span class="var">?pi</span><span class="main">.</span>
                              <span class="bound">p</span> <span class="main">≠</span> <span class="bound">p'</span> <span class="main">⟶</span> <span class="var">?f</span> <span class="bound">p</span> <span class="main">∩</span> <span class="var">?f</span> <span class="bound">p'</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>vertical_boundary <span class="main">(</span>rot_diamond_cube<span class="main">)</span> <span class="main">-</span> <span class="var">?pi</span><span class="main">.</span> finite <span class="main">(</span><span class="var">?f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rot_diamond_cube_boundary_to_subdiv_def 1 diamond_left_edges_def 
            diamond_right_edges_def diamond_bot_left_edge_def diamond_bot_right_edge_def 
            diamond_top_left_edge_def diamond_top_right_edge_def neqs1<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">::</span>int<span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="var">?subdiv</span><span class="main">.</span> valid_path <span class="bound">γ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diamond_edges_are_valid prod.case_eq_if set_eq_iff<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"boundary_chain <span class="var">?subdiv</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundary_chain_def diamond_top_left_edge_def diamond_top_right_edge_def diamond_bot_left_edge_def diamond_bot_right_edge_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="var">?pi</span><span class="main">.</span> point_path <span class="bound">γ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> d_gt_0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> point_path_def diamond_x_def diamond_y_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span><span class="var">?pj</span><span class="main">.</span> point_path <span class="bound">γ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> d_gt_0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> point_path_def diamond_x_def diamond_y_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"common_sudiv_exists <span class="main">(</span>two_chain_vertical_boundary <span class="main">{</span>rot_diamond_cube<span class="main">}</span><span class="main">)</span> <span class="main">(</span>boundary diamond_cube<span class="main">)</span> <span class="main">∨</span>
        common_reparam_exists <span class="main">(</span>boundary diamond_cube<span class="main">)</span> <span class="main">(</span>two_chain_vertical_boundary <span class="main">{</span>rot_diamond_cube<span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 0 1 2 diamond_cube_boundary_valid <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">rot_y</span> <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span> diamond_y_gen <span class="main">(</span>x_coord <span class="main">(</span>rot_x <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>

<span class="keyword1" id="DiamExample-rot_y_ivl"><span class="command">lemma</span></span> rot_y_ivl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> rot_y <span class="free">x</span> <span class="free">y</span> <span class="main">∧</span> rot_y <span class="free">x</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x_coord_def diamond_y_gen_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> linorder_class.not_le abs_if<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> mult_nonneg_nonneg <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">using</span></span> dual_order.order_iff_strict <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">sos</span> <span class="quoted">"(((((A&lt;0 * A&lt;1) * R&lt;1) + (((A&lt;=4 * (A&lt;1 * R&lt;1)) * (R&lt;1/2 * [1]^2)) + (((A&lt;=3 * (A&lt;0 * R&lt;1)) * (R&lt;1/2 * [1]^2)) + ((A&lt;=0 * (A&lt;=2 * (A&lt;=3 * R&lt;1))) * (R&lt;1 * [1]^2)))))) &amp; ((((A&lt;0 * A&lt;1) * R&lt;1) + (((A&lt;=4 * (A&lt;1 * R&lt;1)) * (R&lt;1/3 * [1]^2)) + (((A&lt;=4 * (A&lt;0 * R&lt;1)) * (R&lt;1/3 * [1]^2)) + ((A&lt;=3 * (A&lt;=4 * R&lt;1)) * (R&lt;1/3 * [1]^2)))))))"</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> mult_left_le_one_le <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> affine_ineq <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="DiamExample-diamond_gen_eq_rot_diamond"><span class="command">lemma</span></span> diamond_gen_eq_rot_diamond<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>diamond_cube_gen <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>rot_diamond_cube <span class="main">(</span>rot_y <span class="free">x</span> <span class="free">y</span><span class="main">,</span> rot_x <span class="free">x</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>diamond_cube_gen <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>rot_diamond_cube <span class="main">(</span>rot_y <span class="free">x</span> <span class="free">y</span><span class="main">,</span> rot_x <span class="free">x</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> rot_diamond_cube_def diamond_eq_characterisations_fun<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  diamond_cube_gen_def x_coord_def diamond_y_gen_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>diamond_cube_gen <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>rot_diamond_cube <span class="main">(</span>rot_y <span class="free">x</span> <span class="free">y</span><span class="main">,</span> rot_x <span class="free">x</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diamond_cube_gen_def rot_diamond_cube_def diamond_eq_characterisations_fun<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x_coord_def diamond_y_gen_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> abs_if <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">sos</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="DiamExample-rot_diamond_eq_diamond_gen"><span class="command">lemma</span></span> rot_diamond_eq_diamond_gen<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rot_diamond_cube <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> diamond_cube_gen <span class="main">(</span>rot_x <span class="free">y</span> <span class="free">x</span><span class="main">,</span> rot_y <span class="free">y</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>rot_diamond_cube <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>diamond_cube_gen <span class="main">(</span>rot_x <span class="free">y</span> <span class="free">x</span><span class="main">,</span> rot_y <span class="free">y</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> rot_diamond_cube_def diamond_eq_characterisations_fun<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  diamond_cube_gen_def x_coord_def diamond_y_gen_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>rot_diamond_cube <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>diamond_cube_gen <span class="main">(</span>rot_x <span class="free">y</span> <span class="free">x</span><span class="main">,</span> rot_y <span class="free">y</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diamond_cube_gen_def rot_diamond_cube_def diamond_eq_characterisations_fun<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x_coord_def diamond_y_gen_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> abs_if <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">sos</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="DiamExample-rot_img_eq"><span class="command">lemma</span></span> rot_img_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"cubeImage <span class="main">(</span>diamond_cube_gen<span class="main">)</span> <span class="main">=</span> cubeImage <span class="main">(</span>rot_diamond_cube<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cubeImage_def image_def cbox_def real_pair_basis<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">a</span></span><span class="main">≥</span><span class="main">0</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">b</span></span><span class="main">≥</span><span class="main">0</span><span class="main">.</span> <span class="bound">b</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">∧</span> diamond_cube_gen <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> rot_diamond_cube <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> diamond_cube_gen <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"rot_y <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"rot_x <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="var">?a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rot_y_ivl that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="var">?b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?b</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rot_x_ivl that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"diamond_cube_gen <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> rot_diamond_cube <span class="main">(</span><span class="var">?a</span><span class="main">,</span> <span class="var">?b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that d_gt_0 diamond_gen_eq_rot_diamond <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">a</span></span><span class="main">≥</span><span class="main">0</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">b</span></span><span class="main">≥</span><span class="main">0</span><span class="main">.</span> <span class="bound">b</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">∧</span> rot_diamond_cube <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> diamond_cube_gen <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> rot_diamond_cube <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"rot_x <span class="skolem">y</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"rot_y <span class="skolem">y</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="var">?a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rot_x_ivl that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="var">?b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?b</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rot_y_ivl that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rot_diamond_cube <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> diamond_cube_gen <span class="main">(</span><span class="var">?a</span><span class="main">,</span> <span class="var">?b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that d_gt_0 rot_diamond_eq_diamond_gen <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="DiamExample-rot_diamond_gen_div_diamond_gen"><span class="command">lemma</span></span> rot_diamond_gen_div_diamond_gen<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"gen_division <span class="main">(</span>cubeImage <span class="main">(</span>diamond_cube_gen<span class="main">)</span><span class="main">)</span> <span class="main">(</span>cubeImage <span class="main">`</span> <span class="main">{</span>rot_diamond_cube<span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> rot_img_eq <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gen_division_def<span class="main">)</span>

<span class="keyword1" id="DiamExample-rot_diamond_gen_div_diamond"><span class="command">lemma</span></span> rot_diamond_gen_div_diamond<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"gen_division <span class="main">(</span>cubeImage <span class="main">(</span>diamond_cube<span class="main">)</span><span class="main">)</span> <span class="main">(</span>cubeImage <span class="main">`</span> <span class="main">{</span>rot_diamond_cube<span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> rot_diamond_gen_div_diamond_gen
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> diamond_eq_characterisations_fun<span class="main">)</span>

<span class="keyword1" id="DiamExample-GreenThm_diamond"><span class="command">lemma</span></span> GreenThm_diamond<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"analytically_valid <span class="main">(</span>cubeImage <span class="main">(</span>diamond_cube<span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="free">j</span>"</span></span>
    <span class="quoted"><span class="quoted">"analytically_valid <span class="main">(</span>cubeImage <span class="main">(</span>diamond_cube<span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"integral <span class="main">(</span>cubeImage <span class="main">(</span>diamond_cube<span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="free">i</span> <span class="bound">x</span> <span class="main">-</span> partial_vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="free">j</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span>
         one_chain_line_integral <span class="free">F</span> <span class="main">{</span><span class="free">i</span><span class="main">,</span> <span class="free">j</span><span class="main">}</span> <span class="main">(</span>boundary <span class="main">(</span>diamond_cube<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">γ</span><span class="main">)</span><span class="main">∈</span>boundary <span class="main">(</span>diamond_cube<span class="main">)</span><span class="main">.</span> valid_path <span class="bound">γ</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> diamond_cube_boundary_valid d_gt_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">twoCube</span><span class="main">.</span> <span class="bound">twoCube</span> <span class="main">∈</span> <span class="main">{</span>diamond_cube<span class="main">}</span> <span class="main">⟹</span> typeI_twoCube <span class="bound">twoCube</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms diamond_cube_is_type_I <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_two_chain <span class="main">{</span>diamond_cube<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> diamond_cube_valid_two_cube valid_two_chain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gen_division <span class="main">(</span>cubeImage <span class="main">(</span>diamond_cube<span class="main">)</span><span class="main">)</span> <span class="main">(</span>cubeImage <span class="main">`</span> <span class="main">{</span>diamond_cube<span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gen_division_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">twoCube</span><span class="main">∈</span><span class="main">(</span><span class="main">{</span>rot_diamond_cube<span class="main">}</span><span class="main">)</span><span class="main">.</span> typeII_twoCube <span class="bound">twoCube</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms rot_diamond_cube_is_type_II <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_two_chain <span class="main">{</span>rot_diamond_cube<span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> rot_diamond_cube_valid_two_cube valid_two_chain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gen_division <span class="main">(</span>cubeImage <span class="main">(</span>diamond_cube<span class="main">)</span><span class="main">)</span> <span class="main">(</span>cubeImage <span class="main">`</span> <span class="main">{</span>rot_diamond_cube<span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rot_diamond_gen_div_diamond <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"only_vertical_division <span class="main">(</span>boundary <span class="main">(</span>diamond_cube<span class="main">)</span><span class="main">)</span> <span class="main">{</span>diamond_cube<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> twoChainVertDiv_of_itself<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>diamond_cube<span class="main">}</span>"</span></span><span class="main">]</span> diamond_cube_boundary_valid assms
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> two_chain_boundary_def<span class="main">)</span>                                      
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">twoC</span><span class="main">∈</span><span class="main">{</span>diamond_cube<span class="main">}</span><span class="main">.</span> analytically_valid <span class="main">(</span>cubeImage <span class="bound">twoC</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">i</span><span class="main">)</span> <span class="free">j</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">twoC</span><span class="main">∈</span><span class="main">{</span>rot_diamond_cube<span class="main">}</span><span class="main">.</span> analytically_valid <span class="main">(</span>cubeImage <span class="bound">twoC</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">∙</span> <span class="free">j</span><span class="main">)</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms diamond_eq_characterisations_fun rot_img_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> green_typeI_typeII_chain.GreenThm_typeI_typeII_divisible_region_finite_holes<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cubeImage <span class="main">(</span>diamond_cube<span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">j</span></span> <span class="quoted"><span class="free">F</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>diamond_cube<span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>rot_diamond_cube<span class="main">}</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> _ 0 3 diamond_cube_is_only_horizontal_div_of_rot _<span class="main">]</span>
      R2_axioms 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> green_typeI_typeII_chain_def green_typeI_chain_def green_typeII_chain_def green_typeI_chain_axioms_def green_typeII_chain_axioms_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>