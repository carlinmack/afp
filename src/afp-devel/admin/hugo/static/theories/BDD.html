<div id="BinDag">
<div class="head">
<h1>Theory BinDag</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       BDD
    Author:      Veronika Ortner and Norbert Schirmer, 2004
    Maintainer:  Norbert Schirmer,  norbert.schirmer at web de
    License:     LGPL
*)</span>

<span class="comment1">(*  
BinDag.thy

Copyright (C) 2004-2008 Veronika Ortner and Norbert Schirmer 
Some rights reserved, TU Muenchen

This library is free software; you can redistribute it and/or modify
it under the terms of the GNU Lesser General Public License as
published by the Free Software Foundation; either version 2.1 of the
License, or (at your option) any later version.

This library is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
Lesser General Public License for more details.

You should have received a copy of the GNU Lesser General Public
License along with this library; if not, write to the Free Software
Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307
USA
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹BDD Abstractions›</span></span>

<span class="keyword1"><span class="command">theory</span></span> BinDag
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../Simpl/Simpl_Heap.html">Simpl.Simpl_Heap</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">datatype</span></span> dag <span class="main">=</span> Tip <span class="main">|</span> Node <span class="quoted">dag</span> <span class="quoted">ref</span> <span class="quoted">dag</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Node <span class="free">lt</span> <span class="free">a</span> <span class="free">rt</span> <span class="main">≠</span> <span class="free">lt</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">lt</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">lt</span> <span class="main">≠</span> Node <span class="free">lt</span> <span class="free">a</span> <span class="free">rt</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">lt</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Node <span class="free">lt</span> <span class="free">a</span> <span class="free">rt</span> <span class="main">≠</span> <span class="free">rt</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">rt</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">rt</span> <span class="main">≠</span> Node <span class="free">lt</span> <span class="free">a</span> <span class="free">rt</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">rt</span></span><span class="main">)</span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">set_of</span><span class="main">::</span> <span class="quoted"><span class="quoted">"dag <span class="main">⇒</span> ref set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  set_of_Tip<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">set_of</span> Tip <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="main">|</span> set_of_Node<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">set_of</span> <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">lt</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">rt</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">}</span> <span class="main">∪</span> <span class="free">set_of</span> <span class="free"><span class="bound"><span class="entity">lt</span></span></span> <span class="main">∪</span> <span class="free">set_of</span> <span class="free"><span class="bound"><span class="entity">rt</span></span></span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">DAG</span><span class="main">::</span> <span class="quoted"><span class="quoted">"dag <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">DAG</span> Tip <span class="main">=</span> True"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">DAG</span> <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∉</span> set_of <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∉</span> set_of <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">∧</span> <span class="free">DAG</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">∧</span> <span class="free">DAG</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">subdag</span><span class="main">::</span> <span class="quoted"><span class="quoted">"dag <span class="main">⇒</span> dag <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">subdag</span> Tip <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> False"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">subdag</span> <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">∨</span> <span class="free">subdag</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">∨</span> <span class="free">subdag</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="BinDag-subdag_size"><span class="command">lemma</span></span> subdag_size<span class="main">:</span> <span class="quoted"><span class="quoted">"subdag <span class="free">t</span> <span class="free">s</span> <span class="main">⟹</span> size <span class="free">s</span> <span class="main">&lt;</span> size <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span>  <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="BinDag-subdag_neq"><span class="command">lemma</span></span> subdag_neq<span class="main">:</span> <span class="quoted"><span class="quoted">"subdag <span class="free">t</span> <span class="free">s</span> <span class="main">⟹</span> <span class="free">t</span><span class="main">≠</span><span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> subdag_size<span class="main">)</span>

<span class="keyword1" id="BinDag-subdag_trans"><span class="command">lemma</span></span> subdag_trans <span class="main">[</span><span class="operator">trans</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"subdag <span class="free">t</span> <span class="free">s</span> <span class="main">⟹</span> subdag <span class="free">s</span> <span class="free">r</span> <span class="main">⟹</span> subdag <span class="free">t</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="BinDag-subdag_NodeD"><span class="command">lemma</span></span> subdag_NodeD<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"subdag <span class="free">t</span> <span class="main">(</span>Node <span class="free">lt</span> <span class="free">a</span> <span class="free">rt</span><span class="main">)</span> <span class="main">⟹</span> subdag <span class="free">t</span> <span class="free">lt</span> <span class="main">∧</span> subdag <span class="free">t</span> <span class="free">rt</span>"</span></span>  
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="BinDag-subdag_not_sym"><span class="command">lemma</span></span> subdag_not_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span><span class="main">.</span> <span class="main">⟦</span>subdag <span class="free">s</span> <span class="bound">t</span><span class="main">;</span> subdag <span class="bound">t</span> <span class="free">s</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">s</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> subdag_NodeD<span class="main">)</span>

<span class="keyword1"><span class="command">instantiation</span></span> dag <span class="main">::</span> <span class="quoted">order</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  less_dag_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">&lt;</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">::</span>dag<span class="main">)</span> <span class="main">⟷</span> subdag <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  le_dag_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≤</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">::</span>dag<span class="main">)</span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span>

<span class="keyword1" id="BinDag-le_dag_refl"><span class="command">lemma</span></span> le_dag_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">::</span>dag<span class="main">)</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_dag_def<span class="main">)</span>

<span class="keyword1" id="BinDag-le_dag_trans"><span class="command">lemma</span></span> le_dag_trans<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted">dag</span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="free">y</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">z</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> x_y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y_z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="free">z</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">=</span><span class="free">y</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">with</span></span> y_z <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">note</span></span> x_neq_y <span class="main">=</span> this
  <span class="keyword1"><span class="command">with</span></span> x_y <span class="keyword1"><span class="command">have</span></span> x_less_y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_dag_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">=</span><span class="free">z</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> x_y <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> y_z <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">&lt;</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_dag_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> x_less_y <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="free">z</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_dag_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> subdag_trans<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_dag_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="BinDag-le_dag_antisym"><span class="command">lemma</span></span> le_dag_antisym<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted">dag</span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="free">y</span>   
  <span class="keyword2"><span class="keyword">assumes</span></span> x_y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y_x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">=</span><span class="free">y</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">with</span></span> x_y y_x <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_dag_def le_dag_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> subdag_not_sym<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="BinDag-dag_less_le"><span class="command">lemma</span></span> dag_less_le<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted">dag</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">y</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_dag_def le_dag_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> subdag_neq<span class="main">)</span>
 
<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dag_less_le le_dag_refl <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> le_dag_trans <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> le_dag_antisym<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="BinDag-less_dag_Tip"><span class="command">lemma</span></span> less_dag_Tip <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">x</span> <span class="main">&lt;</span> Tip<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_dag_def<span class="main">)</span>

<span class="keyword1" id="BinDag-less_dag_Node"><span class="command">lemma</span></span> less_dag_Node<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="main">(</span>Node <span class="free">l</span> <span class="free">a</span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="free">x</span> <span class="main">≤</span> <span class="free">l</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order_le_less less_dag_def<span class="main">)</span>

<span class="keyword1" id="BinDag-less_dag_Node'"><span class="command">lemma</span></span> less_dag_Node'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="main">(</span>Node <span class="free">l</span> <span class="free">a</span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="free">x</span><span class="main">=</span><span class="free">l</span> <span class="main">∨</span> <span class="free">x</span><span class="main">=</span><span class="free">r</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free">l</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free">r</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_dag_def<span class="main">)</span>

<span class="keyword1" id="BinDag-less_Node_dag"><span class="command">lemma</span></span> less_Node_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Node <span class="free">l</span> <span class="free">a</span> <span class="free">r</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">l</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="main">∧</span> <span class="free">r</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_dag_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> subdag_NodeD<span class="main">)</span>

<span class="keyword1" id="BinDag-less_dag_set_of"><span class="command">lemma</span></span> less_dag_set_of<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span> <span class="main">⟹</span> set_of <span class="free">x</span> <span class="main">⊆</span> set_of <span class="free">y</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> less_dag_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="BinDag-le_dag_set_of"><span class="command">lemma</span></span> le_dag_set_of<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> set_of <span class="free">x</span> <span class="main">⊆</span> set_of <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> le_dag_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> less_dag_set_of<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="BinDag-DAG_less"><span class="command">lemma</span></span> DAG_less<span class="main">:</span> <span class="quoted"><span class="quoted">"DAG <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span> <span class="main">⟹</span> DAG <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">y</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_dag_Node'<span class="main">)</span>

<span class="keyword1" id="BinDag-less_DAG_set_of"><span class="command">lemma</span></span> less_DAG_set_of<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> x_less_y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span>"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> DAG_y<span class="main">:</span> <span class="quoted"><span class="quoted">"DAG <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set_of <span class="free">x</span> <span class="main">⊂</span> set_of <span class="free">y</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Tip <span class="keyword1"><span class="command">with</span></span> x_less_y <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">l</span> <span class="skolem">a</span> <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> DAG_y <span class="keyword3"><span class="command">obtain</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∉</span> set_of <span class="skolem">l</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∉</span> set_of <span class="skolem">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> Node <span class="keyword3"><span class="command">obtain</span></span> l_less_y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">&lt;</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> r_less_y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">&lt;</span> <span class="free">y</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_dag_Node<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Node a <span class="keyword3"><span class="command">obtain</span></span> 
    l_subset_y<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">l</span> <span class="main">⊂</span> set_of <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    r_subset_y<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">r</span> <span class="main">⊂</span> set_of <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> Node x_less_y <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">=</span><span class="skolem">l</span> <span class="main">∨</span> <span class="free">x</span><span class="main">=</span><span class="skolem">r</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="skolem">l</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="skolem">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_dag_Node'<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> disjE<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">=</span><span class="skolem">l</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> l_subset_y <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">=</span><span class="skolem">r</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> r_subset_y <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="skolem">l</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"set_of <span class="free">x</span> <span class="main">⊆</span> set_of <span class="skolem">l</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> less_dag_set_of<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> l_subset_y
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="skolem">r</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"set_of <span class="free">x</span> <span class="main">⊆</span> set_of <span class="skolem">r</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> less_dag_set_of<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> r_subset_y
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span> 
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="BinDag-in_set_of_decomp"><span class="command">lemma</span></span> in_set_of_decomp<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> set_of <span class="free">t</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">l</span> <span class="bound">r</span><span class="main">.</span> <span class="free">t</span><span class="main">=</span><span class="main">(</span>Node <span class="bound">l</span> <span class="free">p</span> <span class="bound">r</span><span class="main">)</span> <span class="main">∨</span> subdag <span class="free">t</span> <span class="main">(</span>Node <span class="bound">l</span> <span class="free">p</span> <span class="bound">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="var">?B</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">Dag</span><span class="main">::</span> <span class="quoted"><span class="quoted">"ref <span class="main">⇒</span> <span class="main">(</span>ref <span class="main">⇒</span> ref<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>ref <span class="main">⇒</span> ref<span class="main">)</span> <span class="main">⇒</span> dag <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Dag</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> Tip <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> Null<span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">Dag</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">lt</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">rt</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≠</span> Null <span class="main">∧</span> 
                              <span class="free">Dag</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">lt</span></span></span> <span class="main">∧</span> <span class="free">Dag</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span>  <span class="free"><span class="bound"><span class="entity">rt</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="BinDag-Dag_Null"><span class="command">lemma</span></span> Dag_Null <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Dag Null <span class="free">l</span> <span class="free">r</span>  <span class="free">t</span> <span class="main">=</span> <span class="main">(</span><span class="free">t</span> <span class="main">=</span> Tip<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="BinDag-Dag_Ref"><span class="command">lemma</span></span> Dag_Ref <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span>Null <span class="main">⟹</span> Dag <span class="free">p</span> <span class="free">l</span> <span class="free">r</span>  <span class="free">t</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">lt</span> <span class="bound">rt</span><span class="main">.</span> <span class="free">t</span><span class="main">=</span>Node <span class="bound">lt</span> <span class="free">p</span> <span class="bound">rt</span> <span class="main">∧</span> 
                                Dag <span class="main">(</span><span class="free">l</span> <span class="free">p</span><span class="main">)</span> <span class="free">l</span> <span class="free">r</span> <span class="bound">lt</span> <span class="main">∧</span> Dag <span class="main">(</span><span class="free">r</span> <span class="free">p</span><span class="main">)</span> <span class="free">l</span> <span class="free">r</span> <span class="bound">rt</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="BinDag-Null_notin_Dag"><span class="command">lemma</span></span> Null_notin_Dag <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span> <span class="bound">l</span> <span class="bound">r</span><span class="main">.</span> Dag <span class="bound">p</span> <span class="bound">l</span> <span class="bound">r</span> <span class="free">t</span> <span class="main">⟹</span> Null <span class="main">∉</span> set_of <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> notin_Dag_update_l <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">p</span><span class="main">.</span> <span class="free">q</span> <span class="main">∉</span> set_of <span class="free">t</span> <span class="main">⟹</span> Dag <span class="bound">p</span> <span class="main">(</span><span class="free">l</span><span class="main">(</span><span class="free">q</span> <span class="main">:=</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="free">r</span>  <span class="free">t</span> <span class="main">=</span> Dag <span class="bound">p</span> <span class="free">l</span> <span class="free">r</span> <span class="free">t</span>"</span></span>  
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> notin_Dag_update_r <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">p</span><span class="main">.</span> <span class="free">q</span> <span class="main">∉</span> set_of <span class="free">t</span> <span class="main">⟹</span> Dag <span class="bound">p</span> <span class="free">l</span> <span class="main">(</span><span class="free">r</span><span class="main">(</span><span class="free">q</span> <span class="main">:=</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="free">t</span> <span class="main">=</span> Dag <span class="bound">p</span> <span class="free">l</span> <span class="free">r</span> <span class="free">t</span>"</span></span>  
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="operator">auto</span>


<span class="keyword1" id="BinDag-Dag_upd_same_l_lemma"><span class="command">lemma</span></span> Dag_upd_same_l_lemma<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span><span class="main">≠</span>Null <span class="main">⟹</span> <span class="main">¬</span> Dag <span class="bound">p</span> <span class="main">(</span><span class="free">l</span><span class="main">(</span><span class="bound">p</span><span class="main">:=</span><span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="free">r</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_simp</span><span class="main"><span class="main">)</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_simp</span><span class="main"><span class="main">)</span></span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fun_upd_apply refl if_True<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="BinDag-Dag_upd_same_l"><span class="command">lemma</span></span> Dag_upd_same_l <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="free">p</span> <span class="main">(</span><span class="free">l</span><span class="main">(</span><span class="free">p</span><span class="main">:=</span><span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="free">r</span> <span class="free">t</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span><span class="main">=</span>Null <span class="main">∧</span> <span class="free">t</span><span class="main">=</span>Tip<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span>Null"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> Dag_upd_same_l_lemma<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[source] Dag_upd_same_l<span class="antiquote"><span class="antiquote">}</span></span></span></span> prevents 
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">p</span></span><span class="main"><span class="main">≠</span></span>Null <span class="main"><span class="main">⟹</span></span> Dag <span class="free"><span class="free">p</span></span> <span class="main"><span class="main">(</span></span><span class="free"><span class="free">l</span></span><span class="main"><span class="main">(</span></span><span class="free"><span class="free">p</span></span><span class="main"><span class="main">:=</span></span><span class="free"><span class="free">p</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span> <span class="free"><span class="free">r</span></span> <span class="free"><span class="free">t</span></span> <span class="main"><span class="main">=</span></span> <span class="free"><span class="free">X</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> from looping, because of 
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[source] Dag_Ref<span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[source] fun_upd_apply<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>

<span class="keyword1" id="BinDag-Dag_upd_same_r_lemma"><span class="command">lemma</span></span> Dag_upd_same_r_lemma<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span><span class="main">≠</span>Null <span class="main">⟹</span> <span class="main">¬</span> Dag <span class="bound">p</span> <span class="free">l</span> <span class="main">(</span><span class="free">r</span><span class="main">(</span><span class="bound">p</span><span class="main">:=</span><span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_simp</span><span class="main"><span class="main">)</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_simp</span><span class="main"><span class="main">)</span></span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fun_upd_apply refl if_True<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="BinDag-Dag_upd_same_r"><span class="command">lemma</span></span> Dag_upd_same_r <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="free">p</span> <span class="free">l</span> <span class="main">(</span><span class="free">r</span><span class="main">(</span><span class="free">p</span><span class="main">:=</span><span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="free">t</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span><span class="main">=</span>Null <span class="main">∧</span> <span class="free">t</span><span class="main">=</span>Tip<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span>Null"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> Dag_upd_same_r_lemma<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="BinDag-Dag_update_l_new"><span class="command">lemma</span></span>  Dag_update_l_new <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>set_of <span class="free">t</span> <span class="main">⊆</span> set <span class="free">alloc</span><span class="main">⟧</span>
     <span class="main">⟹</span> Dag <span class="free">p</span> <span class="main">(</span><span class="free">l</span><span class="main">(</span>new <span class="main">(</span>set <span class="free">alloc</span><span class="main">)</span> <span class="main">:=</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="free">r</span> <span class="free">t</span> <span class="main">=</span> Dag <span class="free">p</span> <span class="free">l</span> <span class="free">r</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> notin_Dag_update_l<span class="main">)</span> <span class="operator">fastforce</span>

<span class="keyword1" id="BinDag-Dag_update_r_new"><span class="command">lemma</span></span>  Dag_update_r_new <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>set_of <span class="free">t</span> <span class="main">⊆</span> set <span class="free">alloc</span><span class="main">⟧</span>
     <span class="main">⟹</span> Dag <span class="free">p</span> <span class="free">l</span> <span class="main">(</span><span class="free">r</span><span class="main">(</span>new <span class="main">(</span>set <span class="free">alloc</span><span class="main">)</span> <span class="main">:=</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="free">t</span> <span class="main">=</span> Dag <span class="free">p</span> <span class="free">l</span> <span class="free">r</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> notin_Dag_update_r<span class="main">)</span> <span class="operator">fastforce</span>

<span class="keyword1" id="BinDag-Dag_update_lI"><span class="command">lemma</span></span> Dag_update_lI <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Dag <span class="free">p</span> <span class="free">l</span> <span class="free">r</span> <span class="free">t</span><span class="main">;</span> <span class="free">q</span> <span class="main">∉</span> set_of <span class="free">t</span><span class="main">⟧</span> <span class="main">⟹</span> Dag <span class="free">p</span> <span class="main">(</span><span class="free">l</span><span class="main">(</span><span class="free">q</span> <span class="main">:=</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="free">r</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="BinDag-Dag_update_rI"><span class="command">lemma</span></span> Dag_update_rI <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Dag <span class="free">p</span> <span class="free">l</span> <span class="free">r</span> <span class="free">t</span><span class="main">;</span> <span class="free">q</span> <span class="main">∉</span> set_of <span class="free">t</span><span class="main">⟧</span> <span class="main">⟹</span> Dag <span class="free">p</span> <span class="free">l</span> <span class="main">(</span><span class="free">r</span><span class="main">(</span><span class="free">q</span> <span class="main">:=</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="BinDag-Dag_unique"><span class="command">lemma</span></span> Dag_unique<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">p</span> <span class="bound">t2</span><span class="main">.</span> Dag <span class="bound">p</span> <span class="free">l</span> <span class="free">r</span> <span class="free">t1</span> <span class="main">⟹</span> Dag <span class="bound">p</span> <span class="free">l</span> <span class="free">r</span> <span class="bound">t2</span> <span class="main">⟹</span> <span class="free">t1</span><span class="main">=</span><span class="bound">t2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t1</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="BinDag-Dag_unique1"><span class="command">lemma</span></span> Dag_unique1<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="free">p</span> <span class="free">l</span> <span class="free">r</span> <span class="free">t</span> <span class="main">⟹</span> <span class="main">∃!</span><span class="bound">t</span><span class="main">.</span> Dag <span class="free">p</span> <span class="free">l</span> <span class="free">r</span> <span class="bound">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Dag_unique<span class="main">)</span>

<span class="keyword1" id="BinDag-Dag_subdag"><span class="command">lemma</span></span> Dag_subdag<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">p</span><span class="main">.</span> Dag <span class="bound">p</span> <span class="free">l</span> <span class="free">r</span> <span class="free">t</span> <span class="main">⟹</span> subdag <span class="free">t</span> <span class="free">s</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">q</span><span class="main">.</span> Dag <span class="bound">q</span> <span class="free">l</span> <span class="free">r</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="BinDag-Dag_root_not_in_subdag_l"><span class="command">lemma</span></span> Dag_root_not_in_subdag_l <span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="free">l</span> <span class="free">p</span><span class="main">)</span> <span class="free">l</span> <span class="free">r</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∉</span> set_of <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">lt</span> <span class="skolem">rt</span>
    <span class="keyword3"><span class="command">assume</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> Node <span class="skolem">lt</span> <span class="free">p</span> <span class="skolem">rt</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="free">l</span> <span class="free">p</span><span class="main">)</span> <span class="free">l</span> <span class="free">r</span> <span class="skolem">lt</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> t Dag.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span><span class="main">=</span><span class="skolem">lt</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Dag_unique<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> t <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">lt</span> <span class="skolem">rt</span>
    <span class="keyword3"><span class="command">assume</span></span> subdag<span class="main">:</span> <span class="quoted"><span class="quoted">"subdag <span class="free">t</span> <span class="main">(</span>Node <span class="skolem">lt</span> <span class="free">p</span> <span class="skolem">rt</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"Dag <span class="skolem">q</span> <span class="free">l</span> <span class="free">r</span> <span class="main">(</span>Node <span class="skolem">lt</span> <span class="free">p</span> <span class="skolem">rt</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Dag_subdag <span class="main"><span class="main">[</span></span><span class="operator">elim_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">iprover</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="free">l</span> <span class="free">p</span><span class="main">)</span> <span class="free">l</span> <span class="free">r</span> <span class="skolem">lt</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span><span class="main">=</span><span class="skolem">lt</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Dag_unique<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subdag <span class="free">t</span> <span class="skolem">lt</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">note</span></span> subdag
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subdag <span class="main">(</span>Node <span class="skolem">lt</span> <span class="free">p</span> <span class="skolem">rt</span><span class="main">)</span> <span class="skolem">lt</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subdag_neq<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_set_of_decomp<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="BinDag-Dag_root_not_in_subdag_r"><span class="command">lemma</span></span> Dag_root_not_in_subdag_r <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="free">r</span> <span class="free">p</span><span class="main">)</span> <span class="free">l</span> <span class="free">r</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∉</span> set_of <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">lt</span> <span class="skolem">rt</span>
    <span class="keyword3"><span class="command">assume</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> Node <span class="skolem">lt</span> <span class="free">p</span> <span class="skolem">rt</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="free">r</span> <span class="free">p</span><span class="main">)</span> <span class="free">l</span> <span class="free">r</span> <span class="skolem">rt</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> t Dag.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span><span class="main">=</span><span class="skolem">rt</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Dag_unique<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> t <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">lt</span> <span class="skolem">rt</span>
    <span class="keyword3"><span class="command">assume</span></span> subdag<span class="main">:</span> <span class="quoted"><span class="quoted">"subdag <span class="free">t</span> <span class="main">(</span>Node <span class="skolem">lt</span> <span class="free">p</span> <span class="skolem">rt</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"Dag <span class="skolem">q</span> <span class="free">l</span> <span class="free">r</span> <span class="main">(</span>Node <span class="skolem">lt</span> <span class="free">p</span> <span class="skolem">rt</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Dag_subdag <span class="main"><span class="main">[</span></span><span class="operator">elim_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">iprover</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="free">r</span> <span class="free">p</span><span class="main">)</span> <span class="free">l</span> <span class="free">r</span> <span class="skolem">rt</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span><span class="main">=</span><span class="skolem">rt</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Dag_unique<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subdag <span class="free">t</span> <span class="skolem">rt</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">note</span></span> subdag
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subdag <span class="main">(</span>Node <span class="skolem">lt</span> <span class="free">p</span> <span class="skolem">rt</span><span class="main">)</span> <span class="skolem">rt</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subdag_neq<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_set_of_decomp<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="BinDag-Dag_is_DAG"><span class="command">lemma</span></span> Dag_is_DAG<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span> <span class="bound">l</span> <span class="bound">r</span><span class="main">.</span> Dag <span class="bound">p</span> <span class="bound">l</span> <span class="bound">r</span> <span class="free">t</span> <span class="main">⟹</span> DAG <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="operator">auto</span>
 
<span class="keyword1" id="BinDag-heaps_eq_Dag_eq"><span class="command">lemma</span></span> heaps_eq_Dag_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set_of <span class="free">t</span><span class="main">.</span> <span class="free">l</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">l'</span> <span class="bound">x</span> <span class="main">∧</span> <span class="free">r</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">r'</span> <span class="bound">x</span> 
    <span class="main">⟹</span> Dag <span class="bound">p</span> <span class="free">l</span> <span class="free">r</span> <span class="free">t</span> <span class="main">=</span> Dag <span class="bound">p</span> <span class="free">l'</span> <span class="free">r'</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="BinDag-heaps_eq_DagI1"><span class="command">lemma</span></span> heaps_eq_DagI1<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Dag <span class="free">p</span> <span class="free">l</span> <span class="free">r</span> <span class="free">t</span><span class="main">;</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set_of <span class="free">t</span><span class="main">.</span> <span class="free">l</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">l'</span> <span class="bound">x</span> <span class="main">∧</span> <span class="free">r</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">r'</span> <span class="bound">x</span><span class="main">⟧</span>
    <span class="main">⟹</span> Dag <span class="free">p</span> <span class="free">l'</span> <span class="free">r'</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> heaps_eq_Dag_eq <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="BinDag-heaps_eq_DagI2"><span class="command">lemma</span></span> heaps_eq_DagI2<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Dag <span class="free">p</span> <span class="free">l'</span> <span class="free">r'</span> <span class="free">t</span><span class="main">;</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set_of <span class="free">t</span><span class="main">.</span> <span class="free">l</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">l'</span> <span class="bound">x</span> <span class="main">∧</span> <span class="free">r</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">r'</span> <span class="bound">x</span><span class="main">⟧</span>
    <span class="main">⟹</span> Dag <span class="free">p</span> <span class="free">l</span> <span class="free">r</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> heaps_eq_Dag_eq <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
 
<span class="keyword1" id="BinDag-Dag_unique_all_impl_simp"><span class="command">lemma</span></span>  Dag_unique_all_impl_simp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"Dag <span class="free">p</span> <span class="free">l</span> <span class="free">r</span> <span class="free">t</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">t</span><span class="main">.</span> Dag <span class="free">p</span> <span class="free">l</span> <span class="free">r</span> <span class="bound">t</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> Dag_unique<span class="main">)</span>

<span class="keyword1" id="BinDag-Dag_unique_ex_conj_simp"><span class="command">lemma</span></span> Dag_unique_ex_conj_simp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"Dag <span class="free">p</span> <span class="free">l</span> <span class="free">r</span> <span class="free">t</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span><span class="main">.</span> Dag <span class="free">p</span> <span class="free">l</span> <span class="free">r</span> <span class="bound">t</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> Dag_unique<span class="main">)</span>

<span class="keyword1" id="BinDag-Dags_eq_hp_eq"><span class="command">lemma</span></span> Dags_eq_hp_eq<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span> <span class="bound">p'</span><span class="main">.</span> <span class="main">⟦</span>Dag <span class="bound">p</span> <span class="free">l</span> <span class="free">r</span> <span class="free">t</span><span class="main">;</span> Dag <span class="bound">p'</span> <span class="free">l'</span> <span class="free">r'</span> <span class="free">t</span><span class="main">⟧</span> <span class="main">⟹</span>
    <span class="bound">p'</span><span class="main">=</span><span class="bound">p</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">no</span> <span class="main">∈</span> set_of <span class="free">t</span><span class="main">.</span> <span class="free">l'</span> <span class="bound">no</span> <span class="main">=</span> <span class="free">l</span> <span class="bound">no</span> <span class="main">∧</span> <span class="free">r'</span> <span class="bound">no</span> <span class="main">=</span> <span class="free">r</span> <span class="bound">no</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">isDag</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ref <span class="main">⇒</span> <span class="main">(</span>ref <span class="main">⇒</span> ref<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>ref <span class="main">⇒</span> ref<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">isDag</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span><span class="main">.</span> Dag <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="bound">t</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dag</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ref <span class="main">⇒</span> <span class="main">(</span>ref <span class="main">⇒</span> ref<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>ref <span class="main">⇒</span> ref<span class="main">)</span> <span class="main">⇒</span> dag"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">dag</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">t</span><span class="main">.</span> Dag <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="bound">t</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="BinDag-Dag_conv_isDag_dag"><span class="command">lemma</span></span> Dag_conv_isDag_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="free">p</span> <span class="free">l</span> <span class="free">r</span> <span class="free">t</span> <span class="main">=</span> <span class="main">(</span>isDag <span class="free">p</span> <span class="free">l</span> <span class="free">r</span> <span class="main">∧</span> <span class="free">t</span><span class="main">=</span>dag <span class="free">p</span> <span class="free">l</span> <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isDag_def dag_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> the1_equality<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> Dag_unique1<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> refl<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> theI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> <span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Dag_unique<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="BinDag-Dag_dag"><span class="command">lemma</span></span> Dag_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="free">p</span> <span class="free">l</span> <span class="free">r</span> <span class="free">t</span> <span class="main">⟹</span> dag <span class="free">p</span> <span class="free">l</span> <span class="free">r</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Dag_conv_isDag_dag<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="General">
<div class="head">
<h1>Theory General</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       BDD
    Author:      Veronika Ortner and Norbert Schirmer, 2004
    Maintainer:  Norbert Schirmer,  norbert.schirmer at web de
    License:     LGPL
*)</span>

<span class="comment1">(*  
General.thy

Copyright (C) 2004-2008 Veronika Ortner and Norbert Schirmer 
Some rights reserved, TU Muenchen

This library is free software; you can redistribute it and/or modify
it under the terms of the GNU Lesser General Public License as
published by the Free Software Foundation; either version 2.1 of the
License, or (at your option) any later version.

This library is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
Lesser General Public License for more details.

You should have received a copy of the GNU Lesser General Public
License along with this library; if not, write to the Free Software
Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307
USA
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹General Lemmas on BDD Abstractions›</span></span>

<span class="keyword1"><span class="command">theory</span></span> General <span class="keyword2"><span class="keyword">imports</span></span> <a href="BinDag.html">BinDag</a> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">subdag_eq</span><span class="main">::</span> <span class="quoted"><span class="quoted">"dag <span class="main">⇒</span> dag <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">subdag_eq</span> <span class="free"><span class="bound"><span class="entity">t<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">t<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">t<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">∨</span> subdag <span class="free"><span class="bound"><span class="entity">t<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">t<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>"</span></span>
<span class="comment1">(*"subtree_eq Tip t = (if t = Tip then True else False)"
"subtree_eq (Node l a r) t = (t=(Node l a r) ∨ subtree_eq l t ∨ subtree_eq r t)"*)</span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">root</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"dag <span class="main">⇒</span> ref"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">root</span> Tip <span class="main">=</span> Null"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">root</span> <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">isLeaf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"dag <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">isLeaf</span> Tip <span class="main">=</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">isLeaf</span> <span class="main">(</span>Node Tip <span class="free"><span class="bound"><span class="entity">v</span></span></span> Tip<span class="main">)</span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">isLeaf</span> <span class="main">(</span>Node <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>2</sub></span></span></span> Tip<span class="main">)</span> <span class="main">=</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">isLeaf</span> <span class="main">(</span>Node Tip <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> False"</span></span>

<span class="keyword1"><span class="command">datatype</span></span> bdt <span class="main">=</span> Zero <span class="main">|</span> One <span class="main">|</span> Bdt_Node <span class="quoted">bdt</span> <span class="quoted">nat</span> <span class="quoted">bdt</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">bdt_fn</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"dag <span class="main">⇒</span> <span class="main">(</span>ref <span class="main">⇒</span> nat<span class="main">)</span> <span class="main">⇒</span> bdt option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">bdt_fn</span> Tip <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">bdtvar</span> <span class="main">.</span> None<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">bdt_fn</span> <span class="main">(</span>Node Tip <span class="free"><span class="bound"><span class="entity">vref</span></span></span> Tip<span class="main">)</span> <span class="main">=</span> 
    <span class="main">(</span><span class="main">λ</span><span class="bound">bdtvar</span> <span class="main">.</span> 
          <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="bound">bdtvar</span> <span class="free"><span class="bound"><span class="entity">vref</span></span></span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> 
           <span class="keyword1">then</span> Some Zero 
           <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="bound">bdtvar</span> <span class="free"><span class="bound"><span class="entity">vref</span></span></span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> 
                 <span class="keyword1">then</span> Some One
                 <span class="keyword1">else</span> None<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>  
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">bdt_fn</span> <span class="main">(</span>Node Tip <span class="free"><span class="bound"><span class="entity">vref</span></span></span> <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">vref1</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">bdtvar</span> <span class="main">.</span> None<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">bdt_fn</span> <span class="main">(</span>Node <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">vref1</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">vref</span></span></span> Tip<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">bdtvar</span> <span class="main">.</span> None<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">bdt_fn</span> <span class="main">(</span>Node <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">vref1</span></span></span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">vref</span></span></span> <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">l2</span></span></span> <span class="free"><span class="bound"><span class="entity">vref2</span></span></span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="main">λ</span><span class="bound">bdtvar</span> <span class="main">.</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="bound">bdtvar</span> <span class="free"><span class="bound"><span class="entity">vref</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="bound">bdtvar</span> <span class="free"><span class="bound"><span class="entity">vref</span></span></span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> 
     <span class="keyword1">then</span> None 
     <span class="keyword1">else</span>  
      <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span><span class="free">bdt_fn</span> <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">vref1</span></span></span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span><span class="main">)</span> <span class="bound">bdtvar</span><span class="main">)</span> <span class="keyword1">of</span> 
       None <span class="main">⇒</span> None
       <span class="main">|</span><span class="main">(</span>Some <span class="bound">b1</span><span class="main">)</span> <span class="main">⇒</span>
         <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span><span class="free">bdt_fn</span> <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">l2</span></span></span> <span class="free"><span class="bound"><span class="entity">vref2</span></span></span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span><span class="main">)</span> <span class="bound">bdtvar</span><span class="main">)</span> <span class="keyword1">of</span> 
          None <span class="main">⇒</span> None
         <span class="main">|</span><span class="main">(</span>Some <span class="bound">b2</span><span class="main">)</span> <span class="main">⇒</span> Some <span class="main">(</span>Bdt_Node <span class="bound">b1</span> <span class="main">(</span><span class="bound">bdtvar</span> <span class="free"><span class="bound"><span class="entity">vref</span></span></span><span class="main">)</span> <span class="bound">b2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="comment1">(*
Kongruenzregeln sind das Feintuning für den Simplifier (siehe Kapitel 9 im Isabelle
Tutorial). Im Fall von case wird standardmäßig nur die case bedingung nicht
aber die einzelnen Fälle simplifiziert, analog dazu beim if. Dies simuliert die
Auswertungsstrategie einer Programmiersprache, da wird auch zunächst nur die
Bedingung vereinfacht. Will man mehr so kann man die entsprechenden Kongruenz 
regeln dazunehmen.
*)</span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">bdt</span> <span class="main">==</span> bdt_fn"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">eval</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bdt <span class="main">⇒</span> bool list <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">eval</span> Zero <span class="free"><span class="bound"><span class="entity">env</span></span></span> <span class="main">=</span> False"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">eval</span> One <span class="free"><span class="bound"><span class="entity">env</span></span></span>  <span class="main">=</span> True"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">eval</span> <span class="main">(</span>Bdt_Node <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">env</span></span></span>  <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">env</span></span></span> <span class="main">!</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="keyword1">then</span> <span class="free">eval</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">env</span></span></span> <span class="keyword1">else</span> <span class="free">eval</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">env</span></span></span><span class="main">)</span>"</span></span>
 
<span class="comment1">(*A given bdt is ordered if it is a One or Zero or its value is smaller than
its parents value*)</span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">ordered_bdt</span><span class="main">::</span> <span class="quoted"><span class="quoted">"bdt <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">ordered_bdt</span> Zero <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ordered_bdt</span> One <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ordered_bdt</span> <span class="main">(</span>Bdt_Node <span class="main">(</span>Bdt_Node <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">v1</span></span></span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span>Bdt_Node <span class="free"><span class="bound"><span class="entity">l2</span></span></span> <span class="free"><span class="bound"><span class="entity">v2</span></span></span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
    <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">v1</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v2</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">∧</span> 
     <span class="main">(</span><span class="free">ordered_bdt</span> <span class="main">(</span>Bdt_Node <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">v1</span></span></span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">ordered_bdt</span> <span class="main">(</span>Bdt_Node <span class="free"><span class="bound"><span class="entity">l2</span></span></span> <span class="free"><span class="bound"><span class="entity">v2</span></span></span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ordered_bdt</span> <span class="main">(</span>Bdt_Node <span class="main">(</span>Bdt_Node <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">v1</span></span></span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> 
    <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">v1</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">ordered_bdt</span> <span class="main">(</span>Bdt_Node <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">v1</span></span></span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ordered_bdt</span> <span class="main">(</span>Bdt_Node <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span>Bdt_Node <span class="free"><span class="bound"><span class="entity">l2</span></span></span> <span class="free"><span class="bound"><span class="entity">v2</span></span></span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
    <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">v2</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">ordered_bdt</span> <span class="main">(</span>Bdt_Node <span class="free"><span class="bound"><span class="entity">l2</span></span></span> <span class="free"><span class="bound"><span class="entity">v2</span></span></span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ordered_bdt</span> <span class="main">(</span>Bdt_Node <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> True"</span></span>

<span class="comment1">(*In case t = (Node Tip v Tip) v should have the values 0 or 1. This is not checked by this function*)</span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">ordered</span><span class="main">::</span> <span class="quoted"><span class="quoted">"dag <span class="main">⇒</span> <span class="main">(</span>ref<span class="main">⇒</span>nat<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">ordered</span> Tip <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">var</span><span class="main">.</span> True<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ordered</span> <span class="main">(</span>Node <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">l<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">r<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">l<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">r<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
    <span class="main">(</span><span class="main">λ</span> <span class="bound">var</span><span class="main">.</span> <span class="main">(</span><span class="bound">var</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">&lt;</span> <span class="bound">var</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∧</span> <span class="bound">var</span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">&lt;</span> <span class="bound">var</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">∧</span> 
        <span class="main">(</span><span class="free">ordered</span> <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">l<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">r<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span> <span class="bound">var</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">ordered</span> <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">l<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">v<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">r<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="bound">var</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ordered</span> <span class="main">(</span>Node Tip <span class="free"><span class="bound"><span class="entity">v</span></span></span> Tip<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">var</span><span class="main">.</span> <span class="main">(</span>True<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ordered</span> <span class="main">(</span>Node Tip <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> 
     <span class="main">(</span><span class="main">λ</span> <span class="bound">var</span><span class="main">.</span> <span class="main">(</span><span class="bound">var</span> <span class="main">(</span>root <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">&lt;</span> <span class="bound">var</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">ordered</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="bound">var</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ordered</span> <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> Tip<span class="main">)</span> <span class="main">=</span> 
     <span class="main">(</span><span class="main">λ</span> <span class="bound">var</span><span class="main">.</span> <span class="main">(</span><span class="bound">var</span> <span class="main">(</span>root <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="main">&lt;</span> <span class="bound">var</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">ordered</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="bound">var</span><span class="main">)</span><span class="main">)</span>"</span></span>
 

<span class="comment1">(*Calculates maximal value in a non ordered bdt. Does not test parents of the 
given bdt*)</span>
<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">max_var</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bdt <span class="main">⇒</span> nat"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">max_var</span> Zero <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">max_var</span> One <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">max_var</span> <span class="main">(</span>Bdt_Node <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> max <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span>max <span class="main">(</span><span class="free">max_var</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">max_var</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="General-eval_zero"><span class="command">lemma</span></span> eval_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>bdt <span class="main">(</span>Node <span class="free">l</span> <span class="free">v</span> <span class="free">r</span><span class="main">)</span> <span class="free">var</span> <span class="main">=</span> Some <span class="free">x</span><span class="main">;</span> 
<span class="free">var</span> <span class="main">(</span>root <span class="main">(</span>Node <span class="free">l</span> <span class="free">v</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> Zero"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">r</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">r</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="General-bdt_Some_One_iff"><span class="command">lemma</span></span> bdt_Some_One_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span>bdt <span class="free">t</span> <span class="free">var</span> <span class="main">=</span> Some One<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">p</span><span class="main">.</span> <span class="free">t</span> <span class="main">=</span> Node Tip <span class="bound">p</span> Tip <span class="main">∧</span> <span class="free">var</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> bdt_fn.induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span> <span class="comment1">(*in order to split the cases Zero and One*)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="General-bdt_Some_Zero_iff"><span class="command">lemma</span></span> bdt_Some_Zero_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span>bdt <span class="free">t</span> <span class="free">var</span> <span class="main">=</span> Some Zero<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">p</span><span class="main">.</span> <span class="free">t</span> <span class="main">=</span> Node Tip <span class="bound">p</span> Tip <span class="main">∧</span> <span class="free">var</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> bdt_fn.induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1" id="General-bdt_Some_Node_iff"><span class="command">lemma</span></span> bdt_Some_Node_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
 <span class="quoted"><span class="quoted">"<span class="main">(</span>bdt <span class="free">t</span> <span class="free">var</span> <span class="main">=</span> Some <span class="main">(</span>Bdt_Node <span class="free">bdt1</span> <span class="free">v</span> <span class="free">bdt2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
    <span class="main">(</span><span class="main">∃</span> <span class="bound">p</span> <span class="bound">l</span> <span class="bound">r</span><span class="main">.</span> <span class="free">t</span> <span class="main">=</span> Node <span class="bound">l</span> <span class="bound">p</span> <span class="bound">r</span> <span class="main">∧</span> bdt <span class="bound">l</span> <span class="free">var</span> <span class="main">=</span> Some <span class="free">bdt1</span> <span class="main">∧</span> bdt <span class="bound">r</span> <span class="free">var</span> <span class="main">=</span> Some <span class="free">bdt2</span> <span class="main">∧</span> 
               <span class="main">1</span> <span class="main">&lt;</span> <span class="free">v</span> <span class="main">∧</span> <span class="free">var</span> <span class="bound">p</span> <span class="main">=</span> <span class="free">v</span> <span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> bdt_fn.induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 5
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits option.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="General-balanced_bdt"><span class="command">lemma</span></span> balanced_bdt<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">p</span> <span class="bound">bdt1</span><span class="main">.</span> <span class="main">⟦</span> Dag <span class="bound">p</span> <span class="free">low</span> <span class="free">high</span> <span class="free">t</span><span class="main">;</span> bdt <span class="free">t</span> <span class="free">var</span> <span class="main">=</span> Some <span class="bound">bdt1</span><span class="main">;</span> <span class="free">no</span> <span class="main">∈</span> set_of <span class="free">t</span><span class="main">⟧</span> 
 <span class="main">⟹</span> <span class="main">(</span><span class="free">low</span> <span class="free">no</span> <span class="main">=</span> Null<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">high</span> <span class="free">no</span> <span class="main">=</span> Null<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Tip
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">a</span> <span class="skolem">rt</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> NN<span class="main">=</span> this
  <span class="keyword1"><span class="command">have</span></span> bdt1<span class="main">:</span> <span class="quoted"><span class="quoted">"bdt <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">a</span> <span class="skolem">rt</span><span class="main">)</span> <span class="free">var</span> <span class="main">=</span> Some <span class="skolem">bdt1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">have</span></span> no_in_t<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="free">no</span> <span class="main">∈</span> set_of <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">a</span> <span class="skolem">rt</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">have</span></span> p_tree<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="skolem">p</span> <span class="free">low</span> <span class="free">high</span> <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">a</span> <span class="skolem">rt</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">from</span></span> Node.prems <span class="keyword3"><span class="command">obtain</span></span> 
    lt<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="free">low</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">low</span> <span class="free">high</span> <span class="skolem">lt</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
    rt<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="free">high</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">low</span> <span class="free">high</span> <span class="skolem">rt</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">lt</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">llt</span> <span class="skolem">l</span> <span class="skolem">rlt</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> Nlt<span class="main">=</span>this
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">rt</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">lrt</span> <span class="skolem">r</span> <span class="skolem">rrt</span><span class="main">)</span>
      <span class="keyword1"><span class="command">note</span></span> Nrt<span class="main">=</span>this
      <span class="keyword1"><span class="command">from</span></span> Nlt Nrt bdt1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lbdt</span></span> <span class="skolem"><span class="skolem">rbdt</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
        lbdt_def<span class="main">:</span> <span class="quoted"><span class="quoted">"bdt <span class="skolem">lt</span> <span class="free">var</span> <span class="main">=</span> Some <span class="skolem">lbdt</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
        rbdt_def<span class="main">:</span> <span class="quoted"><span class="quoted">"bdt <span class="skolem">rt</span> <span class="free">var</span> <span class="main">=</span> Some <span class="skolem">rbdt</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
        bdt1_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">bdt1</span> <span class="main">=</span> Bdt_Node <span class="skolem">lbdt</span> <span class="main">(</span><span class="free">var</span> <span class="skolem">a</span><span class="main">)</span> <span class="skolem">rbdt</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm option.splits<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> no_in_t <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> disjE<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">" <span class="free">no</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> p_tree Nlt Nrt <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">no</span> <span class="main">∈</span> set_of <span class="skolem">lt</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> Node.hyps lbdt_def lt <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">no</span> <span class="main">∈</span> set_of <span class="skolem">rt</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> Node.hyps rbdt_def rt <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> Tip
      <span class="keyword1"><span class="command">with</span></span> Nlt bdt1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Tip
    <span class="keyword1"><span class="command">note</span></span> ltTip<span class="main">=</span>this
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">rt</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Tip
      <span class="keyword1"><span class="command">with</span></span> ltTip bdt1 no_in_t p_tree <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">rlt</span> <span class="skolem">r</span> <span class="skolem">rrt</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> bdt1 ltTip <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">dag_map</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ref <span class="main">⇒</span> ref<span class="main">)</span> <span class="main">⇒</span> dag <span class="main">⇒</span> dag"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">dag_map</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> Tip <span class="main">=</span> Tip"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">dag_map</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Node <span class="main">(</span><span class="free">dag_map</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">dag_map</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">wf_marking</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"dag <span class="main">⇒</span> <span class="main">(</span>ref <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>ref <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">wf_marking</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">mark_old</span></span></span> <span class="free"><span class="bound"><span class="entity">mark_new</span></span></span> <span class="free"><span class="bound"><span class="entity">marked</span></span></span> <span class="main">=</span>
<span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="keyword1">of</span> Tip <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">mark_new</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">mark_old</span></span></span>
<span class="main">|</span> <span class="main">(</span>Node <span class="bound">lt</span> <span class="bound">p</span> <span class="bound">rt</span><span class="main">)</span> <span class="main">⇒</span>
  <span class="main">(</span><span class="main">∀</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">∉</span> set_of <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">mark_new</span></span></span> <span class="bound">n</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">mark_old</span></span></span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span>
  <span class="main">(</span><span class="main">∀</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">∈</span> set_of <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">mark_new</span></span></span> <span class="bound">n</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">marked</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dag_in_levellist</span><span class="main">::</span> <span class="quoted"><span class="quoted">"dag <span class="main">⇒</span> <span class="main">(</span>ref list list<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>ref <span class="main">⇒</span> nat<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">dag_in_levellist</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">levellist</span></span></span> <span class="free"><span class="bound"><span class="entity">var</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">≠</span> Tip <span class="main">⟶</span>
       <span class="main">(</span><span class="main">∀</span> <span class="bound">st</span><span class="main">.</span> subdag_eq <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="bound">st</span> <span class="main">⟶</span> root <span class="bound">st</span> <span class="main">∈</span> set <span class="main">(</span><span class="free"><span class="bound"><span class="entity">levellist</span></span></span> <span class="main">!</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">var</span></span></span> <span class="main">(</span>root <span class="bound">st</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="General-set_of_nn"><span class="command">lemma</span></span> set_of_nn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> Dag <span class="free">p</span> <span class="free">low</span> <span class="free">high</span> <span class="free">t</span><span class="main">;</span> <span class="free">n</span> <span class="main">∈</span> set_of <span class="free">t</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">≠</span> Null"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="General-subnodes_ordered"><span class="command">lemma</span></span> subnodes_ordered <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">.</span> <span class="free">n</span> <span class="main">∈</span> set_of <span class="free">t</span> <span class="main">⟶</span> Dag <span class="bound">p</span> <span class="free">low</span> <span class="free">high</span> <span class="free">t</span> <span class="main">⟶</span> ordered <span class="free">t</span> <span class="free">var</span> <span class="main">⟶</span> <span class="free">var</span> <span class="free">n</span> <span class="main">&lt;=</span> <span class="free">var</span> <span class="bound">p</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">low</span> <span class="improper">p</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">high</span> <span class="improper">p</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">t1</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">t2</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">t2</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1" id="General-ordered_set_of"><span class="command">lemma</span></span> ordered_set_of<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="main">⟦</span>ordered <span class="free">t</span> <span class="free">var</span><span class="main">;</span> <span class="bound">x</span> <span class="main">∈</span> set_of <span class="free">t</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">var</span> <span class="bound">x</span> <span class="main">&lt;=</span> <span class="free">var</span> <span class="main">(</span>root <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> disjE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">t1</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">t2</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">t2</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">t1</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="General-dag_setofD"><span class="command">lemma</span></span> dag_setofD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">p</span> <span class="bound">low</span> <span class="bound">high</span> <span class="bound">n</span><span class="main">.</span> <span class="main">⟦</span> Dag <span class="bound">p</span> <span class="bound">low</span> <span class="bound">high</span> <span class="free">t</span><span class="main">;</span> <span class="bound">n</span> <span class="main">∈</span> set_of <span class="free">t</span> <span class="main">⟧</span> <span class="main">⟹</span> 
  <span class="main">(</span><span class="main">∃</span> <span class="bound">nt</span><span class="main">.</span> Dag <span class="bound">n</span> <span class="bound">low</span> <span class="bound">high</span> <span class="bound">nt</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">nt</span><span class="main">.</span> Dag <span class="bound">n</span> <span class="bound">low</span> <span class="bound">high</span> <span class="bound">nt</span> <span class="main">⟶</span> set_of <span class="bound">nt</span> <span class="main">⊆</span> set_of <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> Dag_unique<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> Dag_unique<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="General-dag_setof_exD"><span class="command">lemma</span></span> dag_setof_exD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Dag <span class="free">p</span> <span class="free">low</span> <span class="free">high</span> <span class="free">t</span><span class="main">;</span> <span class="free">n</span> <span class="main">∈</span> set_of <span class="free">t</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">nt</span><span class="main">.</span> Dag <span class="free">n</span> <span class="free">low</span> <span class="free">high</span> <span class="bound">nt</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dag_setofD<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="General-dag_setof_subsetD"><span class="command">lemma</span></span> dag_setof_subsetD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Dag <span class="free">p</span> <span class="free">low</span> <span class="free">high</span> <span class="free">t</span><span class="main">;</span> <span class="free">n</span> <span class="main">∈</span> set_of <span class="free">t</span><span class="main">;</span> Dag <span class="free">n</span> <span class="free">low</span> <span class="free">high</span> <span class="free">nt</span><span class="main">⟧</span> <span class="main">⟹</span> set_of <span class="free">nt</span> <span class="main">⊆</span> set_of <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dag_setofD<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>  

<span class="keyword1" id="General-subdag_parentdag_low"><span class="command">lemma</span></span> subdag_parentdag_low<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">not</span> <span class="main">&lt;=</span> <span class="free">lt</span> <span class="main">⟹</span> <span class="free">not</span> <span class="main">&lt;=</span> <span class="main">(</span>Node <span class="free">lt</span> <span class="free">p</span> <span class="free">rt</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">not</span> <span class="main">=</span> <span class="free">lt</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">lt</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">rt</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_dag_def less_dag_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_dag_def less_dag_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_dag_def less_dag_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_dag_def less_dag_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="General-subdag_parentdag_high"><span class="command">lemma</span></span> subdag_parentdag_high<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">not</span> <span class="main">&lt;=</span> <span class="free">rt</span> <span class="main">⟹</span> <span class="free">not</span> <span class="main">&lt;=</span> <span class="main">(</span>Node <span class="free">lt</span> <span class="free">p</span> <span class="free">rt</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">not</span> <span class="main">=</span> <span class="free">rt</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">lt</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">rt</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_dag_def less_dag_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_dag_def less_dag_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_dag_def less_dag_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_dag_def less_dag_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="General-set_of_subdag"><span class="command">lemma</span></span> set_of_subdag<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">p</span> <span class="bound">not</span> <span class="bound">no</span><span class="main">.</span> 
<span class="main">⟦</span>Dag <span class="bound">p</span> <span class="free">low</span> <span class="free">high</span> <span class="free">t</span><span class="main">;</span> Dag <span class="bound">no</span> <span class="free">low</span> <span class="free">high</span> <span class="bound">not</span><span class="main">;</span> <span class="bound">no</span> <span class="main">∈</span> set_of <span class="free">t</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">not</span> <span class="main">&lt;=</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Tip
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">po</span> <span class="skolem">rt</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> rtNode<span class="main">=</span>this
  <span class="keyword1"><span class="command">from</span></span> Node.prems <span class="keyword1"><span class="command">have</span></span> ppo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="skolem">po</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> ppo Node.prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">not</span> <span class="main">=</span> <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">po</span> <span class="skolem">rt</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Dag_unique <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Dag_Ref<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Node.prems ppo <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subdag_eq_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">no</span> <span class="main">≠</span> <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> Node.prems <span class="keyword1"><span class="command">have</span></span> no_in_ltorrt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">∈</span> set_of <span class="skolem">lt</span> <span class="main">∨</span> <span class="skolem">no</span> <span class="main">∈</span> set_of <span class="skolem">rt</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">∈</span> set_of <span class="skolem">lt</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">from</span></span> Node.prems ppo <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="free">low</span> <span class="skolem">po</span><span class="main">)</span> <span class="free">low</span> <span class="free">high</span> <span class="skolem">lt</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> Node.prems ppo True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">not</span> <span class="main">&lt;=</span> <span class="skolem">lt</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Node.hyps<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">with</span></span> Node.prems no_in_ltorrt <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subdag_parentdag_low<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">∉</span> set_of <span class="skolem">lt</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> no_in_ltorrt <span class="keyword1"><span class="command">have</span></span> no_in_rt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">∈</span> set_of <span class="skolem">rt</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> Node.prems ppo <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="free">high</span> <span class="skolem">po</span><span class="main">)</span> <span class="free">low</span> <span class="free">high</span> <span class="skolem">rt</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> Node.prems ppo no_in_rt <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">not</span> <span class="main">&lt;=</span> <span class="skolem">rt</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Node.hyps<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">with</span></span> Node.prems no_in_rt <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subdag_parentdag_high<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="General-children_ordered"><span class="command">lemma</span></span> children_ordered<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>ordered <span class="main">(</span>Node <span class="free">lt</span> <span class="free">p</span> <span class="free">rt</span><span class="main">)</span> <span class="free">var</span><span class="main">⟧</span> <span class="main">⟹</span> 
ordered <span class="free">lt</span> <span class="free">var</span> <span class="main">∧</span> ordered <span class="free">rt</span> <span class="free">var</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">lt</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Tip
  <span class="keyword1"><span class="command">note</span></span> ltTip<span class="main">=</span>this
  <span class="keyword3"><span class="command">assume</span></span>  orderedNode<span class="main">:</span> <span class="quoted"><span class="quoted">"ordered <span class="main">(</span>Node <span class="free">lt</span> <span class="free">p</span> <span class="free">rt</span><span class="main">)</span> <span class="free">var</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">rt</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Tip
    <span class="keyword1"><span class="command">note</span></span> rtTip <span class="main">=</span> this
    <span class="keyword1"><span class="command">with</span></span> ltTip <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">lrt</span> <span class="skolem">r</span> <span class="skolem">rrt</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> orderedNode ltTip <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">llt</span> <span class="skolem">l</span> <span class="skolem">rlt</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> ltNode<span class="main">=</span>this
  <span class="keyword3"><span class="command">assume</span></span> orderedNode<span class="main">:</span> <span class="quoted"><span class="quoted">"ordered <span class="main">(</span>Node <span class="free">lt</span> <span class="free">p</span> <span class="free">rt</span><span class="main">)</span> <span class="free">var</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">rt</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Tip
    <span class="keyword1"><span class="command">note</span></span> rtTip <span class="main">=</span> this
    <span class="keyword1"><span class="command">with</span></span> orderedNode ltNode <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">lrt</span> <span class="skolem">r</span> <span class="skolem">rrt</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> rtNode <span class="main">=</span> this
    <span class="keyword1"><span class="command">with</span></span> orderedNode ltNode <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
    
<span class="keyword1" id="General-ordered_subdag"><span class="command">lemma</span></span> ordered_subdag<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>ordered <span class="free">t</span> <span class="free">var</span><span class="main">;</span> <span class="free">not</span> <span class="main">&lt;=</span> <span class="free">t</span><span class="main">⟧</span> <span class="main">⟹</span> ordered <span class="free">not</span> <span class="free">var</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Tip
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_dag_def le_dag_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">not</span> <span class="main">=</span> Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> Node.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> notnt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">not</span> <span class="main">≠</span> Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> Node.prems <span class="keyword1"><span class="command">have</span></span> notstltorrt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">not</span> <span class="main">&lt;=</span> <span class="skolem">lt</span> <span class="main">∨</span> <span class="free">not</span> <span class="main">&lt;=</span> <span class="skolem">rt</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_dag_def le_dag_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">from</span></span> Node.prems <span class="keyword1"><span class="command">have</span></span> ord_lt<span class="main">:</span> <span class="quoted"><span class="quoted">"ordered <span class="skolem">lt</span> <span class="free">var</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> children_ordered<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">from</span></span> Node.prems <span class="keyword1"><span class="command">have</span></span> ord_rt<span class="main">:</span> <span class="quoted"><span class="quoted">"ordered <span class="skolem">rt</span> <span class="free">var</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> children_ordered<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">not</span> <span class="main">&lt;=</span> <span class="skolem">lt</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> ord_lt <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Node.hyps<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">not</span> <span class="main">≤</span> <span class="skolem">lt</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> notstltorrt <span class="keyword1"><span class="command">have</span></span> notinrt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">not</span> <span class="main">&lt;=</span> <span class="skolem">rt</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> Node.hyps <span class="keyword1"><span class="command">have</span></span> hyprt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>ordered <span class="skolem">rt</span> <span class="free">var</span><span class="main">;</span> <span class="free">not</span> <span class="main">≤</span> <span class="skolem">rt</span><span class="main">⟧</span> <span class="main">⟹</span> ordered <span class="free">not</span> <span class="free">var</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> notinrt ord_rt <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> hyprt<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="General-subdag_ordered"><span class="command">lemma</span></span> subdag_ordered<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">not</span> <span class="bound">no</span> <span class="bound">p</span><span class="main">.</span> <span class="main">⟦</span>ordered <span class="free">t</span> <span class="free">var</span><span class="main">;</span> Dag <span class="bound">p</span> <span class="free">low</span> <span class="free">high</span> <span class="free">t</span><span class="main">;</span> Dag <span class="bound">no</span> <span class="free">low</span> <span class="free">high</span> <span class="bound">not</span><span class="main">;</span> 
              <span class="bound">no</span> <span class="main">∈</span> set_of <span class="free">t</span><span class="main">⟧</span> <span class="main">⟹</span> ordered <span class="bound">not</span> <span class="free">var</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> Tip
  <span class="keyword1"><span class="command">from</span></span> Tip.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">po</span> <span class="skolem">rt</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> nN<span class="main">=</span>this
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">lt</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Tip
    <span class="keyword1"><span class="command">note</span></span> ltTip<span class="main">=</span>this
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">rt</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Tip
      <span class="keyword1"><span class="command">from</span></span> Node.prems <span class="keyword1"><span class="command">have</span></span> ppo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="skolem">po</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> Tip ltTip Node.prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span><span class="main">=</span><span class="skolem">p</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> ppo Node.prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">not</span><span class="main">=</span><span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">po</span> <span class="skolem">rt</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Dag_Ref <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Dag_unique<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> Node.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">lrnot</span> <span class="skolem">rn</span> <span class="skolem">rrnot</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> Node.prems ltTip Node <span class="keyword1"><span class="command">have</span></span> ord_rt<span class="main">:</span> <span class="quoted"><span class="quoted">"ordered <span class="skolem">rt</span> <span class="free">var</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> Node.prems <span class="keyword1"><span class="command">have</span></span> ppo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="skolem">po</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> Node.prems <span class="keyword1"><span class="command">have</span></span> ponN<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">po</span> <span class="main">≠</span> Null"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> ppo ponN ltTip Node.prems <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="free">high</span> <span class="skolem">po</span><span class="main">)</span> <span class="free">low</span> <span class="free">high</span> <span class="skolem">rt</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span><span class="main">=</span><span class="skolem">po</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> ppo Node.prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">not</span> <span class="main">=</span> Node <span class="skolem">lt</span> <span class="skolem">po</span> <span class="skolem">rt</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Dag_Ref <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Dag_unique<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> Node.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">with</span></span> Node.prems ltTip <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">∈</span> set_of <span class="skolem">rt</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> ord_rt * <span class="quoted"><span class="quoted">‹Dag <span class="skolem">no</span> <span class="free">low</span> <span class="free">high</span> <span class="skolem">not</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Node.hyps<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">llt</span> <span class="skolem">l</span> <span class="skolem">rlt</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> ltNode<span class="main">=</span>this
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">rt</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Tip
      <span class="keyword1"><span class="command">from</span></span> Node.prems Tip ltNode <span class="keyword1"><span class="command">have</span></span> ord_lt<span class="main">:</span> <span class="quoted"><span class="quoted">"ordered <span class="skolem">lt</span> <span class="free">var</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> Node.prems <span class="keyword1"><span class="command">have</span></span> ppo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="skolem">po</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> Node.prems <span class="keyword1"><span class="command">have</span></span> ponN<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">po</span> <span class="main">≠</span> Null"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> ppo ponN Tip Node.prems ltNode <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="free">low</span> <span class="skolem">po</span><span class="main">)</span> <span class="free">low</span> <span class="free">high</span> <span class="skolem">lt</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span><span class="main">=</span><span class="skolem">po</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> ppo Node.prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">not</span> <span class="main">=</span> <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">po</span> <span class="skolem">rt</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Dag_Ref <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Dag_unique<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> Node.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">with</span></span> Node.prems Tip <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">∈</span> set_of <span class="skolem">lt</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> ord_lt * <span class="quoted"><span class="quoted">‹Dag <span class="skolem">no</span> <span class="free">low</span> <span class="free">high</span> <span class="skolem">not</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Node.hyps<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>   
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">lrt</span> <span class="skolem">r</span> <span class="skolem">rrt</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> Node.prems <span class="keyword1"><span class="command">have</span></span> ppo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="skolem">po</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> Node.prems Node ltNode <span class="keyword1"><span class="command">have</span></span> ord_lt<span class="main">:</span> <span class="quoted"><span class="quoted">"ordered <span class="skolem">lt</span> <span class="free">var</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> Node.prems Node ltNode <span class="keyword1"><span class="command">have</span></span> ord_rt<span class="main">:</span> <span class="quoted"><span class="quoted">"ordered <span class="skolem">rt</span> <span class="free">var</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> Node.prems <span class="keyword1"><span class="command">have</span></span> ponN<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">po</span> <span class="main">≠</span> Null"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> ppo ponN Node Node.prems ltNode <span class="keyword1"><span class="command">have</span></span> lt_Dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="free">low</span> <span class="skolem">po</span><span class="main">)</span> <span class="free">low</span> <span class="free">high</span> <span class="skolem">lt</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> ppo ponN Node Node.prems ltNode <span class="keyword1"><span class="command">have</span></span> rt_Dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="free">high</span> <span class="skolem">po</span><span class="main">)</span> <span class="free">low</span> <span class="free">high</span> <span class="skolem">rt</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">=</span> <span class="skolem">po</span>"</span></span><span class="main">)</span>
       <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> ppo Node.prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">not</span> <span class="main">=</span> <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">po</span> <span class="skolem">rt</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Dag_Ref <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Dag_unique<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> Node.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">≠</span> <span class="skolem">po</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> Node.prems <span class="keyword1"><span class="command">have</span></span> no_in_lt_or_rt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">∈</span> set_of <span class="skolem">lt</span> <span class="main">∨</span> <span class="skolem">no</span> <span class="main">∈</span> set_of <span class="skolem">rt</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">∈</span> set_of <span class="skolem">lt</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">with</span></span> ord_lt lt_Dag Node.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Node.hyps<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">no</span> <span class="main">∉</span> set_of <span class="skolem">lt</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> no_in_lt_or_rt <span class="keyword1"><span class="command">have</span></span> no_in_rt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">∈</span> set_of <span class="skolem">rt</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">from</span></span> Node.hyps <span class="keyword1"><span class="command">have</span></span> hyp2<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span> <span class="bound">no</span> <span class="bound">not</span><span class="main">.</span> <span class="main">⟦</span>ordered <span class="skolem">rt</span> <span class="free">var</span><span class="main">;</span> Dag <span class="bound">p</span> <span class="free">low</span> <span class="free">high</span> <span class="skolem">rt</span><span class="main">;</span> Dag <span class="bound">no</span> <span class="free">low</span> <span class="free">high</span> <span class="bound">not</span><span class="main">;</span> <span class="bound">no</span> <span class="main">∈</span> set_of <span class="skolem">rt</span><span class="main">⟧</span> 
            <span class="main">⟹</span> ordered <span class="bound">not</span> <span class="free">var</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">from</span></span> no_in_rt ord_rt rt_Dag Node.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> hyp2<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="General-elem_set_of"><span class="command">lemma</span></span> elem_set_of<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="bound">st</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">x</span> <span class="main">∈</span> set_of <span class="bound">st</span><span class="main">;</span> set_of <span class="bound">st</span> <span class="main">⊆</span> set_of <span class="free">t</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> set_of <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="comment1">(*procedure Levellist converts a dag with root p in a ref list list (levellist) with nodes of var = i in 
levellist ! i. 
In order to convert the two datastructures a dag traversal is required using a mark on nodes. m indicates
the value which is assumed for a node to be marked. 
(∃ nt. Dag n <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>low <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>high nt ∧ 
                        {<span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>m} = set_of (dag_map <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>mark nt))*)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">wf_ll</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"dag <span class="main">⇒</span> ref list list <span class="main">⇒</span> <span class="main">(</span>ref <span class="main">⇒</span> nat<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">wf_ll</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">levellist</span></span></span> <span class="free"><span class="bound"><span class="entity">var</span></span></span> <span class="main">=</span>
  <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> set_of <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">⟶</span> <span class="bound">p</span> <span class="main">∈</span> set <span class="main">(</span><span class="free"><span class="bound"><span class="entity">levellist</span></span></span> <span class="main">!</span> <span class="free"><span class="bound"><span class="entity">var</span></span></span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
   <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">k</span></span> <span class="main">&lt;</span> length <span class="free"><span class="bound"><span class="entity">levellist</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">p</span> <span class="main">∈</span> set <span class="main">(</span><span class="free"><span class="bound"><span class="entity">levellist</span></span></span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> set_of <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">var</span></span></span> <span class="bound">p</span> <span class="main">=</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cong_eval</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bdt <span class="main">⇒</span> bdt <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">∼</span>"</span> 60<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">cong_eval</span> <span class="free"><span class="bound"><span class="entity">bdt<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">bdt<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">=</span> <span class="main">(</span>eval <span class="free"><span class="bound"><span class="entity">bdt<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">=</span> eval <span class="free"><span class="bound"><span class="entity">bdt<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="General-cong_eval_sym"><span class="command">lemma</span></span> cong_eval_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">∼</span> <span class="free">r</span> <span class="main">=</span> <span class="free">r</span> <span class="main">∼</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cong_eval_def<span class="main">)</span>

<span class="keyword1" id="General-cong_eval_trans"><span class="command">lemma</span></span> cong_eval_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">l</span> <span class="main">∼</span> <span class="free">r</span><span class="main">;</span> <span class="free">r</span> <span class="main">∼</span> <span class="free">t</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">l</span> <span class="main">∼</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cong_eval_def<span class="main">)</span>

<span class="keyword1" id="General-cong_eval_child_high"><span class="command">lemma</span></span> cong_eval_child_high<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="free">l</span> <span class="main">∼</span> <span class="free">r</span> <span class="main">⟹</span> <span class="free">r</span> <span class="main">∼</span> <span class="main">(</span>Bdt_Node <span class="free">l</span> <span class="free">v</span> <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cong_eval_def <span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="General-cong_eval_child_low"><span class="command">lemma</span></span> cong_eval_child_low<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="free">l</span> <span class="main">∼</span> <span class="free">r</span> <span class="main">⟹</span> <span class="free">l</span> <span class="main">∼</span> <span class="main">(</span>Bdt_Node <span class="free">l</span> <span class="free">v</span> <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cong_eval_def <span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>




<span class="keyword1"><span class="command">definition</span></span> <span class="entity">null_comp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ref <span class="main">⇒</span> ref<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>ref <span class="main">⇒</span> ref<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>ref <span class="main">⇒</span> ref<span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">∝</span>"</span> 60<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">null_comp</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">p</span><span class="main">)</span> <span class="main">=</span> Null <span class="keyword1">then</span> Null <span class="keyword1">else</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∘</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="General-null_comp_not_Null"><span class="command">lemma</span></span> null_comp_not_Null <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="free">q</span> <span class="main">≠</span> Null <span class="main">⟹</span> <span class="main">(</span><span class="free">g</span> <span class="main">∝</span> <span class="free">h</span><span class="main">)</span> <span class="free">q</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span><span class="free">h</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>

<span class="keyword1" id="General-id_trans"><span class="command">lemma</span></span> id_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">∝</span> id<span class="main">)</span> <span class="main">(</span><span class="free">b</span> <span class="main">(</span><span class="free">c</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">∝</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="free">c</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> ref list list <span class="main">⇒</span> ref set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Nodes</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">levellist</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">}</span> <span class="main">.</span> set <span class="main">(</span><span class="free"><span class="bound"><span class="entity">levellist</span></span></span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">inductive_set</span></span> <span class="entity">Dags</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ref set <span class="main">⇒</span> <span class="main">(</span>ref <span class="main">⇒</span> ref<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>ref <span class="main">⇒</span> ref<span class="main">)</span> <span class="main">⇒</span> dag set"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="quoted">"<span class="entity">nodes</span>"</span> <span class="quoted">"<span class="entity">low</span>"</span> <span class="quoted">"<span class="entity">high</span>"</span>
<span class="keyword2"><span class="keyword">where</span></span>
  DagsI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> set_of <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">⊆</span>  <span class="free">nodes</span><span class="main">;</span> Dag <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free">low</span> <span class="free">high</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">≠</span> Tip<span class="main">⟧</span> 
           <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">∈</span> <span class="free">Dags</span> <span class="free">nodes</span> <span class="free">low</span> <span class="free">high</span>"</span></span>

<span class="keyword1" id="General-empty_Dags"><span class="command">lemma</span></span> empty_Dags <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Dags <span class="main">{}</span> <span class="free">low</span> <span class="free">high</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> Dags.cases<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">t</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">isLeaf_pt</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ref <span class="main">⇒</span> <span class="main">(</span>ref <span class="main">⇒</span> ref<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>ref <span class="main">⇒</span> ref<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">isLeaf_pt</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">low</span></span></span> <span class="free"><span class="bound"><span class="entity">high</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">low</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> Null <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">high</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> Null<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">repNodes_eq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ref <span class="main">⇒</span> ref <span class="main">⇒</span> <span class="main">(</span>ref <span class="main">⇒</span> ref<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>ref <span class="main">⇒</span> ref<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>ref <span class="main">⇒</span> ref<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">repNodes_eq</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">low</span></span></span> <span class="free"><span class="bound"><span class="entity">high</span></span></span> <span class="free"><span class="bound"><span class="entity">rep</span></span></span> <span class="main">==</span> 
      <span class="main">(</span><span class="free"><span class="bound"><span class="entity">rep</span></span></span> <span class="main">∝</span> <span class="free"><span class="bound"><span class="entity">high</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">rep</span></span></span> <span class="main">∝</span> <span class="free"><span class="bound"><span class="entity">high</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">rep</span></span></span> <span class="main">∝</span> <span class="free"><span class="bound"><span class="entity">low</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">rep</span></span></span> <span class="main">∝</span> <span class="free"><span class="bound"><span class="entity">low</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">isomorphic_dags_eq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"dag <span class="main">⇒</span> dag <span class="main">⇒</span> <span class="main">(</span>ref <span class="main">⇒</span> nat<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">isomorphic_dags_eq</span> <span class="free"><span class="bound"><span class="entity">st<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">st<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">var</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">bdt<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">bdt<span class="hidden">⇩</span><sub>2</sub></span><span class="main">.</span> <span class="main">(</span>bdt <span class="free"><span class="bound"><span class="entity">st<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">var</span></span></span> <span class="main">=</span> Some <span class="bound">bdt<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span> bdt <span class="free"><span class="bound"><span class="entity">st<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">var</span></span></span> <span class="main">=</span> Some <span class="bound">bdt<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∧</span> <span class="main">(</span><span class="bound">bdt<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="bound">bdt<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span>
                 <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">st<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">st<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="General-isomorphic_dags_eq_sym"><span class="command">lemma</span></span> isomorphic_dags_eq_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"isomorphic_dags_eq <span class="free">st<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">st<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">var</span> <span class="main">=</span> isomorphic_dags_eq <span class="free">st<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">st<span class="hidden">⇩</span><sub>1</sub></span>  <span class="free">var</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isomorphic_dags_eq_def<span class="main">)</span>


<span class="comment1">(*consts subdags_shared :: "dag ⇒ dag ⇒ (ref ⇒ nat) ⇒ bool"
defs subdags_shared_def : "subdags_shared t1 t2 var == ∀ st1 st2. (st1 &lt;= t1 ∧ st2 &lt;= t2) ⟶ shared_prop st1 st2 var"

consts shared :: " dag ⇒ dag ⇒ (ref ⇒ nat) ⇒ bool"
defs shared_def: "shared t1 t2 var == subdags_shared t1 t1 var ∧ subdags_shared t2 t2 var ∧ subdags_shared t1 t2 var"*)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">shared</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"dag <span class="main">⇒</span> <span class="main">(</span>ref <span class="main">⇒</span> nat<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">shared</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">var</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">st<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">st<span class="hidden">⇩</span><sub>2</sub></span><span class="main">.</span> <span class="main">(</span><span class="bound">st<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">&lt;=</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">∧</span> <span class="bound">st<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">&lt;=</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">⟶</span> isomorphic_dags_eq <span class="bound">st<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">st<span class="hidden">⇩</span><sub>2</sub></span> <span class="free"><span class="bound"><span class="entity">var</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(* shared returns True if the Dag has no different subdags which represent the same 
bdts. 
Note: The two subdags can have different references and code the same bdt nevertheless!
consts shared :: "dag ⇒ (ref ⇒ nat) ⇒ bool"
defs shared_def: "shared t bdtvar ≡ ∀ st1 st2. (subdag t st1 ∧ subdag t st2 ∧ 
                       (bdt st1 bdtvar = bdt st2 bdtvar ⟶ st1 = st2))"

consts shared_lower_levels :: "dag ⇒ nat ⇒ (ref ⇒ nat) ⇒ bool"
defs shared_lower_levels_def : "shared_lower_levels t i bdtvar == ∀ st1 st2. (st1 &lt; t ∧ st2 &lt; t ∧ bdtvar (root st1) &lt; i ∧ bdtvar (root st2) &lt; i ∧
                                    (bdt st1 bdtvar = bdt st2 bdtvar ⟶ st1 = st2))"
*)</span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">reduced</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"dag <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">reduced</span> Tip <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">reduced</span> <span class="main">(</span>Node Tip <span class="free"><span class="bound"><span class="entity">v</span></span></span> Tip<span class="main">)</span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">reduced</span> <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">∧</span> <span class="free">reduced</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">∧</span> <span class="free">reduced</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>"</span></span>  

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">reduced_bdt</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bdt <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">reduced_bdt</span> Zero <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">reduced_bdt</span> One <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">reduced_bdt</span> <span class="main">(</span>Bdt_Node <span class="free"><span class="bound"><span class="entity">lbdt</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">rbdt</span></span></span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">lbdt</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">rbdt</span></span></span> <span class="keyword1">then</span> False 
     <span class="keyword1">else</span> <span class="main">(</span><span class="free">reduced_bdt</span> <span class="free"><span class="bound"><span class="entity">lbdt</span></span></span> <span class="main">∧</span> <span class="free">reduced_bdt</span> <span class="free"><span class="bound"><span class="entity">rbdt</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1" id="General-replicate_elem"><span class="command">lemma</span></span> replicate_elem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">==&gt;</span>  <span class="main">(</span>replicate <span class="free">n</span> <span class="free">x</span> <span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="General-no_in_one_ll"><span class="command">lemma</span></span> no_in_one_ll<span class="main">:</span> 
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span>wf_ll <span class="free">pret</span> <span class="free">levellista</span> <span class="free">var</span><span class="main">;</span> <span class="free">i</span><span class="main">&lt;</span>length <span class="free">levellista</span><span class="main">;</span> <span class="free">j</span> <span class="main">&lt;</span> length <span class="free">levellista</span><span class="main">;</span> 
   <span class="free">no</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">levellista</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">;</span> <span class="free">i</span><span class="main">≠</span><span class="free">j</span><span class="main">⟧</span> 
  <span class="main">⟹</span> <span class="free">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="free">levellista</span> <span class="main">!</span> <span class="free">j</span><span class="main">)</span> "</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> wf_ll_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> conjE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rotate_tac</span> 5<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="var">?R</span><span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="free">no</span> <span class="main">∈</span> set_of <span class="free">pret</span> <span class="main">∧</span> <span class="free">var</span> <span class="free">no</span> <span class="main">=</span> <span class="free">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rotate_tac</span> 6<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">no</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="free">levellista</span> <span class="main">!</span> <span class="free">j</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">j</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rotate_tac</span> 7<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">no</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> conjE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">∈</span> set_of <span class="free">pret</span> <span class="main">⟶</span> <span class="bound">q</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">levellista</span> <span class="main">!</span> <span class="free">var</span> <span class="bound">q</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="General-nodes_in_wf_ll"><span class="command">lemma</span></span> nodes_in_wf_ll<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">⟦</span>wf_ll <span class="free">pret</span> <span class="free">levellista</span> <span class="free">var</span><span class="main">;</span> <span class="free">i</span> <span class="main">&lt;</span> length <span class="free">levellista</span><span class="main">;</span>  <span class="free">no</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">levellista</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">⟧</span> 
 <span class="main">⟹</span> <span class="free">var</span> <span class="free">no</span> <span class="main">=</span> <span class="free">i</span> <span class="main">∧</span> <span class="free">no</span> <span class="main">∈</span> set_of <span class="free">pret</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ll_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="General-subelem_set_of_low"><span class="command">lemma</span></span> subelem_set_of_low<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">p</span><span class="main">.</span> <span class="main">⟦</span> <span class="free">x</span> <span class="main">∈</span> set_of <span class="free">t</span><span class="main">;</span> <span class="free">x</span> <span class="main">≠</span> Null<span class="main">;</span> <span class="free">low</span> <span class="free">x</span> <span class="main">≠</span> Null<span class="main">;</span> Dag <span class="bound">p</span> <span class="free">low</span> <span class="free">high</span> <span class="free">t</span> <span class="main">⟧</span> 
 <span class="main">⟹</span> <span class="main">(</span><span class="free">low</span> <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> set_of <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Tip
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">po</span> <span class="skolem">rt</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> tNode<span class="main">=</span>this
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ppo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="skolem">po</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">=</span><span class="skolem">p</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> Node.prems <span class="keyword1"><span class="command">have</span></span> lxrootlt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">low</span> <span class="free">x</span> <span class="main">=</span> root <span class="skolem">lt</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">lt</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Tip
      <span class="keyword1"><span class="command">with</span></span> True Node.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">llt</span> <span class="skolem">l</span> <span class="skolem">rlt</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> Node.prems True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> True Node.prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">low</span> <span class="free">x</span> <span class="main">∈</span> set_of <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">lt</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Tip
      <span class="keyword1"><span class="command">with</span></span> lxrootlt Node.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">llt</span> <span class="skolem">l</span> <span class="skolem">rlt</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> lxrootlt Node.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> ppo <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> xnp<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="free">x</span> <span class="main">≠</span> <span class="skolem">p</span>"</span></span>  
    <span class="keyword1"><span class="command">with</span></span> Node.prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set_of <span class="skolem">lt</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">∈</span> set_of <span class="skolem">rt</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set_of <span class="skolem">lt</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">note</span></span> xinlt<span class="main">=</span>this
      <span class="keyword1"><span class="command">from</span></span> Node.prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="free">low</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">low</span> <span class="free">high</span> <span class="skolem">lt</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">with</span></span> Node.prems True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">low</span> <span class="free">x</span> <span class="main">∈</span> set_of <span class="skolem">lt</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Node.hyps<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">with</span></span> Node.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> xnotinlt<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="free">x</span> <span class="main">∉</span> set_of <span class="skolem">lt</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> xnp Node.prems <span class="keyword1"><span class="command">have</span></span> xinrt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set_of <span class="skolem">rt</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> Node.prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="free">high</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">low</span> <span class="free">high</span> <span class="skolem">rt</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">with</span></span> Node.prems xinrt <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">low</span> <span class="free">x</span> <span class="main">∈</span> set_of <span class="skolem">rt</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Node.hyps<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">with</span></span> Node.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
      
<span class="keyword1" id="General-subelem_set_of_high"><span class="command">lemma</span></span> subelem_set_of_high<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">p</span><span class="main">.</span> <span class="main">⟦</span> <span class="free">x</span> <span class="main">∈</span> set_of <span class="free">t</span><span class="main">;</span> <span class="free">x</span> <span class="main">≠</span> Null<span class="main">;</span> <span class="free">high</span> <span class="free">x</span> <span class="main">≠</span> Null<span class="main">;</span> Dag <span class="bound">p</span> <span class="free">low</span> <span class="free">high</span> <span class="free">t</span> <span class="main">⟧</span> 
 <span class="main">⟹</span> <span class="main">(</span><span class="free">high</span> <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> set_of <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Tip
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">po</span> <span class="skolem">rt</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> tNode<span class="main">=</span>this
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ppo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="skolem">po</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">=</span><span class="skolem">p</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> Node.prems <span class="keyword1"><span class="command">have</span></span> lxrootlt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">high</span> <span class="free">x</span> <span class="main">=</span> root <span class="skolem">rt</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">rt</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Tip
      <span class="keyword1"><span class="command">with</span></span> True Node.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">lrt</span> <span class="skolem">l</span> <span class="skolem">rrt</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> Node.prems True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> True Node.prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">high</span> <span class="free">x</span> <span class="main">∈</span> set_of <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">rt</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Tip
      <span class="keyword1"><span class="command">with</span></span> lxrootlt Node.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">lrt</span> <span class="skolem">l</span> <span class="skolem">rrt</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> lxrootlt Node.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> ppo <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> xnp<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="free">x</span> <span class="main">≠</span> <span class="skolem">p</span>"</span></span>  
    <span class="keyword1"><span class="command">with</span></span> Node.prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set_of <span class="skolem">lt</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">∈</span> set_of <span class="skolem">rt</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set_of <span class="skolem">lt</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">note</span></span> xinlt<span class="main">=</span>this
      <span class="keyword1"><span class="command">from</span></span> Node.prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="free">low</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">low</span> <span class="free">high</span> <span class="skolem">lt</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">with</span></span> Node.prems True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">high</span> <span class="free">x</span> <span class="main">∈</span> set_of <span class="skolem">lt</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Node.hyps<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">with</span></span> Node.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> xnotinlt<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="free">x</span> <span class="main">∉</span> set_of <span class="skolem">lt</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> xnp Node.prems <span class="keyword1"><span class="command">have</span></span> xinrt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set_of <span class="skolem">rt</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> Node.prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="free">high</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">low</span> <span class="free">high</span> <span class="skolem">rt</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">with</span></span> Node.prems xinrt <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">high</span> <span class="free">x</span> <span class="main">∈</span> set_of <span class="skolem">rt</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Node.hyps<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">with</span></span> Node.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>        

<span class="keyword1" id="General-set_split"><span class="command">lemma</span></span> set_split<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span><span class="main">&lt;</span><span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span><span class="main">&lt;</span><span class="free">n</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">n</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1" id="General-Nodes_levellist_subset_t"><span class="command">lemma</span></span> Nodes_levellist_subset_t<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">⟦</span>wf_ll <span class="free">t</span> <span class="free">levellist</span> <span class="free">var</span><span class="main">;</span> <span class="free">i</span><span class="main">&lt;=</span> length <span class="free">levellist</span><span class="main">⟧</span> <span class="main">⟹</span> Nodes <span class="free">i</span> <span class="free">levellist</span> <span class="main">⊆</span> set_of <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nodes_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Suc.prems Suc.hyps <span class="keyword1"><span class="command">have</span></span> Nodesn_in_t<span class="main">:</span> <span class="quoted"><span class="quoted">"Nodes <span class="skolem">n</span> <span class="free">levellist</span> <span class="main">⊆</span> set_of <span class="free">t</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> Suc.prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">levellist</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set_of <span class="free">t</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ll_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> conjE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">∈</span> set_of <span class="free">t</span> <span class="main">⟶</span> <span class="bound">q</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">levellist</span> <span class="main">!</span> <span class="free">var</span> <span class="bound">q</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">with</span></span> Suc.prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="free">levellist</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">⊆</span> set_of <span class="free">t</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">with</span></span> Suc.prems Nodesn_in_t <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nodes_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_split<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="General-bdt_child"><span class="command">lemma</span></span> bdt_child<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">⟦</span> bdt <span class="main">(</span>Node <span class="main">(</span>Node <span class="free">llt</span> <span class="free">l</span> <span class="free">rlt</span><span class="main">)</span> <span class="free">p</span> <span class="main">(</span>Node <span class="free">lrt</span> <span class="free">r</span> <span class="free">rrt</span><span class="main">)</span><span class="main">)</span> <span class="free">var</span> <span class="main">=</span> Some <span class="free">bdt1</span><span class="main">⟧</span> 
 <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">lbdt</span> <span class="bound">rbdt</span><span class="main">.</span>  bdt <span class="main">(</span>Node <span class="free">llt</span> <span class="free">l</span> <span class="free">rlt</span><span class="main">)</span> <span class="free">var</span> <span class="main">=</span> Some <span class="bound">lbdt</span> <span class="main">∧</span> 
                   bdt <span class="main">(</span>Node <span class="free">lrt</span> <span class="free">r</span> <span class="free">rrt</span><span class="main">)</span> <span class="free">var</span> <span class="main">=</span> Some <span class="bound">rbdt</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>


<span class="keyword1" id="General-subbdt_ex_dag_def"><span class="command">lemma</span></span> subbdt_ex_dag_def<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">bdt1</span> <span class="bound">p</span><span class="main">.</span> <span class="main">⟦</span>Dag <span class="bound">p</span> <span class="free">low</span> <span class="free">high</span> <span class="free">t</span><span class="main">;</span> bdt <span class="free">t</span> <span class="free">var</span> <span class="main">=</span> Some <span class="bound">bdt1</span><span class="main">;</span> Dag <span class="free">no</span> <span class="free">low</span> <span class="free">high</span> <span class="free">not</span><span class="main">;</span> 
<span class="free">no</span> <span class="main">∈</span> set_of <span class="free">t</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">bdt2</span><span class="main">.</span>  bdt <span class="free">not</span> <span class="free">var</span> <span class="main">=</span> Some <span class="bound">bdt2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Tip
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">po</span> <span class="skolem">rt</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> pNode<span class="main">=</span>this
  <span class="keyword1"><span class="command">with</span></span> Node.prems <span class="keyword1"><span class="command">have</span></span> p_po<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="skolem">po</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">no</span> <span class="main">=</span> <span class="skolem">po</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">note</span></span> no_eq_po<span class="main">=</span>this
    <span class="keyword1"><span class="command">from</span></span> p_po Node.prems no_eq_po <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">not</span> <span class="main">=</span> <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">po</span> <span class="skolem">rt</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Dag_unique <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Dag_Ref<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Node.prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bdt <span class="free">not</span> <span class="free">var</span> <span class="main">=</span> Some <span class="skolem">bdt1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_dag_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">no</span> <span class="main">≠</span> <span class="skolem">po</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> Node.prems <span class="keyword1"><span class="command">have</span></span> no_in_lt_or_rt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">no</span> <span class="main">∈</span> set_of <span class="skolem">lt</span> <span class="main">∨</span> <span class="free">no</span> <span class="main">∈</span> set_of <span class="skolem">rt</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">no</span> <span class="main">∈</span> set_of <span class="skolem">lt</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">note</span></span> no_in_lt<span class="main">=</span>this
      <span class="keyword1"><span class="command">from</span></span> Node.prems p_po <span class="keyword1"><span class="command">have</span></span> lt_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="free">low</span> <span class="skolem">po</span><span class="main">)</span> <span class="free">low</span> <span class="free">high</span> <span class="skolem">lt</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> Node.prems <span class="keyword1"><span class="command">have</span></span> lbdt_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">lbdt</span><span class="main">.</span> bdt <span class="skolem">lt</span> <span class="free">var</span> <span class="main">=</span> Some <span class="bound">lbdt</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">lt</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> Tip
        <span class="keyword1"><span class="command">with</span></span> Node.prems no_in_lt <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_dag_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">llt</span> <span class="skolem">l</span> <span class="skolem">rlt</span><span class="main">)</span>
        <span class="keyword1"><span class="command">note</span></span> lNode<span class="main">=</span>this
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">rt</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> Tip
          <span class="keyword1"><span class="command">note</span></span> rNode<span class="main">=</span>this
          <span class="keyword1"><span class="command">with</span></span> lNode Node.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span> 
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">lrt</span> <span class="skolem">r</span> <span class="skolem">rrt</span><span class="main">)</span>
          <span class="keyword1"><span class="command">note</span></span> rNode<span class="main">=</span>this
          <span class="keyword1"><span class="command">with</span></span> lNode Node.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lbdt</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"bdt <span class="skolem">lt</span> <span class="free">var</span> <span class="main">=</span> Some <span class="skolem">lbdt</span>"</span></span><span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">with</span></span> Node.prems lt_dag no_in_lt <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Node.hyps<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">no</span> <span class="main">∉</span> set_of <span class="skolem">lt</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> no_in_lt_or_rt <span class="keyword1"><span class="command">have</span></span> no_in_rt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">no</span> <span class="main">∈</span> set_of <span class="skolem">rt</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> Node.prems p_po <span class="keyword1"><span class="command">have</span></span> rt_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="free">high</span> <span class="skolem">po</span><span class="main">)</span> <span class="free">low</span> <span class="free">high</span> <span class="skolem">rt</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> Node.hyps <span class="keyword1"><span class="command">have</span></span> hyp2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">rbdt</span><span class="main">.</span> <span class="main">⟦</span>Dag <span class="main">(</span><span class="free">high</span> <span class="skolem">po</span><span class="main">)</span> <span class="free">low</span> <span class="free">high</span> <span class="skolem">rt</span><span class="main">;</span> bdt <span class="skolem">rt</span> <span class="free">var</span> <span class="main">=</span> Some <span class="bound">rbdt</span><span class="main">;</span> Dag <span class="free">no</span> <span class="free">low</span> <span class="free">high</span> <span class="free">not</span><span class="main">;</span> <span class="free">no</span> <span class="main">∈</span> set_of <span class="skolem">rt</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">bdt2</span><span class="main">.</span> bdt <span class="free">not</span> <span class="free">var</span> <span class="main">=</span> Some <span class="bound">bdt2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> Node.prems <span class="keyword1"><span class="command">have</span></span> lbdt_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">rbdt</span><span class="main">.</span> bdt <span class="skolem">rt</span> <span class="free">var</span> <span class="main">=</span> Some <span class="bound">rbdt</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">rt</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> Tip
        <span class="keyword1"><span class="command">with</span></span> Node.prems no_in_rt <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_dag_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">lrt</span> <span class="skolem">l</span> <span class="skolem">rrt</span><span class="main">)</span>
        <span class="keyword1"><span class="command">note</span></span> rNode<span class="main">=</span>this
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">lt</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> Tip
          <span class="keyword1"><span class="command">note</span></span> lTip<span class="main">=</span>this
          <span class="keyword1"><span class="command">with</span></span> rNode Node.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span> 
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">llt</span> <span class="skolem">r</span> <span class="skolem">rlt</span><span class="main">)</span>
          <span class="keyword1"><span class="command">note</span></span> lNode<span class="main">=</span>this
          <span class="keyword1"><span class="command">with</span></span> rNode Node.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rbdt</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"bdt <span class="skolem">rt</span> <span class="free">var</span> <span class="main">=</span> Some <span class="skolem">rbdt</span>"</span></span><span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">with</span></span> Node.prems rt_dag no_in_rt <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> hyp2<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
      
<span class="keyword1" id="General-subbdt_ex"><span class="command">lemma</span></span> subbdt_ex<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">bdt1</span><span class="main">.</span> <span class="main">⟦</span> <span class="main">(</span>Node <span class="free">lst</span> <span class="free">stp</span> <span class="free">rst</span><span class="main">)</span> <span class="main">&lt;=</span> <span class="free">t</span><span class="main">;</span> bdt <span class="free">t</span> <span class="free">var</span> <span class="main">=</span> Some <span class="bound">bdt1</span><span class="main">⟧</span> 
 <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">bdt2</span><span class="main">.</span>  bdt <span class="main">(</span>Node <span class="free">lst</span> <span class="free">stp</span> <span class="free">rst</span><span class="main">)</span> <span class="free">var</span> <span class="main">=</span> Some <span class="bound">bdt2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Tip
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_dag_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span> 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> pNode<span class="main">=</span>this
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Node <span class="free">lst</span> <span class="free">stp</span> <span class="free">rst</span> <span class="main">=</span> Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> Node.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">" Node <span class="free">lst</span> <span class="free">stp</span> <span class="free">rst</span> <span class="main">≠</span> Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> Node.prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Node <span class="free">lst</span> <span class="free">stp</span> <span class="free">rst</span> <span class="main">&lt;</span> Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_dag_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> in_ltrt<span class="main">:</span> <span class="quoted"><span class="quoted">"Node <span class="free">lst</span> <span class="free">stp</span> <span class="free">rst</span> <span class="main">&lt;=</span> <span class="skolem">lt</span> <span class="main">∨</span> Node <span class="free">lst</span> <span class="free">stp</span> <span class="free">rst</span> <span class="main">&lt;=</span> <span class="skolem">rt</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_dag_Node<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Node <span class="free">lst</span> <span class="free">stp</span> <span class="free">rst</span> <span class="main">&lt;=</span> <span class="skolem">lt</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True 
      <span class="keyword1"><span class="command">note</span></span> in_lt<span class="main">=</span>this
      <span class="keyword1"><span class="command">from</span></span> Node.prems <span class="keyword1"><span class="command">have</span></span> lbdt_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">lbdt</span><span class="main">.</span> bdt <span class="skolem">lt</span> <span class="free">var</span> <span class="main">=</span> Some <span class="bound">lbdt</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">lt</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> Tip
        <span class="keyword1"><span class="command">with</span></span> Node.prems in_lt <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_dag_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">llt</span> <span class="skolem">l</span> <span class="skolem">rlt</span><span class="main">)</span>
        <span class="keyword1"><span class="command">note</span></span> lNode<span class="main">=</span>this
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">rt</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> Tip
          <span class="keyword1"><span class="command">note</span></span> rNode<span class="main">=</span>this
          <span class="keyword1"><span class="command">with</span></span> lNode Node.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span> 
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">lrt</span> <span class="skolem">r</span> <span class="skolem">rrt</span><span class="main">)</span>
          <span class="keyword1"><span class="command">note</span></span> rNode<span class="main">=</span>this
          <span class="keyword1"><span class="command">with</span></span> lNode Node.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lbdt</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"bdt <span class="skolem">lt</span> <span class="free">var</span> <span class="main">=</span> Some <span class="skolem">lbdt</span>"</span></span><span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">with</span></span> Node.prems in_lt <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Node.hyps<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">" <span class="main">¬</span> Node <span class="free">lst</span> <span class="free">stp</span> <span class="free">rst</span> <span class="main">≤</span> <span class="skolem">lt</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> in_ltrt <span class="keyword1"><span class="command">have</span></span> in_rt<span class="main">:</span> <span class="quoted"><span class="quoted">"Node <span class="free">lst</span> <span class="free">stp</span> <span class="free">rst</span> <span class="main">&lt;=</span> <span class="skolem">rt</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> Node.hyps <span class="keyword1"><span class="command">have</span></span> hyp2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">rbdt</span><span class="main">.</span> <span class="main">⟦</span>Node <span class="free">lst</span> <span class="free">stp</span> <span class="free">rst</span> <span class="main">&lt;=</span> <span class="skolem">rt</span><span class="main">;</span> bdt <span class="skolem">rt</span> <span class="free">var</span> <span class="main">=</span> Some <span class="bound">rbdt</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">bdt2</span><span class="main">.</span> bdt <span class="main">(</span>Node <span class="free">lst</span> <span class="free">stp</span> <span class="free">rst</span><span class="main">)</span> <span class="free">var</span> <span class="main">=</span> Some <span class="bound">bdt2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> Node.prems <span class="keyword1"><span class="command">have</span></span> rbdt_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">rbdt</span><span class="main">.</span> bdt <span class="skolem">rt</span> <span class="free">var</span> <span class="main">=</span> Some <span class="bound">rbdt</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">rt</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> Tip
        <span class="keyword1"><span class="command">with</span></span> Node.prems in_rt <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_dag_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">lrt</span> <span class="skolem">l</span> <span class="skolem">rrt</span><span class="main">)</span>
        <span class="keyword1"><span class="command">note</span></span> rNode<span class="main">=</span>this
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">lt</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> Tip
          <span class="keyword1"><span class="command">note</span></span> lNode<span class="main">=</span>this
          <span class="keyword1"><span class="command">with</span></span> rNode Node.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span> 
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">lrt</span> <span class="skolem">r</span> <span class="skolem">rrt</span><span class="main">)</span>
          <span class="keyword1"><span class="command">note</span></span> lNode<span class="main">=</span>this
          <span class="keyword1"><span class="command">with</span></span> rNode Node.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rbdt</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"bdt <span class="skolem">rt</span> <span class="free">var</span> <span class="main">=</span> Some <span class="skolem">rbdt</span>"</span></span><span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">with</span></span> Node.prems in_rt <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> hyp2<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="General-var_ordered_children"><span class="command">lemma</span></span> var_ordered_children<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">p</span><span class="main">.</span> <span class="main">⟦</span> Dag <span class="bound">p</span> <span class="free">low</span> <span class="free">high</span> <span class="free">t</span><span class="main">;</span> ordered <span class="free">t</span> <span class="free">var</span><span class="main">;</span> <span class="free">no</span> <span class="main">∈</span> set_of <span class="free">t</span><span class="main">;</span> 
        <span class="free">low</span> <span class="free">no</span> <span class="main">≠</span> Null<span class="main">;</span> <span class="free">high</span> <span class="free">no</span> <span class="main">≠</span> Null<span class="main">⟧</span> 
       <span class="main">⟹</span> <span class="free">var</span> <span class="main">(</span><span class="free">low</span> <span class="free">no</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">var</span> <span class="free">no</span> <span class="main">∧</span> <span class="free">var</span> <span class="main">(</span><span class="free">high</span> <span class="free">no</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">var</span> <span class="free">no</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Tip
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">po</span> <span class="skolem">rt</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ppo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="skolem">po</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">no</span> <span class="main">=</span> <span class="skolem">po</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">note</span></span> no_po<span class="main">=</span>this
    <span class="keyword1"><span class="command">from</span></span> Node.prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="main">(</span><span class="free">low</span> <span class="skolem">po</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">var</span> <span class="skolem">po</span> <span class="main">∧</span> <span class="free">var</span> <span class="main">(</span><span class="free">high</span> <span class="skolem">po</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">var</span> <span class="skolem">po</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">lt</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Tip
      <span class="keyword1"><span class="command">note</span></span> ltTip<span class="main">=</span>this
      <span class="keyword1"><span class="command">with</span></span> Node.prems no_po ppo <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">llt</span> <span class="skolem">l</span> <span class="skolem">rlt</span><span class="main">)</span>
      <span class="keyword1"><span class="command">note</span></span> lNode<span class="main">=</span>this
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">rt</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> Tip
        <span class="keyword1"><span class="command">note</span></span> rTip<span class="main">=</span>this
        <span class="keyword1"><span class="command">with</span></span> Node.prems no_po ppo <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">lrt</span> <span class="skolem">r</span> <span class="skolem">rrt</span><span class="main">)</span>
        <span class="keyword1"><span class="command">note</span></span> rNode<span class="main">=</span>this
        <span class="keyword1"><span class="command">with</span></span> Node.prems ppo no_po lNode  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Dag_Ref<span class="main">)</span> 
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> no_po <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">" <span class="free">no</span> <span class="main">≠</span> <span class="skolem">po</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> Node.prems <span class="keyword1"><span class="command">have</span></span> no_in_ltrt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">no</span> <span class="main">∈</span> set_of <span class="skolem">lt</span> <span class="main">∨</span> <span class="free">no</span> <span class="main">∈</span> set_of <span class="skolem">rt</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">no</span> <span class="main">∈</span> set_of <span class="skolem">lt</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">note</span></span> no_in_lt<span class="main">=</span>this
      <span class="keyword1"><span class="command">from</span></span> Node.prems ppo <span class="keyword1"><span class="command">have</span></span> lt_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="free">low</span> <span class="skolem">po</span><span class="main">)</span> <span class="free">low</span> <span class="free">high</span> <span class="skolem">lt</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> Node.prems <span class="keyword1"><span class="command">have</span></span> ord_lt<span class="main">:</span> <span class="quoted"><span class="quoted">"ordered <span class="skolem">lt</span> <span class="free">var</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> children_ordered<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">from</span></span> no_in_lt lt_dag ord_lt Node.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Node.hyps<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">" <span class="free">no</span> <span class="main">∉</span> set_of <span class="skolem">lt</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> no_in_ltrt <span class="keyword1"><span class="command">have</span></span> no_in_rt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">no</span> <span class="main">∈</span> set_of <span class="skolem">rt</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> Node.prems ppo <span class="keyword1"><span class="command">have</span></span> rt_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="free">high</span> <span class="skolem">po</span><span class="main">)</span> <span class="free">low</span> <span class="free">high</span> <span class="skolem">rt</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> Node.hyps <span class="keyword1"><span class="command">have</span></span> hyp2<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">⟦</span>Dag <span class="main">(</span><span class="free">high</span> <span class="skolem">po</span><span class="main">)</span> <span class="free">low</span> <span class="free">high</span> <span class="skolem">rt</span><span class="main">;</span> ordered <span class="skolem">rt</span> <span class="free">var</span><span class="main">;</span> <span class="free">no</span> <span class="main">∈</span> set_of <span class="skolem">rt</span><span class="main">;</span> <span class="free">low</span> <span class="free">no</span> <span class="main">≠</span> Null<span class="main">;</span> <span class="free">high</span> <span class="free">no</span> <span class="main">≠</span> Null<span class="main">⟧</span>
                                  <span class="main">⟹</span> <span class="free">var</span> <span class="main">(</span><span class="free">low</span> <span class="free">no</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">var</span> <span class="free">no</span> <span class="main">∧</span> <span class="free">var</span> <span class="main">(</span><span class="free">high</span> <span class="free">no</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">var</span> <span class="free">no</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> Node.prems <span class="keyword1"><span class="command">have</span></span> ord_rt<span class="main">:</span> <span class="quoted"><span class="quoted">"ordered <span class="skolem">rt</span> <span class="free">var</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> children_ordered<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">from</span></span> rt_dag ord_rt no_in_rt Node.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> hyp2<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="General-nort_null_comp"><span class="command">lemma</span></span> nort_null_comp<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> pret_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="free">p</span> <span class="free">low</span> <span class="free">high</span> <span class="free">pret</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        prebdt_pret<span class="main">:</span> <span class="quoted"><span class="quoted">"bdt <span class="free">pret</span> <span class="free">var</span> <span class="main">=</span> Some <span class="free">prebdt</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        nort_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="free">repc</span> <span class="free">no</span><span class="main">)</span> <span class="main">(</span><span class="free">repb</span> <span class="main">∝</span> <span class="free">low</span><span class="main">)</span> <span class="main">(</span><span class="free">repb</span> <span class="main">∝</span> <span class="free">high</span><span class="main">)</span> <span class="free">nort</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        ord_pret<span class="main">:</span> <span class="quoted"><span class="quoted">"ordered <span class="free">pret</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        wf_llb<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_ll <span class="free">pret</span> <span class="free">levellistb</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        nbsll<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">nb</span> <span class="main">&lt;</span> length <span class="free">levellistb</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        repbc_nc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">nt</span><span class="main">.</span> <span class="bound">nt</span> <span class="main">∉</span> set <span class="main">(</span><span class="free">levellistb</span> <span class="main">!</span> <span class="free">nb</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">repb</span> <span class="bound">nt</span> <span class="main">=</span> <span class="free">repc</span> <span class="bound">nt</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        xsnb_in_pret<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> set_of <span class="free">nort</span><span class="main">.</span> <span class="free">var</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">nb</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∈</span> set_of <span class="free">pret</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> set_of <span class="free">nort</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">repc</span> <span class="main">∝</span> <span class="free">low</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">repb</span> <span class="main">∝</span> <span class="free">low</span><span class="main">)</span> <span class="bound">x</span> <span class="main">∧</span> 
                           <span class="main">(</span><span class="free">repc</span> <span class="main">∝</span> <span class="free">high</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">repb</span> <span class="main">∝</span> <span class="free">high</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> x_in_nort<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set_of <span class="free">nort</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> nort_dag <span class="keyword1"><span class="command">have</span></span> xnN<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> Null"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_of_nn <span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">from</span></span> x_in_nort xsnb_in_pret <span class="keyword1"><span class="command">have</span></span> xsnb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="skolem">x</span> <span class="main">&lt;</span><span class="free">nb</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> x_in_nort xsnb_in_pret <span class="keyword1"><span class="command">have</span></span> x_in_pret<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set_of <span class="free">pret</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="free">repc</span> <span class="main">∝</span> <span class="free">low</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">repb</span> <span class="main">∝</span> <span class="free">low</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="main">(</span><span class="free">repc</span> <span class="main">∝</span> <span class="free">high</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">repb</span> <span class="main">∝</span> <span class="free">high</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">low</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≠</span> Null"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> pret_dag prebdt_pret x_in_pret <span class="keyword1"><span class="command">have</span></span> highnN<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">high</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≠</span> Null"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> balanced_bdt<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">from</span></span> x_in_pret ord_pret highnN True <span class="keyword1"><span class="command">have</span></span> children_var_smaller<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="main">(</span><span class="free">low</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">var</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="free">var</span> <span class="main">(</span><span class="free">high</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">var</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> var_ordered_children<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> pret_dag<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ord_pret<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> x_in_pret<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> True<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> highnN<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">with</span></span> xsnb <span class="keyword1"><span class="command">have</span></span> lowxsnb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="main">(</span><span class="free">low</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">nb</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
    <span class="keyword1"><span class="command">from</span></span> children_var_smaller xsnb <span class="keyword1"><span class="command">have</span></span> highxsnb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="main">(</span><span class="free">high</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">nb</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
    <span class="keyword1"><span class="command">from</span></span> x_in_pret xnN True pret_dag <span class="keyword1"><span class="command">have</span></span> lowxinpret<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">low</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> set_of <span class="free">pret</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> subelem_set_of_low<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> Null"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">with</span></span> wf_llb <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">low</span> <span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">levellistb</span> <span class="main">!</span> <span class="main">(</span><span class="free">var</span> <span class="main">(</span><span class="free">low</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ll_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> wf_llb nbsll lowxsnb <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">low</span> <span class="skolem">x</span> <span class="main">∉</span> set <span class="main">(</span><span class="free">levellistb</span> <span class="main">!</span> <span class="free">nb</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="var">?i</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">var</span> <span class="main">(</span><span class="free">low</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="var">?j</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">nb</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> no_in_one_ll<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">with</span></span> repbc_nc <span class="keyword1"><span class="command">have</span></span> repclow<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">repc</span> <span class="main">(</span><span class="free">low</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">repb</span> <span class="main">(</span><span class="free">low</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> x_in_pret xnN highnN pret_dag <span class="keyword1"><span class="command">have</span></span> highxinpret<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">high</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> set_of <span class="free">pret</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> subelem_set_of_high<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> Null"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">with</span></span> wf_llb <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">high</span> <span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">levellistb</span> <span class="main">!</span> <span class="main">(</span><span class="free">var</span> <span class="main">(</span><span class="free">high</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ll_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> wf_llb nbsll highxsnb <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">high</span> <span class="skolem">x</span> <span class="main">∉</span> set <span class="main">(</span><span class="free">levellistb</span> <span class="main">!</span> <span class="free">nb</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="var">?i</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">var</span> <span class="main">(</span><span class="free">high</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="var">?j</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">nb</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> no_in_one_ll<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">with</span></span> repbc_nc <span class="keyword1"><span class="command">have</span></span> repchigh<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">repc</span> <span class="main">(</span><span class="free">high</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">repb</span> <span class="main">(</span><span class="free">high</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> repclow <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">" <span class="main">¬</span> <span class="free">low</span> <span class="skolem">x</span> <span class="main">≠</span> Null"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> lowxNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">low</span> <span class="skolem">x</span> <span class="main">=</span> Null"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> pret_dag x_in_pret prebdt_pret <span class="keyword1"><span class="command">have</span></span> highxNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">high</span> <span class="skolem">x</span> <span class="main">=</span>Null"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> balanced_bdt<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">from</span></span> lowxNull <span class="keyword1"><span class="command">have</span></span> repclowNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">repc</span> <span class="main">∝</span> <span class="free">low</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> Null"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> lowxNull <span class="keyword1"><span class="command">have</span></span> repblowNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">repb</span> <span class="main">∝</span> <span class="free">low</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> Null"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> repclowNull <span class="keyword1"><span class="command">have</span></span> lowxrepbc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">repc</span> <span class="main">∝</span> <span class="free">low</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">repb</span> <span class="main">∝</span> <span class="free">low</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> highxNull <span class="keyword1"><span class="command">have</span></span> repchighNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">repc</span> <span class="main">∝</span> <span class="free">high</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> Null"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> highxNull <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">repb</span> <span class="main">∝</span> <span class="free">high</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> Null"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> repchighNull <span class="keyword1"><span class="command">have</span></span> highxrepbc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">repc</span> <span class="main">∝</span> <span class="free">high</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">repb</span> <span class="main">∝</span> <span class="free">high</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> lowxrepbc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>         

<span class="keyword1" id="General-wf_ll_Nodes_pret"><span class="command">lemma</span></span> wf_ll_Nodes_pret<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">⟦</span>wf_ll <span class="free">pret</span> <span class="free">levellista</span> <span class="free">var</span><span class="main">;</span> <span class="free">nb</span> <span class="main">&lt;</span> length <span class="free">levellista</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> Nodes <span class="free">nb</span> <span class="free">levellista</span><span class="main">⟧</span> 
 <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> set_of <span class="free">pret</span> <span class="main">∧</span> <span class="free">var</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free">nb</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ll_def Nodes_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> conjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">∈</span> set_of <span class="free">pret</span> <span class="main">⟶</span> <span class="bound">q</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">levellista</span> <span class="main">!</span> <span class="free">var</span> <span class="bound">q</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> conjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">xa</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="General-bdt_Some_var1_One"><span class="command">lemma</span></span> bdt_Some_var1_One<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="main">⟦</span> bdt <span class="free">t</span> <span class="free">var</span> <span class="main">=</span> Some <span class="bound">x</span><span class="main">;</span> <span class="free">var</span> <span class="main">(</span>root <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">⟧</span> 
 <span class="main">⟹</span> <span class="bound">x</span> <span class="main">=</span> One <span class="main">∧</span> <span class="free">t</span> <span class="main">=</span> <span class="main">(</span>Node Tip <span class="main">(</span>root <span class="free">t</span><span class="main">)</span> Tip<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Tip
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span>  <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> tNode <span class="main">=</span> this
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">lt</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Tip
    <span class="keyword1"><span class="command">note</span></span> ltTip<span class="main">=</span>this
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">rt</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Tip
      <span class="keyword1"><span class="command">note</span></span> rtTip <span class="main">=</span> this
      <span class="keyword1"><span class="command">with</span></span> ltTip Node.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">lrt</span> <span class="skolem">r</span> <span class="skolem">rrt</span><span class="main">)</span>
      <span class="keyword1"><span class="command">note</span></span> rtNode<span class="main">=</span>this
      <span class="keyword1"><span class="command">with</span></span> Node.prems ltTip <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">llt</span> <span class="skolem">l</span> <span class="skolem">rlt</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> ltNode<span class="main">=</span>this
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">rt</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Tip
      <span class="keyword1"><span class="command">with</span></span> ltNode Node.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">lrt</span> <span class="skolem">r</span> <span class="skolem">rrt</span><span class="main">)</span>
      <span class="keyword1"><span class="command">note</span></span> rtNode<span class="main">=</span>this
      <span class="keyword1"><span class="command">with</span></span> ltNode Node.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="General-bdt_Some_var0_Zero"><span class="command">lemma</span></span> bdt_Some_var0_Zero<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="main">⟦</span> bdt <span class="free">t</span> <span class="free">var</span> <span class="main">=</span> Some <span class="bound">x</span><span class="main">;</span> <span class="free">var</span> <span class="main">(</span>root <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">⟧</span> 
<span class="main">⟹</span> <span class="bound">x</span> <span class="main">=</span> Zero <span class="main">∧</span> <span class="free">t</span> <span class="main">=</span> <span class="main">(</span>Node Tip <span class="main">(</span>root <span class="free">t</span><span class="main">)</span> Tip<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Tip
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span>  <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> tNode <span class="main">=</span> this
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">lt</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Tip
    <span class="keyword1"><span class="command">note</span></span> ltTip<span class="main">=</span>this
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">rt</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Tip
      <span class="keyword1"><span class="command">note</span></span> rtTip <span class="main">=</span> this
      <span class="keyword1"><span class="command">with</span></span> ltTip Node.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">lrt</span> <span class="skolem">r</span> <span class="skolem">rrt</span><span class="main">)</span>
      <span class="keyword1"><span class="command">note</span></span> rtNode<span class="main">=</span>this
      <span class="keyword1"><span class="command">with</span></span> Node.prems ltTip <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">llt</span> <span class="skolem">l</span> <span class="skolem">rlt</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> ltNode<span class="main">=</span>this
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">rt</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Tip
      <span class="keyword1"><span class="command">with</span></span> ltNode Node.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">lrt</span> <span class="skolem">r</span> <span class="skolem">rrt</span><span class="main">)</span>
      <span class="keyword1"><span class="command">note</span></span> rtNode<span class="main">=</span>this
      <span class="keyword1"><span class="command">with</span></span> ltNode Node.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="General-reduced_children_parent"><span class="command">lemma</span></span> reduced_children_parent<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">⟦</span> reduced <span class="free">l</span><span class="main">;</span> <span class="free">l</span><span class="main">=</span> <span class="main">(</span>Node <span class="free">llt</span> <span class="free">lp</span> <span class="free">rlt</span><span class="main">)</span><span class="main">;</span> reduced <span class="free">r</span><span class="main">;</span> <span class="free">r</span><span class="main">=</span><span class="main">(</span>Node <span class="free">lrt</span> <span class="free">rp</span> <span class="free">rrt</span><span class="main">)</span><span class="main">;</span> 
  <span class="free">lp</span> <span class="main">≠</span> <span class="free">rp</span> <span class="main">⟧</span> 
 <span class="main">⟹</span> reduced <span class="main">(</span>Node <span class="free">l</span> <span class="free">p</span> <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="comment1">(*Die allgemeine Form mit i &lt;=j ⟹ Nodes i levellista ⊆ Nodes j levellista wäre schöner, aber wie beweist man das? *)</span>
<span class="keyword1" id="General-Nodes_subset"><span class="command">lemma</span></span> Nodes_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"Nodes <span class="free">i</span> <span class="free">levellista</span> <span class="main">⊆</span> Nodes <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="free">levellista</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nodes_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_split<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="General-Nodes_levellist"><span class="command">lemma</span></span> Nodes_levellist<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">⟦</span> wf_ll <span class="free">pret</span> <span class="free">levellista</span> <span class="free">var</span><span class="main">;</span> <span class="free">nb</span> <span class="main">&lt;</span> length <span class="free">levellista</span><span class="main">;</span> <span class="free">p</span> <span class="main">∈</span> Nodes <span class="free">nb</span> <span class="free">levellista</span><span class="main">⟧</span> 
 <span class="main">⟹</span> <span class="free">p</span> <span class="main">∉</span> set <span class="main">(</span><span class="free">levellista</span> <span class="main">!</span> <span class="free">nb</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nodes_def<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> i<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> j<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">nb</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> no_in_one_ll<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="General-Nodes_var_pret"><span class="command">lemma</span></span> Nodes_var_pret<span class="main">:</span> 
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span>wf_ll <span class="free">pret</span> <span class="free">levellista</span> <span class="free">var</span><span class="main">;</span> <span class="free">nb</span> <span class="main">&lt;</span> length <span class="free">levellista</span><span class="main">;</span> <span class="free">p</span> <span class="main">∈</span> Nodes <span class="free">nb</span> <span class="free">levellista</span><span class="main">⟧</span> 
  <span class="main">⟹</span> <span class="free">var</span> <span class="free">p</span> <span class="main">&lt;</span> <span class="free">nb</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">∈</span> set_of <span class="free">pret</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nodes_def wf_ll_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> conjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">∈</span> set_of <span class="free">pret</span> <span class="main">⟶</span> <span class="bound">q</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">levellista</span> <span class="main">!</span> <span class="free">var</span> <span class="bound">q</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">p</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="General-Dags_root_in_Nodes"><span class="command">lemma</span></span> Dags_root_in_Nodes<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> t_in_DagsSucnb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> Dags <span class="main">(</span>Nodes <span class="main">(</span>Suc <span class="free">nb</span><span class="main">)</span> <span class="free">levellista</span><span class="main">)</span> <span class="free">low</span> <span class="free">high</span>"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">p</span> <span class="main">.</span> Dag <span class="bound">p</span> <span class="free">low</span> <span class="free">high</span> <span class="free">t</span>  <span class="main">∧</span> <span class="bound">p</span> <span class="main">∈</span> Nodes <span class="main">(</span>Suc <span class="free">nb</span><span class="main">)</span> <span class="free">levellista</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> t_in_DagsSucnb <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> t_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="skolem">p</span> <span class="free">low</span> <span class="free">high</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t_subset_Nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="free">t</span> <span class="main">⊆</span> Nodes <span class="main">(</span>Suc <span class="free">nb</span><span class="main">)</span> <span class="free">levellista</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t_nTip<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span><span class="main">≠</span> Tip"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> Dags.cases<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> t_dag t_nTip <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">≠</span>Null"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> t_subset_Nodes t_dag <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> Nodes <span class="main">(</span>Suc <span class="free">nb</span><span class="main">)</span> <span class="free">levellista</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> t_dag <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

  


<span class="keyword1" id="General-subdag_dag"><span class="command">lemma</span></span> subdag_dag<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">p</span><span class="main">.</span> <span class="main">⟦</span>Dag <span class="bound">p</span> <span class="free">low</span> <span class="free">high</span> <span class="free">t</span><span class="main">;</span> <span class="free">st</span> <span class="main">&lt;=</span> <span class="free">t</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">stp</span><span class="main">.</span> Dag <span class="bound">stp</span> <span class="free">low</span> <span class="free">high</span> <span class="free">st</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Tip
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_dag_def le_dag_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">po</span> <span class="skolem">rt</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> t_Node<span class="main">=</span>this
  <span class="keyword1"><span class="command">with</span></span> Node.prems <span class="keyword1"><span class="command">have</span></span> p_po<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="skolem">po</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">st</span> <span class="main">=</span> Node <span class="skolem">lt</span> <span class="skolem">po</span> <span class="skolem">rt</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">note</span></span> st_t<span class="main">=</span>this
    <span class="keyword1"><span class="command">with</span></span> Node.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> st_nt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">st</span> <span class="main">≠</span> Node <span class="skolem">lt</span> <span class="skolem">po</span> <span class="skolem">rt</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> Node.prems p_po <span class="keyword1"><span class="command">have</span></span> st_subdag_lt_rt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">st</span><span class="main">&lt;=</span><span class="skolem">lt</span> <span class="main">∨</span> <span class="free">st</span> <span class="main">&lt;=</span><span class="skolem">rt</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>le_dag_def less_dag_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Node.prems p_po <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lp</span></span> <span class="skolem"><span class="skolem">rp</span></span> <span class="keyword2"><span class="keyword">where</span></span> lt_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="skolem">lp</span> <span class="free">low</span> <span class="free">high</span> <span class="skolem">lt</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> rt_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="skolem">rp</span> <span class="free">low</span> <span class="free">high</span> <span class="skolem">rt</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">st</span><span class="main">&lt;=</span><span class="skolem">lt</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">note</span></span> st_lt<span class="main">=</span>this
      <span class="keyword1"><span class="command">with</span></span> lt_dag <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="operator">-</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Node.hyps<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">st</span> <span class="main">≤</span> <span class="skolem">lt</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> st_subdag_lt_rt <span class="keyword1"><span class="command">have</span></span> st_rt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">st</span> <span class="main">&lt;=</span> <span class="skolem">rt</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> Node.hyps <span class="keyword1"><span class="command">have</span></span> rhyp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Dag <span class="skolem">rp</span> <span class="free">low</span> <span class="free">high</span> <span class="skolem">rt</span><span class="main">;</span> <span class="free">st</span> <span class="main">≤</span> <span class="skolem">rt</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">stp</span><span class="main">.</span> Dag <span class="bound">stp</span> <span class="free">low</span> <span class="free">high</span> <span class="free">st</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> st_rt rt_dag <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rhyp<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="General-Dags_subdags"><span class="command">lemma</span></span> Dags_subdags<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> t_in_Dags<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> Dags <span class="free">nodes</span> <span class="free">low</span> <span class="free">high</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  st_t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">st</span> <span class="main">&lt;=</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
  st_nTip<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">st</span> <span class="main">≠</span> Tip"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">st</span> <span class="main">∈</span> Dags <span class="free">nodes</span> <span class="free">low</span> <span class="free">high</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> t_in_Dags <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> t_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="skolem">p</span> <span class="free">low</span> <span class="free">high</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t_subset_Nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="free">t</span> <span class="main">⊆</span> <span class="free">nodes</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t_nTip<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span><span class="main">≠</span> Tip"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> Dags.cases<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> st_t <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_of <span class="free">st</span> <span class="main">⊆</span> set_of <span class="free">t</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_dag_set_of<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> t_subset_Nodes <span class="keyword1"><span class="command">have</span></span> st_subset_fnctNodes<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="free">st</span> <span class="main">⊆</span> <span class="free">nodes</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> st_t t_dag <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">stp</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"Dag <span class="skolem">stp</span> <span class="free">low</span> <span class="free">high</span> <span class="free">st</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> subdag_dag<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">with</span></span> st_subset_fnctNodes st_nTip <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> DagsI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="General-Dags_Nodes_cases"><span class="command">lemma</span></span> Dags_Nodes_cases<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> P_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="free">P</span> <span class="bound">t1</span> <span class="bound">t2</span> <span class="free">var</span> <span class="main">=</span> <span class="free">P</span> <span class="bound">t2</span> <span class="bound">t1</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  dags_in_lower_levels<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">t1</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="free">fnct</span> <span class="main">`</span><span class="main">(</span>Nodes <span class="free">n</span> <span class="free">levellista</span><span class="main">)</span><span class="main">)</span> <span class="free">low</span> <span class="free">high</span><span class="main">;</span> 
              <span class="bound">t2</span>  <span class="main">∈</span> Dags <span class="main">(</span><span class="free">fnct</span> <span class="main">`</span><span class="main">(</span>Nodes <span class="free">n</span> <span class="free">levellista</span><span class="main">)</span><span class="main">)</span> <span class="free">low</span> <span class="free">high</span><span class="main">⟧</span> 
             <span class="main">⟹</span> <span class="free">P</span> <span class="bound">t1</span> <span class="bound">t2</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  dags_in_mixed_levels<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">t1</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="free">fnct</span> <span class="main">`</span><span class="main">(</span>Nodes <span class="free">n</span> <span class="free">levellista</span><span class="main">)</span><span class="main">)</span> <span class="free">low</span> <span class="free">high</span><span class="main">;</span> 
              <span class="bound">t2</span>  <span class="main">∈</span> Dags <span class="main">(</span><span class="free">fnct</span> <span class="main">`</span><span class="main">(</span>Nodes <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">levellista</span><span class="main">)</span><span class="main">)</span> <span class="free">low</span> <span class="free">high</span><span class="main">;</span> 
              <span class="bound">t2</span> <span class="main">∉</span>  Dags <span class="main">(</span><span class="free">fnct</span> <span class="main">`</span><span class="main">(</span>Nodes <span class="free">n</span> <span class="free">levellista</span><span class="main">)</span><span class="main">)</span> <span class="free">low</span> <span class="free">high</span><span class="main">⟧</span> 
             <span class="main">⟹</span> <span class="free">P</span> <span class="bound">t1</span> <span class="bound">t2</span> <span class="free">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  dags_in_high_level<span class="main">:</span> 
   <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">t1</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="free">fnct</span> <span class="main">`</span><span class="main">(</span>Nodes <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">levellista</span><span class="main">)</span><span class="main">)</span> <span class="free">low</span> <span class="free">high</span><span class="main">;</span> 
               <span class="bound">t1</span> <span class="main">∉</span>  Dags <span class="main">(</span><span class="free">fnct</span> <span class="main">`</span><span class="main">(</span>Nodes <span class="free">n</span> <span class="free">levellista</span><span class="main">)</span><span class="main">)</span> <span class="free">low</span> <span class="free">high</span><span class="main">;</span> 
               <span class="bound">t2</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="free">fnct</span> <span class="main">`</span><span class="main">(</span>Nodes <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">levellista</span><span class="main">)</span><span class="main">)</span> <span class="free">low</span> <span class="free">high</span><span class="main">;</span> 
               <span class="bound">t2</span> <span class="main">∉</span>  Dags <span class="main">(</span><span class="free">fnct</span> <span class="main">`</span><span class="main">(</span>Nodes <span class="free">n</span> <span class="free">levellista</span><span class="main">)</span><span class="main">)</span> <span class="free">low</span> <span class="free">high</span><span class="main">⟧</span> 
              <span class="main">⟹</span> <span class="free">P</span> <span class="bound">t1</span> <span class="bound">t2</span> <span class="free">var</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span>  <span class="bound">t1</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="free">fnct</span> <span class="main">`</span><span class="main">(</span>Nodes <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">levellista</span><span class="main">)</span><span class="main">)</span> <span class="free">low</span> <span class="free">high</span> <span class="main">∧</span> 
                 <span class="bound">t2</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="free">fnct</span> <span class="main">`</span><span class="main">(</span>Nodes <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">levellista</span><span class="main">)</span><span class="main">)</span> <span class="free">low</span> <span class="free">high</span> 
                 <span class="main">⟶</span> <span class="free">P</span> <span class="bound">t1</span> <span class="bound">t2</span> <span class="free">var</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI <span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> conjE<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t1</span> <span class="skolem">t2</span>
  <span class="keyword3"><span class="command">assume</span></span> t1_in_higher_levels<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="free">fnct</span> <span class="main">`</span> Nodes <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">levellista</span><span class="main">)</span> <span class="free">low</span> <span class="free">high</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> t2_in_higher_levels<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t2</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="free">fnct</span> <span class="main">`</span> Nodes <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">levellista</span><span class="main">)</span> <span class="free">low</span> <span class="free">high</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="free">var</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="free">fnct</span> <span class="main">`</span> Nodes <span class="free">n</span> <span class="free">levellista</span><span class="main">)</span> <span class="free">low</span> <span class="free">high</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True 
    <span class="keyword1"><span class="command">note</span></span> t1_in_ll <span class="main">=</span> this
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">t2</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="free">fnct</span> <span class="main">`</span> Nodes <span class="free">n</span> <span class="free">levellista</span><span class="main">)</span> <span class="free">low</span> <span class="free">high</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">note</span></span> t2_in_ll<span class="main">=</span>this
      <span class="keyword1"><span class="command">with</span></span> t1_in_ll dags_in_lower_levels <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> t2_notin_ll<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t2</span> <span class="main">∉</span> Dags <span class="main">(</span><span class="free">fnct</span> <span class="main">`</span> Nodes <span class="free">n</span> <span class="free">levellista</span><span class="main">)</span> <span class="free">low</span> <span class="free">high</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> t1_in_ll t2_in_higher_levels dags_in_mixed_levels <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> t1_notin_ll<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span> <span class="main">∉</span> Dags <span class="main">(</span><span class="free">fnct</span> <span class="main">`</span> Nodes <span class="free">n</span> <span class="free">levellista</span><span class="main">)</span> <span class="free">low</span> <span class="free">high</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">t2</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="free">fnct</span> <span class="main">`</span> Nodes <span class="free">n</span> <span class="free">levellista</span><span class="main">)</span> <span class="free">low</span> <span class="free">high</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">note</span></span> t2_in_ll<span class="main">=</span>this
      <span class="keyword1"><span class="command">with</span></span> dags_in_mixed_levels t1_in_higher_levels t1_notin_ll P_sym <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> t2_notin_ll<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t2</span> <span class="main">∉</span> Dags <span class="main">(</span><span class="free">fnct</span> <span class="main">`</span> Nodes <span class="free">n</span> <span class="free">levellista</span><span class="main">)</span> <span class="free">low</span> <span class="free">high</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> t1_notin_ll t1_in_higher_levels t2_in_higher_levels dags_in_high_level <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="General-Null_notin_Nodes"><span class="command">lemma</span></span> Null_notin_Nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Dag <span class="free">p</span> <span class="free">low</span> <span class="free">high</span> <span class="free">t</span><span class="main">;</span> <span class="free">nb</span> <span class="main">&lt;=</span> length <span class="free">levellista</span><span class="main">;</span> wf_ll <span class="free">t</span> <span class="free">levellista</span> <span class="free">var</span><span class="main">⟧</span> <span class="main">⟹</span> Null <span class="main">∉</span> Nodes <span class="free">nb</span> <span class="free">levellista</span>"</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nodes_def wf_ll_def <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Dag_Ref<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> conjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">q</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">q</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="skolem">P</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted">Null</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> conjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> set_of_nn <span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1" id="General-Nodes_in_pret"><span class="command">lemma</span></span> Nodes_in_pret<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>wf_ll <span class="free">t</span> <span class="free">levellista</span> <span class="free">var</span><span class="main">;</span> <span class="free">nb</span> <span class="main">&lt;=</span> length <span class="free">levellista</span><span class="main">⟧</span> <span class="main">⟹</span> Nodes <span class="free">nb</span> <span class="free">levellista</span> <span class="main">⊆</span> set_of <span class="free">t</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ll_def Nodes_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> conjE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">∈</span> set_of <span class="free">t</span> <span class="main">⟶</span> <span class="bound">q</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">levellista</span> <span class="main">!</span> <span class="free">var</span> <span class="bound">q</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">xa</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>



<span class="keyword1" id="General-restrict_root_Node"><span class="command">lemma</span></span> restrict_root_Node<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">t</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="free">repc</span> <span class="main">`</span>Nodes <span class="main">(</span>Suc <span class="free">nb</span><span class="main">)</span> <span class="free">levellista</span><span class="main">)</span> <span class="main">(</span><span class="free">repc</span> <span class="main">∝</span> <span class="free">low</span><span class="main">)</span> <span class="main">(</span><span class="free">repc</span> <span class="main">∝</span> <span class="free">high</span><span class="main">)</span><span class="main">;</span> <span class="free">t</span> <span class="main">∉</span>  Dags <span class="main">(</span><span class="free">repc</span> <span class="main">`</span>Nodes <span class="free">nb</span> <span class="free">levellista</span><span class="main">)</span> <span class="main">(</span><span class="free">repc</span> <span class="main">∝</span> <span class="free">low</span><span class="main">)</span> <span class="main">(</span><span class="free">repc</span> <span class="main">∝</span> <span class="free">high</span><span class="main">)</span><span class="main">;</span> 
  ordered <span class="free">t</span> <span class="free">var</span><span class="main">;</span> <span class="main">∀</span> <span class="bound">no</span> <span class="main">∈</span> Nodes <span class="main">(</span>Suc <span class="free">nb</span><span class="main">)</span> <span class="free">levellista</span><span class="main">.</span> <span class="free">var</span> <span class="main">(</span><span class="free">repc</span> <span class="bound">no</span><span class="main">)</span> <span class="main">&lt;=</span> <span class="free">var</span> <span class="bound">no</span> <span class="main">∧</span> <span class="free">repc</span> <span class="main">(</span><span class="free">repc</span> <span class="bound">no</span><span class="main">)</span> <span class="main">=</span> <span class="free">repc</span> <span class="bound">no</span><span class="main">;</span> wf_ll <span class="free">pret</span> <span class="free">levellista</span> <span class="free">var</span><span class="main">;</span> <span class="free">nb</span> <span class="main">&lt;</span> length <span class="free">levellista</span><span class="main">;</span><span class="free">repc</span> <span class="main">`</span>Nodes <span class="main">(</span>Suc <span class="free">nb</span><span class="main">)</span> <span class="free">levellista</span> <span class="main">⊆</span> Nodes <span class="main">(</span>Suc <span class="free">nb</span><span class="main">)</span> <span class="free">levellista</span><span class="main">⟧</span>
  <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">q</span><span class="main">.</span> Dag <span class="main">(</span><span class="free">repc</span> <span class="bound">q</span><span class="main">)</span> <span class="main">(</span><span class="free">repc</span> <span class="main">∝</span> <span class="free">low</span><span class="main">)</span> <span class="main">(</span><span class="free">repc</span> <span class="main">∝</span> <span class="free">high</span><span class="main">)</span> <span class="free">t</span> <span class="main">∧</span> <span class="bound">q</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">levellista</span> <span class="main">!</span> <span class="free">nb</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> Dags.cases<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">ta</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"dag"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> t_notin_DagsNodesnb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∉</span> Dags <span class="main">(</span><span class="free">repc</span> <span class="main">`</span> Nodes <span class="free">nb</span> <span class="free">levellista</span><span class="main">)</span> <span class="main">(</span><span class="free">repc</span> <span class="main">∝</span> <span class="free">low</span><span class="main">)</span> <span class="main">(</span><span class="free">repc</span> <span class="main">∝</span> <span class="free">high</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> t_ta<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> <span class="skolem">ta</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> ta_in_repc_NodesSucnb<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">ta</span> <span class="main">⊆</span> <span class="free">repc</span> <span class="main">`</span> Nodes <span class="main">(</span>Suc <span class="free">nb</span><span class="main">)</span> <span class="free">levellista</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> ta_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="skolem">p</span> <span class="main">(</span><span class="free">repc</span> <span class="main">∝</span> <span class="free">low</span><span class="main">)</span> <span class="main">(</span><span class="free">repc</span> <span class="main">∝</span> <span class="free">high</span><span class="main">)</span> <span class="skolem">ta</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> ta_nTip<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ta</span> <span class="main">≠</span> Tip"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> ord_t<span class="main">:</span> <span class="quoted"><span class="quoted">"ordered <span class="free">t</span> <span class="free">var</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> varrep_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">no</span> <span class="main">∈</span> Nodes <span class="main">(</span>Suc <span class="free">nb</span><span class="main">)</span> <span class="free">levellista</span><span class="main">.</span> <span class="free">var</span> <span class="main">(</span><span class="free">repc</span> <span class="bound">no</span><span class="main">)</span> <span class="main">&lt;=</span> <span class="free">var</span> <span class="bound">no</span> <span class="main">∧</span> <span class="free">repc</span> <span class="main">(</span><span class="free">repc</span> <span class="bound">no</span><span class="main">)</span> <span class="main">=</span> <span class="free">repc</span> <span class="bound">no</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> wf_lla<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_ll <span class="free">pret</span> <span class="free">levellista</span> <span class="free">var</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> nbslla<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">nb</span> <span class="main">&lt;</span> length <span class="free">levellista</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> repcNodes_in_Nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">repc</span> <span class="main">`</span>Nodes <span class="main">(</span>Suc <span class="free">nb</span><span class="main">)</span> <span class="free">levellista</span> <span class="main">⊆</span> Nodes <span class="main">(</span>Suc <span class="free">nb</span><span class="main">)</span> <span class="free">levellista</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> ta_nTip ta_dag <span class="keyword1"><span class="command">have</span></span> p_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">≠</span> Null"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> ta_nTip ta_dag <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lt</span></span> <span class="skolem"><span class="skolem">rt</span></span> <span class="keyword2"><span class="keyword">where</span></span> ta_Node<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">ta</span> <span class="main">=</span> Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> ta_nTip ta_dag <span class="keyword1"><span class="command">have</span></span> p_in_ta<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> set_of <span class="skolem">ta</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> ta_in_repc_NodesSucnb <span class="keyword1"><span class="command">have</span></span> p_in_repcNodes_Sucnb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="free">repc</span> <span class="main">`</span>Nodes <span class="main">(</span>Suc <span class="free">nb</span><span class="main">)</span> <span class="free">levellista</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="free">repc</span> <span class="main">`</span><span class="main">(</span>set <span class="main">(</span><span class="free">levellista</span> <span class="main">!</span> <span class="free">nb</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
        p_repca<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="free">repc</span> <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        a_in_llanb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">levellista</span> <span class="main">!</span> <span class="free">nb</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> ta_dag t_ta <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> p_notin_repc_llanb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∉</span> <span class="free">repc</span> <span class="main">`</span> set <span class="main">(</span><span class="free">levellista</span> <span class="main">!</span> <span class="free">nb</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> p_in_repcNodes_Sucnb <span class="keyword1"><span class="command">have</span></span> p_in_repc_Nodesnb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="free">repc</span> <span class="main">`</span>Nodes <span class="free">nb</span> <span class="free">levellista</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> imageE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nodes_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nodes_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE conjE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">xa</span><span class="main">=</span><span class="free">nb</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">xa</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="free">repc</span> <span class="main">`</span>Nodes <span class="free">nb</span> <span class="free">levellista</span><span class="main">)</span> <span class="main">(</span><span class="free">repc</span> <span class="main">∝</span> <span class="free">low</span><span class="main">)</span> <span class="main">(</span><span class="free">repc</span> <span class="main">∝</span> <span class="free">high</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_of <span class="free">t</span> <span class="main">⊆</span> <span class="free">repc</span> <span class="main">`</span>Nodes <span class="free">nb</span> <span class="free">levellista</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">ref</span>
          <span class="keyword3"><span class="command">assume</span></span> x_in_t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set_of <span class="free">t</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> ord_t <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="skolem">x</span> <span class="main">&lt;=</span> <span class="free">var</span> <span class="main">(</span>root <span class="free">t</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ordered_set_of<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">with</span></span> t_ta ta_Node <span class="keyword1"><span class="command">have</span></span> varx_varp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="skolem">x</span> <span class="main">&lt;=</span> <span class="free">var</span> <span class="skolem">p</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> p_in_repc_Nodesnb <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> ksnb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> <span class="free">nb</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p_in_repc_llak<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="free">repc</span> <span class="main">`</span><span class="main">(</span>set <span class="main">(</span><span class="free">levellista</span> <span class="main">!</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nodes_def ImageE<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> p_repcq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="free">repc</span> <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q_in_llak<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">levellista</span> <span class="main">!</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> q_in_llak wf_lla nbslla ksnb <span class="keyword1"><span class="command">have</span></span> varqk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="skolem">q</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ll_def<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> Nodesnb_in_NodesSucnb<span class="main">:</span> <span class="quoted"><span class="quoted">"Nodes <span class="free">nb</span> <span class="free">levellista</span> <span class="main">⊆</span> Nodes <span class="main">(</span>Suc <span class="free">nb</span><span class="main">)</span> <span class="free">levellista</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Nodes_subset<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> q_in_llak ksnb <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> Nodes <span class="free">nb</span> <span class="free">levellista</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nodes_def<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> varrep_prop Nodesnb_in_NodesSucnb <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="main">(</span><span class="free">repc</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">&lt;=</span> <span class="free">var</span> <span class="skolem">q</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> varqk ksnb p_repcq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="skolem">p</span> <span class="main">&lt;</span> <span class="free">nb</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> varx_varp <span class="keyword1"><span class="command">have</span></span> varx_snb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">nb</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> x_in_t t_ta ta_in_repc_NodesSucnb <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
            x_repca<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span> <span class="free">repc</span> <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
            a_in_NodesSucnb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> Nodes <span class="main">(</span>Suc <span class="free">nb</span><span class="main">)</span> <span class="free">levellista</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> varrep_prop <span class="keyword1"><span class="command">have</span></span> rx_x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">repc</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set_of <span class="free">pret</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">from</span></span> wf_lla nbslla <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Nodes <span class="main">(</span>Suc <span class="free">nb</span><span class="main">)</span> <span class="free">levellista</span> <span class="main">⊆</span> set_of <span class="free">pret</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Nodes_in_pret<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">with</span></span> x_in_t t_ta ta_in_repc_NodesSucnb repcNodes_in_Nodes <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">qed</span></span> 
          <span class="keyword1"><span class="command">with</span></span> wf_lla <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">levellista</span> <span class="main">!</span> <span class="main">(</span><span class="free">var</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ll_def<span class="main">)</span> 
          <span class="keyword1"><span class="command">with</span></span> varx_snb <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> Nodes <span class="free">nb</span> <span class="free">levellista</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nodes_def<span class="main">)</span> 
          <span class="keyword1"><span class="command">with</span></span> rx_x <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">repc</span> <span class="main">`</span>Nodes <span class="free">nb</span> <span class="free">levellista</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="free">repc</span> <span class="skolem">x</span>"</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">qed</span></span> 
        <span class="keyword1"><span class="command">with</span></span> ta_nTip ta_dag t_ta <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> DagsI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">with</span></span> t_notin_DagsNodesnb <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
          




<span class="keyword1" id="General-same_bdt_var"><span class="command">lemma</span></span> same_bdt_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>bdt <span class="main">(</span>Node <span class="free">lt1</span> <span class="free">p1</span> <span class="free">rt1</span><span class="main">)</span> <span class="free">var</span> <span class="main">=</span> Some <span class="free">bdt1</span><span class="main">;</span> bdt <span class="main">(</span>Node <span class="free">lt2</span> <span class="free">p2</span> <span class="free">rt2</span><span class="main">)</span> <span class="free">var</span> <span class="main">=</span> Some <span class="free">bdt1</span><span class="main">⟧</span>
  <span class="main">⟹</span> <span class="free">var</span> <span class="free">p1</span> <span class="main">=</span> <span class="free">var</span> <span class="free">p2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bdt1</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Zero
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> var_p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">p1</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> var_p2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">p2</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> One
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> var_p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">p1</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> var_p2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">p2</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Bdt_Node <span class="skolem">lbdt</span> <span class="skolem">v</span> <span class="skolem">rbdt</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> var_p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">p1</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> var_p2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free">p2</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="General-bdt_Some_Leaf_var_le_1"><span class="command">lemma</span></span> bdt_Some_Leaf_var_le_1<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">⟦</span>Dag <span class="free">p</span> <span class="free">low</span> <span class="free">high</span> <span class="free">t</span><span class="main">;</span> bdt <span class="free">t</span> <span class="free">var</span> <span class="main">=</span> Some <span class="free">x</span><span class="main">;</span> isLeaf_pt <span class="free">p</span> <span class="free">low</span> <span class="free">high</span><span class="main">⟧</span> 
  <span class="main">⟹</span> <span class="free">var</span> <span class="free">p</span> <span class="main">&lt;=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Tip
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> tNode<span class="main">=</span>this
  <span class="keyword1"><span class="command">from</span></span> Node.prems tNode <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isLeaf_pt_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="skolem">p</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="General-subnode_dag_cons"><span class="command">lemma</span></span> subnode_dag_cons<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">p</span><span class="main">.</span> <span class="main">⟦</span>Dag <span class="bound">p</span> <span class="free">low</span> <span class="free">high</span> <span class="free">t</span><span class="main">;</span> <span class="free">no</span> <span class="main">∈</span> set_of <span class="free">t</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">not</span><span class="main">.</span> Dag <span class="free">no</span> <span class="free">low</span> <span class="free">high</span> <span class="bound">not</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Tip
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">q</span> <span class="skolem">rt</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> Node.prems <span class="keyword1"><span class="command">have</span></span> q_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> Node.prems <span class="keyword1"><span class="command">have</span></span> lt_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="free">low</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">low</span> <span class="free">high</span> <span class="skolem">lt</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> Node.prems <span class="keyword1"><span class="command">have</span></span> rt_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="free">high</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">low</span> <span class="free">high</span> <span class="skolem">rt</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">no</span> <span class="main">∈</span> set_of <span class="skolem">lt</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> Node.hyps lt_dag <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> no_notin_lt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">no</span> <span class="main">∉</span> set_of <span class="skolem">lt</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">no</span><span class="main">=</span><span class="skolem">p</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> Node.prems q_p <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> no_neq_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">no</span> <span class="main">≠</span> <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> Node.prems no_notin_lt <span class="keyword1"><span class="command">have</span></span> no_in_rt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">no</span> <span class="main">∈</span> set_of <span class="skolem">rt</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> rt_dag Node.hyps <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>






<span class="comment1">(*theorems for the proof of share_reduce_rep_list*)</span>




<span class="keyword1" id="General-nodes_in_taken_in_takeSucn"><span class="command">lemma</span></span> nodes_in_taken_in_takeSucn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">no</span> <span class="main">∈</span> set <span class="main">(</span>take <span class="free">n</span> <span class="free">nodeslist</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">no</span> <span class="main">∈</span> set <span class="main">(</span>take <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">nodeslist</span><span class="main">)</span> "</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> no_in_taken<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">no</span> <span class="main">∈</span> set <span class="main">(</span>take <span class="free">n</span> <span class="free">nodeslist</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>take <span class="free">n</span> <span class="free">nodeslist</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>take <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">nodeslist</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_take_subset_set_take<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">with</span></span> no_in_taken <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="General-ind_in_higher_take"><span class="command">lemma</span></span> ind_in_higher_take<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span> <span class="bound">k</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">n</span> <span class="main">&lt;</span> <span class="bound">k</span><span class="main">;</span>  <span class="bound">n</span> <span class="main">&lt;</span> length <span class="free">xs</span><span class="main">⟧</span> 
  <span class="main">⟹</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">n</span> <span class="main">∈</span> set <span class="main">(</span>take <span class="bound">k</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">n</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">k</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">k</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="General-take_length_set"><span class="command">lemma</span></span> take_length_set<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span><span class="main">=</span>length <span class="free">xs</span> <span class="main">⟹</span> set <span class="main">(</span>take <span class="bound">n</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> set <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> take_Cons <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1" id="General-repNodes_eq_ext_rep"><span class="command">lemma</span></span> repNodes_eq_ext_rep<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">low</span> <span class="free">no</span> <span class="main">≠</span> <span class="free">nodeslist</span><span class="main">!</span> <span class="free">n</span><span class="main">;</span> <span class="free">high</span> <span class="free">no</span> <span class="main">≠</span> <span class="free">nodeslist</span> <span class="main">!</span> <span class="free">n</span><span class="main">;</span> 
  <span class="free">low</span> <span class="free">sn</span> <span class="main">≠</span> <span class="free">nodeslist</span> <span class="main">!</span> <span class="free">n</span><span class="main">;</span> <span class="free">high</span> <span class="free">sn</span> <span class="main">≠</span> <span class="free">nodeslist</span> <span class="main">!</span> <span class="free">n</span><span class="main">⟧</span>
  <span class="main">⟹</span> repNodes_eq <span class="free">sn</span> <span class="free">no</span> <span class="free">low</span> <span class="free">high</span> <span class="free">repa</span> <span class="main">=</span> repNodes_eq <span class="free">sn</span> <span class="free">no</span> <span class="free">low</span> <span class="free">high</span> <span class="main">(</span><span class="free">repa</span><span class="main">(</span><span class="free">nodeslist</span> <span class="main">!</span> <span class="free">n</span> <span class="main">:=</span> <span class="free">repa</span> <span class="main">(</span><span class="free">low</span> <span class="main">(</span><span class="free">nodeslist</span> <span class="main">!</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repNodes_eq_def null_comp_def<span class="main">)</span>


<span class="keyword1" id="General-filter_not_empty"><span class="command">lemma</span></span> filter_not_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">∈</span> set <span class="free">xs</span><span class="main">;</span> <span class="free">P</span> <span class="free">x</span><span class="main">⟧</span> <span class="main">⟹</span> filter <span class="free">P</span> <span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>filter <span class="free">P</span> <span class="free">xs</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="General-hd_filter_in_list"><span class="command">lemma</span></span> hd_filter_in_list<span class="main">:</span> <span class="quoted"><span class="quoted">"filter <span class="free">P</span> <span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> hd <span class="main">(</span>filter <span class="free">P</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="General-hd_filter_in_filter"><span class="command">lemma</span></span> hd_filter_in_filter<span class="main">:</span> <span class="quoted"><span class="quoted">"filter <span class="free">P</span> <span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> hd <span class="main">(</span>filter <span class="free">P</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>filter <span class="free">P</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="General-hd_filter_prop"><span class="command">lemma</span></span> hd_filter_prop<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> non_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"filter <span class="free">P</span> <span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>hd <span class="main">(</span>filter <span class="free">P</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> non_empty <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span>filter <span class="free">P</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>filter <span class="free">P</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hd_filter_in_filter<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="General-index_elem"><span class="command">lemma</span></span> index_elem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">xs</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">=</span><span class="improper">a</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="General-filter_hd_P_rep_indep"><span class="command">lemma</span></span> filter_hd_P_rep_indep<span class="main">:</span>     
<span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">x</span><span class="main">;</span> <span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">P</span> <span class="free">x</span> <span class="bound">a</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟶</span> <span class="free">P</span> <span class="free">x</span> <span class="bound">b</span><span class="main">;</span> filter <span class="main">(</span><span class="free">P</span> <span class="free">x</span><span class="main">)</span> <span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">⟧</span>  <span class="main">⟹</span> 
  hd <span class="main">(</span>filter <span class="main">(</span><span class="free">P</span> <span class="main">(</span>hd <span class="main">(</span>filter <span class="main">(</span><span class="free">P</span> <span class="free">x</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span>  hd <span class="main">(</span>filter <span class="main">(</span><span class="free">P</span> <span class="free">x</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">x</span> <span class="improper">a</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_depth_limit</span><span class="main"><span class="main">=</span></span>2<span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> hd_filter_prop<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="General-take_Suc_not_last"><span class="command">lemma</span></span> take_Suc_not_last<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="main">⟦</span><span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>take <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">;</span> <span class="free">x</span><span class="main">≠</span><span class="free">xs</span><span class="main">!</span><span class="bound">n</span><span class="main">;</span> <span class="bound">n</span> <span class="main">&lt;</span> length <span class="free">xs</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>take <span class="bound">n</span> <span class="free">xs</span><span class="main">)</span>"</span></span>     
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">n</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">simp</span>
<span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_depth_limit</span><span class="main"><span class="main">=</span></span>2<span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="General-P_eq_list_filter"><span class="command">lemma</span></span> P_eq_list_filter<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="free">xs</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">Q</span> <span class="bound">x</span> <span class="main">⟹</span> filter <span class="free">P</span> <span class="free">xs</span> <span class="main">=</span> filter <span class="free">Q</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="General-hd_filter_take_more"><span class="command">lemma</span></span> hd_filter_take_more<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span> <span class="bound">m</span><span class="main">.</span><span class="main">⟦</span>filter <span class="free">P</span> <span class="main">(</span>take <span class="bound">n</span> <span class="free">xs</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">;</span> <span class="bound">n</span> <span class="main">≤</span> <span class="bound">m</span><span class="main">⟧</span> <span class="main">⟹</span> 
       hd <span class="main">(</span>filter <span class="free">P</span> <span class="main">(</span>take <span class="bound">n</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>  hd <span class="main">(</span>filter <span class="free">P</span> <span class="main">(</span>take <span class="bound">m</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">n</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">m</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="comment1">(*
consts wf_levellist :: "dag ⇒ ref list list ⇒ ref list list ⇒
                       (ref ⇒ nat) ⇒ bool"
defs wf_levellist_def: "wf_levellist t levellist_old levellist_new var  ≡ 
case t of Tip ⇒ levellist_old = levellist_new
| (Node lt p rt) ⇒
  (∀ q. q ∈ set_of t ⟶ q ∈ set (levellist_new ! (var q))) ∧
  (∀ i ≤ var p. (∃ prx. (levellist_new ! i) = prx@(levellist_old ! i) 
                       ∧ (∀ pt ∈ set prx. pt ∈ set_of t ∧ var pt = i))) ∧
  (∀ i. (var p) &lt; i ⟶ (levellist_new ! i) = (levellist_old ! i)) ∧
  (length levellist_new = length levellist_old)" 
*)</span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="ProcedureSpecs">
<div class="head">
<h1>Theory ProcedureSpecs</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       BDD
    Author:      Veronika Ortner and Norbert Schirmer, 2004
    Maintainer:  Norbert Schirmer,  norbert.schirmer at web de
    License:     LGPL
*)</span>

<span class="comment1">(*  
ProcedureSpecs.thy

Copyright (C) 2004-2008 Veronika Ortner and Norbert Schirmer 
Some rights reserved, TU Muenchen

This library is free software; you can redistribute it and/or modify
it under the terms of the GNU Lesser General Public License as
published by the Free Software Foundation; either version 2.1 of the
License, or (at your option) any later version.

This library is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
Lesser General Public License for more details.

You should have received a copy of the GNU Lesser General Public
License along with this library; if not, write to the Free Software
Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307
USA
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Definitions of Procedures›</span></span>
<span class="keyword1"><span class="command">theory</span></span> ProcedureSpecs
<span class="keyword2"><span class="keyword">imports</span></span> <a href="General.html">General</a> <a href="../Simpl/Vcg.html">Simpl.Vcg</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">record</span></span> <span class="quoted">"globals"</span> <span class="main">=</span>
  var_' <span class="main">::</span> <span class="quoted"><span class="quoted">"ref <span class="main">⇒</span> nat"</span></span>
  low_' <span class="main">::</span> <span class="quoted"><span class="quoted">"ref <span class="main">⇒</span> ref"</span></span>
  high_' <span class="main">::</span> <span class="quoted"><span class="quoted">"ref <span class="main">⇒</span> ref"</span></span>
  rep_' <span class="main">::</span> <span class="quoted"><span class="quoted">"ref <span class="main">⇒</span> ref"</span></span>
  mark_' <span class="main">::</span> <span class="quoted"><span class="quoted">"ref <span class="main">⇒</span> bool"</span></span>
  next_' <span class="main">::</span><span class="quoted"><span class="quoted">"ref <span class="main">⇒</span> ref"</span></span>


<span class="keyword1"><span class="command">record</span></span> <span class="tfree">'g</span> bdd_state <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'g</span> state"</span></span> <span class="main">+</span>
  varval_' <span class="main">::</span> <span class="quoted"><span class="quoted">"bool list"</span></span>
  p_' <span class="main">::</span> <span class="quoted"><span class="quoted">"ref"</span></span>
  R_' <span class="main">::</span> <span class="quoted"><span class="quoted">"bool"</span></span>
  levellist_' <span class="main">::</span> <span class="quoted"><span class="quoted">"ref list"</span></span>
  nodeslist_' <span class="main">::</span> <span class="quoted"><span class="quoted">"ref"</span></span>
  node_'<span class="main">::</span> <span class="quoted"><span class="quoted">"ref"</span></span>
  m_' <span class="main">::</span> <span class="quoted"><span class="quoted">"bool"</span></span>
  n_' <span class="main">::</span> <span class="quoted"><span class="quoted">"nat"</span></span>


<span class="comment1">(*Evaluation even of unsymmetric dags. 
If a child is unexpectedly Null Eval returns False*)</span>


<span class="keyword1"><span class="command">procedures</span></span>
  Eval <span class="main">(</span>p<span class="main">,</span> varval <span class="main">|</span> R<span class="main">)</span> <span class="main">=</span> 
    <span class="quoted">"IF (´p→´var = 0) THEN ´R :==False
     ELSE IF (´p→´var = 1) THEN ´R :==True
       ELSE IF (´varval ! (´p→´var)) THEN CALL Eval (´p→´high, ´varval, ´R)
         ELSE CALL Eval (´p→´low, ´varval, ´R)
         FI
       FI
     FI"</span>
  


<span class="keyword1"><span class="command">procedures</span></span> 
  Levellist <span class="main">(</span>p<span class="main">,</span> m<span class="main">,</span> levellist <span class="main">|</span> levellist<span class="main">)</span> <span class="main">=</span> 
    <span class="quoted">"IF (´p ≠ Null) 
     THEN
       IF (´p → ´mark ≠ ´m)
       THEN
         ´levellist :== CALL Levellist ( ´p → ´low, ´m, ´levellist );;
         ´levellist :== CALL Levellist ( ´p → ´high, ´m, ´levellist );;
         ´p → ´next :== ´levellist ! (´p→´var);;
         ´levellist ! (´p→´var) :== ´p;;
         ´p → ´mark :==´m
       FI
     FI"</span>


<span class="keyword1"><span class="command">procedures</span></span>
  ShareRep <span class="main">(</span>nodeslist<span class="main">,</span> p<span class="main">)</span> <span class="main">=</span>
  <span class="quoted">"IF (isLeaf_pt ´p ´low ´high) 
   THEN ´p → ´rep :== ´nodeslist
   ELSE
        WHILE (´nodeslist ≠ Null) DO
          IF (repNodes_eq ´nodeslist ´p ´low ´high ´rep)
          THEN ´p→´rep :== ´nodeslist;; ´nodeslist :== Null
          ELSE ´nodeslist :== ´nodeslist→´next
          FI
        OD
   FI"</span>



<span class="keyword1"><span class="command">procedures</span></span>
  ShareReduceRepList <span class="main">(</span>nodeslist <span class="main">|</span> <span class="main">)</span> <span class="main">=</span>
  <span class="quoted">"´node :== ´nodeslist;;
   WHILE (´node ≠ Null) DO
     IF (¬ isLeaf_pt ´node ´low ´high ∧ 
         ´node → ´low → ´rep = ´node → ´high → ´rep )
     THEN ´node → ´rep :== ´node → ´low → ´rep
     ELSE CALL ShareRep (´nodeslist , ´node )  
     FI;;
     ´node :==´node → ´next
   OD"</span>


<span class="keyword1"><span class="command">procedures</span></span> 
  Repoint <span class="main">(</span>p<span class="main">|</span>p<span class="main">)</span> <span class="main">=</span> 
  <span class="quoted">"IF ( ´p ≠ Null )
   THEN  
     ´p :== ´p → ´rep;;
     IF ( ´p ≠ Null )
     THEN ´p  → ´low :== CALL Repoint (´p  → ´low);;
          ´p  → ´high :== CALL Repoint (´p → ´high)
     FI
   FI"</span>


<span class="keyword1"><span class="command">procedures</span></span> 
  Normalize <span class="main">(</span>p<span class="main">|</span>p<span class="main">)</span> <span class="main">=</span>
  <span class="quoted">"´levellist :==replicate (´p→´var +1) Null;;
    ´levellist :== CALL Levellist (´p, (¬ ´p→´mark) , ´levellist);;
   (´n :==0;;
   WHILE (´n &lt; length ´levellist) DO
     CALL ShareReduceRepList(´levellist ! ´n);;
     ´n :==´n + 1
   OD);;
   ´p :== CALL Repoint (´p)"</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="EvalProof">
<div class="head">
<h1>Theory EvalProof</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       BDD

    Author:      Veronika Ortner and Norbert Schirmer, 2004
    Maintainer:  Norbert Schirmer,  norbert.schirmer at web de
    License:     LPGL
*)</span>

<span class="comment1">(*  
EvalProof.thy

Copyright (C) 2004-2008 Veronika Ortner and Norbert Schirmer 
Some rights reserved, TU Muenchen

This library is free software; you can redistribute it and/or modify
it under the terms of the GNU Lesser General Public License as
published by the Free Software Foundation; either version 2.1 of the
License, or (at your option) any later version.

This library is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
Lesser General Public License for more details.

You should have received a copy of the GNU Lesser General Public
License along with this library; if not, write to the Free Software
Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307
USA
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Proof of Procedure Eval›</span></span>
<span class="keyword1"><span class="command">theory</span></span> EvalProof <span class="keyword2"><span class="keyword">imports</span></span> <a href="ProcedureSpecs.html">ProcedureSpecs</a> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Eval_impl<span class="main">)</span> Eval_modifies<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">σ</span><span class="main">.</span> <span class="free">Γ</span><span class="main">⊢</span><span class="main">{</span><span class="bound">σ</span><span class="main">}</span>  <span class="keyword1">PROC</span> Eval <span class="main">(</span><span class="main">´</span>p<span class="main">,</span> <span class="main">´</span>varval<span class="main">,</span> <span class="main">´</span>R<span class="main">)</span> 
                <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="keyword1">may_not_modify_globals</span> <span class="bound">σ</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">hoare_rule</span> HoarePartial.ProcRec1<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">vcg</span> spec<span class="main"><span class="main">=</span></span>modifies<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 


<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Eval_impl<span class="main">)</span> Eval_spec<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">σ</span> <span class="bound">t</span> <span class="bound">bdt1</span><span class="main">.</span> <span class="free">Γ</span><span class="main">⊢</span>
  <span class="main">⦃</span><span class="bound">σ</span><span class="main">.</span> Dag <span class="main">´</span>p <span class="main">´</span>low <span class="main">´</span>high <span class="bound">t</span> <span class="main">∧</span> bdt <span class="bound">t</span> <span class="main">´</span>var <span class="main">=</span> Some <span class="bound">bdt1</span><span class="main">⦄</span> 
   <span class="main">´</span>R <span class="main">:==</span> <span class="keyword1">PROC</span> Eval<span class="main">(</span><span class="main">´</span>p<span class="main">,</span> <span class="main">´</span>varval<span class="main">)</span> 
  <span class="main">⦃</span><span class="main">´</span>R <span class="main">=</span> eval <span class="bound">bdt1</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>varval <span class="main">⦄</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">hoare_rule</span> HoarePartial.ProcRec1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">vcg</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">bdt1</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>      <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>     <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">bdt1</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>     <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">bdt1</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">bdt1</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>



<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="LevellistProof">
<div class="head">
<h1>Theory LevellistProof</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       BDD
    Author:      Veronika Ortner and Norbert Schirmer, 2004
    Maintainer:  Norbert Schirmer,  norbert.schirmer at web de
    License:     LGPL
*)</span>

<span class="comment1">(*
LevellistProof.thy

Copyright (C) 2004-2008 Veronika Ortner and Norbert Schirmer
Some rights reserved, TU Muenchen

This library is free software; you can redistribute it and/or modify
it under the terms of the GNU Lesser General Public License as
published by the Free Software Foundation; either version 2.1 of the
License, or (at your option) any later version.

This library is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
Lesser General Public License for more details.

You should have received a copy of the GNU Lesser General Public
License along with this library; if not, write to the Free Software
Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307
USA
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Proof of Procedure Levellist›</span></span>
<span class="keyword1"><span class="command">theory</span></span> LevellistProof <span class="keyword2"><span class="keyword">imports</span></span> <a href="ProcedureSpecs.html">ProcedureSpecs</a> <a href="../Simpl/HeapList.html">Simpl.HeapList</a> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> DistinctTreeProver.set_of tree.Node tree.Tip

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Levellist_impl<span class="main">)</span> Levellist_modifies<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">σ</span><span class="main">.</span> <span class="free">Γ</span><span class="main">⊢</span><span class="main">{</span><span class="bound">σ</span><span class="main">}</span> <span class="main">´</span>levellist <span class="main">:==</span> <span class="keyword1">PROC</span> Levellist <span class="main">(</span><span class="main">´</span>p<span class="main">,</span> <span class="main">´</span>m<span class="main">,</span> <span class="main">´</span>levellist<span class="main">)</span>
             <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="keyword1">may_only_modify_globals</span> <span class="bound">σ</span> <span class="keyword1">in</span> <span class="main">[</span>mark<span class="main">,</span>next<span class="main">]</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">hoare_rule</span> HoarePartial.ProcRec1<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">vcg</span> spec<span class="main"><span class="main">=</span></span>modifies<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="comment1">(*a well formed levellist is a list that contains all nodes with variable
i on position i
because the elements of levellist can contain old elements before the call of Levellist,
subdag_eq t pt can not be postulated for all elements of the sublists. One has to make
shure that the initial call of Levellist is parameterized with a levellist with empty sublists.
Otherwise some problems could arise in the call of Reduce!
(∃ ptt. (Dag pt low high ptt ∧ subdag_eq (Node lt p rt) ptt ∧ pt→var = i))
consts wf_levellist :: "dag ⇒ ref list list ⇒ ref list list ⇒
                        (ref ⇒ nat) ⇒ (ref ⇒ ref) ⇒ (ref ⇒ ref) ⇒ bool"
defs wf_levellist_def: "wf_levellist t levellist_old levellist_new var low high ≡
case t of Tip ⇒ levellist_old = levellist_new
| (Node lt p rt) ⇒
  (∀ q. q ∈ set_of t ⟶ q ∈ set (levellist_new ! (q→var))) ∧
  (∀ i ≤ p→var. (∃ prx. (levellist_new ! i) = prx@(levellist_old ! i)
                       ∧ (∀ pt ∈ set prx. pt ∈ set_of t ∧ pt→var = i))) ∧
  (∀ i. (p→var) &lt; i ⟶ (levellist_new ! i) = (levellist_old ! i)) ∧
  (length levellist_new = length levellist_old)"
*)</span>


<span class="keyword1" id="LevellistProof-all_stop_cong"><span class="command">lemma</span></span> all_stop_cong<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="LevellistProof-Dag_RefD"><span class="command">lemma</span></span> Dag_RefD<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Dag <span class="free">p</span> <span class="free">l</span> <span class="free">r</span> <span class="free">t</span><span class="main">;</span> <span class="free">p</span><span class="main">≠</span>Null<span class="main">⟧</span> <span class="main">⟹</span>
    <span class="main">∃</span><span class="bound">lt</span> <span class="bound">rt</span><span class="main">.</span> <span class="free">t</span><span class="main">=</span>Node <span class="bound">lt</span> <span class="free">p</span> <span class="bound">rt</span> <span class="main">∧</span> Dag <span class="main">(</span><span class="free">l</span> <span class="free">p</span><span class="main">)</span> <span class="free">l</span> <span class="free">r</span> <span class="bound">lt</span> <span class="main">∧</span> Dag <span class="main">(</span><span class="free">r</span> <span class="free">p</span><span class="main">)</span> <span class="free">l</span> <span class="free">r</span> <span class="bound">rt</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="LevellistProof-Dag_unique_ex_conjI"><span class="command">lemma</span></span> Dag_unique_ex_conjI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Dag <span class="free">p</span> <span class="free">l</span> <span class="free">r</span> <span class="free">t</span><span class="main">;</span>   <span class="free">P</span> <span class="free">t</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span><span class="main">.</span> Dag <span class="free">p</span> <span class="free">l</span> <span class="free">r</span> <span class="bound">t</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="comment1">(* FIXME: To BinDag *)</span>
<span class="keyword1" id="LevellistProof-dag_Null"><span class="command">lemma</span></span> dag_Null <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"dag Null <span class="free">l</span> <span class="free">r</span> <span class="main">=</span> Tip"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dag_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">first</span><span class="main">::</span> <span class="quoted"><span class="quoted">"ref list <span class="main">⇒</span> ref"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">first</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="keyword1">of</span> <span class="main">[]</span> <span class="main">⇒</span> Null <span class="main">|</span> <span class="main">(</span><span class="bound">p</span><span class="main">#</span><span class="bound">rs</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="LevellistProof-first_simps"><span class="command">lemma</span></span> first_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"first <span class="main">[]</span> <span class="main">=</span> Null"</span></span>
 <span class="quoted"><span class="quoted">"first <span class="main">(</span><span class="free">r</span><span class="main">#</span><span class="free">rs</span><span class="main">)</span> <span class="main">=</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> first_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Levellist</span><span class="main">::</span> <span class="quoted"><span class="quoted">"ref list <span class="main">⇒</span> <span class="main">(</span>ref <span class="main">⇒</span> ref<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>ref list list<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Levellist</span> <span class="free"><span class="bound"><span class="entity">hds</span></span></span> <span class="free"><span class="bound"><span class="entity">next</span></span></span> <span class="free"><span class="bound"><span class="entity">ll</span></span></span> <span class="main">⟷</span> <span class="main">(</span>map first <span class="free"><span class="bound"><span class="entity">ll</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">hds</span></span></span><span class="main">)</span> <span class="main">∧</span>
                         <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="free"><span class="bound"><span class="entity">hds</span></span></span><span class="main">.</span> List <span class="main">(</span><span class="free"><span class="bound"><span class="entity">hds</span></span></span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">next</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ll</span></span></span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="LevellistProof-Levellist_unique"><span class="command">lemma</span></span> Levellist_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ll<span class="main">:</span> <span class="quoted"><span class="quoted">"Levellist <span class="free">hds</span> <span class="free">next</span> <span class="free">ll</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ll'<span class="main">:</span> <span class="quoted"><span class="quoted">"Levellist <span class="free">hds</span> <span class="free">next</span> <span class="free">ll'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ll</span><span class="main">=</span><span class="free">ll'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> ll <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ll</span> <span class="main">=</span> length <span class="free">hds</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Levellist_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> ll' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ll'</span> <span class="main">=</span> length <span class="free">hds</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Levellist_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> leq<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">ll</span> <span class="main">=</span> length <span class="free">ll'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> nth_equalityI <span class="main"><span class="main">[</span></span><span class="operator">OF</span> leq<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">ll</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> ll ll'
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">ll</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="free">ll'</span><span class="main">!</span><span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Levellist_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> List_unique<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LevellistProof-Levellist_unique_ex_conj_simp"><span class="command">lemma</span></span> Levellist_unique_ex_conj_simp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"Levellist <span class="free">hds</span> <span class="free">next</span> <span class="free">ll</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ll</span><span class="main">.</span> Levellist <span class="free">hds</span> <span class="free">next</span> <span class="bound">ll</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">ll</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="free">ll</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> Levellist_unique<span class="main">)</span>


<span class="keyword1" id="LevellistProof-in_set_concat_idx"><span class="command">lemma</span></span> in_set_concat_idx<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>concat <span class="free">xss</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="free">xss</span><span class="main">.</span> <span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">xss</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xss</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="main">0</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">wf_levellist</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"dag <span class="main">⇒</span> ref list list <span class="main">⇒</span> ref list list <span class="main">⇒</span>
                       <span class="main">(</span>ref <span class="main">⇒</span> nat<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">wf_levellist</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">levellist_old</span></span></span> <span class="free"><span class="bound"><span class="entity">levellist_new</span></span></span> <span class="free"><span class="bound"><span class="entity">var</span></span></span> <span class="main">=</span>
<span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="keyword1">of</span> Tip <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">levellist_old</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">levellist_new</span></span></span>
<span class="main">|</span> <span class="main">(</span>Node <span class="bound">lt</span> <span class="bound">p</span> <span class="bound">rt</span><span class="main">)</span> <span class="main">⇒</span>
  <span class="main">(</span><span class="main">∀</span> <span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">∈</span> set_of <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">⟶</span> <span class="bound">q</span> <span class="main">∈</span> set <span class="main">(</span><span class="free"><span class="bound"><span class="entity">levellist_new</span></span></span> <span class="main">!</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">var</span></span></span> <span class="bound">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
  <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">var</span></span></span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">prx</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">levellist_new</span></span></span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="bound">prx</span><span class="main">@</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">levellist_old</span></span></span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span>
                       <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">pt</span> <span class="main">∈</span> set <span class="bound">prx</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∈</span> set_of <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">var</span></span></span> <span class="bound">pt</span> <span class="main">=</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
  <span class="main">(</span><span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">var</span></span></span> <span class="bound">p</span><span class="main">)</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">⟶</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">levellist_new</span></span></span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">levellist_old</span></span></span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
  <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">levellist_new</span></span></span> <span class="main">=</span> length <span class="free"><span class="bound"><span class="entity">levellist_old</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="LevellistProof-wf_levellist_subset"><span class="command">lemma</span></span> wf_levellist_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wf_ll<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_levellist <span class="free">t</span> <span class="free">ll</span> <span class="free">ll'</span> <span class="free">var</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>concat <span class="free">ll'</span><span class="main">)</span> <span class="main">⊆</span>  set <span class="main">(</span>concat <span class="free">ll</span><span class="main">)</span> <span class="main">∪</span> set_of <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Tip <span class="keyword1"><span class="command">with</span></span> wf_ll <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_levellist_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> set <span class="main">(</span>concat <span class="free">ll'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> in_set_concat_idx <span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">ll'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> n_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ll'</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> set <span class="main">(</span>concat <span class="free">ll</span><span class="main">)</span> <span class="main">∪</span> set_of <span class="free">t</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="free">var</span> <span class="skolem">p</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> wf_ll <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">prx</span></span> <span class="keyword2"><span class="keyword">where</span></span>
          ll'_ll<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ll'</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">prx</span> <span class="main">@</span> <span class="free">ll</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          prx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">pt</span> <span class="main">∈</span> set <span class="skolem">prx</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∈</span> set_of <span class="free">t</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span>
          leq<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">ll'</span> <span class="main">=</span> length <span class="free">ll</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_levellist_def Node<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> set <span class="skolem">prx</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">with</span></span> prx <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> set_of <span class="free">t</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">with</span></span> n_in ll'_ll
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ll</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> i_bound leq
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> set <span class="main">(</span>concat <span class="free">ll</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">with</span></span> wf_ll <span class="keyword3"><span class="command">obtain</span></span> <span class="quoted"><span class="quoted">"<span class="free">ll'</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="free">ll</span><span class="main">!</span><span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ll'</span> <span class="main">=</span> length <span class="free">ll</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_levellist_def Node<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> n_in i_bound
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> set <span class="main">(</span>concat <span class="free">ll</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="comment1">(*
  next
    show "set (concat ll) ∪ set_of t ⊆ set (concat ll')"
    proof -
      {
        fix n
        assume "n ∈ set (concat ll)"
        from in_set_concat_idx [OF this]
        obtain i where i_bound: "i &lt; length ll" and n_in: "n ∈ set (ll ! i)"
          by blast
        with wf_ll
        obtain "n ∈ set (ll' ! i)" "length ll = length ll'"
          apply (clarsimp simp add: wf_levellist_def Node)
          apply (case_tac "i ≤ var p")
          apply  fastforce
          apply fastforce
          done
        with i_bound have "n ∈ set (concat ll')"
          by auto
      }
      moreover
      {
        fix n
        assume "n ∈ set_of t"
        with wf_ll obtain "n ∈ set (ll' ! var n)" "length ll' = length ll"
          by (auto simp add: wf_levellist_def Node)
        with root

            next

          proof (cases prx)
            case Nil
            with ll'_ll i_bound leq n_in
            have "n ∈ set (concat ll)"
              by auto
            thus ?thesis by simp
          next
            case (Cons p prx')
            show ?thesis

              apply auto
        *)</span>


<span class="comment1">(*
consts wf_levellist :: "dag ⇒ ref list ⇒ ref list ⇒
                        (ref ⇒ ref) ⇒ (ref ⇒ ref) ⇒
                       (ref ⇒ nat) ⇒ bool"
defs wf_levellist_def:
"wf_levellist t levellist_old levellist_new next_old next_new var  ≡
case t of Tip ⇒ levellist_old = levellist_new
| (Node lt p rt) ⇒
  (∀ q. q ∈ set_of t ⟶ (∃ns. List (levellist_new ! (var q)) next_new ns ∧
                                q ∈ set ns)) ∧
  (∀ i ≤ var p. (∃ns_new ns_old.
                  List (levellist_new ! i) next_new ns_new ∧
                  List (levellist_old ! i) next_old ns_old ∧
                 (∃ prx. ns_new = prx@ns_old
                       ∧ (∀ pt ∈ set prx. pt ∈ set_of t ∧ var pt = i)))) ∧
  (∀ i. (var p) &lt; i ⟶ (∃ns_new ns_old.
                          List (levellist_new ! i) next_new ns_new ∧
                          List (levellist_old ! i) next_old ns_old ∧
                          ns_new = ns_old)) ∧
  (length levellist_new = length levellist_old)"
*)</span>

<span class="keyword1" id="LevellistProof-Levellist_ext_to_all"><span class="command">lemma</span></span> Levellist_ext_to_all<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">ll</span><span class="main">.</span> Levellist <span class="free">hds</span> <span class="free">next</span> <span class="bound">ll</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">ll</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Q</span><span class="main">)</span>
       <span class="main">=</span>
       <span class="main">(</span><span class="main">∀</span><span class="bound">ll</span><span class="main">.</span> Levellist <span class="free">hds</span> <span class="free">next</span> <span class="bound">ll</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">ll</span> <span class="main">⟶</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="LevellistProof-Levellist_length"><span class="command">lemma</span></span> Levellist_length<span class="main">:</span> <span class="quoted"><span class="quoted">"Levellist <span class="free">hds</span> <span class="free">p</span> <span class="free">ll</span> <span class="main">⟹</span> length <span class="free">ll</span> <span class="main">=</span> length <span class="free">hds</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Levellist_def<span class="main">)</span>


<span class="keyword1" id="LevellistProof-map_update"><span class="command">lemma</span></span> map_update<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">xss</span> <span class="main">⟹</span> map <span class="free">f</span> <span class="main">(</span><span class="free">xss</span><span class="main">[</span><span class="bound">i</span> <span class="main">:=</span> <span class="free">xs</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>map <span class="free">f</span> <span class="free">xss</span><span class="main">)</span> <span class="main">[</span><span class="bound">i</span> <span class="main">:=</span> <span class="free">f</span> <span class="free">xs</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xss</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">i</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Levellist_impl<span class="main">)</span> Levellist_spec_total'<span class="main">:</span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ll</span> <span class="bound">σ</span> <span class="bound">t</span><span class="main">.</span> <span class="free">Γ</span><span class="main">,</span><span class="free">Θ</span><span class="keyword1">⊢<span class="hidden">⇩</span><sub>t</sub></span>
        <span class="main">⦃</span><span class="bound">σ</span><span class="main">.</span> Dag <span class="main">´</span>p <span class="main">´</span>low <span class="main">´</span>high <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="main">´</span>p <span class="main">≠</span> Null <span class="main">⟶</span> <span class="main">(</span><span class="main">´</span>p<span class="main">→</span><span class="main">´</span>var<span class="main">)</span> <span class="main">&lt;</span> length <span class="main">´</span>levellist<span class="main">)</span> <span class="main">∧</span>
             ordered <span class="bound">t</span> <span class="main">´</span>var <span class="main">∧</span> Levellist <span class="main">´</span>levellist <span class="main">´</span>next <span class="bound">ll</span> <span class="main">∧</span>
             <span class="main">(</span><span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> set_of <span class="bound">t</span><span class="main">.</span>
              <span class="main">(</span><span class="keyword1">if</span> <span class="main">´</span>mark <span class="bound">n</span> <span class="main">=</span> <span class="main">´</span>m
               <span class="keyword1">then</span> <span class="bound">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="bound">ll</span> <span class="main">!</span> <span class="main">´</span>var <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span>
                    <span class="main">(</span><span class="main">∀</span><span class="bound">nt</span> <span class="bound">p</span><span class="main">.</span> Dag <span class="bound">n</span> <span class="main">´</span>low <span class="main">´</span>high <span class="bound">nt</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">∈</span> set_of <span class="bound">nt</span>
                     <span class="main">⟶</span> <span class="main">´</span>mark <span class="bound">p</span> <span class="main">=</span> <span class="main">´</span>m<span class="main">)</span>
               <span class="keyword1">else</span> <span class="bound">n</span> <span class="main">∉</span> set <span class="main">(</span>concat <span class="bound">ll</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span>
          <span class="main">´</span>levellist <span class="main">:==</span> <span class="keyword1">PROC</span> Levellist <span class="main">(</span><span class="main">´</span>p<span class="main">,</span> <span class="main">´</span>m<span class="main">,</span> <span class="main">´</span>levellist<span class="main">)</span>
       <span class="main">⦃</span><span class="main">∃</span><span class="bound">ll'</span><span class="main">.</span> Levellist <span class="main">´</span>levellist <span class="main">´</span>next <span class="bound">ll'</span> <span class="main">∧</span> wf_levellist <span class="bound">t</span> <span class="bound">ll</span> <span class="bound">ll'</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>var <span class="main">∧</span>
        wf_marking <span class="bound">t</span>  <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>mark <span class="main">´</span>mark <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>m <span class="main">∧</span>
        <span class="main">(</span><span class="main">∀</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∉</span> set_of <span class="bound">t</span> <span class="main">⟶</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>next <span class="bound">p</span> <span class="main">=</span> <span class="main">´</span>next <span class="bound">p</span><span class="main">)</span>
        <span class="main">⦄</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">hoare_rule</span> HoareTotal.ProcRec1
           <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> r<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"measure <span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">s</span></span><span class="main"><span class="main">,</span></span><span class="bound"><span class="bound">p</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">.</span></span> size <span class="main"><span class="main">(</span></span>dag <span class="hidden">⇗</span><sup>s</sup><span class="hidden">⇖</span>p <span class="hidden">⇗</span><sup>s</sup><span class="hidden">⇖</span>low <span class="hidden">⇗</span><sup>s</sup><span class="hidden">⇖</span>high<span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">vcg</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">clarify</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="operator">clarify</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> BinDag.set_of.simps <span class="quasi_keyword">split</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> if_split<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> BinDag.set_of.simps <span class="quasi_keyword">split</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> if_split<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_levellist_def wf_marking_def<span class="main">)</span> <span class="comment1">(* p=Null*)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Levellist_ext_to_all <span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ll</span> <span class="skolem">var</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">mark</span> <span class="quoted">"<span class="skolem">next</span>"</span> <span class="skolem">nexta</span> <span class="skolem">p</span> <span class="skolem">levellist</span> <span class="skolem">m</span> <span class="skolem">lt</span> <span class="skolem">rt</span>
  <span class="keyword3"><span class="command">assume</span></span> pnN<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> Null"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> mark_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mark</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="skolem">m</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> lt<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">low</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">lt</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> rt<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">high</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">rt</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> pnN lt rt <span class="keyword1"><span class="command">have</span></span> Dag_p<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="skolem">p</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> Dag_p rt
  <span class="keyword1"><span class="command">have</span></span> size_rt_dec<span class="main">:</span> <span class="quoted"><span class="quoted">"size <span class="main">(</span>dag <span class="main">(</span><span class="skolem">high</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">low</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">&lt;</span> size <span class="main">(</span>dag <span class="skolem">p</span> <span class="skolem">low</span> <span class="skolem">high</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Dag_dag<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> Dag_p lt
  <span class="keyword1"><span class="command">have</span></span> size_lt_dec<span class="main">:</span> <span class="quoted"><span class="quoted">"size <span class="main">(</span>dag <span class="main">(</span><span class="skolem">low</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">low</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">&lt;</span> size <span class="main">(</span>dag <span class="skolem">p</span> <span class="skolem">low</span> <span class="skolem">high</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Dag_dag<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">assume</span></span> ll<span class="main">:</span> <span class="quoted"><span class="quoted">"Levellist <span class="skolem">levellist</span> <span class="skolem">next</span> <span class="skolem">ll</span>"</span></span>

  <span class="keyword3"><span class="command">assume</span></span> marked_child_ll<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> set_of <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span><span class="main">)</span><span class="main">.</span>
        <span class="keyword1">if</span> <span class="skolem">mark</span> <span class="bound">n</span> <span class="main">=</span> <span class="skolem">m</span>
        <span class="keyword1">then</span> <span class="bound">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">var</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span>
             <span class="main">(</span><span class="main">∀</span><span class="bound">nt</span> <span class="bound">p</span><span class="main">.</span> Dag <span class="bound">n</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="bound">nt</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">∈</span> set_of <span class="bound">nt</span> <span class="main">⟶</span> <span class="skolem">mark</span> <span class="bound">p</span> <span class="main">=</span> <span class="skolem">m</span><span class="main">)</span>
        <span class="keyword1">else</span> <span class="bound">n</span> <span class="main">∉</span> set <span class="main">(</span>concat <span class="skolem">ll</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> mark_p <span class="keyword1"><span class="command">have</span></span> p_notin_ll<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∉</span> set <span class="main">(</span>concat <span class="skolem">ll</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">assume</span></span> varsll'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">p</span> <span class="main">&lt;</span> length <span class="skolem">levellist</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> ll <span class="keyword1"><span class="command">have</span></span> varsll<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">p</span> <span class="main">&lt;</span> length <span class="skolem">ll</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Levellist_length<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> orderedt<span class="main">:</span> <span class="quoted"><span class="quoted">"ordered <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span><span class="main">)</span> <span class="skolem">var</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">low</span> <span class="skolem">p</span> <span class="main">≠</span> Null <span class="main">⟶</span> <span class="skolem">var</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="skolem">levellist</span><span class="main">)</span> <span class="main">∧</span>
          ordered <span class="skolem">lt</span> <span class="skolem">var</span> <span class="main">∧</span>
          <span class="main">(</span><span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> set_of <span class="skolem">lt</span><span class="main">.</span>
              <span class="keyword1">if</span> <span class="skolem">mark</span> <span class="bound">n</span> <span class="main">=</span> <span class="skolem">m</span>
              <span class="keyword1">then</span> <span class="bound">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">var</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span>
                   <span class="main">(</span><span class="main">∀</span><span class="bound">nt</span> <span class="bound">p</span><span class="main">.</span> Dag <span class="bound">n</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="bound">nt</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">∈</span> set_of <span class="bound">nt</span> <span class="main">⟶</span> <span class="skolem">mark</span> <span class="bound">p</span> <span class="main">=</span> <span class="skolem">m</span><span class="main">)</span>
              <span class="keyword1">else</span> <span class="bound">n</span> <span class="main">∉</span> set <span class="main">(</span>concat <span class="skolem">ll</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
          size <span class="main">(</span>dag <span class="main">(</span><span class="skolem">low</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">low</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">&lt;</span> size <span class="main">(</span>dag <span class="skolem">p</span> <span class="skolem">low</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">∧</span>
          <span class="main">(</span><span class="main">∀</span><span class="bound">marka</span> <span class="bound">nexta</span> <span class="bound">levellist</span> <span class="bound">lla</span><span class="main">.</span>
              Levellist <span class="bound">levellist</span> <span class="bound">nexta</span> <span class="bound">lla</span> <span class="main">∧</span>
              wf_levellist <span class="skolem">lt</span> <span class="skolem">ll</span> <span class="bound">lla</span> <span class="skolem">var</span> <span class="main">∧</span> wf_marking <span class="skolem">lt</span> <span class="skolem">mark</span> <span class="bound">marka</span> <span class="skolem">m</span> <span class="main">∧</span>
              <span class="main">(</span><span class="main">∀</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∉</span> set_of <span class="skolem">lt</span> <span class="main">⟶</span> <span class="skolem">next</span> <span class="bound">p</span> <span class="main">=</span> <span class="bound">nexta</span> <span class="bound">p</span><span class="main">)</span><span class="main">⟶</span>
              <span class="main">(</span><span class="skolem">high</span> <span class="skolem">p</span> <span class="main">≠</span> Null <span class="main">⟶</span> <span class="skolem">var</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="bound">levellist</span><span class="main">)</span> <span class="main">∧</span>
              ordered <span class="skolem">rt</span> <span class="skolem">var</span> <span class="main">∧</span>
              <span class="main">(</span><span class="main">∃</span><span class="bound">lla</span><span class="main">.</span> Levellist <span class="bound">levellist</span> <span class="bound">nexta</span> <span class="bound">lla</span> <span class="main">∧</span>
                     <span class="main">(</span><span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> set_of <span class="skolem">rt</span><span class="main">.</span>
                        <span class="keyword1">if</span> <span class="bound">marka</span> <span class="bound">n</span> <span class="main">=</span> <span class="skolem">m</span>
                        <span class="keyword1">then</span> <span class="bound">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="bound">lla</span> <span class="main">!</span> <span class="skolem">var</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span>
                             <span class="main">(</span><span class="main">∀</span><span class="bound">nt</span> <span class="bound">p</span><span class="main">.</span> Dag <span class="bound">n</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="bound">nt</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">∈</span> set_of <span class="bound">nt</span> <span class="main">⟶</span>
                                    <span class="bound">marka</span> <span class="bound">p</span> <span class="main">=</span> <span class="skolem">m</span><span class="main">)</span>
                        <span class="keyword1">else</span> <span class="bound">n</span> <span class="main">∉</span> set <span class="main">(</span>concat <span class="bound">lla</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                     size <span class="main">(</span>dag <span class="main">(</span><span class="skolem">high</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">low</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">&lt;</span> size <span class="main">(</span>dag <span class="skolem">p</span> <span class="skolem">low</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">∧</span>
                     <span class="main">(</span><span class="main">∀</span><span class="bound">markb</span> <span class="bound">nextb</span> <span class="bound">levellist</span> <span class="bound">llb</span><span class="main">.</span>
                         Levellist <span class="bound">levellist</span> <span class="bound">nextb</span> <span class="bound">llb</span> <span class="main">∧</span>
                         wf_levellist <span class="skolem">rt</span> <span class="bound">lla</span> <span class="bound">llb</span> <span class="skolem">var</span> <span class="main">∧</span>
                         wf_marking <span class="skolem">rt</span> <span class="bound">marka</span> <span class="bound">markb</span> <span class="skolem">m</span> <span class="main">∧</span>
                         <span class="main">(</span><span class="main">∀</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∉</span> set_of <span class="skolem">rt</span> <span class="main">⟶</span> <span class="bound">nexta</span> <span class="bound">p</span> <span class="main">=</span> <span class="bound">nextb</span> <span class="bound">p</span><span class="main">)</span> <span class="main">⟶</span>
                         <span class="main">(</span><span class="main">∃</span><span class="bound">ll'</span><span class="main">.</span> Levellist <span class="main">(</span><span class="bound">levellist</span><span class="main">[</span><span class="skolem">var</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">p</span><span class="main">]</span><span class="main">)</span>
                                 <span class="main">(</span><span class="bound">nextb</span><span class="main">(</span><span class="skolem">p</span> <span class="main">:=</span> <span class="bound">levellist</span> <span class="main">!</span> <span class="skolem">var</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="bound">ll'</span> <span class="main">∧</span>
                                wf_levellist <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span><span class="main">)</span> <span class="skolem">ll</span> <span class="bound">ll'</span> <span class="skolem">var</span> <span class="main">∧</span>
                                wf_marking <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span><span class="main">)</span> <span class="skolem">mark</span> <span class="main">(</span><span class="bound">markb</span><span class="main">(</span><span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="skolem">m</span> <span class="main">∧</span>
                                <span class="main">(</span><span class="main">∀</span><span class="bound">pa</span><span class="main">.</span> <span class="bound">pa</span> <span class="main">∉</span> set_of <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span><span class="main">)</span> <span class="main">⟶</span>
                                      <span class="skolem">next</span> <span class="bound">pa</span> <span class="main">=</span>
                                      <span class="main">(</span><span class="keyword1">if</span> <span class="bound">pa</span> <span class="main">=</span> <span class="skolem">p</span> <span class="keyword1">then</span> <span class="bound">levellist</span> <span class="main">!</span> <span class="skolem">var</span> <span class="skolem">p</span>
                                       <span class="keyword1">else</span> <span class="bound">nextb</span> <span class="bound">pa</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">lt</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Tip
    <span class="keyword1"><span class="command">note</span></span> lt_Tip <span class="main">=</span> this
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">rt</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Tip
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> size_rt_dec Tip lt_Tip Tip lt rt
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">premises</span></span> prems <span class="keyword2"><span class="keyword">for</span></span> marka nexta levellista lla markb nextb levellistb llb
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> lla<span class="main">:</span> <span class="quoted"><span class="quoted">"Levellist <span class="skolem">levellista</span> <span class="skolem">nexta</span> <span class="skolem">lla</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
          <span class="keyword1"><span class="command">have</span></span> llb<span class="main">:</span> <span class="quoted"><span class="quoted">"Levellist <span class="skolem">levellistb</span> <span class="skolem">nextb</span> <span class="skolem">llb</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
          <span class="keyword1"><span class="command">have</span></span> wfll_lt<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_levellist Tip <span class="skolem">ll</span> <span class="skolem">lla</span> <span class="skolem">var</span>"</span></span>
                        <span class="quoted"><span class="quoted">"wf_marking Tip <span class="skolem">mark</span> <span class="skolem">marka</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>

          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ll_lla<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ll</span> <span class="main">=</span> <span class="skolem">lla</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_levellist_def<span class="main">)</span>

          <span class="keyword1"><span class="command">moreover</span></span>
          <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> wfll_lt lt_Tip lt <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">marka</span> <span class="main">=</span> <span class="skolem">mark</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_marking_def<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span>
          <span class="keyword1"><span class="command">have</span></span> wfll_rt<span class="main">:</span><span class="quoted"><span class="quoted">"wf_levellist Tip <span class="skolem">lla</span> <span class="skolem">llb</span> <span class="skolem">var</span>"</span></span>
                       <span class="quoted"><span class="quoted">"wf_marking Tip <span class="skolem">marka</span> <span class="skolem">markb</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> lla_llb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lla</span> <span class="main">=</span> <span class="skolem">llb</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_levellist_def<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span>
          <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> wfll_rt Tip rt <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">markb</span> <span class="main">=</span> <span class="skolem">marka</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_marking_def<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span>
          <span class="keyword1"><span class="command">from</span></span> varsll llb ll_lla lla_llb
          <span class="keyword3"><span class="command">obtain</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">p</span> <span class="main">&lt;</span> length <span class="skolem">levellistb</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">p</span> <span class="main">&lt;</span> length <span class="skolem">llb</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Levellist_length<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> llb pnN
          <span class="keyword1"><span class="command">have</span></span> llc<span class="main">:</span> <span class="quoted"><span class="quoted">"Levellist <span class="main">(</span><span class="skolem">levellistb</span><span class="main">[</span><span class="skolem">var</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">p</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="skolem">nextb</span><span class="main">(</span><span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">levellistb</span> <span class="main">!</span> <span class="skolem">var</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>
                      <span class="main">(</span><span class="skolem">llb</span><span class="main">[</span><span class="skolem">var</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">p</span> <span class="main">#</span> <span class="skolem">llb</span> <span class="main">!</span> <span class="skolem">var</span> <span class="skolem">p</span><span class="main">]</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Levellist_def map_update<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">llb</span> <span class="main">!</span> <span class="improper">i</span><span class="main">)</span> "</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
            <span class="keyword1"><span class="command">using</span></span>  p_notin_ll ll_lla lla_llb
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">simp</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">i</span><span class="main">=</span><span class="skolem">var</span> <span class="skolem">p</span>"</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">simp</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">ultimately</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> lt_Tip Tip varsll
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_levellist_def wf_marking_def<span class="main">)</span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
            <span class="keyword3"><span class="command">assume</span></span> varsllb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">p</span> <span class="main">&lt;</span> length <span class="skolem">llb</span>"</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">var</span> <span class="skolem">p</span>"</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">prx</span><span class="main">.</span> <span class="skolem">llb</span><span class="main">[</span><span class="skolem">var</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">p</span><span class="main">#</span><span class="skolem">llb</span><span class="main">!</span><span class="skolem">var</span> <span class="skolem">p</span><span class="main">]</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="bound">prx</span> <span class="main">@</span> <span class="skolem">llb</span><span class="main">!</span><span class="skolem">i</span> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">∀</span><span class="bound">pt</span><span class="main">∈</span>set <span class="bound">prx</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">∧</span> <span class="skolem">var</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="skolem">var</span> <span class="skolem">p</span>"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">with</span></span> pnN lt rt varsllb lt_Tip Tip <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">p</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subdag_eq_def<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">var</span> <span class="skolem">p</span>"</span></span>
              <span class="keyword1"><span class="command">with</span></span> varsllb <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subdag_eq_def<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">dag1</span> <span class="skolem">a</span> <span class="skolem">dag2</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> rt_node<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rt</span> <span class="main">=</span> Node <span class="skolem">dag1</span> <span class="skolem">a</span> <span class="skolem">dag2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
      <span class="keyword1"><span class="command">with</span></span> rt <span class="keyword1"><span class="command">have</span></span> high_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">p</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">nexta</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">next</span> <span class="bound">p</span> <span class="main">=</span> <span class="bound">nexta</span> <span class="bound">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">next</span> <span class="main">=</span> <span class="bound">nexta</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> size_rt_dec size_lt_dec rt_node lt_Tip Tip lt rt
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> set_of_Node <span class="quasi_keyword">split</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> if_split <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">premises</span></span> prems <span class="keyword2"><span class="keyword">for</span></span> marka levellista lla
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> lla<span class="main">:</span> <span class="quoted"><span class="quoted">"Levellist <span class="skolem">levellista</span> <span class="skolem">next</span> <span class="skolem">lla</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
          <span class="keyword1"><span class="command">have</span></span> wfll_lt<span class="main">:</span><span class="quoted"><span class="quoted">"wf_levellist Tip <span class="skolem">ll</span> <span class="skolem">lla</span> <span class="skolem">var</span>"</span></span>
                       <span class="quoted"><span class="quoted">"wf_marking Tip <span class="skolem">mark</span> <span class="skolem">marka</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> ll_lla<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ll</span> <span class="main">=</span> <span class="skolem">lla</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_levellist_def<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span>
          <span class="keyword1"><span class="command">from</span></span> wfll_lt lt_Tip lt <span class="keyword1"><span class="command">have</span></span> marklrec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">marka</span> <span class="main">=</span> <span class="skolem">mark</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_marking_def<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> orderedt varsll lla ll_lla rt_node lt_Tip high_p
          <span class="keyword1"><span class="command">have</span></span> var_highp_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="skolem">levellista</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Levellist_length<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> orderedt high_p rt_node lt_Tip
          <span class="keyword1"><span class="command">have</span></span> ordered_rt<span class="main">:</span> <span class="quoted"><span class="quoted">"ordered <span class="main">(</span>Node <span class="skolem">dag1</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">dag2</span><span class="main">)</span> <span class="skolem">var</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">from</span></span> high_p marklrec marked_child_ll lt rt lt_Tip rt_node ll_lla
          <span class="keyword1"><span class="command">have</span></span> mark_rt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">∈</span>set_of <span class="main">(</span>Node <span class="skolem">dag1</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">dag2</span><span class="main">)</span><span class="main">.</span>
                <span class="keyword1">if</span> <span class="skolem">marka</span> <span class="bound">n</span> <span class="main">=</span> <span class="skolem">m</span>
                <span class="keyword1">then</span> <span class="bound">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">lla</span> <span class="main">!</span> <span class="skolem">var</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span>
                     <span class="main">(</span><span class="main">∀</span><span class="bound">nt</span> <span class="bound">p</span><span class="main">.</span> Dag <span class="bound">n</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="bound">nt</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">∈</span> set_of <span class="bound">nt</span> <span class="main">⟶</span> <span class="skolem">marka</span> <span class="bound">p</span> <span class="main">=</span> <span class="skolem">m</span><span class="main">)</span>
                <span class="keyword1">else</span> <span class="bound">n</span> <span class="main">∉</span> set <span class="main">(</span>concat <span class="skolem">lla</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> BinDag.set_of.simps<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">blast</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">rule</span> var_highp_bound<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">rule</span> ordered_rt<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">rule</span> mark_rt<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">premises</span></span> prems <span class="keyword2"><span class="keyword">for</span></span> markb nextb levellistb llb
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> llb<span class="main">:</span> <span class="quoted"><span class="quoted">"Levellist <span class="skolem">levellistb</span> <span class="skolem">nextb</span> <span class="skolem">llb</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
              <span class="keyword1"><span class="command">have</span></span> wfll_rt<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_levellist <span class="main">(</span>Node <span class="skolem">dag1</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">dag2</span><span class="main">)</span> <span class="skolem">lla</span> <span class="skolem">llb</span> <span class="skolem">var</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
              <span class="keyword1"><span class="command">have</span></span> wfmarking_rt<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_marking <span class="main">(</span>Node <span class="skolem">dag1</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">dag2</span><span class="main">)</span> <span class="skolem">marka</span> <span class="skolem">markb</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
              <span class="keyword1"><span class="command">from</span></span> wfll_rt varsll llb ll_lla
              <span class="keyword3"><span class="command">obtain</span></span> var_p_bounds<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">p</span> <span class="main">&lt;</span> length <span class="skolem">levellistb</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">p</span> <span class="main">&lt;</span> length <span class="skolem">llb</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Levellist_length wf_levellist_def<span class="main">)</span>
              <span class="keyword1"><span class="command">with</span></span> p_notin_ll ll_lla wfll_rt
              <span class="keyword1"><span class="command">have</span></span> p_notin_llb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="skolem">llb</span><span class="main">.</span> <span class="skolem">p</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">llb</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_levellist_def<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">i</span> <span class="main">≤</span> <span class="skolem">var</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">p</span><span class="main">)</span>"</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
                <span class="keyword1"><span class="command">using</span></span>  orderedt rt_node lt_Tip high_p
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">clarsimp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">with</span></span> llb pnN var_p_bounds
              <span class="keyword1"><span class="command">have</span></span> llc<span class="main">:</span> <span class="quoted"><span class="quoted">"Levellist <span class="main">(</span><span class="skolem">levellistb</span><span class="main">[</span><span class="skolem">var</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">p</span><span class="main">]</span><span class="main">)</span>
                            <span class="main">(</span><span class="skolem">nextb</span><span class="main">(</span><span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">levellistb</span> <span class="main">!</span> <span class="skolem">var</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>
                            <span class="main">(</span><span class="skolem">llb</span><span class="main">[</span><span class="skolem">var</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">p</span> <span class="main">#</span> <span class="skolem">llb</span> <span class="main">!</span> <span class="skolem">var</span> <span class="skolem">p</span><span class="main">]</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Levellist_def map_update<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">i</span><span class="main">=</span><span class="skolem">var</span> <span class="skolem">p</span>"</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">simp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">using</span></span> wfll_rt wfmarking_rt
                      lt_Tip rt_node varsll orderedt lt rt pnN ll_lla marklrec
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_levellist_def wf_marking_def<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">q</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">p</span> <span class="main">=</span> <span class="skolem">var</span> <span class="improper">q</span>"</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="operator">fastforce</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="operator">fastforce</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">p</span> <span class="main">=</span> <span class="skolem">var</span> <span class="improper">q</span>"</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="operator">hypsubst_thin</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="operator">fastforce</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">fastforce</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rotate_tac</span> 4<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">i</span><span class="main">=</span><span class="skolem">var</span> <span class="skolem">p</span>"</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">simp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">&lt;</span> <span class="improper">i</span>"</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">simp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">prx</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">simp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rotate_tac</span> 15<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">pt</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">fastforce</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">llt</span> <span class="skolem">l</span> <span class="skolem">rlt</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> lt_Node<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lt</span> <span class="main">=</span> Node <span class="skolem">llt</span> <span class="skolem">l</span> <span class="skolem">rlt</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">from</span></span> orderedt lt varsll' lt_Node
    <span class="keyword3"><span class="command">obtain</span></span> ordered_lt<span class="main">:</span>
      <span class="quoted"><span class="quoted">"ordered <span class="skolem">lt</span> <span class="skolem">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">low</span> <span class="skolem">p</span> <span class="main">≠</span> Null <span class="main">⟶</span> <span class="skolem">var</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="skolem">levellist</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">rt</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> lt lt_Node marked_child_ll
    <span class="keyword1"><span class="command">have</span></span> mark_lt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">∈</span>set_of <span class="skolem">lt</span><span class="main">.</span>
     <span class="keyword1">if</span> <span class="skolem">mark</span> <span class="bound">n</span> <span class="main">=</span> <span class="skolem">m</span>
     <span class="keyword1">then</span> <span class="bound">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">var</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span>
          <span class="main">(</span><span class="main">∀</span><span class="bound">nt</span> <span class="bound">p</span><span class="main">.</span> Dag <span class="bound">n</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="bound">nt</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">∈</span> set_of <span class="bound">nt</span> <span class="main">⟶</span> <span class="skolem">mark</span> <span class="bound">p</span> <span class="main">=</span> <span class="skolem">m</span><span class="main">)</span>
     <span class="keyword1">else</span> <span class="bound">n</span> <span class="main">∉</span> set <span class="main">(</span>concat <span class="skolem">ll</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> BinDag.set_of.simps<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">blast</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI ordered_lt mark_lt size_lt_dec<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> size_rt_dec <span class="quasi_keyword">split</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> if_split<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Levellist_ext_to_all<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">premises</span></span> prems <span class="keyword2"><span class="keyword">for</span></span> marka nexta levellista lla
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> lla<span class="main">:</span> <span class="quoted"><span class="quoted">"Levellist <span class="skolem">levellista</span> <span class="skolem">nexta</span> <span class="skolem">lla</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
        <span class="keyword1"><span class="command">have</span></span> wfll_lt<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_levellist <span class="skolem">lt</span> <span class="skolem">ll</span> <span class="skolem">lla</span> <span class="skolem">var</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
        <span class="keyword1"><span class="command">have</span></span> wfmarking_lt<span class="main">:</span><span class="quoted"><span class="quoted">"wf_marking <span class="skolem">lt</span> <span class="skolem">mark</span> <span class="skolem">marka</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
        <span class="keyword1"><span class="command">from</span></span> wfll_lt lt_Node
        <span class="keyword1"><span class="command">have</span></span> lla_eq_ll<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">lla</span> <span class="main">=</span> length <span class="skolem">ll</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_levellist_def<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> ll lla <span class="keyword1"><span class="command">have</span></span> lla_eq_ll'<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">levellista</span> <span class="main">=</span> length <span class="skolem">levellist</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Levellist_length<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> orderedt rt lt_Node lt varsll'
        <span class="keyword3"><span class="command">obtain</span></span> ordered_rt<span class="main">:</span>
          <span class="quoted"><span class="quoted">"ordered <span class="skolem">rt</span> <span class="skolem">var</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">high</span> <span class="skolem">p</span> <span class="main">≠</span> Null <span class="main">⟶</span> <span class="skolem">var</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="skolem">levellista</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">rt</span></span><span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> wfll_lt lt_Node
        <span class="keyword1"><span class="command">have</span></span> nodes_in_lla<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">∈</span> set_of <span class="skolem">lt</span> <span class="main">⟶</span> <span class="bound">q</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">lla</span> <span class="main">!</span> <span class="main">(</span><span class="bound">q</span><span class="main">→</span><span class="skolem">var</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_levellist_def<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> wfll_lt lt_Node lt
        <span class="keyword1"><span class="command">have</span></span> lla_st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">p</span><span class="main">)</span><span class="main">→</span><span class="skolem">var</span><span class="main">.</span>
                        <span class="main">(</span><span class="main">∃</span><span class="bound">prx</span><span class="main">.</span> <span class="main">(</span><span class="skolem">lla</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="bound">prx</span><span class="main">@</span><span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∧</span>
                               <span class="main">(</span><span class="main">∀</span><span class="bound">pt</span> <span class="main">∈</span> set <span class="bound">prx</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∈</span> set_of <span class="skolem">lt</span> <span class="main">∧</span> <span class="bound">pt</span><span class="main">→</span><span class="skolem">var</span> <span class="main">=</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_levellist_def<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> wfll_lt lt_Node lt
        <span class="keyword1"><span class="command">have</span></span> lla_nc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">low</span> <span class="skolem">p</span><span class="main">)</span><span class="main">→</span><span class="skolem">var</span><span class="main">)</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">lla</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_levellist_def<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> wfmarking_lt lt_Node lt
        <span class="keyword1"><span class="command">have</span></span> mot_nc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">∉</span> set_of <span class="skolem">lt</span> <span class="main">⟶</span> <span class="skolem">mark</span> <span class="bound">n</span> <span class="main">=</span> <span class="skolem">marka</span> <span class="bound">n</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_marking_def<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> wfmarking_lt lt_Node lt
        <span class="keyword1"><span class="command">have</span></span> mit_marked<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">∈</span> set_of <span class="skolem">lt</span> <span class="main">⟶</span> <span class="skolem">marka</span> <span class="bound">n</span> <span class="main">=</span> <span class="skolem">m</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_marking_def<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> marked_child_ll nodes_in_lla mot_nc mit_marked lla_st
        <span class="keyword1"><span class="command">have</span></span> mark_rt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">∈</span>set_of <span class="skolem">rt</span><span class="main">.</span>
               <span class="keyword1">if</span> <span class="skolem">marka</span> <span class="bound">n</span> <span class="main">=</span> <span class="skolem">m</span>
               <span class="keyword1">then</span> <span class="bound">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">lla</span> <span class="main">!</span> <span class="skolem">var</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span>
                   <span class="main">(</span><span class="main">∀</span><span class="bound">nt</span> <span class="bound">p</span><span class="main">.</span> Dag <span class="bound">n</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="bound">nt</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">∈</span> set_of <span class="bound">nt</span> <span class="main">⟶</span> <span class="skolem">marka</span> <span class="bound">p</span> <span class="main">=</span> <span class="skolem">m</span><span class="main">)</span>
               <span class="keyword1">else</span> <span class="bound">n</span> <span class="main">∉</span> set <span class="main">(</span>concat <span class="skolem">lla</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">n</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>

          <span class="keyword3"><span class="command">assume</span></span> nodes_in_lla<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">∈</span> set_of <span class="skolem">lt</span> <span class="main">⟶</span> <span class="bound">q</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">lla</span> <span class="main">!</span> <span class="skolem">var</span> <span class="bound">q</span><span class="main">)</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> mot_nc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">∉</span> set_of <span class="skolem">lt</span> <span class="main">⟶</span> <span class="skolem">mark</span> <span class="bound">n</span> <span class="main">=</span> <span class="skolem">marka</span> <span class="bound">n</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> mit_marked<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">∈</span> set_of <span class="skolem">lt</span> <span class="main">⟶</span> <span class="skolem">marka</span> <span class="bound">n</span> <span class="main">=</span> <span class="skolem">m</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> marked_child_ll<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">if</span> <span class="skolem">mark</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">m</span>
           <span class="keyword1">then</span> <span class="skolem">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">var</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">∧</span>
                <span class="main">(</span><span class="main">∀</span><span class="bound">nt</span> <span class="bound">p</span><span class="main">.</span> Dag <span class="skolem">n</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="bound">nt</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">∈</span> set_of <span class="bound">nt</span> <span class="main">⟶</span> <span class="skolem">mark</span> <span class="bound">p</span> <span class="main">=</span> <span class="skolem">m</span><span class="main">)</span>
           <span class="keyword1">else</span> <span class="skolem">n</span> <span class="main">∉</span> set <span class="main">(</span>concat <span class="skolem">ll</span><span class="main">)</span>"</span></span>

          <span class="keyword3"><span class="command">assume</span></span> lla_st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">≤</span><span class="skolem">var</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">p</span><span class="main">)</span><span class="main">.</span>
                               <span class="main">∃</span><span class="bound">prx</span><span class="main">.</span> <span class="skolem">lla</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="bound">prx</span> <span class="main">@</span> <span class="skolem">ll</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">∧</span>
                               <span class="main">(</span><span class="main">∀</span><span class="bound">pt</span><span class="main">∈</span>set <span class="bound">prx</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∈</span> set_of <span class="skolem">lt</span> <span class="main">∧</span> <span class="skolem">var</span> <span class="bound">pt</span> <span class="main">=</span> <span class="bound">i</span><span class="main">)</span>"</span></span>

          <span class="keyword3"><span class="command">assume</span></span> n_in_rt<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">n</span> <span class="main">∈</span> set_of <span class="skolem">rt</span>"</span></span>
          <span class="keyword3"><span class="command">show</span></span> n_in_lla_marked<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">if</span> <span class="skolem">marka</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">m</span>
             <span class="keyword1">then</span> <span class="skolem">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">lla</span> <span class="main">!</span> <span class="skolem">var</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">∧</span>
                  <span class="main">(</span><span class="main">∀</span><span class="bound">nt</span> <span class="bound">p</span><span class="main">.</span> Dag <span class="skolem">n</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="bound">nt</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">∈</span> set_of <span class="bound">nt</span> <span class="main">⟶</span> <span class="skolem">marka</span> <span class="bound">p</span> <span class="main">=</span> <span class="skolem">m</span><span class="main">)</span>
             <span class="keyword1">else</span> <span class="skolem">n</span> <span class="main">∉</span> set <span class="main">(</span>concat <span class="skolem">lla</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> set_of <span class="skolem">lt</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">from</span></span> True nodes_in_lla <span class="keyword1"><span class="command">have</span></span> n_in_ll<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">lla</span> <span class="main">!</span> <span class="skolem">var</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">moreover</span></span>
            <span class="keyword1"><span class="command">from</span></span> True wfmarking_lt
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">marka</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">m</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">lt</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_marking_def<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">moreover</span></span>
            <span class="keyword1"><span class="command">{</span></span>
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">nt</span> <span class="skolem">p</span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Dag <span class="skolem">n</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">nt</span>"</span></span>
              <span class="keyword1"><span class="command">with</span></span> lt True <span class="keyword1"><span class="command">have</span></span> subset_nt_lt<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">nt</span> <span class="main">⊆</span> set_of <span class="skolem">lt</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dag_setof_subsetD<span class="main">)</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">p</span> <span class="main">∈</span> set_of <span class="skolem">nt</span>"</span></span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> set_of <span class="skolem">lt</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">with</span></span> mit_marked <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">marka</span> <span class="skolem">p</span> <span class="main">=</span> <span class="skolem">m</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">}</span></span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> n_in_rt
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">assume</span></span> n_notin_lt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∉</span> set_of <span class="skolem">lt</span>"</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">marka</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">m</span>"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">from</span></span> n_notin_lt mot_nc <span class="keyword1"><span class="command">have</span></span> marka_eq_mark<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mark</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">marka</span> <span class="skolem">n</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">from</span></span> marka_eq_mark True <span class="keyword1"><span class="command">have</span></span> n_marked<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mark</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">m</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">from</span></span> rt n_in_rt <span class="keyword1"><span class="command">have</span></span> nnN<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≠</span> Null"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_of_nn <span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">from</span></span> marked_child_ll n_in_rt marka_eq_mark nnN n_marked
              <span class="keyword1"><span class="command">have</span></span> n_in_ll<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">var</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
              <span class="keyword1"><span class="command">from</span></span> marked_child_ll n_in_rt marka_eq_mark nnN n_marked lt rt
              <span class="keyword1"><span class="command">have</span></span> nt_mark<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">nt</span> <span class="bound">p</span><span class="main">.</span> Dag <span class="skolem">n</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="bound">nt</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">∈</span> set_of <span class="bound">nt</span> <span class="main">⟶</span> <span class="skolem">mark</span> <span class="bound">p</span> <span class="main">=</span> <span class="skolem">m</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">from</span></span> nodes_in_lla n_in_ll lla_st
              <span class="keyword1"><span class="command">have</span></span> n_in_lla<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">lla</span> <span class="main">!</span> <span class="skolem">var</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="skolem">var</span> <span class="skolem">n</span><span class="main">)</span>"</span></span><span class="main">)</span>
                <span class="keyword3"><span class="command">case</span></span> True
                <span class="keyword1"><span class="command">with</span></span> lla_nc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">lla</span> <span class="main">!</span> <span class="skolem">var</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">var</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                <span class="keyword1"><span class="command">with</span></span> n_in_ll <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
              <span class="keyword1"><span class="command">next</span></span>
                <span class="keyword3"><span class="command">assume</span></span> varnslp<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">¬</span> <span class="skolem">var</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">n</span>"</span></span>
                <span class="keyword1"><span class="command">with</span></span> lla_st
                <span class="keyword1"><span class="command">have</span></span> ll_in_lla<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">prx</span><span class="main">.</span> <span class="skolem">lla</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">var</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="bound">prx</span> <span class="main">@</span> <span class="skolem">ll</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">var</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                <span class="keyword1"><span class="command">with</span></span> n_in_ll <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
              <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">{</span></span>
                <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">nt</span> <span class="skolem">pt</span>
                <span class="keyword3"><span class="command">assume</span></span> nt_Dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="skolem">n</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">nt</span>"</span></span>
                <span class="keyword3"><span class="command">assume</span></span> pt_in_nt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">pt</span> <span class="main">∈</span> set_of <span class="skolem">nt</span>"</span></span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">marka</span> <span class="skolem">pt</span> <span class="main">=</span> <span class="skolem">m</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">pt</span> <span class="main">∈</span> set_of <span class="skolem">lt</span>"</span></span><span class="main">)</span>
                  <span class="keyword3"><span class="command">case</span></span> True
                  <span class="keyword1"><span class="command">with</span></span> mit_marked <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                <span class="keyword1"><span class="command">next</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> pt_notin_lt<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">pt</span> <span class="main">∉</span> set_of <span class="skolem">lt</span>"</span></span>
                  <span class="keyword1"><span class="command">with</span></span> mot_nc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">mark</span> <span class="skolem">pt</span> <span class="main">=</span> <span class="skolem">marka</span> <span class="skolem">pt</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                  <span class="keyword1"><span class="command">with</span></span> nt_mark nt_Dag pt_in_nt <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">}</span></span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> nt_marka<span class="main">:</span>
                <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">nt</span> <span class="bound">pt</span><span class="main">.</span> Dag <span class="skolem">n</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="bound">nt</span> <span class="main">∧</span> <span class="bound">pt</span> <span class="main">∈</span> set_of <span class="bound">nt</span> <span class="main">⟶</span> <span class="skolem">marka</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">m</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
              <span class="keyword1"><span class="command">with</span></span> n_in_lla nt_marka True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">note</span></span> n_not_marka <span class="main">=</span> this
              <span class="keyword1"><span class="command">with</span></span> wfmarking_lt n_notin_lt
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">mark</span> <span class="skolem">n</span> <span class="main">≠</span> <span class="skolem">m</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_marking_def lt_Node<span class="main">)</span>
              <span class="keyword1"><span class="command">with</span></span> marked_child_ll
              <span class="keyword1"><span class="command">have</span></span> n_notin_ll<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∉</span> set <span class="main">(</span>concat <span class="skolem">ll</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> set <span class="main">(</span>concat <span class="skolem">lla</span><span class="main">)</span>"</span></span><span class="main">)</span>
                <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">with</span></span> n_not_marka <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">next</span></span>
                <span class="keyword3"><span class="command">case</span></span> True
                <span class="keyword1"><span class="command">with</span></span> wf_levellist_subset <span class="main">[</span><span class="operator">OF</span> wfll_lt<span class="main">]</span> n_notin_ll
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> set_of <span class="skolem">lt</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                <span class="keyword1"><span class="command">with</span></span> n_notin_lt <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI ordered_rt mark_rt<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">premises</span></span> prems <span class="keyword2"><span class="keyword">for</span></span> markb nextb levellistb llb
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> llb<span class="main">:</span> <span class="quoted"><span class="quoted">"Levellist <span class="skolem">levellistb</span> <span class="skolem">nextb</span> <span class="skolem">llb</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
            <span class="keyword1"><span class="command">have</span></span> wfll_rt<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_levellist <span class="skolem">rt</span> <span class="skolem">lla</span> <span class="skolem">llb</span> <span class="skolem">var</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
            <span class="keyword1"><span class="command">have</span></span> wfmarking_rt<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_marking <span class="skolem">rt</span> <span class="skolem">marka</span> <span class="skolem">markb</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">rt</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> Tip
              <span class="keyword1"><span class="command">from</span></span> wfll_rt Tip <span class="keyword1"><span class="command">have</span></span> lla_llb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lla</span> <span class="main">=</span> <span class="skolem">llb</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_levellist_def<span class="main">)</span>
              <span class="keyword1"><span class="command">moreover</span></span>
              <span class="keyword1"><span class="command">from</span></span> wfmarking_rt Tip rt <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">markb</span> <span class="main">=</span> <span class="skolem">marka</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_marking_def<span class="main">)</span>
              <span class="keyword1"><span class="command">moreover</span></span>
              <span class="keyword1"><span class="command">from</span></span> wfll_lt varsll llb lla_llb
              <span class="keyword3"><span class="command">obtain</span></span> var_p_bounds<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">p</span> <span class="main">&lt;</span> length <span class="skolem">levellistb</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">p</span> <span class="main">&lt;</span> length <span class="skolem">llb</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Levellist_length wf_levellist_def lt_Node Tip<span class="main">)</span>
              <span class="keyword1"><span class="command">with</span></span> p_notin_ll lla_llb wfll_lt
              <span class="keyword1"><span class="command">have</span></span> p_notin_llb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="skolem">llb</span><span class="main">.</span> <span class="skolem">p</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">llb</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_levellist_def lt_Node<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">i</span> <span class="main">≤</span> <span class="skolem">var</span> <span class="skolem">l</span>"</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
                <span class="keyword1"><span class="command">using</span></span>  orderedt Tip lt_Node
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">clarsimp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">with</span></span> llb pnN var_p_bounds
              <span class="keyword1"><span class="command">have</span></span> llc<span class="main">:</span> <span class="quoted"><span class="quoted">"Levellist <span class="main">(</span><span class="skolem">levellistb</span><span class="main">[</span><span class="skolem">var</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">p</span><span class="main">]</span><span class="main">)</span>
                            <span class="main">(</span><span class="skolem">nextb</span><span class="main">(</span><span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">levellistb</span> <span class="main">!</span> <span class="skolem">var</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>
                            <span class="main">(</span><span class="skolem">llb</span><span class="main">[</span><span class="skolem">var</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">p</span> <span class="main">#</span> <span class="skolem">llb</span> <span class="main">!</span> <span class="skolem">var</span> <span class="skolem">p</span><span class="main">]</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Levellist_def map_update<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">i</span><span class="main">=</span><span class="skolem">var</span> <span class="skolem">p</span>"</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">simp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">using</span></span> Tip lt_Node varsll orderedt lt rt pnN wfll_lt wfmarking_lt
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_levellist_def wf_marking_def<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">q</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">p</span> <span class="main">=</span> <span class="skolem">var</span> <span class="improper">q</span>"</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="operator">fastforce</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="operator">fastforce</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">p</span> <span class="main">=</span> <span class="skolem">var</span> <span class="improper">q</span>"</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="operator">hypsubst_thin</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="operator">fastforce</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">fastforce</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rotate_tac</span> 4<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">i</span><span class="main">=</span><span class="skolem">var</span> <span class="skolem">p</span>"</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">simp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">&lt;</span> <span class="improper">i</span>"</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">simp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">prx</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">simp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rotate_tac</span> 15<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">pt</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">fastforce</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">lrt</span> <span class="skolem">r</span> <span class="skolem">rrt</span><span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> rt_Node<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rt</span> <span class="main">=</span> Node <span class="skolem">lrt</span> <span class="skolem">r</span> <span class="skolem">rrt</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
              <span class="keyword1"><span class="command">from</span></span> wfll_rt rt_Node
              <span class="keyword1"><span class="command">have</span></span> llb_eq_lla<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">llb</span> <span class="main">=</span> length <span class="skolem">lla</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_levellist_def<span class="main">)</span>
              <span class="keyword1"><span class="command">with</span></span> llb lla
              <span class="keyword1"><span class="command">have</span></span> llb_eq_lla'<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">levellistb</span> <span class="main">=</span> length <span class="skolem">levellista</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Levellist_length<span class="main">)</span>
              <span class="keyword1"><span class="command">from</span></span> wfll_rt rt_Node
              <span class="keyword1"><span class="command">have</span></span> nodes_in_llb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">∈</span> set_of <span class="skolem">rt</span> <span class="main">⟶</span> <span class="bound">q</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">llb</span> <span class="main">!</span> <span class="main">(</span><span class="bound">q</span><span class="main">→</span><span class="skolem">var</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_levellist_def<span class="main">)</span>
              <span class="keyword1"><span class="command">from</span></span> wfll_rt rt_Node rt
              <span class="keyword1"><span class="command">have</span></span> llb_st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">p</span><span class="main">)</span><span class="main">→</span><span class="skolem">var</span><span class="main">.</span>
                             <span class="main">(</span><span class="main">∃</span> <span class="bound">prx</span><span class="main">.</span> <span class="main">(</span><span class="skolem">llb</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="bound">prx</span><span class="main">@</span><span class="main">(</span><span class="skolem">lla</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∧</span>
                             <span class="main">(</span><span class="main">∀</span><span class="bound">pt</span> <span class="main">∈</span> set <span class="bound">prx</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∈</span> set_of <span class="skolem">rt</span> <span class="main">∧</span> <span class="bound">pt</span><span class="main">→</span><span class="skolem">var</span> <span class="main">=</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_levellist_def<span class="main">)</span>
              <span class="keyword1"><span class="command">from</span></span> wfll_rt rt_Node rt
              <span class="keyword1"><span class="command">have</span></span> llb_nc<span class="main">:</span>
                <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">high</span> <span class="skolem">p</span><span class="main">)</span><span class="main">→</span><span class="skolem">var</span><span class="main">)</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">llb</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">lla</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_levellist_def<span class="main">)</span>
              <span class="keyword1"><span class="command">from</span></span> wfmarking_rt rt_Node rt
              <span class="keyword1"><span class="command">have</span></span> mort_nc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">∉</span> set_of <span class="skolem">rt</span> <span class="main">⟶</span> <span class="skolem">marka</span> <span class="bound">n</span> <span class="main">=</span> <span class="skolem">markb</span> <span class="bound">n</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_marking_def<span class="main">)</span>
              <span class="keyword1"><span class="command">from</span></span> wfmarking_rt rt_Node rt
              <span class="keyword1"><span class="command">have</span></span> mirt_marked<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">∈</span> set_of <span class="skolem">rt</span> <span class="main">⟶</span> <span class="skolem">markb</span> <span class="bound">n</span> <span class="main">=</span> <span class="skolem">m</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_marking_def<span class="main">)</span>
              <span class="keyword1"><span class="command">with</span></span> p_notin_ll wfll_rt wfll_lt
              <span class="keyword1"><span class="command">have</span></span> p_notin_llb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="skolem">llb</span><span class="main">.</span> <span class="skolem">p</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">llb</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_levellist_def lt_Node rt_Node<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">i</span> <span class="main">≤</span> <span class="skolem">var</span> <span class="skolem">r</span>"</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
                <span class="keyword1"><span class="command">using</span></span>  orderedt rt_Node lt_Node
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">clarsimp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="operator">clarsimp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">i</span> <span class="main">≤</span> <span class="skolem">var</span> <span class="skolem">l</span>"</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="operator">clarsimp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">clarsimp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">llb</span> <span class="main">!</span> <span class="improper">i</span> <span class="main">=</span> <span class="skolem">lla</span> <span class="main">!</span> <span class="improper">i</span>"</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">clarsimp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">i</span> <span class="main">≤</span> <span class="skolem">var</span> <span class="skolem">l</span>"</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> impE<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">clarsimp</span>
                <span class="keyword1"><span class="command">using</span></span>  orderedt rt_Node lt_Node
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">clarsimp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">from</span></span> wfll_lt wfll_rt varsll lla llb
              <span class="keyword3"><span class="command">obtain</span></span> var_p_bounds<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">p</span> <span class="main">&lt;</span> length <span class="skolem">levellistb</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">p</span> <span class="main">&lt;</span> length <span class="skolem">llb</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Levellist_length wf_levellist_def lt_Node rt_Node<span class="main">)</span>
              <span class="keyword1"><span class="command">with</span></span> p_notin_llb llb pnN var_p_bounds
              <span class="keyword1"><span class="command">have</span></span> llc<span class="main">:</span> <span class="quoted"><span class="quoted">"Levellist <span class="main">(</span><span class="skolem">levellistb</span><span class="main">[</span><span class="skolem">var</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">p</span><span class="main">]</span><span class="main">)</span>
                            <span class="main">(</span><span class="skolem">nextb</span><span class="main">(</span><span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">levellistb</span> <span class="main">!</span> <span class="skolem">var</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>
                            <span class="main">(</span><span class="skolem">llb</span><span class="main">[</span><span class="skolem">var</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">p</span> <span class="main">#</span> <span class="skolem">llb</span> <span class="main">!</span> <span class="skolem">var</span> <span class="skolem">p</span><span class="main">]</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Levellist_def map_update<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">i</span><span class="main">=</span><span class="skolem">var</span> <span class="skolem">p</span>"</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">simp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"wf_levellist <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span><span class="main">)</span> <span class="skolem">ll</span> <span class="main">(</span><span class="skolem">llb</span><span class="main">[</span><span class="skolem">var</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">p</span><span class="main">#</span><span class="skolem">llb</span> <span class="main">!</span> <span class="skolem">var</span> <span class="skolem">p</span><span class="main">]</span><span class="main">)</span> <span class="skolem">var</span> <span class="main">∧</span>
                      wf_marking <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span><span class="main">)</span> <span class="skolem">mark</span> <span class="main">(</span><span class="skolem">markb</span><span class="main">(</span><span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="skolem">m</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                  <span class="keyword1"><span class="command">have</span></span> nodes_in_upllb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">∈</span> set_of <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span><span class="main">)</span>
                    <span class="main">⟶</span> <span class="bound">q</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">llb</span><span class="main">[</span><span class="skolem">var</span> <span class="skolem">p</span> <span class="main">:=</span><span class="skolem">p</span> <span class="main">#</span> <span class="skolem">llb</span> <span class="main">!</span> <span class="skolem">var</span> <span class="skolem">p</span><span class="main">]</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">var</span> <span class="bound">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
                  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span>
                    <span class="keyword3"><span class="command">assume</span></span> q_in_t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set_of <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span><span class="main">)</span>"</span></span>
                    <span class="keyword3"><span class="command">show</span></span> q_in_upllb<span class="main">:</span>
                      <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">llb</span><span class="main">[</span><span class="skolem">var</span> <span class="skolem">p</span> <span class="main">:=</span><span class="skolem">p</span> <span class="main">#</span> <span class="skolem">llb</span> <span class="main">!</span> <span class="skolem">var</span> <span class="skolem">p</span><span class="main">]</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">var</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set_of <span class="skolem">rt</span>"</span></span><span class="main">)</span>
                      <span class="keyword3"><span class="command">case</span></span> True
                      <span class="keyword1"><span class="command">with</span></span> nodes_in_llb <span class="keyword1"><span class="command">have</span></span> q_in_llb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">llb</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">var</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                      <span class="keyword1"><span class="command">from</span></span> orderedt rt_Node lt_Node lt rt
                      <span class="keyword1"><span class="command">have</span></span> ordered_rt<span class="main">:</span> <span class="quoted"><span class="quoted">"ordered <span class="skolem">rt</span> <span class="skolem">var</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                      <span class="keyword1"><span class="command">from</span></span> True rt ordered_rt rt_Node lt lt_Node <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">q</span> <span class="main">≤</span> <span class="skolem">var</span> <span class="skolem">r</span>"</span></span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> subnodes_ordered<span class="main">)</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                      <span class="keyword1"><span class="command">with</span></span> orderedt rt lt rt_Node lt_Node <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">q</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">p</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span>
                        <span class="quoted"><span class="quoted">"<span class="skolem">llb</span><span class="main">[</span><span class="skolem">var</span> <span class="skolem">p</span> <span class="main">:=</span><span class="skolem">p</span><span class="main">#</span><span class="skolem">llb</span> <span class="main">!</span> <span class="skolem">var</span> <span class="skolem">p</span><span class="main">]</span> <span class="main">!</span> <span class="skolem">var</span> <span class="skolem">q</span> <span class="main">=</span>
                         <span class="skolem">llb</span> <span class="main">!</span> <span class="skolem">var</span> <span class="skolem">q</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                      <span class="keyword1"><span class="command">with</span></span> q_in_llb <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                    <span class="keyword1"><span class="command">next</span></span>
                      <span class="keyword3"><span class="command">assume</span></span> q_notin_rt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∉</span> set_of <span class="skolem">rt</span>"</span></span>
                      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">llb</span><span class="main">[</span><span class="skolem">var</span> <span class="skolem">p</span> <span class="main">:=</span><span class="skolem">p</span> <span class="main">#</span> <span class="skolem">llb</span> <span class="main">!</span> <span class="skolem">var</span> <span class="skolem">p</span><span class="main">]</span> <span class="main">!</span> <span class="skolem">var</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set_of <span class="skolem">lt</span>"</span></span><span class="main">)</span>
                        <span class="keyword3"><span class="command">case</span></span> True
                        <span class="keyword3"><span class="command">assume</span></span> q_in_lt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set_of <span class="skolem">lt</span>"</span></span>
                        <span class="keyword1"><span class="command">with</span></span> nodes_in_lla <span class="keyword1"><span class="command">have</span></span> q_in_lla<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">lla</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">var</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
                          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                        <span class="keyword1"><span class="command">from</span></span> orderedt rt_Node lt_Node lt rt
                        <span class="keyword1"><span class="command">have</span></span> ordered_lt<span class="main">:</span> <span class="quoted"><span class="quoted">"ordered <span class="skolem">lt</span> <span class="skolem">var</span>"</span></span>
                          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                        <span class="keyword1"><span class="command">from</span></span> q_in_lt lt ordered_lt rt_Node rt lt_Node
                        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">q</span> <span class="main">≤</span> <span class="skolem">var</span> <span class="skolem">l</span>"</span></span>
                          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> subnodes_ordered<span class="main">)</span>
                          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
                          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
                          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
                          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                        <span class="keyword1"><span class="command">with</span></span> orderedt rt lt rt_Node lt_Node <span class="keyword1"><span class="command">have</span></span> qsp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">q</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">p</span>"</span></span>
                          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">q</span> <span class="main">≤</span> <span class="skolem">var</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">p</span><span class="main">)</span>"</span></span><span class="main">)</span>
                          <span class="keyword3"><span class="command">case</span></span> True
                          <span class="keyword1"><span class="command">with</span></span> llb_st
                          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">prx</span><span class="main">.</span> <span class="main">(</span><span class="skolem">llb</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">var</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="bound">prx</span><span class="main">@</span><span class="main">(</span><span class="skolem">lla</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">var</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
                            <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                          <span class="keyword1"><span class="command">with</span></span> nodes_in_lla q_in_lla
                          <span class="keyword1"><span class="command">have</span></span> q_in_llb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">llb</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">var</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
                            <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                          <span class="keyword1"><span class="command">from</span></span> qsp
                          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">llb</span><span class="main">[</span><span class="skolem">var</span> <span class="skolem">p</span> <span class="main">:=</span><span class="skolem">p</span><span class="main">#</span><span class="skolem">llb</span> <span class="main">!</span> <span class="skolem">var</span> <span class="skolem">p</span><span class="main">]</span><span class="main">!</span><span class="skolem">var</span> <span class="skolem">q</span> <span class="main">=</span>
                                   <span class="skolem">llb</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">var</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
                            <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                          <span class="keyword1"><span class="command">with</span></span> q_in_llb <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                            <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                        <span class="keyword1"><span class="command">next</span></span>
                          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">var</span> <span class="skolem">q</span> <span class="main">≤</span> <span class="skolem">var</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
                          <span class="keyword1"><span class="command">with</span></span> llb_nc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">llb</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">var</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">lla</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">var</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
                            <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                          <span class="keyword1"><span class="command">with</span></span> q_in_lla <span class="keyword1"><span class="command">have</span></span> q_in_llb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">llb</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">var</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
                            <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                          <span class="keyword1"><span class="command">from</span></span> qsp <span class="keyword1"><span class="command">have</span></span>
                            <span class="quoted"><span class="quoted">"<span class="skolem">llb</span><span class="main">[</span><span class="skolem">var</span> <span class="skolem">p</span> <span class="main">:=</span><span class="skolem">p</span> <span class="main">#</span> <span class="skolem">llb</span> <span class="main">!</span> <span class="skolem">var</span> <span class="skolem">p</span><span class="main">]</span> <span class="main">!</span> <span class="skolem">var</span> <span class="skolem">q</span> <span class="main">=</span> <span class="skolem">llb</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">var</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
                            <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                          <span class="keyword1"><span class="command">with</span></span> q_in_llb <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                            <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                        <span class="keyword1"><span class="command">qed</span></span>
                      <span class="keyword1"><span class="command">next</span></span>
                        <span class="keyword3"><span class="command">assume</span></span> q_notin_lt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∉</span> set_of <span class="skolem">lt</span>"</span></span>
                        <span class="keyword1"><span class="command">with</span></span> q_notin_rt rt lt rt_Node lt_Node q_in_t <span class="keyword1"><span class="command">have</span></span> qp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span>
                          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                        <span class="keyword1"><span class="command">with</span></span> varsll lla_eq_ll llb_eq_lla <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">p</span> <span class="main">&lt;</span> length <span class="skolem">llb</span>"</span></span>
                          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                        <span class="keyword1"><span class="command">with</span></span> qp <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command">qed</span></span>
                    <span class="keyword1"><span class="command">qed</span></span>
                  <span class="keyword1"><span class="command">qed</span></span>
                  <span class="keyword1"><span class="command">have</span></span> prx_ll_st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">≤</span> <span class="skolem">var</span> <span class="skolem">p</span><span class="main">.</span>
                   <span class="main">(</span><span class="main">∃</span><span class="bound">prx</span><span class="main">.</span> <span class="skolem">llb</span><span class="main">[</span><span class="skolem">var</span> <span class="skolem">p</span> <span class="main">:=</span><span class="skolem">p</span><span class="main">#</span><span class="skolem">llb</span><span class="main">!</span><span class="skolem">var</span> <span class="skolem">p</span><span class="main">]</span><span class="main">!</span><span class="bound">i</span> <span class="main">=</span> <span class="bound">prx</span><span class="main">@</span><span class="main">(</span><span class="skolem">ll</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">∧</span>
                         <span class="main">(</span><span class="main">∀</span><span class="bound">pt</span> <span class="main">∈</span> set <span class="bound">prx</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∈</span> set_of <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">var</span> <span class="bound">pt</span> <span class="main">=</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
                  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
                    <span class="keyword3"><span class="command">assume</span></span> isep<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">var</span> <span class="skolem">p</span>"</span></span>
                    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">prx</span><span class="main">.</span> <span class="skolem">llb</span><span class="main">[</span><span class="skolem">var</span> <span class="skolem">p</span> <span class="main">:=</span><span class="skolem">p</span><span class="main">#</span><span class="skolem">llb</span><span class="main">!</span><span class="skolem">var</span> <span class="skolem">p</span><span class="main">]</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="bound">prx</span><span class="main">@</span><span class="skolem">ll</span><span class="main">!</span><span class="skolem">i</span> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">∀</span><span class="bound">pt</span><span class="main">∈</span>set <span class="bound">prx</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∈</span> set_of <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">var</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="skolem">var</span> <span class="skolem">p</span>"</span></span><span class="main">)</span>
                      <span class="keyword3"><span class="command">case</span></span> True
                      <span class="keyword1"><span class="command">with</span></span> orderedt lt lt_Node rt rt_Node
                      <span class="keyword1"><span class="command">have</span></span> lpsp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">p</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                      <span class="keyword1"><span class="command">with</span></span> orderedt lt lt_Node rt rt_Node
                      <span class="keyword1"><span class="command">have</span></span> hpsp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">p</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                      <span class="keyword1"><span class="command">with</span></span> lpsp lla_nc
                      <span class="keyword1"><span class="command">have</span></span> llall<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lla</span> <span class="main">!</span> <span class="skolem">var</span> <span class="skolem">p</span> <span class="main">=</span> <span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">var</span> <span class="skolem">p</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                      <span class="keyword1"><span class="command">with</span></span> hpsp llb_nc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">llb</span> <span class="main">!</span> <span class="skolem">var</span> <span class="skolem">p</span> <span class="main">=</span> <span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">var</span> <span class="skolem">p</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                      <span class="keyword1"><span class="command">with</span></span> llb_eq_lla lla_eq_ll isep True varsll lt rt <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">p</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                    <span class="keyword1"><span class="command">next</span></span>
                      <span class="keyword3"><span class="command">assume</span></span> inp<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">var</span> <span class="skolem">p</span>"</span></span>
                      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span><span class="main">)</span>
                        <span class="keyword3"><span class="command">case</span></span> True
                        <span class="keyword1"><span class="command">with</span></span> lla_nc <span class="keyword1"><span class="command">have</span></span> llall<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lla</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span>
                          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                        <span class="keyword3"><span class="command">assume</span></span> vpsi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span>
                        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span><span class="main">)</span>
                          <span class="keyword3"><span class="command">case</span></span> True
                          <span class="keyword1"><span class="command">with</span></span> llall llb_nc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">llb</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span>
                            <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                          <span class="keyword1"><span class="command">with</span></span> inp True vpsi varsll lt rt <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
                            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
                            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
                            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
                            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                        <span class="keyword1"><span class="command">next</span></span>
                          <span class="keyword3"><span class="command">assume</span></span> isehp<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">¬</span> <span class="skolem">var</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span>
                          <span class="keyword1"><span class="command">with</span></span> vpsi lla_nc <span class="keyword1"><span class="command">have</span></span> lla_ll<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lla</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span>
                            <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                          <span class="keyword1"><span class="command">with</span></span> isehp llb_st
                          <span class="keyword1"><span class="command">have</span></span> prx_lla<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">prx</span><span class="main">.</span> <span class="skolem">llb</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="bound">prx</span> <span class="main">@</span> <span class="skolem">lla</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">∧</span>
                            <span class="main">(</span><span class="main">∀</span><span class="bound">pt</span><span class="main">∈</span>set <span class="bound">prx</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∈</span> set_of <span class="skolem">rt</span> <span class="main">∧</span> <span class="skolem">var</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
                            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
                            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                          <span class="keyword1"><span class="command">with</span></span> lla_ll inp rt <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
                            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">prx</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
                            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                        <span class="keyword1"><span class="command">qed</span></span>
                      <span class="keyword1"><span class="command">next</span></span>
                        <span class="keyword3"><span class="command">assume</span></span> iselp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">var</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span>
                        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span><span class="main">)</span>
                          <span class="keyword3"><span class="command">case</span></span> True
                          <span class="keyword1"><span class="command">with</span></span> llb_nc <span class="keyword1"><span class="command">have</span></span> llb_ll<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">llb</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">lla</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span>
                            <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                          <span class="keyword1"><span class="command">with</span></span> iselp lla_st
                          <span class="keyword1"><span class="command">have</span></span> prx_ll<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">prx</span><span class="main">.</span> <span class="skolem">lla</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="bound">prx</span> <span class="main">@</span> <span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">∧</span>
                            <span class="main">(</span><span class="main">∀</span><span class="bound">pt</span><span class="main">∈</span>set <span class="bound">prx</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∈</span> set_of <span class="skolem">lt</span> <span class="main">∧</span> <span class="skolem">var</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
                            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
                            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                          <span class="keyword1"><span class="command">with</span></span> llb_ll inp lt <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
                            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">prx</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
                            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                        <span class="keyword1"><span class="command">next</span></span>
                          <span class="keyword3"><span class="command">assume</span></span> isehp<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">¬</span> <span class="skolem">var</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span>
                          <span class="keyword1"><span class="command">from</span></span> iselp lla_st
                          <span class="keyword1"><span class="command">have</span></span> prxl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">prx</span><span class="main">.</span> <span class="skolem">lla</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="bound">prx</span> <span class="main">@</span> <span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">∧</span>
                            <span class="main">(</span><span class="main">∀</span><span class="bound">pt</span><span class="main">∈</span>set <span class="bound">prx</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∈</span> set_of <span class="skolem">lt</span> <span class="main">∧</span> <span class="skolem">var</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
                            <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                          <span class="keyword1"><span class="command">from</span></span> isehp llb_st
                          <span class="keyword1"><span class="command">have</span></span> prxh<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">prx</span><span class="main">.</span> <span class="skolem">llb</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="bound">prx</span> <span class="main">@</span> <span class="skolem">lla</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">∧</span>
                            <span class="main">(</span><span class="main">∀</span><span class="bound">pt</span><span class="main">∈</span>set <span class="bound">prx</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∈</span> set_of <span class="skolem">rt</span> <span class="main">∧</span> <span class="skolem">var</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
                            <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                          <span class="keyword1"><span class="command">with</span></span> prxl inp lt pnN rt <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> exE<span class="main">)</span>
                            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">prxa</span> <span class="main">@</span> <span class="improper">prx</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
                            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> conjE<span class="main">)</span>
                            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
                            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                        <span class="keyword1"><span class="command">qed</span></span>
                      <span class="keyword1"><span class="command">qed</span></span>
                    <span class="keyword1"><span class="command">qed</span></span>
                  <span class="keyword1"><span class="command">qed</span></span>
                  <span class="keyword1"><span class="command">have</span></span> big_Nodes_nc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="skolem">p</span><span class="main">-&gt;</span><span class="skolem">var</span><span class="main">)</span> <span class="main">&lt;</span> <span class="bound">i</span>
                    <span class="main">⟶</span> <span class="main">(</span><span class="skolem">llb</span><span class="main">[</span><span class="skolem">var</span> <span class="skolem">p</span> <span class="main">:=</span><span class="skolem">p</span> <span class="main">#</span> <span class="skolem">llb</span> <span class="main">!</span> <span class="skolem">var</span> <span class="skolem">p</span><span class="main">]</span><span class="main">)</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="skolem">ll</span> <span class="main">!</span> <span class="bound">i</span>"</span></span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
                  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
                    <span class="keyword3"><span class="command">assume</span></span> psi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">p</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span>
                    <span class="keyword1"><span class="command">with</span></span> orderedt lt rt lt_Node rt_Node <span class="keyword1"><span class="command">have</span></span> lpsi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                    <span class="keyword1"><span class="command">with</span></span> lla_nc <span class="keyword1"><span class="command">have</span></span> lla_ll<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lla</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                    <span class="keyword1"><span class="command">from</span></span> psi orderedt lt rt lt_Node rt_Node <span class="keyword1"><span class="command">have</span></span> hpsi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                    <span class="keyword1"><span class="command">with</span></span> llb_nc <span class="keyword1"><span class="command">have</span></span> llb_lla<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">llb</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">lla</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                    <span class="keyword1"><span class="command">from</span></span> psi
                    <span class="keyword1"><span class="command">have</span></span> upllb_llb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">llb</span><span class="main">[</span><span class="skolem">var</span> <span class="skolem">p</span> <span class="main">:=</span><span class="skolem">p</span><span class="main">#</span><span class="skolem">llb</span><span class="main">!</span><span class="skolem">var</span> <span class="skolem">p</span><span class="main">]</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="skolem">llb</span><span class="main">!</span><span class="skolem">i</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                    <span class="keyword1"><span class="command">from</span></span> upllb_llb llb_lla lla_ll
                    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">llb</span><span class="main">[</span><span class="skolem">var</span> <span class="skolem">p</span> <span class="main">:=</span><span class="skolem">p</span> <span class="main">#</span> <span class="skolem">llb</span> <span class="main">!</span> <span class="skolem">var</span> <span class="skolem">p</span><span class="main">]</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                  <span class="keyword1"><span class="command">qed</span></span>
                  <span class="keyword1"><span class="command">from</span></span> lla_eq_ll llb_eq_lla
                  <span class="keyword1"><span class="command">have</span></span> length_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">llb</span><span class="main">[</span><span class="skolem">var</span> <span class="skolem">p</span> <span class="main">:=</span><span class="skolem">p</span> <span class="main">#</span> <span class="skolem">llb</span> <span class="main">!</span> <span class="skolem">var</span> <span class="skolem">p</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">ll</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                  <span class="keyword1"><span class="command">from</span></span> length_eq big_Nodes_nc prx_ll_st nodes_in_upllb
                  <span class="keyword1"><span class="command">have</span></span> wf_ll_upllb<span class="main">:</span>
                    <span class="quoted"><span class="quoted">"wf_levellist <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span><span class="main">)</span> <span class="skolem">ll</span> <span class="main">(</span><span class="skolem">llb</span><span class="main">[</span><span class="skolem">var</span> <span class="skolem">p</span> <span class="main">:=</span><span class="skolem">p</span> <span class="main">#</span> <span class="skolem">llb</span> <span class="main">!</span> <span class="skolem">var</span> <span class="skolem">p</span><span class="main">]</span><span class="main">)</span> <span class="skolem">var</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_levellist_def<span class="main">)</span>
                  <span class="keyword1"><span class="command">have</span></span> mark_nc<span class="main">:</span>
                    <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">∉</span> set_of <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">markb</span><span class="main">(</span><span class="skolem">p</span><span class="main">:=</span><span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="bound">n</span> <span class="main">=</span> <span class="skolem">mark</span> <span class="bound">n</span>"</span></span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
                  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
                    <span class="keyword3"><span class="command">assume</span></span> nnit<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∉</span> set_of <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">with</span></span> lt rt <span class="keyword1"><span class="command">have</span></span> nnilt<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">n</span> <span class="main">∉</span> set_of <span class="skolem">lt</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                    <span class="keyword1"><span class="command">from</span></span> nnit lt rt <span class="keyword1"><span class="command">have</span></span> nnirt<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">n</span> <span class="main">∉</span> set_of <span class="skolem">rt</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                    <span class="keyword1"><span class="command">with</span></span> nnilt mot_nc mort_nc <span class="keyword1"><span class="command">have</span></span> mb_eq_m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">markb</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">mark</span> <span class="skolem">n</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                    <span class="keyword1"><span class="command">from</span></span> nnit <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≠</span><span class="skolem">p</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> upmarkb_markb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">markb</span><span class="main">(</span><span class="skolem">p</span> <span class="main">:=</span><span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">markb</span> <span class="skolem">n</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                    <span class="keyword1"><span class="command">with</span></span> mb_eq_m <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">markb</span><span class="main">(</span><span class="skolem">p</span> <span class="main">:=</span><span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">mark</span> <span class="skolem">n</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                  <span class="keyword1"><span class="command">qed</span></span>
                  <span class="keyword1"><span class="command">have</span></span> mark_c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">∈</span> set_of <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">markb</span><span class="main">(</span><span class="skolem">p</span> <span class="main">:=</span><span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="bound">n</span> <span class="main">=</span> <span class="skolem">m</span>"</span></span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
                  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
                    <span class="keyword3"><span class="command">assume</span></span> nint<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">n</span> <span class="main">∈</span> set_of <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span><span class="main">)</span>"</span></span>
                    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">markb</span><span class="main">(</span><span class="skolem">p</span> <span class="main">:=</span><span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">m</span>"</span></span>
                    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">=</span><span class="skolem">p</span>"</span></span><span class="main">)</span>
                      <span class="keyword3"><span class="command">case</span></span> True
                      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                    <span class="keyword1"><span class="command">next</span></span>
                      <span class="keyword3"><span class="command">assume</span></span> nnp<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">n</span> <span class="main">≠</span> <span class="skolem">p</span>"</span></span>
                      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> set_of <span class="skolem">rt</span>"</span></span><span class="main">)</span>
                        <span class="keyword3"><span class="command">case</span></span> True
                        <span class="keyword1"><span class="command">with</span></span> mirt_marked <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">markb</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">m</span>"</span></span>
                          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                        <span class="keyword1"><span class="command">with</span></span> nnp <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                      <span class="keyword1"><span class="command">next</span></span>
                        <span class="keyword3"><span class="command">assume</span></span> nninrt<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">n</span> <span class="main">∉</span> set_of <span class="skolem">rt</span>"</span></span>
                        <span class="keyword1"><span class="command">with</span></span> nint nnp <span class="keyword1"><span class="command">have</span></span> ninlt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> set_of <span class="skolem">lt</span>"</span></span>
                          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                        <span class="keyword1"><span class="command">with</span></span> mit_marked <span class="keyword1"><span class="command">have</span></span> marka_m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">marka</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">m</span>"</span></span>
                          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                        <span class="keyword1"><span class="command">from</span></span> mort_nc nninrt <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">marka</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">markb</span> <span class="skolem">n</span>"</span></span>
                          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                        <span class="keyword1"><span class="command">with</span></span> marka_m <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">markb</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">m</span>"</span></span>
                          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                        <span class="keyword1"><span class="command">with</span></span> nnp <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                      <span class="keyword1"><span class="command">qed</span></span>
                    <span class="keyword1"><span class="command">qed</span></span>
                  <span class="keyword1"><span class="command">qed</span></span>
                  <span class="keyword1"><span class="command">from</span></span> mark_c mark_nc
                  <span class="keyword1"><span class="command">have</span></span> wf_mark<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_marking <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span><span class="main">)</span> <span class="skolem">mark</span> <span class="main">(</span><span class="skolem">markb</span><span class="main">(</span><span class="skolem">p</span> <span class="main">:=</span><span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="skolem">m</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_marking_def<span class="main">)</span>
                  <span class="keyword1"><span class="command">with</span></span> wf_ll_upllb <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">var</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">p</span> <span class="skolem">lt</span> <span class="skolem">rt</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">levellist</span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="skolem">ll</span><span class="main">::</span><span class="quoted"><span class="quoted">"ref list list"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">mark</span><span class="main">::</span><span class="quoted"><span class="quoted">"ref <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted">"<span class="skolem">next</span>"</span>
  <span class="keyword3"><span class="command">assume</span></span> pnN<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> Null"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> ll<span class="main">:</span> <span class="quoted"><span class="quoted">"Levellist <span class="skolem">levellist</span> <span class="skolem">next</span> <span class="skolem">ll</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> vpsll<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">p</span> <span class="main">&lt;</span> length <span class="skolem">levellist</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> orderedt<span class="main">:</span> <span class="quoted"><span class="quoted">"ordered <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span><span class="main">)</span> <span class="skolem">var</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> marked_child_ll<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">∈</span>set_of <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span><span class="main">)</span><span class="main">.</span>
           <span class="keyword1">if</span> <span class="skolem">mark</span> <span class="bound">n</span> <span class="main">=</span> <span class="skolem">mark</span> <span class="skolem">p</span>
           <span class="keyword1">then</span> <span class="bound">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">var</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span>
                <span class="main">(</span><span class="main">∀</span><span class="bound">nt</span> <span class="bound">pa</span><span class="main">.</span> Dag <span class="bound">n</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="bound">nt</span> <span class="main">∧</span> <span class="bound">pa</span> <span class="main">∈</span> set_of <span class="bound">nt</span> <span class="main">⟶</span> <span class="skolem">mark</span> <span class="bound">pa</span> <span class="main">=</span> <span class="skolem">mark</span> <span class="skolem">p</span><span class="main">)</span>
           <span class="keyword1">else</span> <span class="bound">n</span> <span class="main">∉</span> set <span class="main">(</span>concat <span class="skolem">ll</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> lt<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">low</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">lt</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> rt<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">high</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">rt</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"wf_levellist <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span><span class="main">)</span> <span class="skolem">ll</span> <span class="skolem">ll</span> <span class="skolem">var</span> <span class="main">∧</span>
        wf_marking <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span><span class="main">)</span> <span class="skolem">mark</span> <span class="skolem">mark</span> <span class="main">(</span><span class="skolem">mark</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> marked_child_ll pnN lt rt <span class="keyword1"><span class="command">have</span></span> marked_st<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">pa</span><span class="main">.</span> <span class="bound">pa</span> <span class="main">∈</span> set_of <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span><span class="main">)</span> <span class="main">⟶</span> <span class="skolem">mark</span> <span class="bound">pa</span> <span class="main">=</span> <span class="skolem">mark</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">have</span></span> nodest_in_ll<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">∈</span> set_of <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">q</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">var</span> <span class="bound">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> marked_child_ll pnN <span class="keyword1"><span class="command">have</span></span> pinll<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">var</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">from</span></span> marked_st marked_child_ll lt rt <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">q</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">assumption</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">q</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> levellist_nc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">≤</span> <span class="skolem">var</span> <span class="skolem">p</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">prx</span><span class="main">.</span> <span class="skolem">ll</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="bound">prx</span><span class="main">@</span><span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">(</span><span class="main">∀</span> <span class="bound">pt</span> <span class="main">∈</span> set <span class="bound">prx</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∈</span> set_of <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">var</span> <span class="bound">pt</span> <span class="main">=</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">have</span></span> ll_nc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="skolem">var</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">⟶</span> <span class="skolem">ll</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="skolem">ll</span> <span class="main">!</span> <span class="bound">i</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> length_ll<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">ll</span> <span class="main">=</span> length <span class="skolem">ll</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">with</span></span> ll_nc levellist_nc nodest_in_ll
    <span class="keyword1"><span class="command">have</span></span> wf<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_levellist <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span><span class="main">)</span> <span class="skolem">ll</span> <span class="skolem">ll</span> <span class="skolem">var</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_levellist_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> m_nc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">∉</span> set_of <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span><span class="main">)</span> <span class="main">⟶</span> <span class="skolem">mark</span> <span class="bound">n</span> <span class="main">=</span> <span class="skolem">mark</span> <span class="bound">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">from</span></span> marked_st <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">∈</span> set_of <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span><span class="main">)</span> <span class="main">⟶</span> <span class="skolem">mark</span> <span class="bound">n</span> <span class="main">=</span> <span class="skolem">mark</span> <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">with</span></span> m_nc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" wf_marking <span class="main">(</span>Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span><span class="main">)</span> <span class="skolem">mark</span> <span class="skolem">mark</span> <span class="main">(</span><span class="skolem">mark</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_marking_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> wf <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LevellistProof-allD"><span class="command">lemma</span></span> allD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ll</span><span class="main">.</span> <span class="free">P</span> <span class="bound">ll</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">ll</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="LevellistProof-replicate_spec"><span class="command">lemma</span></span> replicate_spec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">.</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">x</span><span class="main">;</span> <span class="free">n</span><span class="main">=</span>length <span class="free">xs</span><span class="main">⟧</span>
  <span class="main">⟹</span> replicate <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">hypsubst_thin</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Levellist_impl<span class="main">)</span> Levellist_spec_total<span class="main">:</span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">σ</span> <span class="bound">t</span><span class="main">.</span> <span class="free">Γ</span><span class="main">,</span><span class="free">Θ</span><span class="keyword1">⊢<span class="hidden">⇩</span><sub>t</sub></span>
        <span class="main">⦃</span><span class="bound">σ</span><span class="main">.</span> Dag <span class="main">´</span>p <span class="main">´</span>low <span class="main">´</span>high <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="main">´</span>levellist<span class="main">.</span> <span class="main">´</span>levellist <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> Null<span class="main">)</span> <span class="main">∧</span>
             length <span class="main">´</span>levellist  <span class="main">=</span> <span class="main">´</span>p <span class="main">→</span> <span class="main">´</span>var <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span>
             ordered <span class="bound">t</span> <span class="main">´</span>var <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> set_of <span class="bound">t</span><span class="main">.</span> <span class="main">´</span>mark <span class="bound">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="main">´</span>m<span class="main">)</span> <span class="main">)</span><span class="main">⦄</span>
          <span class="main">´</span>levellist <span class="main">:==</span> <span class="keyword1">PROC</span> Levellist <span class="main">(</span><span class="main">´</span>p<span class="main">,</span> <span class="main">´</span>m<span class="main">,</span> <span class="main">´</span>levellist<span class="main">)</span>
       <span class="main">⦃</span><span class="main">∃</span><span class="bound">ll</span><span class="main">.</span> Levellist <span class="main">´</span>levellist <span class="main">´</span>next <span class="bound">ll</span> <span class="main">∧</span> wf_ll <span class="bound">t</span> <span class="bound">ll</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>var  <span class="main">∧</span>
         length <span class="main">´</span>levellist <span class="main">=</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>p <span class="main">→</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>var <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span>
         wf_marking <span class="bound">t</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>mark <span class="main">´</span>mark <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>m <span class="main">∧</span>
         <span class="main">(</span><span class="main">∀</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∉</span> set_of <span class="bound">t</span> <span class="main">⟶</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>next <span class="bound">p</span> <span class="main">=</span> <span class="main">´</span>next <span class="bound">p</span><span class="main">)</span><span class="main">⦄</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">hoare_rule</span> HoareTotal.conseq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">rule_tac</span> ll<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"replicate <span class="main">(</span><span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>p<span class="main">→</span><span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>var <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> Levellist_spec_total'<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">σ</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_split_asm <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> concat_replicate_trivial<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">frule</span> replicate_spec <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Levellist_def <span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">i</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Collect_conv_if <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_split_asm<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">vcg_step</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> exE conjE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">ll'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∉</span> set_of <span class="improper">t</span> <span class="main">⟶</span> <span class="improper">next</span> <span class="bound">p</span> <span class="main">=</span> <span class="improper">nexta</span> <span class="bound">p</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_levellist_def wf_ll_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">t</span> <span class="main">=</span> Tip"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">k</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"length <span class="improper">ll'</span><span class="main">=</span>Suc <span class="main">(</span><span class="improper">var</span> Null<span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Levellist_length<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> dag.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> conjE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">pa</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="operator">clarify</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Levellist_length<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rotate_tac</span> 11<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> dag1 ref dag2 k pa<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">k</span> <span class="main">&lt;=</span> <span class="improper">var</span> <span class="improper">ref</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">ref</span> <span class="main">=</span> <span class="improper">p</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">clarify</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">erule_tac</span> <span class="var">?P</span> <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"Dag <span class="improper">p</span> <span class="improper">low</span> <span class="improper">high</span> <span class="main">(</span>Node <span class="improper">dag1</span> <span class="improper">ref</span> <span class="improper">dag2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> rev_mp<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rotate_tac</span> 14<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">k</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">k</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">k</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="ShareRepProof">
<div class="head">
<h1>Theory ShareRepProof</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       BDD

    Author:      Veronika Ortner and Norbert Schirmer, 2004
    Maintainer:  Norbert Schirmer,  norbert.schirmer at web de
    License:     LGPL
*)</span>

<span class="comment1">(*  
ShareRepProof.thy

Copyright (C) 2004-2008 Veronika Ortner and Norbert Schirmer 
Some rights reserved, TU Muenchen

This library is free software; you can redistribute it and/or modify
it under the terms of the GNU Lesser General Public License as
published by the Free Software Foundation; either version 2.1 of the
License, or (at your option) any later version.

This library is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
Lesser General Public License for more details.

You should have received a copy of the GNU Lesser General Public
License along with this library; if not, write to the Free Software
Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307
USA
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Proof of Procedure ShareRep›</span></span>
<span class="keyword1"><span class="command">theory</span></span> ShareRepProof <span class="keyword2"><span class="keyword">imports</span></span> <a href="ProcedureSpecs.html">ProcedureSpecs</a> <a href="../Simpl/HeapList.html">Simpl.HeapList</a> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ShareRep_impl<span class="main">)</span> ShareRep_modifies<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">σ</span><span class="main">.</span> <span class="free">Γ</span><span class="main">⊢</span><span class="main">{</span><span class="bound">σ</span><span class="main">}</span>  <span class="keyword1">PROC</span> ShareRep <span class="main">(</span><span class="main">´</span>nodeslist<span class="main">,</span> <span class="main">´</span>p<span class="main">)</span> 
             <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="keyword1">may_only_modify_globals</span> <span class="bound">σ</span> <span class="keyword1">in</span> <span class="main">[</span>rep<span class="main">]</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">hoare_rule</span> HoarePartial.ProcRec1<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">vcg</span> spec<span class="main"><span class="main">=</span></span>modifies<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1" id="ShareRepProof-hd_filter_cons"><span class="command">lemma</span></span> hd_filter_cons<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> <span class="main">⟦</span> <span class="free">P</span> <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="free">p</span><span class="main">;</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">xs</span><span class="main">;</span> <span class="main">∀</span> <span class="bound">no</span> <span class="main">∈</span> set <span class="main">(</span>take <span class="bound">i</span> <span class="free">xs</span><span class="main">)</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">no</span> <span class="free">p</span><span class="main">;</span> <span class="main">∀</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span>  <span class="free">P</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">=</span> <span class="free">P</span> <span class="bound">b</span> <span class="bound">a</span><span class="main">⟧</span>
  <span class="main">⟹</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> hd <span class="main">(</span>filter <span class="main">(</span><span class="free">P</span> <span class="free">p</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="improper">a</span> <span class="free">p</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">i</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">i</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ShareRep_impl<span class="main">)</span> ShareRep_spec_total<span class="main">:</span>
<span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">σ</span> <span class="bound">ns</span><span class="main">.</span> <span class="free">Γ</span><span class="main">,</span><span class="free">Θ</span><span class="keyword1">⊢<span class="hidden">⇩</span><sub>t</sub></span> 
  <span class="main">⦃</span><span class="bound">σ</span><span class="main">.</span> List <span class="main">´</span>nodeslist <span class="main">´</span>next <span class="bound">ns</span> <span class="main">∧</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">no</span> <span class="main">∈</span> set <span class="bound">ns</span><span class="main">.</span> <span class="bound">no</span> <span class="main">≠</span> Null  <span class="main">∧</span> 
       <span class="main">(</span><span class="main">(</span><span class="bound">no</span><span class="main">→</span><span class="main">´</span>low <span class="main">=</span> Null<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">no</span><span class="main">→</span><span class="main">´</span>high <span class="main">=</span> Null<span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
       <span class="main">(</span>isLeaf_pt <span class="main">´</span>p <span class="main">´</span>low <span class="main">´</span>high <span class="main">⟶</span> isLeaf_pt <span class="bound">no</span> <span class="main">´</span>low <span class="main">´</span>high<span class="main">)</span> <span class="main">∧</span>
       <span class="bound">no</span><span class="main">→</span><span class="main">´</span>var <span class="main">=</span> <span class="main">´</span>p<span class="main">→</span><span class="main">´</span>var<span class="main">)</span> <span class="main">∧</span> 
       <span class="main">´</span>p <span class="main">∈</span> set <span class="bound">ns</span><span class="main">⦄</span> 
  <span class="keyword1">PROC</span> ShareRep <span class="main">(</span><span class="main">´</span>nodeslist<span class="main">,</span> <span class="main">´</span>p<span class="main">)</span>
  <span class="main">⦃</span> <span class="main">(</span><span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>p <span class="main">→</span> <span class="main">´</span>rep <span class="main">=</span> hd <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span> <span class="bound">sn</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>p <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>low <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>high <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>rep<span class="main">)</span> <span class="bound">ns</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">pt</span><span class="main">.</span>  <span class="bound">pt</span> <span class="main">≠</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>p <span class="main">⟶</span> <span class="bound">pt</span><span class="main">→</span><span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>rep <span class="main">=</span> <span class="bound">pt</span><span class="main">→</span><span class="main">´</span>rep<span class="main">)</span> <span class="main">∧</span> 
    <span class="main">(</span><span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>p<span class="main">→</span><span class="main">´</span>rep<span class="main">→</span><span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>var <span class="main">=</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>p <span class="main">→</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>var<span class="main">)</span><span class="main">⦄</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">hoare_rule</span> HoareTotal.ProcNoRec1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">hoare_rule</span> anno<span class="main"><span class="main">=</span></span>  
  <span class="quoted"><span class="quoted">"<span class="keyword1">IF</span> <span class="main">(</span>isLeaf_pt <span class="main">´</span>p <span class="main">´</span>low <span class="main">´</span>high<span class="main">)</span> 
   <span class="keyword1">THEN</span> <span class="main">´</span>p <span class="main">→</span> <span class="main">´</span>rep <span class="main">:==</span> <span class="main">´</span>nodeslist
   <span class="keyword1">ELSE</span>
     <span class="keyword1">WHILE</span> <span class="main">(</span><span class="main">´</span>nodeslist <span class="main">≠</span> Null<span class="main">)</span>  
     <span class="keyword1">INV</span> <span class="main">⦃</span><span class="main">∃</span><span class="bound">prx</span> <span class="bound">sfx</span><span class="main">.</span> List <span class="main">´</span>nodeslist <span class="main">´</span>next <span class="bound">sfx</span> <span class="main">∧</span> <span class="improper">ns</span><span class="main">=</span><span class="bound">prx</span><span class="main">@</span><span class="bound">sfx</span> <span class="main">∧</span> 
           <span class="main">¬</span> isLeaf_pt <span class="main">´</span>p <span class="main">´</span>low <span class="main">´</span>high <span class="main">∧</span>
           <span class="main">(</span><span class="main">∀</span><span class="bound">no</span> <span class="main">∈</span> set <span class="improper">ns</span><span class="main">.</span> <span class="bound">no</span> <span class="main">≠</span> Null <span class="main">∧</span> 
             <span class="main">(</span><span class="main">(</span><span class="bound">no</span><span class="main">→</span><span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>low <span class="main">=</span> Null<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">no</span><span class="main">→</span><span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>high <span class="main">=</span> Null<span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
             <span class="main">(</span>isLeaf_pt <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>p <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>low <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>high <span class="main">⟶</span> isLeaf_pt <span class="bound">no</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>low <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>high<span class="main">)</span> <span class="main">∧</span>
             <span class="bound">no</span><span class="main">→</span><span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>var <span class="main">=</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>p<span class="main">→</span><span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>var<span class="main">)</span> <span class="main">∧</span> 
        <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>p <span class="main">∈</span> set <span class="improper">ns</span> <span class="main">∧</span> 
        <span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">pt</span> <span class="main">∈</span> set <span class="bound">prx</span><span class="main">.</span>  repNodes_eq <span class="bound">pt</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>p <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>low <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>high <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>rep<span class="main">)</span> 
         <span class="main">⟶</span> <span class="main">´</span>rep  <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>p <span class="main">=</span>  hd <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span> <span class="bound">sn</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>p <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>low <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>high <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>rep<span class="main">)</span> <span class="bound">prx</span><span class="main">)</span> <span class="main">∧</span>
             <span class="main">(</span><span class="main">∀</span><span class="bound">pt</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">≠</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>p <span class="main">⟶</span> <span class="bound">pt</span><span class="main">→</span><span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>rep <span class="main">=</span> <span class="bound">pt</span><span class="main">→</span><span class="main">´</span>rep<span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
        <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">pt</span> <span class="main">∈</span> set <span class="bound">prx</span><span class="main">.</span>  <span class="main">¬</span> repNodes_eq <span class="bound">pt</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>p <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>low <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>high <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>rep<span class="main">)</span> <span class="main">⟶</span>  <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>rep <span class="main">=</span> <span class="main">´</span>rep<span class="main">)</span> <span class="main">∧</span>
        <span class="main">(</span><span class="main">´</span>nodeslist <span class="main">≠</span> Null <span class="main">⟶</span> 
           <span class="main">(</span><span class="main">∀</span><span class="bound">pt</span> <span class="main">∈</span> set <span class="bound">prx</span><span class="main">.</span> <span class="main">¬</span> repNodes_eq <span class="bound">pt</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>p <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>low <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>high <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>rep<span class="main">)</span><span class="main">)</span> <span class="main">∧</span>  
        <span class="main">(</span><span class="main">´</span>p <span class="main">=</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>p <span class="main">∧</span> <span class="main">´</span>high <span class="main">=</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>high <span class="main">∧</span> <span class="main">´</span>low <span class="main">=</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>low<span class="main">)</span><span class="main">⦄</span>
     <span class="keyword1">VAR</span> <span class="keyword1">MEASURE</span> <span class="main">(</span>length <span class="main">(</span>list <span class="main">´</span>nodeslist <span class="main">´</span>next<span class="main">)</span><span class="main">)</span>  
     <span class="keyword1">DO</span>
       <span class="keyword1">IF</span> <span class="main">(</span>repNodes_eq <span class="main">´</span>nodeslist <span class="main">´</span>p <span class="main">´</span>low <span class="main">´</span>high <span class="main">´</span>rep<span class="main">)</span>
       <span class="keyword1">THEN</span> <span class="main">´</span>p<span class="main">→</span><span class="main">´</span>rep <span class="main">:==</span> <span class="main">´</span>nodeslist<span class="main">;;</span> <span class="main">´</span>nodeslist <span class="main">:==</span> Null
       <span class="keyword1">ELSE</span> <span class="main">´</span>nodeslist <span class="main">:==</span> <span class="main">´</span>nodeslist<span class="main">→</span><span class="main">´</span>next
       <span class="keyword1">FI</span>
     <span class="keyword1">OD</span>
  <span class="keyword1">FI</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> HoareTotal.annotateI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">vcg</span>
<span class="keyword1"><span class="command">using</span></span>  <span class="main">[</span><span class="main">[</span><span class="operator">simp_depth_limit</span> <span class="main"><span class="main">=</span></span> 2<span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="operator">clarify</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_use</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="operator">clarify</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">ns</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_use</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="operator">clarify</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="operator">clarify</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>     <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> List_list<span class="main">)</span> <span class="comment1">(* solving termination contraint *)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_use</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="operator">clarify</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_use</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> List_list<span class="main">)</span> <span class="comment1">(* solving termination constraint *)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> List_not_Null simp_thms triv_forall_equality<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="operator">clarify</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> triv_forall_equality<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="main">(</span><span class="operator">rename_tac</span> sfx<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">prx</span><span class="main">@</span><span class="main">[</span><span class="improper">nodeslist</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">sfx</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>     <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>     <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 4
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">elim</span> exE conjE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_use</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="operator">hypsubst</span>
<span class="keyword1"><span class="command">using</span></span>  <span class="main">[</span><span class="main">[</span><span class="operator">simp_depth_limit</span> <span class="main"><span class="main">=</span></span> 100<span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="comment1">(* IF-THEN to postcondition *)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ns</span> <span class="skolem">var</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">rep</span> <span class="quoted">"<span class="skolem">next</span>"</span> <span class="skolem">p</span> <span class="skolem">nodeslist</span>
  <span class="keyword3"><span class="command">assume</span></span> ns<span class="main">:</span> <span class="quoted"><span class="quoted">"List <span class="skolem">nodeslist</span> <span class="skolem">next</span> <span class="skolem">ns</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> no_prop<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set <span class="skolem">ns</span><span class="main">.</span>
           <span class="bound">no</span> <span class="main">≠</span> Null <span class="main">∧</span>
           <span class="main">(</span><span class="skolem">low</span> <span class="bound">no</span> <span class="main">=</span> Null<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">high</span> <span class="bound">no</span> <span class="main">=</span> Null<span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span>isLeaf_pt <span class="skolem">p</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="main">⟶</span> isLeaf_pt <span class="bound">no</span> <span class="skolem">low</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">var</span> <span class="bound">no</span> <span class="main">=</span> <span class="skolem">var</span> <span class="skolem">p</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> p_in_ns<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> set <span class="skolem">ns</span>"</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> p_Leaf<span class="main">:</span> <span class="quoted"><span class="quoted">"isLeaf_pt <span class="skolem">p</span> <span class="skolem">low</span> <span class="skolem">high</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nodeslist</span> <span class="main">=</span> hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">ns</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">p</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">rep</span><span class="main">]</span> <span class="main">∧</span>
        <span class="skolem">var</span> <span class="skolem">nodeslist</span> <span class="main">=</span> <span class="skolem">var</span> <span class="skolem">p</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> p_in_ns no_prop <span class="keyword1"><span class="command">have</span></span> p_not_Null<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">≠</span>Null"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_depth_limit</span><span class="main"><span class="main">=</span></span>2<span class="main">]</span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> p_in_ns <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ns</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ns</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> ns <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns'</span></span> <span class="keyword2"><span class="keyword">where</span></span> ns'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ns</span> <span class="main">=</span> <span class="skolem">nodeslist</span><span class="main">#</span><span class="skolem">ns'</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">nodeslist</span><span class="main">=</span>Null"</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> no_prop p_Leaf <span class="keyword3"><span class="command">obtain</span></span> 
      <span class="quoted"><span class="quoted">"isLeaf_pt <span class="skolem">nodeslist</span> <span class="skolem">low</span> <span class="skolem">high</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      var_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">nodeslist</span> <span class="main">=</span> <span class="skolem">var</span> <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">nodeslist</span><span class="main">≠</span>Null"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_depth_limit</span><span class="main"><span class="main">=</span></span>2<span class="main">]</span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> p_not_Null p_Leaf <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"repNodes_eq <span class="skolem">nodeslist</span> <span class="skolem">p</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">rep</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repNodes_eq_def isLeaf_pt_def null_comp_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> ns' var_eq
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="comment1">(* From invariant to postcondition *)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">var</span><span class="main">::</span><span class="quoted"><span class="quoted">"ref<span class="main">⇒</span>nat"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">rep</span> <span class="skolem">repa</span> <span class="skolem">p</span> <span class="skolem">prx</span> <span class="skolem">sfx</span> <span class="quoted">"<span class="skolem">next</span>"</span>
  <span class="keyword3"><span class="command">assume</span></span> sfx<span class="main">:</span> <span class="quoted"><span class="quoted">"List Null <span class="skolem">next</span> <span class="skolem">sfx</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> p_in_ns<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">sfx</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> no_props<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span>
           <span class="bound">no</span> <span class="main">≠</span> Null <span class="main">∧</span>
           <span class="main">(</span><span class="skolem">low</span> <span class="bound">no</span> <span class="main">=</span> Null<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">high</span> <span class="bound">no</span> <span class="main">=</span> Null<span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span>isLeaf_pt <span class="skolem">p</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="main">⟶</span> isLeaf_pt <span class="bound">no</span> <span class="skolem">low</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">var</span> <span class="bound">no</span> <span class="main">=</span> <span class="skolem">var</span> <span class="skolem">p</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> match_prx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">pt</span><span class="main">∈</span>set <span class="skolem">prx</span><span class="main">.</span> repNodes_eq <span class="bound">pt</span> <span class="skolem">p</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">rep</span><span class="main">)</span> <span class="main">⟶</span>
                       <span class="skolem">repa</span> <span class="skolem">p</span> <span class="main">=</span> hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">prx</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">p</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">rep</span><span class="main">]</span> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">∀</span><span class="bound">pt</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">≠</span> <span class="skolem">p</span> <span class="main">⟶</span> <span class="skolem">rep</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">repa</span> <span class="bound">pt</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repa</span> <span class="skolem">p</span> <span class="main">=</span> hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">sfx</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">p</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">rep</span><span class="main">]</span> <span class="main">∧</span>
          <span class="main">(</span><span class="main">∀</span><span class="bound">pt</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">≠</span> <span class="skolem">p</span> <span class="main">⟶</span> <span class="skolem">rep</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">repa</span> <span class="bound">pt</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">var</span> <span class="main">(</span><span class="skolem">repa</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">var</span> <span class="skolem">p</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> sfx
    <span class="keyword1"><span class="command">have</span></span> sfx_Nil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">sfx</span><span class="main">=</span><span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> p_in_ns <span class="keyword1"><span class="command">have</span></span> ex_match<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">pt</span><span class="main">∈</span>set <span class="skolem">prx</span><span class="main">.</span> repNodes_eq <span class="bound">pt</span> <span class="skolem">p</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">rep</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repNodes_eq_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">hence</span></span> not_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">prx</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">p</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">rep</span><span class="main">]</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> bexE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> filter_not_empty<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">from</span></span> ex_match match_prx <span class="keyword3"><span class="command">obtain</span></span>
      found<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repa</span> <span class="skolem">p</span> <span class="main">=</span> hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">prx</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">p</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">rep</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      unmodif<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">pt</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">≠</span> <span class="skolem">p</span> <span class="main">⟶</span> <span class="skolem">rep</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">repa</span> <span class="bound">pt</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> hd_filter_in_list <span class="main">[</span><span class="operator">OF</span> not_empty<span class="main">]</span> found
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repa</span> <span class="skolem">p</span> <span class="main">∈</span> set <span class="skolem">prx</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> no_props
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">repa</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">var</span> <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_depth_limit</span><span class="main"><span class="main">=</span></span>2<span class="main">]</span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> found unmodif sfx_Nil
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="comment1">(* Invariant to invariant; ELSE part *)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">var</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">p</span> <span class="skolem">repa</span> <span class="quoted">"<span class="skolem">next</span>"</span> <span class="skolem">nodeslist</span> <span class="skolem">prx</span> <span class="skolem">sfx</span>
  <span class="keyword3"><span class="command">assume</span></span> nodeslist_not_Null<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">nodeslist</span> <span class="main">≠</span> Null"</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> p_no_Leaf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> isLeaf_pt <span class="skolem">p</span> <span class="skolem">low</span> <span class="skolem">high</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> no_props<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set <span class="skolem">prx</span> <span class="main">∪</span> set <span class="main">(</span><span class="skolem">nodeslist</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span>
           <span class="bound">no</span> <span class="main">≠</span> Null <span class="main">∧</span> <span class="main">(</span><span class="skolem">low</span> <span class="bound">no</span> <span class="main">=</span> Null<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">high</span> <span class="bound">no</span> <span class="main">=</span> Null<span class="main">)</span> <span class="main">∧</span> <span class="skolem">var</span> <span class="bound">no</span> <span class="main">=</span> <span class="skolem">var</span> <span class="skolem">p</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> p_in_ns<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> set <span class="skolem">prx</span> <span class="main">∨</span> <span class="skolem">p</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">nodeslist</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> match_prx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">pt</span><span class="main">∈</span>set <span class="skolem">prx</span><span class="main">.</span> repNodes_eq <span class="bound">pt</span> <span class="skolem">p</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">)</span> <span class="main">⟶</span>
            <span class="skolem">repa</span> <span class="skolem">p</span> <span class="main">=</span> hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">prx</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">p</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> nomatch_prx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">pt</span><span class="main">∈</span>set <span class="skolem">prx</span><span class="main">.</span> <span class="main">¬</span> repNodes_eq <span class="bound">pt</span> <span class="skolem">p</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> nomatch_nodeslist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> repNodes_eq <span class="skolem">nodeslist</span> <span class="skolem">p</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> sfx<span class="main">:</span> <span class="quoted"><span class="quoted">"List <span class="main">(</span><span class="skolem">next</span> <span class="skolem">nodeslist</span><span class="main">)</span> <span class="skolem">next</span> <span class="skolem">sfx</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set <span class="skolem">prx</span> <span class="main">∪</span> set <span class="main">(</span><span class="skolem">nodeslist</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span>
              <span class="bound">no</span> <span class="main">≠</span> Null <span class="main">∧</span> <span class="main">(</span><span class="skolem">low</span> <span class="bound">no</span> <span class="main">=</span> Null<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">high</span> <span class="bound">no</span> <span class="main">=</span> Null<span class="main">)</span> <span class="main">∧</span> <span class="skolem">var</span> <span class="bound">no</span> <span class="main">=</span> <span class="skolem">var</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∧</span>
        <span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">pt</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">nodeslist</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">pt</span> <span class="skolem">p</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">)</span> <span class="main">⟶</span>
           <span class="skolem">repa</span> <span class="skolem">p</span> <span class="main">=</span> hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">prx</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">nodeslist</span><span class="main">]</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">p</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span><span class="main">)</span> <span class="main">∧</span>
        <span class="main">(</span><span class="skolem">next</span> <span class="skolem">nodeslist</span> <span class="main">≠</span> Null <span class="main">⟶</span>
            <span class="main">(</span><span class="main">∀</span><span class="bound">pt</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">nodeslist</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> <span class="main">¬</span> repNodes_eq <span class="bound">pt</span> <span class="skolem">p</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> nomatch_prx nomatch_nodeslist
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">pt</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">nodeslist</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">pt</span> <span class="skolem">p</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">)</span> <span class="main">⟶</span>
           <span class="skolem">repa</span> <span class="skolem">p</span> <span class="main">=</span> hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">prx</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">nodeslist</span><span class="main">]</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">p</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">from</span></span> nomatch_prx nomatch_nodeslist
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">next</span> <span class="skolem">nodeslist</span> <span class="main">≠</span> Null <span class="main">⟶</span>
            <span class="main">(</span><span class="main">∀</span><span class="bound">pt</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">nodeslist</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> <span class="main">¬</span> repNodes_eq <span class="bound">pt</span> <span class="skolem">p</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> no_props
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="comment1">(* Invariant to invariant: THEN part *)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">var</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">p</span> <span class="skolem">repa</span> <span class="quoted">"<span class="skolem">next</span>"</span> <span class="skolem">nodeslist</span> <span class="skolem">prx</span> <span class="skolem">sfx</span>
  <span class="keyword3"><span class="command">assume</span></span> nodeslist_not_Null<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">nodeslist</span> <span class="main">≠</span> Null"</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> sfx<span class="main">:</span> <span class="quoted"><span class="quoted">"List <span class="skolem">nodeslist</span> <span class="skolem">next</span> <span class="skolem">sfx</span>"</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> p_not_Leaf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> isLeaf_pt <span class="skolem">p</span> <span class="skolem">low</span> <span class="skolem">high</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> no_props<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set <span class="skolem">prx</span> <span class="main">∪</span> set <span class="skolem">sfx</span><span class="main">.</span>
           <span class="bound">no</span> <span class="main">≠</span> Null <span class="main">∧</span>
           <span class="main">(</span><span class="skolem">low</span> <span class="bound">no</span> <span class="main">=</span> Null<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">high</span> <span class="bound">no</span> <span class="main">=</span> Null<span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span>isLeaf_pt <span class="skolem">p</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="main">⟶</span> isLeaf_pt <span class="bound">no</span> <span class="skolem">low</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">var</span> <span class="bound">no</span> <span class="main">=</span> <span class="skolem">var</span> <span class="skolem">p</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> p_in_ns<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> set <span class="skolem">prx</span> <span class="main">∨</span> <span class="skolem">p</span> <span class="main">∈</span> set <span class="skolem">sfx</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> match_prx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">pt</span><span class="main">∈</span>set <span class="skolem">prx</span><span class="main">.</span> repNodes_eq <span class="bound">pt</span> <span class="skolem">p</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">)</span> <span class="main">⟶</span>
        <span class="skolem">repa</span> <span class="skolem">p</span> <span class="main">=</span> hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">prx</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">p</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> nomatch_prx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">pt</span><span class="main">∈</span>set <span class="skolem">prx</span><span class="main">.</span> <span class="main">¬</span> repNodes_eq <span class="bound">pt</span> <span class="skolem">p</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> match<span class="main">:</span> <span class="quoted"><span class="quoted">"repNodes_eq <span class="skolem">nodeslist</span> <span class="skolem">p</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set <span class="skolem">prx</span> <span class="main">∪</span> set <span class="skolem">sfx</span><span class="main">.</span>
              <span class="bound">no</span> <span class="main">≠</span> Null <span class="main">∧</span>
              <span class="main">(</span><span class="skolem">low</span> <span class="bound">no</span> <span class="main">=</span> Null<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">high</span> <span class="bound">no</span> <span class="main">=</span> Null<span class="main">)</span> <span class="main">∧</span>
              <span class="main">(</span>isLeaf_pt <span class="skolem">p</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="main">⟶</span> isLeaf_pt <span class="bound">no</span> <span class="skolem">low</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">var</span> <span class="bound">no</span> <span class="main">=</span> <span class="skolem">var</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∧</span>
        <span class="main">(</span><span class="skolem">p</span> <span class="main">∈</span> set <span class="skolem">prx</span> <span class="main">∨</span> <span class="skolem">p</span> <span class="main">∈</span> set <span class="skolem">sfx</span><span class="main">)</span> <span class="main">∧</span>
        <span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">pt</span><span class="main">∈</span>set <span class="skolem">prx</span> <span class="main">∪</span> set <span class="skolem">sfx</span><span class="main">.</span> repNodes_eq <span class="bound">pt</span> <span class="skolem">p</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">)</span> <span class="main">⟶</span>
           <span class="skolem">nodeslist</span> <span class="main">=</span>
           hd <span class="main">(</span><span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">prx</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">p</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span> <span class="main">@</span>
               <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">sfx</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">p</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
        <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">pt</span><span class="main">∈</span>set <span class="skolem">prx</span> <span class="main">∪</span> set <span class="skolem">sfx</span><span class="main">.</span> <span class="main">¬</span> repNodes_eq <span class="bound">pt</span> <span class="skolem">p</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">)</span> <span class="main">⟶</span>
           <span class="skolem">repa</span> <span class="main">=</span> <span class="skolem">repa</span><span class="main">(</span><span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">nodeslist</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> nodeslist_not_Null sfx
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">sfx'</span></span> <span class="keyword2"><span class="keyword">where</span></span> sfx'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">sfx</span><span class="main">=</span><span class="skolem">nodeslist</span><span class="main">#</span><span class="skolem">sfx'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">nodeslist</span><span class="main">=</span>Null"</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> nomatch_prx match sfx'
    <span class="keyword1"><span class="command">have</span></span> hd<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">prx</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">p</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span> <span class="main">@</span>
               <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">sfx</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">p</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">nodeslist</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> match sfx'
    <span class="keyword1"><span class="command">have</span></span> triv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">pt</span><span class="main">∈</span>set <span class="skolem">prx</span> <span class="main">∪</span> set <span class="skolem">sfx</span><span class="main">.</span> <span class="main">¬</span> repNodes_eq <span class="bound">pt</span> <span class="skolem">p</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">)</span> <span class="main">⟶</span>
           <span class="skolem">repa</span> <span class="main">=</span> <span class="skolem">repa</span><span class="main">(</span><span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">nodeslist</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> no_props<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">rule</span> p_in_ns<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hd<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> triv<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="ShareReduceRepListProof">
<div class="head">
<h1>Theory ShareReduceRepListProof</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       BDD

    Author:      Veronika Ortner and Norbert Schirmer, 2004
    Maintainer:  Norbert Schirmer,  norbert.schirmer at web de
    License:     LGPL
*)</span>

<span class="comment1">(*  
ShareReduceRepListProof.thy

Copyright (C) 2004 Veronika Ortner and Norbert Schirmer 
Some rights reserved, TU Muenchen

This library is free software; you can redistribute it and/or modify
it under the terms of the GNU Lesser General Public License as
published by the Free Software Foundation; either version 2.1 of the
License, or (at your option) any later version.

This library is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
Lesser General Public License for more details.

You should have received a copy of the GNU Lesser General Public
License along with this library; if not, write to the Free Software
Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307
USA
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Proof of Procedure ShareReduceRepList›</span></span>
<span class="keyword1"><span class="command">theory</span></span> ShareReduceRepListProof <span class="keyword2"><span class="keyword">imports</span></span> <a href="ShareRepProof.html">ShareRepProof</a> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ShareReduceRepList_impl<span class="main">)</span> ShareReduceRepList_modifies<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">σ</span><span class="main">.</span> <span class="free">Γ</span><span class="main">⊢</span><span class="main">{</span><span class="bound">σ</span><span class="main">}</span>  <span class="keyword1">PROC</span> ShareReduceRepList <span class="main">(</span><span class="main">´</span>nodeslist<span class="main">)</span>
        <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="keyword1">may_only_modify_globals</span> <span class="bound">σ</span> <span class="keyword1">in</span> <span class="main">[</span>rep<span class="main">]</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">hoare_rule</span> HoarePartial.ProcRec1<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">vcg</span> spec<span class="main"><span class="main">=</span></span>modifies<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="ShareReduceRepListProof-hd_filter_app"><span class="command">lemma</span></span> hd_filter_app<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>filter <span class="free">P</span> <span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">;</span> <span class="free">zs</span><span class="main">=</span><span class="free">xs</span><span class="main">@</span><span class="free">ys</span><span class="main">⟧</span> <span class="main">⟹</span> 
       hd <span class="main">(</span>filter <span class="free">P</span> <span class="free">zs</span><span class="main">)</span> <span class="main">=</span>  hd <span class="main">(</span>filter <span class="free">P</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ShareReduceRepList_impl<span class="main">)</span> ShareReduceRepList_spec_total<span class="main">:</span> 
<span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">var_eq</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">ns</span> <span class="bound">var</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">no1</span> <span class="main">∈</span> set <span class="bound">ns</span><span class="main">.</span> <span class="main">∀</span><span class="bound">no2</span> <span class="main">∈</span> set <span class="bound">ns</span><span class="main">.</span> <span class="bound">no1</span><span class="main">→</span><span class="bound">var</span> <span class="main">=</span> <span class="bound">no2</span><span class="main">→</span><span class="bound">var</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">σ</span> <span class="bound">ns</span><span class="main">.</span> <span class="free">Γ</span><span class="keyword1">⊢<span class="hidden">⇩</span><sub>t</sub></span>
   <span class="main">⦃</span><span class="bound">σ</span><span class="main">.</span> List <span class="main">´</span>nodeslist <span class="main">´</span>next <span class="bound">ns</span> <span class="main">∧</span>
       <span class="main">(</span><span class="main">∀</span><span class="bound">no</span> <span class="main">∈</span> set <span class="bound">ns</span><span class="main">.</span>
            <span class="bound">no</span> <span class="main">≠</span> Null <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="bound">no</span><span class="main">→</span><span class="main">´</span>low <span class="main">=</span> Null<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">no</span><span class="main">→</span><span class="main">´</span>high <span class="main">=</span> Null<span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
             <span class="bound">no</span><span class="main">→</span><span class="main">´</span>low <span class="main">∉</span> set <span class="bound">ns</span> <span class="main">∧</span> <span class="bound">no</span><span class="main">→</span><span class="main">´</span>high <span class="main">∉</span> set <span class="bound">ns</span> <span class="main">∧</span>
             <span class="main">(</span>isLeaf_pt <span class="bound">no</span> <span class="main">´</span>low <span class="main">´</span>high <span class="main">=</span> <span class="main">(</span><span class="bound">no</span><span class="main">→</span><span class="main">´</span>var <span class="main">≤</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
             <span class="main">(</span><span class="bound">no</span><span class="main">→</span><span class="main">´</span>low <span class="main">≠</span> Null <span class="main">⟶</span> <span class="main">(</span><span class="bound">no</span><span class="main">→</span><span class="main">´</span>low<span class="main">)</span><span class="main">→</span><span class="main">´</span>rep <span class="main">≠</span> Null<span class="main">)</span> <span class="main">∧</span>
             <span class="main">(</span><span class="main">(</span><span class="main">´</span>rep <span class="main">∝</span> <span class="main">´</span>low<span class="main">)</span> <span class="bound">no</span> <span class="main">∉</span> set <span class="bound">ns</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
        <span class="free">var_eq</span> <span class="bound">ns</span> <span class="main">´</span>var<span class="main">⦄</span> 
    <span class="keyword1">PROC</span>  ShareReduceRepList <span class="main">(</span><span class="main">´</span>nodeslist<span class="main">)</span>
   <span class="main">⦃</span><span class="main">(</span><span class="main">∀</span><span class="bound">no</span><span class="main">.</span> <span class="bound">no</span> <span class="main">∉</span> set <span class="bound">ns</span> <span class="main">⟶</span> <span class="bound">no</span><span class="main">→</span><span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>rep <span class="main">=</span> <span class="bound">no</span><span class="main">→</span><span class="main">´</span>rep<span class="main">)</span>  <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">no</span> <span class="main">∈</span> set <span class="bound">ns</span><span class="main">.</span> <span class="bound">no</span><span class="main">→</span><span class="main">´</span>rep <span class="main">≠</span> Null <span class="main">∧</span> 
      <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="main">(</span><span class="main">´</span>rep <span class="main">∝</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>low<span class="main">)</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="main">´</span>rep <span class="main">∝</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>high<span class="main">)</span> <span class="bound">no</span> <span class="main">∧</span> <span class="bound">no</span><span class="main">→</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>low <span class="main">≠</span> Null<span class="main">)</span> 
       <span class="keyword1">then</span> <span class="main">(</span><span class="bound">no</span><span class="main">→</span><span class="main">´</span>rep <span class="main">=</span> <span class="main">(</span><span class="main">´</span>rep <span class="main">∝</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>low<span class="main">)</span> <span class="bound">no</span> <span class="main">)</span>
       <span class="keyword1">else</span> <span class="main">(</span><span class="main">(</span><span class="bound">no</span><span class="main">→</span><span class="main">´</span>rep<span class="main">)</span> <span class="main">∈</span> set <span class="bound">ns</span> <span class="main">∧</span> <span class="bound">no</span><span class="main">→</span><span class="main">´</span>rep<span class="main">→</span><span class="main">´</span>rep <span class="main">=</span> <span class="bound">no</span><span class="main">→</span><span class="main">´</span>rep <span class="main">∧</span> 
             <span class="main">(</span><span class="main">∀</span> <span class="bound">no1</span> <span class="main">∈</span> set <span class="bound">ns</span><span class="main">.</span> 
                 <span class="main">(</span><span class="main">(</span><span class="main">´</span>rep <span class="main">∝</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>high<span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="main">´</span>rep <span class="main">∝</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>high<span class="main">)</span> <span class="bound">no</span> <span class="main">∧</span> 
                 <span class="main">(</span><span class="main">´</span>rep <span class="main">∝</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>low<span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="main">´</span>rep <span class="main">∝</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>low<span class="main">)</span> <span class="bound">no</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">no</span><span class="main">→</span><span class="main">´</span>rep <span class="main">=</span> <span class="bound">no1</span><span class="main">→</span><span class="main">´</span>rep<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">hoare_rule</span> HoareTotal.ProcNoRec1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">hoare_rule</span> anno<span class="main"><span class="main">=</span></span>
       <span class="quoted"><span class="quoted">" <span class="main">´</span>node <span class="main">:==</span> <span class="main">´</span>nodeslist<span class="main">;;</span>
         <span class="keyword1">WHILE</span> <span class="main">(</span><span class="main">´</span>node <span class="main">≠</span> Null <span class="main">)</span> 
         <span class="keyword1">INV</span> <span class="main">⦃</span><span class="main">∃</span><span class="bound">prx</span> <span class="bound">sfx</span><span class="main">.</span> List <span class="main">´</span>node <span class="main">´</span>next <span class="bound">sfx</span> <span class="main">∧</span> 
              List <span class="main">´</span>nodeslist <span class="main">´</span>next <span class="improper">ns</span> <span class="main">∧</span> <span class="improper">ns</span><span class="main">=</span><span class="bound">prx</span><span class="main">@</span><span class="bound">sfx</span> <span class="main">∧</span> 
              <span class="main">(</span><span class="main">∀</span><span class="bound">no</span> <span class="main">∈</span> set <span class="improper">ns</span><span class="main">.</span>
                 <span class="bound">no</span> <span class="main">≠</span> Null <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="bound">no</span><span class="main">→</span><span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>low <span class="main">=</span> Null<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">no</span><span class="main">→</span><span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>high <span class="main">=</span> Null<span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
                 <span class="bound">no</span><span class="main">→</span><span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>low <span class="main">∉</span> set <span class="improper">ns</span> <span class="main">∧</span> <span class="bound">no</span><span class="main">→</span><span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>high <span class="main">∉</span> set <span class="improper">ns</span> <span class="main">∧</span>
                 <span class="main">(</span>isLeaf_pt <span class="bound">no</span>  <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>low <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>high <span class="main">=</span> <span class="main">(</span><span class="bound">no</span><span class="main">→</span><span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>var <span class="main">≤</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                 <span class="main">(</span><span class="bound">no</span><span class="main">→</span><span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>low <span class="main">≠</span> Null <span class="main">⟶</span> <span class="main">(</span><span class="bound">no</span><span class="main">→</span><span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>low<span class="main">)</span><span class="main">→</span><span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>rep <span class="main">≠</span> Null<span class="main">)</span> <span class="main">∧</span>
                 <span class="main">(</span><span class="main">(</span><span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>rep <span class="main">∝</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>low<span class="main">)</span> <span class="bound">no</span>  <span class="main">∉</span> set <span class="improper">ns</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
              <span class="free">var_eq</span> <span class="improper">ns</span> <span class="main">´</span>var <span class="main">∧</span>
              <span class="main">(</span><span class="main">∀</span><span class="bound">no</span><span class="main">.</span>  <span class="bound">no</span> <span class="main">∉</span> set <span class="bound">prx</span> <span class="main">⟶</span> <span class="bound">no</span><span class="main">→</span><span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>rep <span class="main">=</span> <span class="bound">no</span> <span class="main">→</span><span class="main">´</span>rep<span class="main">)</span>  <span class="main">∧</span>
              <span class="main">(</span><span class="main">∀</span> <span class="bound">no</span> <span class="main">∈</span> set <span class="bound">prx</span><span class="main">.</span> <span class="bound">no</span><span class="main">→</span><span class="main">´</span>rep <span class="main">≠</span> Null <span class="main">∧</span> 
               <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="main">(</span><span class="main">´</span>rep <span class="main">∝</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>low<span class="main">)</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="main">´</span>rep <span class="main">∝</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>high<span class="main">)</span> <span class="bound">no</span> <span class="main">∧</span> <span class="bound">no</span><span class="main">→</span><span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>low <span class="main">≠</span> Null<span class="main">)</span> 
                <span class="keyword1">then</span> <span class="main">(</span><span class="bound">no</span><span class="main">→</span><span class="main">´</span>rep <span class="main">=</span> <span class="main">(</span><span class="main">´</span>rep <span class="main">∝</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>low<span class="main">)</span> <span class="bound">no</span> <span class="main">)</span>
                <span class="keyword1">else</span> <span class="main">(</span><span class="main">(</span><span class="bound">no</span><span class="main">→</span><span class="main">´</span>rep<span class="main">)</span><span class="main">=</span>hd <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">sn</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="bound">no</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>low <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>high <span class="main">´</span>rep<span class="main">)</span> 
                                     <span class="bound">prx</span><span class="main">)</span> <span class="main">∧</span> 
                     <span class="main">(</span><span class="main">(</span><span class="bound">no</span><span class="main">→</span><span class="main">´</span>rep<span class="main">)</span><span class="main">→</span><span class="main">´</span>rep<span class="main">)</span> <span class="main">=</span> <span class="bound">no</span><span class="main">→</span><span class="main">´</span>rep <span class="main">∧</span> 
                     <span class="main">(</span><span class="main">∀</span><span class="bound">no1</span> <span class="main">∈</span> set <span class="bound">prx</span><span class="main">.</span> 
                        <span class="main">(</span><span class="main">(</span><span class="main">´</span>rep <span class="main">∝</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>high<span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="main">´</span>rep <span class="main">∝</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>high<span class="main">)</span> <span class="bound">no</span> <span class="main">∧</span> 
                         <span class="main">(</span><span class="main">´</span>rep <span class="main">∝</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>low<span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="main">´</span>rep <span class="main">∝</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>low<span class="main">)</span> <span class="bound">no</span><span class="main">)</span> <span class="main">=</span> 
                         <span class="main">(</span><span class="bound">no</span><span class="main">→</span><span class="main">´</span>rep <span class="main">=</span> <span class="bound">no1</span><span class="main">→</span><span class="main">´</span>rep<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                 <span class="main">´</span>nodeslist<span class="main">=</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>nodeslist <span class="main">∧</span> <span class="main">´</span>high<span class="main">=</span><span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>high <span class="main">∧</span> <span class="main">´</span>low<span class="main">=</span><span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>low <span class="main">∧</span> <span class="main">´</span>var<span class="main">=</span><span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>var<span class="main">⦄</span>
         <span class="keyword1">VAR</span> <span class="keyword1">MEASURE</span> <span class="main">(</span>length <span class="main">(</span>list <span class="main">´</span>node <span class="main">´</span>next<span class="main">)</span><span class="main">)</span>
         <span class="keyword1">DO</span>
         <span class="keyword1">IF</span> <span class="main">(</span><span class="main">¬</span> isLeaf_pt <span class="main">´</span>node <span class="main">´</span>low <span class="main">´</span>high <span class="main">∧</span> 
            <span class="main">´</span>node <span class="main">→</span> <span class="main">´</span>low <span class="main">→</span> <span class="main">´</span>rep <span class="main">=</span> <span class="main">´</span>node <span class="main">→</span> <span class="main">´</span>high <span class="main">→</span> <span class="main">´</span>rep <span class="main">)</span>
         <span class="keyword1">THEN</span> <span class="main">´</span>node <span class="main">→</span> <span class="main">´</span>rep <span class="main">:==</span> <span class="main">´</span>node <span class="main">→</span> <span class="main">´</span>low <span class="main">→</span> <span class="main">´</span>rep
         <span class="keyword1">ELSE</span> <span class="keyword1">CALL</span> ShareRep <span class="main">(</span><span class="main">´</span>nodeslist <span class="main">,</span> <span class="main">´</span>node<span class="main">)</span>   
         <span class="keyword1">FI</span><span class="main">;;</span>
         <span class="main">´</span>node <span class="main">:==</span><span class="main">´</span>node <span class="main">→</span> <span class="main">´</span>next
         <span class="keyword1">OD</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> HoareTotal.annotateI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">vcg</span> spec<span class="main"><span class="main">=</span></span>spec_total<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">ns</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_depth_limit</span> <span class="main"><span class="main">=</span></span> 2<span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_use</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_depth_limit</span> <span class="main"><span class="main">=</span></span> 4<span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="operator">clarify</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> List_list<span class="main">)</span> <span class="comment1">(* termination *)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> List_not_Null simp_thms triv_forall_equality<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="operator">clarify</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> triv_forall_equality<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">rename_tac</span> sfx<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">prx</span><span class="main">@</span><span class="main">[</span><span class="improper">node</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">sfx</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="main">(</span><span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="operator">clarify</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> List_not_Null simp_thms triv_forall_equality<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="operator">clarify</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> triv_forall_equality<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">rename_tac</span> sfx<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">prx</span><span class="main">@</span><span class="improper">node</span><span class="main">#</span><span class="improper">sfx</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="comment1">(* Precondition for ShareRep *)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="main">(</span><span class="operator">frule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">no</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">node</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>     <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_use</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="main">(</span><span class="operator">elim</span> conjE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>     <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>     <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="main">(</span><span class="operator">unfold</span> var_eq_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">node</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">no</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span><span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isLeaf_pt_def <span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"List <span class="improper">node</span> <span class="improper">next</span> <span class="main">(</span><span class="improper">node</span><span class="main">#</span><span class="improper">sfx</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="comment1">(* termination *)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>     <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> List_list<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>     <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_simp</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">prx</span><span class="main">@</span><span class="main">[</span><span class="improper">node</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">sfx</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="main">(</span><span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_depth_limit</span> <span class="main"><span class="main">=</span></span> 100<span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> <span class="comment1">(* From invariant to postcondition *)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">var</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">rep</span> <span class="skolem">nodeslist</span> <span class="skolem">ns</span> <span class="skolem">repa</span> <span class="quoted">"<span class="skolem">next</span>"</span> <span class="skolem">no</span>
  <span class="keyword3"><span class="command">assume</span></span> ns<span class="main">:</span> <span class="quoted"><span class="quoted">"List <span class="skolem">nodeslist</span> <span class="skolem">next</span> <span class="skolem">ns</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> no_in_ns<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">∈</span> set <span class="skolem">ns</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> while_inv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set <span class="skolem">ns</span><span class="main">.</span>
           <span class="skolem">repa</span> <span class="bound">no</span> <span class="main">≠</span> Null <span class="main">∧</span>
           <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no</span> <span class="main">∧</span> <span class="skolem">high</span> <span class="bound">no</span> <span class="main">≠</span> Null
            <span class="keyword1">then</span> <span class="skolem">repa</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no</span>
            <span class="keyword1">else</span> <span class="skolem">repa</span> <span class="bound">no</span> <span class="main">=</span> hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">ns</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="bound">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span> <span class="main">∧</span>
                 <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">repa</span> <span class="bound">no</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repa</span> <span class="bound">no</span> <span class="main">∧</span>
                 <span class="main">(</span><span class="main">∀</span><span class="bound">no1</span><span class="main">∈</span>set <span class="skolem">ns</span><span class="main">.</span>
                     <span class="main">(</span><span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no</span> <span class="main">∧</span>
                      <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no</span><span class="main">)</span> <span class="main">=</span>
                     <span class="main">(</span><span class="skolem">repa</span> <span class="bound">no</span> <span class="main">=</span> <span class="skolem">repa</span> <span class="bound">no1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> pre<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set <span class="skolem">ns</span><span class="main">.</span>
           <span class="bound">no</span> <span class="main">≠</span> Null <span class="main">∧</span>
           <span class="main">(</span><span class="skolem">low</span> <span class="bound">no</span> <span class="main">=</span> Null<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">high</span> <span class="bound">no</span> <span class="main">=</span> Null<span class="main">)</span> <span class="main">∧</span>
           <span class="skolem">low</span> <span class="bound">no</span> <span class="main">∉</span> set <span class="skolem">ns</span> <span class="main">∧</span>
           <span class="skolem">high</span> <span class="bound">no</span> <span class="main">∉</span> set <span class="skolem">ns</span> <span class="main">∧</span>
           isLeaf_pt <span class="bound">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">var</span> <span class="bound">no</span> <span class="main">≤</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="skolem">low</span> <span class="bound">no</span> <span class="main">≠</span> Null <span class="main">⟶</span> <span class="skolem">rep</span> <span class="main">(</span><span class="skolem">low</span> <span class="bound">no</span><span class="main">)</span> <span class="main">≠</span> Null<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no</span> <span class="main">∉</span> set <span class="skolem">ns</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> same_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no1</span><span class="main">∈</span>set <span class="skolem">ns</span><span class="main">.</span> <span class="main">∀</span><span class="bound">no2</span><span class="main">∈</span>set <span class="skolem">ns</span><span class="main">.</span> <span class="skolem">var</span> <span class="bound">no1</span> <span class="main">=</span> <span class="skolem">var</span> <span class="bound">no2</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> share_case<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">⟶</span> <span class="skolem">high</span> <span class="skolem">no</span> <span class="main">=</span> Null"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> unmodif<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span><span class="main">.</span> <span class="bound">no</span> <span class="main">∉</span> set <span class="skolem">ns</span> <span class="main">⟶</span> <span class="skolem">rep</span> <span class="bound">no</span> <span class="main">=</span> <span class="skolem">repa</span> <span class="bound">no</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">ns</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span> <span class="main">∈</span> set <span class="skolem">ns</span> <span class="main">∧</span>
        <span class="skolem">repa</span> <span class="main">(</span>hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">ns</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span>
        hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">ns</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> no_in_ns pre <span class="keyword3"><span class="command">obtain</span></span>
      no_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">no</span> <span class="main">≠</span> Null"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      no_balanced<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span> <span class="main">=</span> Null<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span> <span class="main">=</span> Null<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      isLeaf_var<span class="main">:</span> <span class="quoted"><span class="quoted">"isLeaf_pt <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">var</span> <span class="skolem">no</span> <span class="main">≤</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> repNodes_eq_same_node<span class="main">:</span> <span class="quoted"><span class="quoted">"repNodes_eq <span class="skolem">no</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repNodes_eq_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> no_in_ns <span class="keyword1"><span class="command">have</span></span> ns_nempty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ns</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> no_in_ns repNodes_eq_same_node 
    <span class="keyword1"><span class="command">have</span></span> repNodes_not_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">ns</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> filter_not_empty<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> hd_term_in_ns<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">ns</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span> <span class="main">∈</span> set <span class="skolem">ns</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hd_filter_in_list<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> while_inv <span class="keyword3"><span class="command">obtain</span></span> 
      repa_hd_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repa</span>  <span class="main">(</span>hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">ns</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span><span class="main">)</span> <span class="main">≠</span> Null"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?hd</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">ns</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> hd_term_in_ns  pre <span class="keyword3"><span class="command">obtain</span></span>
      hd_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="var">?hd</span> <span class="main">≠</span> Null"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      hd_balanced<span class="main">:</span> 
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">low</span> <span class="main">(</span>hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">ns</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> Null<span class="main">)</span> <span class="main">=</span> 
         <span class="main">(</span><span class="skolem">high</span> <span class="main">(</span>hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">ns</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> Null<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      hd_isLeaf_var<span class="main">:</span> 
      <span class="quoted"><span class="quoted">"isLeaf_pt <span class="main">(</span>hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">ns</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span><span class="main">)</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="main">=</span> 
      <span class="main">(</span><span class="skolem">var</span> <span class="main">(</span>hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">ns</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repa</span> <span class="main">(</span>hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">ns</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> 
      hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">ns</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">no</span> <span class="main">=</span> Null"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> no_balanced <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">no</span> <span class="main">=</span> Null"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> True <span class="keyword1"><span class="command">have</span></span> no_Leaf<span class="main">:</span> <span class="quoted"><span class="quoted">"isLeaf_pt <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isLeaf_pt_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> isLeaf_var <span class="keyword1"><span class="command">have</span></span> varno<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">no</span> <span class="main">&lt;=</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> same_var <span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> no_in_ns hd_term_in_ns<span class="main">]</span> varno
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span>hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">ns</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> hd_isLeaf_var <span class="keyword1"><span class="command">have</span></span> 
        <span class="quoted"><span class="quoted">"isLeaf_pt <span class="main">(</span>hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">ns</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span><span class="main">)</span> <span class="skolem">low</span> <span class="skolem">high</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> while_inv hd_term_in_ns repNodes_not_empty <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isLeaf_pt_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span>
          <span class="quoted"><span class="quoted">"hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">ns</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_use</span><span class="main"><span class="main">)</span></span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repNodes_eq_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> filter_hd_P_rep_indep<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_simp</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_simp</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> hno_nNull<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">no</span> <span class="main">≠</span> Null"</span></span>
      <span class="keyword1"><span class="command">with</span></span> share_case <span class="keyword1"><span class="command">have</span></span> repchildren_neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">≠</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> repNodes_not_empty <span class="keyword1"><span class="command">have</span></span> 
        <span class="quoted"><span class="quoted">"repNodes_eq  <span class="main">(</span>hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">ns</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span><span class="main">)</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hd_filter_prop<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span>hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">ns</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> 
              <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span> 
            <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">(</span>hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">ns</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> 
              <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repNodes_eq_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> repchildren_neq <span class="keyword1"><span class="command">have</span></span> 
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span>hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">ns</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span><span class="main">)</span>
        <span class="main">≠</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">(</span>hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">ns</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> while_inv hd_term_in_ns repNodes_not_empty <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isLeaf_pt_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span>
          <span class="quoted"><span class="quoted">"hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">ns</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_use</span><span class="main"><span class="main">)</span></span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repNodes_eq_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> filter_hd_P_rep_indep<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> hd_term_in_ns
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="comment1">(* invariant to invariant, THEN part  --  REDUCING*)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">var</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">rep</span> <span class="skolem">nodeslist</span> <span class="skolem">repa</span> <span class="quoted">"<span class="skolem">next</span>"</span> <span class="skolem">node</span> <span class="skolem">prx</span> <span class="skolem">sfx</span>
  <span class="keyword3"><span class="command">assume</span></span> ns<span class="main">:</span> <span class="quoted"><span class="quoted">"List <span class="skolem">nodeslist</span> <span class="skolem">next</span> <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> sfx<span class="main">:</span> <span class="quoted"><span class="quoted">"List <span class="main">(</span><span class="skolem">next</span> <span class="skolem">node</span><span class="main">)</span> <span class="skolem">next</span> <span class="skolem">sfx</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> node_not_Null<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">node</span> <span class="main">≠</span> Null"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> nodes_balanced_ordered<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span>
           <span class="bound">no</span> <span class="main">≠</span> Null <span class="main">∧</span>
           <span class="main">(</span><span class="skolem">low</span> <span class="bound">no</span> <span class="main">=</span> Null<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">high</span> <span class="bound">no</span> <span class="main">=</span> Null<span class="main">)</span> <span class="main">∧</span>
           <span class="skolem">low</span> <span class="bound">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span> <span class="main">∧</span>
           <span class="skolem">high</span> <span class="bound">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span> <span class="main">∧</span>
           isLeaf_pt <span class="bound">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">var</span> <span class="bound">no</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="skolem">low</span> <span class="bound">no</span> <span class="main">≠</span> Null <span class="main">⟶</span> <span class="skolem">rep</span> <span class="main">(</span><span class="skolem">low</span> <span class="bound">no</span><span class="main">)</span> <span class="main">≠</span> Null<span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> all_nodes_same_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no1</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span>
           <span class="main">∀</span><span class="bound">no2</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span> <span class="skolem">var</span> <span class="bound">no1</span> <span class="main">=</span> <span class="skolem">var</span> <span class="bound">no2</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> rep_repa_nc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span><span class="main">.</span> <span class="bound">no</span> <span class="main">∉</span> set <span class="skolem">prx</span> <span class="main">⟶</span> <span class="skolem">rep</span> <span class="bound">no</span> <span class="main">=</span> <span class="skolem">repa</span> <span class="bound">no</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> while_inv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set <span class="skolem">prx</span><span class="main">.</span>
           <span class="skolem">repa</span> <span class="bound">no</span> <span class="main">≠</span> Null <span class="main">∧</span>
           <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no</span> <span class="main">∧</span> <span class="skolem">low</span> <span class="bound">no</span> <span class="main">≠</span> Null
            <span class="keyword1">then</span> <span class="skolem">repa</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no</span>
            <span class="keyword1">else</span> <span class="skolem">repa</span> <span class="bound">no</span> <span class="main">=</span> hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">prx</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="bound">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span> <span class="main">∧</span>
                 <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">repa</span> <span class="bound">no</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repa</span> <span class="bound">no</span> <span class="main">∧</span>
                 <span class="main">(</span><span class="main">∀</span><span class="bound">no1</span><span class="main">∈</span>set <span class="skolem">prx</span><span class="main">.</span>
                     <span class="main">(</span><span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no</span> <span class="main">∧</span>
                      <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no</span><span class="main">)</span> <span class="main">=</span>
                     <span class="main">(</span><span class="skolem">repa</span> <span class="bound">no</span> <span class="main">=</span> <span class="skolem">repa</span> <span class="bound">no1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> not_Leaf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> isLeaf_pt <span class="skolem">node</span> <span class="skolem">low</span> <span class="skolem">high</span>"</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> repchildren_eq_nln<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">node</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">no</span><span class="main">.</span> <span class="bound">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span> <span class="main">⟶</span>
                <span class="skolem">rep</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">no</span><span class="main">)</span> <span class="main">∧</span>
        <span class="main">(</span><span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span>
              <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">no</span> <span class="main">≠</span> Null <span class="main">∧</span>
              <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no</span> <span class="main">=</span>
                  <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no</span> <span class="main">∧</span>
                  <span class="skolem">low</span> <span class="bound">no</span> <span class="main">≠</span> Null
               <span class="keyword1">then</span> <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">no</span> <span class="main">=</span>
                    <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no</span>
               <span class="keyword1">else</span> <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">no</span> <span class="main">=</span>
                    hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">prx</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">node</span><span class="main">]</span> <span class="main">.</span>
                        repNodes_eq <span class="bound">sn</span> <span class="bound">no</span> <span class="skolem">low</span> <span class="skolem">high</span>
                         <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">]</span> <span class="main">∧</span>
                    <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                     <span class="main">(</span><span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">no</span><span class="main">)</span> <span class="main">=</span>
                    <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">no</span> <span class="main">∧</span>
                    <span class="main">(</span><span class="main">∀</span><span class="bound">no1</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span>
                        <span class="main">(</span><span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span>
                         <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no</span> <span class="main">∧</span>
                         <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span>
                         <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no</span><span class="main">)</span> <span class="main">=</span>
                        <span class="main">(</span><span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">no</span> <span class="main">=</span>
                         <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">no1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?NodesUnmodif</span> <span class="main">∧</span> <span class="var">?NodesModif</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="comment1">― ‹This proof was originally conducted without the
          substitution <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">node</span><span class="main">)</span>"</span><span class="antiquote">}</span></span> preformed.
          So don't be confused if we show everythin for <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">"repa (low node)"</span><span class="antiquote">}</span></span>.›</span>
    <span class="keyword1"><span class="command">from</span></span> rep_repa_nc
    <span class="keyword1"><span class="command">have</span></span> nodes_unmodif<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?NodesUnmodif</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> rep_Sucna_nc<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">no</span><span class="main">.</span> <span class="bound">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span> 
      <span class="main">⟶</span> <span class="skolem">rep</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="main">(</span><span class="skolem">node</span> <span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">no</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> nodes_modif<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?NodesModif</span></span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">no</span> <span class="main">∧</span> <span class="var">?Q</span> <span class="bound">no</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">no</span>
      <span class="keyword3"><span class="command">assume</span></span> no_in_take_Sucna<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">no</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">no</span> <span class="main">∧</span> <span class="var">?Q</span> <span class="skolem">no</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">=</span> <span class="skolem">node</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">note</span></span> no_noteq_nln<span class="main">=</span>this
        <span class="keyword1"><span class="command">with</span></span> no_in_take_Sucna 
        <span class="keyword1"><span class="command">have</span></span> no_in_take_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">∈</span> set <span class="skolem">prx</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> no_in_take_n while_inv <span class="keyword3"><span class="command">obtain</span></span> 
          repa_no_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">repa</span> <span class="skolem">no</span> <span class="main">≠</span> Null"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          repa_cases<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span> <span class="skolem">low</span> <span class="skolem">no</span> <span class="main">≠</span> Null 
          <span class="keyword1">then</span> <span class="skolem">repa</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span>
          <span class="keyword1">else</span>  <span class="skolem">repa</span> <span class="skolem">no</span> <span class="main">=</span> hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">prx</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span> 
          <span class="main">∧</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">repa</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repa</span> <span class="skolem">no</span> <span class="main">∧</span> 
          <span class="main">(</span><span class="main">∀</span><span class="bound">no1</span><span class="main">∈</span>set <span class="skolem">prx</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> 
          <span class="main">∧</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span><span class="main">)</span> 
          <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">repa</span> <span class="bound">no1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_depth_limit</span> <span class="main"><span class="main">=</span></span> 2<span class="main">]</span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">from</span></span> no_in_take_n 
        <span class="keyword1"><span class="command">have</span></span> no_in_nodeslist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> repa_no_nNull no_noteq_nln <span class="keyword1"><span class="command">have</span></span> ext_repa_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">no</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> no_in_nodeslist nodes_balanced_ordered <span class="keyword3"><span class="command">obtain</span></span>
          nln_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">node</span> <span class="main">≠</span> Null"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          nln_balanced_children<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span> <span class="main">=</span> Null<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">node</span> <span class="main">=</span> Null<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          lnln_notin_nodeslist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">node</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          hnln_notin_nodeslist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">node</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          isLeaf_var_nln<span class="main">:</span> <span class="quoted"><span class="quoted">"isLeaf_pt <span class="skolem">node</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">var</span> <span class="skolem">node</span> <span class="main">≤</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          node_nNull_rap_nNull_nln<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span> <span class="main">≠</span> Null 
          <span class="main">⟶</span> <span class="skolem">rep</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span> <span class="main">≠</span> Null<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          nln_varrep_le_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">node</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">node</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">from</span></span>  no_in_nodeslist nodes_balanced_ordered no_in_take_Sucna 
        <span class="keyword3"><span class="command">obtain</span></span> 
          no_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">≠</span> Null"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          balanced_children<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span> <span class="main">=</span> Null<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span> <span class="main">=</span> Null<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          lno_notin_nodeslist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          hno_notin_nodeslist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          isLeaf_var_no<span class="main">:</span> <span class="quoted"><span class="quoted">"isLeaf_pt <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">var</span> <span class="skolem">no</span> <span class="main">≤</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          node_nNull_rep_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span> <span class="main">≠</span> Null <span class="main">⟶</span> <span class="skolem">rep</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">≠</span> Null<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          varrep_le_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">no</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">from</span></span> lno_notin_nodeslist  
        <span class="keyword1"><span class="command">have</span></span> ext_rep_null_comp_low<span class="main">:</span> 
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repa</span> <span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> hno_notin_nodeslist 
        <span class="keyword1"><span class="command">have</span></span> ext_rep_null_comp_high<span class="main">:</span> 
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repa</span> <span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> share_reduce_if<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="skolem">no</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repa</span> <span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> 
            <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span> <span class="skolem">low</span> <span class="skolem">no</span> <span class="main">≠</span> Null"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> 
            red_case<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repa</span> <span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> 
            <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
            lno_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">no</span> <span class="main">≠</span> Null"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">from</span></span> lno_nNull balanced_children <span class="keyword1"><span class="command">have</span></span> hno_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">no</span> <span class="main">≠</span> Null"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">from</span></span> True ext_rep_null_comp_low ext_rep_null_comp_high 
          <span class="keyword1"><span class="command">have</span></span> repchildren_eq_no<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> repa_cases lno_nNull <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repa</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> ext_rep_null_comp_low no_noteq_nln 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> 
            <span class="main">(</span><span class="skolem">repa</span> <span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> True repchildren_eq_nln <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> share_case_ext<span class="main">:</span> 
            <span class="quoted"><span class="quoted">" <span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> 
            <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span> <span class="skolem">low</span> <span class="skolem">no</span> <span class="main">≠</span> Null<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> not_Leaf isLeaf_var_nln 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">node</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> all_nodes_same_var 
          <span class="keyword1"><span class="command">have</span></span> all_nodes_nl_Suc0_l_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="bound">x</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_depth_limit</span><span class="main"><span class="main">=</span></span>1<span class="main">]</span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> nodes_balanced_ordered 
          <span class="keyword1"><span class="command">have</span></span> all_nodes_nl_noLeaf<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span> <span class="main">¬</span> isLeaf_pt <span class="bound">x</span> <span class="skolem">low</span> <span class="skolem">high</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span><span class="operator">assumption</span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span><span class="operator">assumption</span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">from</span></span> nodes_balanced_ordered 
          <span class="keyword1"><span class="command">have</span></span> all_nodes_nl_balanced<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="skolem">low</span> <span class="bound">x</span> <span class="main">=</span> Null<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">high</span> <span class="bound">x</span> <span class="main">=</span> Null<span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span><span class="operator">assumption</span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">from</span></span> all_nodes_nl_Suc0_l_var no_in_nodeslist 
          <span class="keyword1"><span class="command">have</span></span> Suc0_l_var_no<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">no</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> isLeaf_var_no <span class="keyword1"><span class="command">have</span></span> no_nLeaf<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">¬</span> isLeaf_pt <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> balanced_children <span class="keyword1"><span class="command">have</span></span> lno_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">no</span> <span class="main">≠</span> Null"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isLeaf_pt_def<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> balanced_children <span class="keyword1"><span class="command">have</span></span> hno_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">no</span> <span class="main">≠</span> Null"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> share_case_ext ext_rep_null_comp_low ext_rep_null_comp_high lno_nNull 
          <span class="keyword1"><span class="command">have</span></span> repchildren_neq_no<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">≠</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> repa_cases 
          <span class="keyword1"><span class="command">have</span></span> share_case_inv<span class="main">:</span> 
          <span class="quoted"><span class="quoted">"<span class="skolem">repa</span> <span class="skolem">no</span> <span class="main">=</span> hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">prx</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span> <span class="main">∧</span> 
            <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">repa</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repa</span> <span class="skolem">no</span> <span class="main">∧</span> 
            <span class="main">(</span><span class="main">∀</span><span class="bound">no1</span><span class="main">∈</span>set <span class="skolem">prx</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span> 
            <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">repa</span> <span class="bound">no1</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> repa_no<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repa</span> <span class="skolem">no</span> <span class="main">=</span> hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">prx</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">from</span></span> Suc0_l_var_no <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">no</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> no_in_take_n <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">prx</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> filter_not_empty<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repNodes_eq_def<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"repNodes_eq 
            <span class="main">(</span>hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">prx</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span><span class="main">)</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hd_filter_prop<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> repa_no 
          <span class="keyword1"><span class="command">have</span></span> rep_children_eq_no_repa_no<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repa</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span> 
             <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repa</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repNodes_eq_def<span class="main">)</span> 
          <span class="keyword1"><span class="command">from</span></span> lno_notin_nodeslist rep_repa_nc 
          <span class="keyword1"><span class="command">have</span></span> rep_repa_nc_low_no<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rep</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">no</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> 
            repNodes_eq <span class="bound">x</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
            repNodes_eq <span class="bound">x</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> repNodes_eq_def<span class="main">)</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
            <span class="keyword3"><span class="command">assume</span></span> x_in_take_Sucn<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> x_in_nodeslist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">with</span></span> all_nodes_nl_noLeaf nodes_balanced_ordered 
            <span class="keyword1"><span class="command">have</span></span> children_nNull_x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">x</span> <span class="main">≠</span> Null <span class="main">∧</span> <span class="skolem">high</span> <span class="skolem">x</span> <span class="main">≠</span> Null"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span><span class="operator">assumption</span><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span><span class="operator">assumption</span><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isLeaf_pt_def<span class="main">)</span> 
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">from</span></span> x_in_nodeslist nodes_balanced_ordered 
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">x</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">high</span> <span class="skolem">x</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span><span class="operator">assumption</span><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">with</span></span> lno_notin_nodeslist hno_notin_nodeslist 
              children_nNull_x lno_nNull hno_nNull
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> 
              <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span>
              <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> 
              <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span>
              <span class="main">(</span><span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span> 
              <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> filter_extrep_rep<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> 
                                   <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> 
            <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> P_eq_list_filter<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> no_in_take_n 
          <span class="keyword1"><span class="command">have</span></span> filter_n_notempty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">prx</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> filter_not_empty<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repNodes_eq_def<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">prx</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span> <span class="main">=</span> 
            hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> no_noteq_nln filter_extrep_rep repa_no 
          <span class="keyword1"><span class="command">have</span></span> ext_repa_no<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span><span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> 
            hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> 
            <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">]</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repa</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repa</span> <span class="skolem">no</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">repa</span> <span class="skolem">no</span> <span class="main">=</span>  <span class="skolem">node</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">note</span></span> rno_nln<span class="main">=</span>this
            <span class="keyword1"><span class="command">from</span></span> rep_repa_nc_low_no rep_children_eq_no_repa_no lno_nNull 
              node_nNull_rep_nNull 
            <span class="keyword1"><span class="command">have</span></span> low_rep_no_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="main">(</span><span class="skolem">repa</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">≠</span> Null"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">with</span></span> nodes_balanced_ordered rno_nln 
            <span class="keyword1"><span class="command">have</span></span> high_rap_no_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="main">(</span><span class="skolem">repa</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">≠</span> Null"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">repa</span> <span class="skolem">no</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">with</span></span> low_rep_no_nNull rno_nln rep_children_eq_no_repa_no 
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span> 
              <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">node</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span>"</span></span> 
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> repchildren_eq_nln <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">with</span></span> repchildren_neq_no <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">assume</span></span> rno_not_nln<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repa</span> <span class="skolem">no</span> <span class="main">≠</span> <span class="skolem">node</span>"</span></span>
            <span class="keyword1"><span class="command">from</span></span> share_case_inv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repa</span> <span class="main">(</span><span class="skolem">repa</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repa</span> <span class="skolem">no</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">with</span></span> rno_not_nln <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">with</span></span> no_noteq_nln <span class="keyword1"><span class="command">have</span></span> ext_repa_ext_repa<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
            <span class="main">(</span><span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">no</span><span class="main">)</span> 
            <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">no</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">no1</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span>
            <span class="main">(</span><span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> 
            <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span>  <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span>
            <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span>  <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> 
            <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span>  <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span>
            <span class="main">(</span><span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span>  <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> 
            <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span>  <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">no1</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">no1</span>
            <span class="keyword3"><span class="command">assume</span></span> no1_in_take_Sucn<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">no1</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> no1_in_nodeslist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">no1</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no1</span> <span class="main">=</span> 
                 <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span>
                 <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no1</span> <span class="main">=</span> 
                 <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span>
                 <span class="main">(</span><span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> 
                  <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">no1</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">no1</span> <span class="main">=</span> <span class="skolem">node</span>"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> conjE<span class="main">)</span>
                <span class="keyword3"><span class="command">assume</span></span> ext_repa_no_no1<span class="main">:</span> 
                  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> 
                    <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">no1</span>"</span></span>
                <span class="keyword1"><span class="command">with</span></span> True no_noteq_nln 
                <span class="keyword1"><span class="command">have</span></span> repa_no_repa_low_nln<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repa</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">from</span></span> filter_n_notempty 
                <span class="keyword1"><span class="command">have</span></span> repa_no_in_take_n<span class="main">:</span>  
                  <span class="quoted"><span class="quoted">"hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">prx</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span> 
                    <span class="main">∈</span> set <span class="skolem">prx</span> "</span></span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> hd_filter_in_list<span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                <span class="keyword1"><span class="command">with</span></span> repa_no 
                <span class="keyword1"><span class="command">have</span></span> repa_no_in_nodeslist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repa</span> <span class="skolem">no</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">from</span></span> lnln_notin_nodeslist rep_repa_nc 
                <span class="keyword1"><span class="command">have</span></span> rep_repa_low_nln<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rep</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">from</span></span> all_nodes_nl_noLeaf nln_balanced_children
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">node</span> <span class="main">≠</span> Null"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isLeaf_pt_def<span class="main">)</span>
                <span class="keyword1"><span class="command">with</span></span> rep_repa_low_nln lnln_notin_nodeslist lno_nNull 
                  nln_varrep_le_var 
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span> 
                <span class="keyword1"><span class="command">with</span></span> repa_no_repa_low_nln repa_no_in_nodeslist 
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no1</span> <span class="main">=</span> 
                  <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span>
                  <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no1</span> <span class="main">=</span> 
                  <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">next</span></span>
                <span class="keyword3"><span class="command">assume</span></span> no_no1_high<span class="main">:</span> 
                  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no1</span> <span class="main">=</span> 
                  <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
                <span class="keyword3"><span class="command">assume</span></span> no_no1_low<span class="main">:</span> 
                  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no1</span> <span class="main">=</span> 
                  <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
                <span class="keyword1"><span class="command">from</span></span> True repchildren_eq_nln 
                <span class="keyword1"><span class="command">have</span></span> repachildren_eq_no1<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no1</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">from</span></span> not_Leaf True nln_balanced_children 
                <span class="keyword1"><span class="command">have</span></span> children_nNull_no1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">low</span> <span class="skolem">no1</span><span class="main">)</span> <span class="main">≠</span> Null <span class="main">∧</span> <span class="skolem">high</span> <span class="skolem">no1</span> <span class="main">≠</span> Null"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isLeaf_pt_def<span class="main">)</span>
                <span class="keyword1"><span class="command">with</span></span> repachildren_eq_no1 
                <span class="keyword1"><span class="command">have</span></span> repchildren_eq_no1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no1</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
                <span class="keyword1"><span class="command">from</span></span> no_no1_low children_nNull_no1 lno_nNull 
                  lnln_notin_nodeslist lno_notin_nodeslist True 
                <span class="keyword1"><span class="command">have</span></span> rep_low_eq_no_no1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
                <span class="keyword1"><span class="command">from</span></span> no_no1_high children_nNull_no1 hno_nNull 
                  hnln_notin_nodeslist hno_notin_nodeslist True 
                <span class="keyword1"><span class="command">have</span></span> rep_high_eq_no_no1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
                <span class="keyword1"><span class="command">with</span></span> rep_low_eq_no_no1 repchildren_eq_no1 
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">with</span></span> repchildren_neq_no 
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> 
                  <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">no1</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">assume</span></span> no1_neq_nln<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">no1</span> <span class="main">≠</span> <span class="skolem">node</span>"</span></span>
              <span class="keyword1"><span class="command">from</span></span> no1_in_nodeslist nodes_balanced_ordered 
              <span class="keyword1"><span class="command">have</span></span> children_notin_nl_no1<span class="main">:</span> 
              <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">no1</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">high</span> <span class="skolem">no1</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">no1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span><span class="operator">assumption</span><span class="main">)</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">from</span></span> no1_neq_nln no1_in_take_Sucn 
              <span class="keyword1"><span class="command">have</span></span> no1_in_take_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">no1</span> <span class="main">∈</span> set <span class="skolem">prx</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">from</span></span> no1_in_nodeslist all_nodes_nl_noLeaf all_nodes_nl_balanced 
              <span class="keyword1"><span class="command">have</span></span> children_nNull_no1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">low</span> <span class="skolem">no1</span><span class="main">)</span> <span class="main">≠</span> Null <span class="main">∧</span> <span class="skolem">high</span> <span class="skolem">no1</span> <span class="main">≠</span> Null"</span></span>
                <span class="keyword1"><span class="command">by</span></span>  <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isLeaf_pt_def<span class="main">)</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> conjE<span class="main">)</span>
                <span class="keyword3"><span class="command">assume</span></span> ext_repa_high_no1_no<span class="main">:</span> 
                <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no1</span> 
                  <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span>"</span></span> 
                <span class="keyword3"><span class="command">assume</span></span> ext_repa_low_no1_no<span class="main">:</span> 
                  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no1</span> 
                  <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
                <span class="keyword1"><span class="command">from</span></span> children_nNull_no1 hno_nNull ext_repa_high_no1_no 
                  children_notin_nl_no1 
                  hno_notin_nodeslist 
                <span class="keyword1"><span class="command">have</span></span> repa_high_no1_no<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
                <span class="keyword1"><span class="command">from</span></span> children_nNull_no1 lno_nNull ext_repa_low_no1_no 
                  children_notin_nl_no1 lno_notin_nodeslist 
                <span class="keyword1"><span class="command">have</span></span> repa_low_no1_no<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
                <span class="keyword1"><span class="command">from</span></span> repchildren_neq_no repa_high_no1_no repa_low_no1_no 
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no1</span> <span class="main">≠</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no1</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">from</span></span> no1_in_take_n share_case_inv repa_high_no1_no repa_low_no1_no 
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repa</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">repa</span> <span class="skolem">no1</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">with</span></span> no_noteq_nln no1_neq_nln 
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> 
                  <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">no1</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">next</span></span>
                <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> 
                  <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">no1</span>"</span></span>
                <span class="keyword1"><span class="command">with</span></span> no_noteq_nln no1_neq_nln 
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repa</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">repa</span> <span class="skolem">no1</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">with</span></span> share_case_inv no1_in_take_n 
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span> 
                  <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">with</span></span> children_notin_nl_no1 children_nNull_no1 lno_notin_nodeslist 
                  hno_notin_nodeslist lno_nNull hno_nNull 
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no1</span> <span class="main">=</span> 
                <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span>
                <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no1</span> <span class="main">=</span> 
                <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
              <span class="keyword1"><span class="command">qed</span></span> 
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">from</span></span> ext_repa_ext_repa ext_repa_no share_case_ext repchildren_eq_nln this 
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_depth_limit</span><span class="main"><span class="main">=</span></span>4<span class="main">]</span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">with</span></span> ext_repa_nNull <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> no_nln<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">=</span> <span class="skolem">node</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> no_in_nodeslist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> no_nln not_Leaf no_in_nodeslist 
          nodes_balanced_ordered <span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span>  
          low_no_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">no</span> <span class="main">≠</span> Null"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          high_no_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">no</span> <span class="main">≠</span> Null"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          rep_low_no_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rep</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">≠</span> Null"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          lno_notin_nl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          hno_notin_nl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          children_nNull_no<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span> <span class="main">≠</span> Null<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span> <span class="main">≠</span> Null<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> isLeaf_pt_def<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">no</span> <span class="main">∉</span> set <span class="skolem">prx</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> rep_repa_nc no_nln rep_low_no_nNull 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">≠</span> Null"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> 
                  <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span> <span class="skolem">low</span> <span class="skolem">no</span> <span class="main">≠</span> Null
          <span class="keyword1">then</span> <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> 
               <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span>
          <span class="keyword1">else</span> <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span>
            hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> 
                <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">]</span> <span class="main">∧</span>
          <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
            <span class="main">(</span><span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span>
            <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span>
          <span class="main">(</span><span class="main">∀</span><span class="bound">no1</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span>
            <span class="main">(</span><span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> 
            <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span>
            <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> 
            <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span>
            <span class="main">(</span><span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> 
            <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">no1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> 
          <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span> <span class="skolem">low</span> <span class="skolem">no</span> <span class="main">≠</span> Null"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">note</span></span> red_case<span class="main">=</span>this
          <span class="keyword1"><span class="command">with</span></span> children_nNull_no lno_notin_nl hno_notin_nl 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> children_nNull_no lno_notin_nl 
          <span class="keyword1"><span class="command">have</span></span> ext_repa_eq_repa_low<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> 
            <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> "</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> children_nNull_no hno_notin_nl 
          <span class="keyword1"><span class="command">have</span></span> ext_repa_eq_repa_high<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> 
            <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> "</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> no_nln children_nNull_no 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> red_case ext_repa_eq_repa_high ext_repa_eq_repa_low no_nln 
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_depth_limit</span><span class="main"><span class="main">=</span></span>2<span class="main">]</span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> null_comp_not_Null<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> share_case<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> 
            <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span> <span class="skolem">low</span> <span class="skolem">no</span> <span class="main">≠</span> Null<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> low_no_nNull <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> 
            <span class="main">≠</span> <span class="main">(</span><span class="skolem">repa</span><span class="main">(</span><span class="skolem">node</span> <span class="main">:=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> children_nNull_no lno_notin_nl hno_notin_nl 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">≠</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> children_nNull_no <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> repchildren_eq_nln no_nln <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> repchildren_eq_nln
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> nodes_unmodif nodes_modif
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">iprover</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">var</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">rep</span> <span class="skolem">nodeslist</span> <span class="skolem">repa</span> <span class="quoted">"<span class="skolem">next</span>"</span> <span class="skolem">node</span> <span class="skolem">prx</span> <span class="skolem">sfx</span> <span class="skolem">repb</span>
  <span class="keyword3"><span class="command">assume</span></span> ns<span class="main">:</span> <span class="quoted"><span class="quoted">"List <span class="skolem">nodeslist</span> <span class="skolem">next</span> <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> sfx<span class="main">:</span> <span class="quoted"><span class="quoted">"List <span class="main">(</span><span class="skolem">next</span> <span class="skolem">node</span><span class="main">)</span> <span class="skolem">next</span> <span class="skolem">sfx</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> nodes_balanced_ordered<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span>
           <span class="bound">no</span> <span class="main">≠</span> Null <span class="main">∧</span>
           <span class="main">(</span><span class="skolem">low</span> <span class="bound">no</span> <span class="main">=</span> Null<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">high</span> <span class="bound">no</span> <span class="main">=</span> Null<span class="main">)</span> <span class="main">∧</span>
           <span class="skolem">low</span> <span class="bound">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span> <span class="main">∧</span>
           <span class="skolem">high</span> <span class="bound">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span> <span class="main">∧</span>
           isLeaf_pt <span class="bound">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">var</span> <span class="bound">no</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="skolem">low</span> <span class="bound">no</span> <span class="main">≠</span> Null <span class="main">⟶</span> <span class="skolem">rep</span> <span class="main">(</span><span class="skolem">low</span> <span class="bound">no</span><span class="main">)</span> <span class="main">≠</span> Null<span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> all_nodes_same_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no1</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span>
           <span class="main">∀</span><span class="bound">no2</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span> <span class="skolem">var</span> <span class="bound">no1</span> <span class="main">=</span> <span class="skolem">var</span> <span class="bound">no2</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> rep_repa_nc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span><span class="main">.</span> <span class="bound">no</span> <span class="main">∉</span> set <span class="skolem">prx</span> <span class="main">⟶</span> <span class="skolem">rep</span> <span class="bound">no</span> <span class="main">=</span> <span class="skolem">repa</span> <span class="bound">no</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> while_inv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set <span class="skolem">prx</span><span class="main">.</span>
           <span class="skolem">repa</span> <span class="bound">no</span> <span class="main">≠</span> Null <span class="main">∧</span>
           <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no</span> <span class="main">∧</span> <span class="skolem">low</span> <span class="bound">no</span> <span class="main">≠</span> Null
            <span class="keyword1">then</span> <span class="skolem">repa</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no</span>
            <span class="keyword1">else</span> <span class="skolem">repa</span> <span class="bound">no</span> <span class="main">=</span> hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">prx</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="bound">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span> <span class="main">∧</span>
                 <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">repa</span> <span class="bound">no</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repa</span> <span class="bound">no</span> <span class="main">∧</span>
                 <span class="main">(</span><span class="main">∀</span><span class="bound">no1</span><span class="main">∈</span>set <span class="skolem">prx</span><span class="main">.</span>
                     <span class="main">(</span><span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no</span> <span class="main">∧</span>
                      <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no</span><span class="main">)</span> <span class="main">=</span>
                     <span class="main">(</span><span class="skolem">repa</span> <span class="bound">no</span> <span class="main">=</span> <span class="skolem">repa</span> <span class="bound">no1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> share_cond<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">¬</span> isLeaf_pt <span class="skolem">node</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="main">∧</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">node</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">node</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> repb_node<span class="main">:</span> 
          <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">node</span> <span class="main">=</span> hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">node</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> repa_repb_nc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">pt</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">≠</span> <span class="skolem">node</span> <span class="main">⟶</span> <span class="skolem">repa</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">repb</span> <span class="bound">pt</span>"</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> var_repb_node<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">node</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">var</span> <span class="skolem">node</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">no</span><span class="main">.</span> <span class="bound">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span> <span class="main">⟶</span> <span class="skolem">rep</span> <span class="bound">no</span> <span class="main">=</span> <span class="skolem">repb</span> <span class="bound">no</span><span class="main">)</span> <span class="main">∧</span>
          <span class="main">(</span><span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span>
              <span class="skolem">repb</span> <span class="bound">no</span> <span class="main">≠</span> Null <span class="main">∧</span>
              <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no</span> <span class="main">∧</span> <span class="skolem">low</span> <span class="bound">no</span> <span class="main">≠</span> Null
               <span class="keyword1">then</span> <span class="skolem">repb</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no</span>
               <span class="keyword1">else</span> <span class="skolem">repb</span> <span class="bound">no</span> <span class="main">=</span>
                    hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">prx</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">node</span><span class="main">]</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="bound">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span> <span class="main">∧</span>
                    <span class="skolem">repb</span> <span class="main">(</span><span class="skolem">repb</span> <span class="bound">no</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repb</span> <span class="bound">no</span> <span class="main">∧</span>
                    <span class="main">(</span><span class="main">∀</span><span class="bound">no1</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span>
                        <span class="main">(</span><span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no</span> <span class="main">∧</span>
                         <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no</span><span class="main">)</span> <span class="main">=</span>
                        <span class="main">(</span><span class="skolem">repb</span> <span class="bound">no</span> <span class="main">=</span> <span class="skolem">repb</span> <span class="bound">no1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> rep_repb_nc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">no</span><span class="main">.</span> <span class="bound">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span> <span class="main">⟶</span> <span class="skolem">rep</span> <span class="bound">no</span> <span class="main">=</span> <span class="skolem">repb</span> <span class="bound">no</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">no</span>
      <span class="keyword3"><span class="command">assume</span></span> no_notin_take_Sucn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> rep_repa_nc 
      <span class="keyword1"><span class="command">have</span></span> rep_repa_nc_Sucn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rep</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">repa</span> <span class="skolem">no</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> no_notin_take_Sucn <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">≠</span> <span class="skolem">node</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> repa_repb_nc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repa</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">repb</span> <span class="skolem">no</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> rep_repa_nc_Sucn <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rep</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">repb</span> <span class="skolem">no</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> repb_no_share_def<span class="main">:</span> 
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> 
      <span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no</span> <span class="main">∧</span> <span class="skolem">low</span> <span class="bound">no</span> <span class="main">≠</span> Null<span class="main">)</span> <span class="main">⟶</span> 
          <span class="skolem">repb</span> <span class="bound">no</span> <span class="main">=</span> hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="bound">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ballI impI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">no</span>
      <span class="keyword3"><span class="command">assume</span></span> no_in_take_Sucn<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">no</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> share_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span> <span class="skolem">low</span> <span class="skolem">no</span> <span class="main">≠</span> Null<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> share_prop <span class="keyword1"><span class="command">have</span></span> share_or<span class="main">:</span> 
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">≠</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∨</span> <span class="skolem">low</span> <span class="skolem">no</span> <span class="main">=</span> Null"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_depth_limit</span><span class="main"><span class="main">=</span></span>2<span class="main">]</span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> no_in_take_Sucn <span class="keyword1"><span class="command">have</span></span> no_in_nl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> nodes_balanced_ordered <span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span>
        no_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">≠</span> Null"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        balanced_no<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span> <span class="main">=</span> Null<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span> <span class="main">=</span> Null<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        lno_notin_nl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        hno_notin_nl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        isLeaf_var_no<span class="main">:</span> <span class="quoted"><span class="quoted">"isLeaf_pt <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">var</span> <span class="skolem">no</span> <span class="main">≤</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> nodes_notin_nl_neq_nln<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">p</span> <span class="main">≠</span> <span class="skolem">node</span> "</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">repb</span> <span class="skolem">no</span> <span class="main">=</span> hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">=</span> <span class="skolem">node</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">note</span></span> no_notin_nl<span class="main">=</span>this
        <span class="keyword1"><span class="command">with</span></span> no_in_take_Sucn <span class="keyword1"><span class="command">have</span></span> no_in_take_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">∈</span> set <span class="skolem">prx</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> False repa_repb_nc <span class="keyword1"><span class="command">have</span></span> repb_repa_no<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">repa</span> <span class="skolem">no</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> while_inv <span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> no_in_take_n<span class="main">]</span> no_in_take_n <span class="keyword3"><span class="command">obtain</span></span> 
          repa_no_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repa</span> <span class="skolem">no</span> <span class="main">≠</span> Null"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          while_share_red_exp<span class="main">:</span> 
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span> <span class="skolem">low</span> <span class="skolem">no</span> <span class="main">≠</span> Null 
              <span class="keyword1">then</span> <span class="skolem">repa</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span>
              <span class="keyword1">else</span> <span class="skolem">repa</span> <span class="skolem">no</span> <span class="main">=</span> hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">prx</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span> <span class="main">∧</span>
              <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">repa</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repa</span> <span class="skolem">no</span> <span class="main">∧</span> 
              <span class="main">(</span><span class="main">∀</span><span class="bound">no1</span><span class="main">∈</span>set <span class="skolem">prx</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span> 
              <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">repa</span> <span class="bound">no1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_depth_limit</span> <span class="main"><span class="main">=</span></span> 2<span class="main">]</span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">from</span></span> no_in_take_n 
        <span class="keyword1"><span class="command">have</span></span> filter_take_n_notempty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">prx</span><span class="main">.</span> 
          repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> filter_not_empty<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repNodes_eq_def<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> hd_term_n_Sucn<span class="main">:</span> 
          <span class="quoted"><span class="quoted">"hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">prx</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span> 
              <span class="main">=</span> hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">no</span> <span class="main">=</span> Null"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">note</span></span> lno_Null<span class="main">=</span>this
          <span class="keyword1"><span class="command">with</span></span> balanced_no <span class="keyword1"><span class="command">have</span></span> hno_Null<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">no</span> <span class="main">=</span> Null"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">from</span></span> lno_Null hno_Null <span class="keyword1"><span class="command">have</span></span> isLeaf_no<span class="main">:</span> <span class="quoted"><span class="quoted">"isLeaf_pt <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isLeaf_pt_def<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> True while_share_red_exp 
          <span class="keyword1"><span class="command">have</span></span> while_low_Null<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"<span class="skolem">repa</span> <span class="skolem">no</span> <span class="main">=</span> hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">prx</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span> <span class="main">∧</span>
             <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">repa</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repa</span> <span class="skolem">no</span> <span class="main">∧</span> 
             <span class="main">(</span><span class="main">∀</span><span class="bound">no1</span><span class="main">∈</span>set <span class="skolem">prx</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> 
             <span class="main">∧</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">repa</span> <span class="bound">no1</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> all_nodes_in_nl_Leafs<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span> isLeaf_pt <span class="bound">x</span> <span class="skolem">low</span> <span class="skolem">high</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ballI<span class="main">)</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
            <span class="keyword3"><span class="command">assume</span></span> x_in_nodeslist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">from</span></span> isLeaf_no isLeaf_var_no <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">no</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">with</span></span> all_nodes_same_var <span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> x_in_nodeslist no_in_nl<span class="main">]</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">with</span></span> nodes_balanced_ordered <span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> x_in_nodeslist<span class="main">]</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"isLeaf_pt <span class="skolem">x</span> <span class="skolem">low</span> <span class="skolem">high</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isLeaf_pt_def<span class="main">)</span>  
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">x</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span> 
                <span class="main">=</span> repNodes_eq <span class="bound">x</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
            <span class="keyword3"><span class="command">assume</span></span> x_in_take_Sucn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> x_in_nodeslist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">with</span></span> all_nodes_in_nl_Leafs <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"isLeaf_pt <span class="skolem">x</span> <span class="skolem">low</span> <span class="skolem">high</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">with</span></span> isLeaf_no repa_repb_nc <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"repNodes_eq <span class="skolem">x</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span> 
                  <span class="main">=</span> repNodes_eq <span class="skolem">x</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repNodes_eq_def null_comp_def isLeaf_pt_def<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span> 
                <span class="main">=</span> <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> P_eq_list_filter<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">with</span></span> hd_term_n_Sucn while_low_Null repb_repa_no <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> lno_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">low</span> <span class="skolem">no</span> <span class="main">≠</span> Null"</span></span>
          <span class="keyword1"><span class="command">with</span></span> balanced_no <span class="keyword1"><span class="command">have</span></span> hno_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">no</span> <span class="main">≠</span> Null"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> lno_nNull <span class="keyword1"><span class="command">have</span></span> no_nLeaf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> isLeaf_pt <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isLeaf_pt_def<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> isLeaf_var_no <span class="keyword1"><span class="command">have</span></span> Sucn_s_varno<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">no</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> no_in_nl all_nodes_same_var 
          <span class="keyword1"><span class="command">have</span></span> all_nodes_nl_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="bound">x</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">no</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span><span class="operator">assumption</span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span><span class="operator">assumption</span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">with</span></span> nodes_balanced_ordered 
          <span class="keyword1"><span class="command">have</span></span> all_nodes_nl_nLeaf<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span> <span class="main">¬</span> isLeaf_pt <span class="bound">x</span> <span class="skolem">low</span> <span class="skolem">high</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span><span class="operator">assumption</span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span><span class="operator">assumption</span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">from</span></span> lno_nNull share_or 
          <span class="keyword1"><span class="command">have</span></span> repbchildren_eq_no<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">≠</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> lno_nNull hno_nNull lno_notin_nl hno_notin_nl repa_repb_nc  
            nodes_notin_nl_neq_nln 
          <span class="keyword1"><span class="command">have</span></span> repachildren_eq_no<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">≠</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_depth_limit</span><span class="main"><span class="main">=</span></span>2<span class="main">]</span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span> 
          <span class="keyword1"><span class="command">with</span></span> while_share_red_exp 
          <span class="keyword1"><span class="command">have</span></span> repa_no_def<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"<span class="skolem">repa</span> <span class="skolem">no</span> <span class="main">=</span> hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">prx</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span> "</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> no_notin_nl repa_repb_nc 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">no</span> <span class="main">=</span>  hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">prx</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span> "</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> hd_term_n_Sucn 
          <span class="keyword1"><span class="command">have</span></span> repb_no_hd_term_repa<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">no</span> <span class="main">=</span> 
                 hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span> "</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> 
            repNodes_eq <span class="bound">x</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span> <span class="main">=</span> repNodes_eq <span class="bound">x</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span>"</span></span> 
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ballI<span class="main">)</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
            <span class="keyword3"><span class="command">assume</span></span> x_in_take_Sucn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span> "</span></span>
            <span class="keyword1"><span class="command">hence</span></span> x_in_nodeslist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">with</span></span> all_nodes_nl_nLeaf <span class="keyword1"><span class="command">have</span></span> x_nLeaf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> isLeaf_pt <span class="skolem">x</span> <span class="skolem">low</span> <span class="skolem">high</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> nodes_balanced_ordered <span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> x_in_nodeslist<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span>
              balanced_x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">low</span> <span class="skolem">x</span> <span class="main">=</span> Null<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">x</span> <span class="main">=</span> Null<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
              lx_notin_nl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">x</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
              hx_notin_nl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">x</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span>"</span></span> 
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">with</span></span> nodes_notin_nl_neq_nln lno_notin_nl hno_notin_nl lno_nNull 
              hno_nNull repa_repb_nc 
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" repNodes_eq <span class="skolem">x</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span> <span class="main">=</span> repNodes_eq <span class="skolem">x</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repNodes_eq_def null_comp_def<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span> <span class="main">=</span> 
            <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> P_eq_list_filter<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">with</span></span> repb_no_hd_term_repa <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span> 
        <span class="keyword3"><span class="command">assume</span></span> no_nln<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">=</span> <span class="skolem">node</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> repb_node <span class="keyword1"><span class="command">have</span></span> repb_no_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">no</span> <span class="main">=</span> 
          hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">node</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"isLeaf_pt <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">note</span></span> isLeaf_no<span class="main">=</span>this
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">x</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span> 
            <span class="main">=</span> repNodes_eq <span class="bound">x</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
            <span class="keyword3"><span class="command">assume</span></span> x_in_nodeslist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">have</span></span> all_nodes_in_nl_Leafs<span class="main">:</span> 
              <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span> isLeaf_pt <span class="bound">x</span> <span class="skolem">low</span> <span class="skolem">high</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ballI<span class="main">)</span>
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
              <span class="keyword3"><span class="command">assume</span></span> x_in_nodeslist<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">from</span></span> isLeaf_no isLeaf_var_no <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">no</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">with</span></span> all_nodes_same_var <span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> x_in_nodeslist no_in_nl<span class="main">]</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">with</span></span> nodes_balanced_ordered <span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> x_in_nodeslist<span class="main">]</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"isLeaf_pt <span class="skolem">x</span> <span class="skolem">low</span> <span class="skolem">high</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isLeaf_pt_def<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">with</span></span> x_in_nodeslist <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"isLeaf_pt <span class="skolem">x</span> <span class="skolem">low</span> <span class="skolem">high</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">with</span></span> isLeaf_no repa_repb_nc 
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"repNodes_eq <span class="skolem">x</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span> <span class="main">=</span> repNodes_eq <span class="skolem">x</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repNodes_eq_def null_comp_def isLeaf_pt_def<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">with</span></span> repb_no_def no_nln <span class="keyword1"><span class="command">have</span></span> repb_no_whole_nl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">no</span> <span class="main">=</span> 
            hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span> <span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">node</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> 
              <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">sn</span><span class="main">←</span> <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">node</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span> 
              <span class="main">=</span> <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">node</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span>"</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> P_eq_list_filter<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">from</span></span> no_in_take_Sucn no_nln 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">sn</span><span class="main">←</span> <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">node</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span>  <span class="main">≠</span> <span class="main">[]</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> filter_not_empty<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repNodes_eq_def<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">then</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">node</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span> <span class="main">=</span> 
                hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span> <span class="main">@</span> <span class="skolem">node</span> <span class="main">#</span> <span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">node</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> hd_filter_app <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">with</span></span> repb_no_whole_nl no_nln <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>         
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> no_nLeaf<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">¬</span> isLeaf_pt <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> share_or balanced_no <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">≠</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_depth_limit</span><span class="main"><span class="main">=</span></span>2<span class="main">]</span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isLeaf_pt_def<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> no_nLeaf share_cond no_nln <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> no_nLeaf balanced_no <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">≠</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> "</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def isLeaf_pt_def<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">x</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span> 
            <span class="main">=</span> repNodes_eq <span class="bound">x</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
            <span class="keyword3"><span class="command">assume</span></span> x_in_nodeslist<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">have</span></span> all_nodes_in_nl_Leafs<span class="main">:</span> 
              <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span> <span class="main">¬</span> isLeaf_pt <span class="bound">x</span> <span class="skolem">low</span> <span class="skolem">high</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ballI<span class="main">)</span>
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
              <span class="keyword3"><span class="command">assume</span></span> x_in_nodeslist<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">from</span></span> no_nLeaf isLeaf_var_no <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">no</span> "</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">with</span></span> all_nodes_same_var <span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> x_in_nodeslist no_in_nl<span class="main">]</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">x</span>"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">with</span></span> nodes_balanced_ordered <span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> x_in_nodeslist<span class="main">]</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> isLeaf_pt <span class="skolem">x</span> <span class="skolem">low</span> <span class="skolem">high</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> isLeaf_pt_def<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">with</span></span> x_in_nodeslist <span class="keyword1"><span class="command">have</span></span> x_nLeaf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> isLeaf_pt <span class="skolem">x</span> <span class="skolem">low</span> <span class="skolem">high</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> nodes_balanced_ordered <span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> x_in_nodeslist<span class="main">]</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">low</span> <span class="skolem">x</span> <span class="main">=</span> Null<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">x</span> <span class="main">=</span> Null<span class="main">)</span> 
                  <span class="main">∧</span> <span class="skolem">low</span> <span class="skolem">x</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">high</span> <span class="skolem">x</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">with</span></span> x_nLeaf balanced_no no_nLeaf repa_repb_nc 
              nodes_notin_nl_neq_nln lno_notin_nl hno_notin_nl
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"repNodes_eq <span class="skolem">x</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span> <span class="main">=</span> repNodes_eq <span class="skolem">x</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_depth_limit</span><span class="main"><span class="main">=</span></span>2<span class="main">]</span><span class="main">]</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repNodes_eq_def null_comp_def isLeaf_pt_def<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">with</span></span> repb_no_def no_nln 
          <span class="keyword1"><span class="command">have</span></span> repb_no_whole_nl<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">no</span> <span class="main">=</span> hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">node</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> 
                  <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">node</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span> 
                  <span class="main">=</span> <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">node</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span>"</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> P_eq_list_filter<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">from</span></span> no_in_take_Sucn no_nln 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">node</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span>  <span class="main">≠</span> <span class="main">[]</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> filter_not_empty<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repNodes_eq_def<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 
            <span class="quoted"><span class="quoted">"hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span> <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">node</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span> <span class="main">=</span> 
            hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">node</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> hd_filter_app <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">with</span></span> repb_no_whole_nl no_nln <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>        
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> repb_no_red_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span><span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no</span> 
      <span class="main">∧</span> <span class="skolem">low</span> <span class="bound">no</span> <span class="main">≠</span> Null <span class="main">⟶</span>  <span class="skolem">repb</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ballI impI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">no</span>
      <span class="keyword3"><span class="command">assume</span></span> no_in_take_Sucn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> red_cond_no<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span> <span class="skolem">low</span> <span class="skolem">no</span> <span class="main">≠</span> Null"</span></span>
      <span class="keyword1"><span class="command">from</span></span> no_in_take_Sucn <span class="keyword1"><span class="command">have</span></span> no_in_nl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> nodes_balanced_ordered <span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> this<span class="main">]</span><span class="keyword3"><span class="command">obtain</span></span>
        no_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">≠</span> Null"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        balanced_no<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span> <span class="main">=</span> Null<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span> <span class="main">=</span> Null<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        lno_notin_nl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        hno_notin_nl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        isLeaf_var_no<span class="main">:</span> <span class="quoted"><span class="quoted">"isLeaf_pt <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">var</span> <span class="skolem">no</span> <span class="main">≤</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> nodes_notin_nl_neq_nln<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">p</span> <span class="main">≠</span> <span class="skolem">node</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">repb</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">=</span> <span class="skolem">node</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">note</span></span> no_notin_nl<span class="main">=</span>this
        <span class="keyword1"><span class="command">with</span></span> no_in_take_Sucn <span class="keyword1"><span class="command">have</span></span> no_in_take_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">∈</span> set <span class="skolem">prx</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> False repa_repb_nc <span class="keyword1"><span class="command">have</span></span> repb_repa_no<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">repa</span> <span class="skolem">no</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> while_inv <span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> no_in_take_n<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> 
          repa_no_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repa</span> <span class="skolem">no</span> <span class="main">≠</span> Null"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          while_share_red_exp<span class="main">:</span> 
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span> <span class="skolem">low</span> <span class="skolem">no</span> <span class="main">≠</span> Null 
          <span class="keyword1">then</span> <span class="skolem">repa</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span>
          <span class="keyword1">else</span> <span class="skolem">repa</span> <span class="skolem">no</span> <span class="main">=</span> hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">prx</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span> <span class="main">∧</span>
          <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">repa</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repa</span> <span class="skolem">no</span> <span class="main">∧</span> 
          <span class="main">(</span><span class="main">∀</span><span class="bound">no1</span><span class="main">∈</span>set <span class="skolem">prx</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span> 
          <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">repa</span> <span class="bound">no1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_depth_limit</span><span class="main"><span class="main">=</span></span>2<span class="main">]</span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> red_cond_no nodes_notin_nl_neq_nln lno_notin_nl 
          hno_notin_nl while_share_red_exp balanced_no repa_repb_nc 
        <span class="keyword1"><span class="command">have</span></span> red_repa_no<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repa</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> red_cond_no nodes_notin_nl_neq_nln lno_notin_nl repa_repb_nc 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span>  <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> red_repa_no no_notin_nl balanced_no repa_repb_nc 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> red_cond_no <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">=</span> <span class="skolem">node</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> share_cond 
        <span class="keyword1"><span class="command">have</span></span> share_cond_pre<span class="main">:</span> 
          <span class="quoted"><span class="quoted">"isLeaf_pt <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="main">∨</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"isLeaf_pt <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">with</span></span> red_cond_no <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isLeaf_pt_def<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> no_nLeaf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> isLeaf_pt <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> share_cond_pre 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> no_nLeaf lno_notin_nl hno_notin_nl nodes_notin_nl_neq_nln 
            balanced_no repa_repb_nc
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">repb</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_depth_limit</span><span class="main"><span class="main">=</span></span>2<span class="main">]</span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isLeaf_pt_def<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> no_nLeaf balanced_no <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">≠</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def isLeaf_pt_def<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> red_cond_no <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> while_while<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span>
          <span class="skolem">repb</span> <span class="bound">no</span> <span class="main">≠</span> Null <span class="main">∧</span>
          <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no</span> <span class="main">∧</span> <span class="skolem">low</span> <span class="bound">no</span> <span class="main">≠</span> Null 
          <span class="keyword1">then</span> <span class="skolem">repb</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no</span>
          <span class="keyword1">else</span> <span class="skolem">repb</span> <span class="bound">no</span> <span class="main">=</span> hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="bound">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span> <span class="main">∧</span>
          <span class="skolem">repb</span> <span class="main">(</span><span class="skolem">repb</span> <span class="bound">no</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repb</span> <span class="bound">no</span> <span class="main">∧</span>
          <span class="main">(</span><span class="main">∀</span><span class="bound">no1</span><span class="main">∈</span>set <span class="main">(</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no</span> 
          <span class="main">∧</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="bound">no</span> <span class="main">=</span> <span class="skolem">repb</span> <span class="bound">no1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">no</span> <span class="main">∧</span> <span class="var">?Q</span> <span class="bound">no</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ballI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">no</span>
      <span class="keyword3"><span class="command">assume</span></span> no_in_take_Sucn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> no_in_nl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> nodes_balanced_ordered <span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span>
        no_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">≠</span> Null"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        balanced_no<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span> <span class="main">=</span> Null<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span> <span class="main">=</span> Null<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        lno_notin_nl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        hno_notin_nl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        isLeaf_var_no<span class="main">:</span> <span class="quoted"><span class="quoted">"isLeaf_pt <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">var</span> <span class="skolem">no</span> <span class="main">≤</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> no_in_take_Sucn 
      <span class="keyword1"><span class="command">have</span></span> filter_take_Sucn_not_empty<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> filter_not_empty<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repNodes_eq_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> hd_filter_Sucn_in_Sucn<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span> <span class="main">∈</span> 
            set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hd_filter_in_list<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> nodes_notin_nl_neq_nln<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">p</span> <span class="main">≠</span> <span class="skolem">node</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">no</span> <span class="main">∧</span> <span class="var">?Q</span> <span class="skolem">no</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">=</span> <span class="skolem">node</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">note</span></span> no_notin_nl<span class="main">=</span>this
        <span class="keyword1"><span class="command">with</span></span> no_in_take_Sucn 
        <span class="keyword1"><span class="command">have</span></span> no_in_take_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">∈</span> set <span class="skolem">prx</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> False repa_repb_nc <span class="keyword1"><span class="command">have</span></span> repb_repa_no<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">repa</span> <span class="skolem">no</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> while_inv <span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> no_in_take_n<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> 
          repa_no_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repa</span> <span class="skolem">no</span> <span class="main">≠</span> Null"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          while_share_red_exp<span class="main">:</span> 
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span> <span class="skolem">low</span> <span class="skolem">no</span> <span class="main">≠</span> Null 
              <span class="keyword1">then</span> <span class="skolem">repa</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span>
              <span class="keyword1">else</span> <span class="skolem">repa</span> <span class="skolem">no</span> <span class="main">=</span> hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">prx</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span> <span class="main">∧</span>
              <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">repa</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repa</span> <span class="skolem">no</span> <span class="main">∧</span> 
              <span class="main">(</span><span class="main">∀</span><span class="bound">no1</span><span class="main">∈</span>set <span class="skolem">prx</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span> 
              <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">repa</span> <span class="bound">no1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_depth_limit</span><span class="main"><span class="main">=</span></span>2<span class="main">]</span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> repb_repa_no repa_no_nNull <span class="keyword1"><span class="command">have</span></span> repb_no_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">no</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="skolem">no</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span> <span class="skolem">low</span> <span class="skolem">no</span> <span class="main">≠</span> Null"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">with</span></span> no_in_take_Sucn repb_no_red_def <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> share_case_repb<span class="main">:</span> 
            <span class="quoted"><span class="quoted">" <span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span> <span class="skolem">low</span> <span class="skolem">no</span> <span class="main">≠</span> Null<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> repb_no_share_def no_in_take_Sucn 
          <span class="keyword1"><span class="command">have</span></span> repb_no_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">no</span> <span class="main">=</span> hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span> <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> 
            repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> share_case_repb 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">≠</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∨</span> <span class="skolem">low</span> <span class="skolem">no</span> <span class="main">=</span> Null"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_depth_limit</span><span class="main"><span class="main">=</span></span>2<span class="main">]</span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">no</span> <span class="main">=</span> Null"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">note</span></span> lno_Null<span class="main">=</span>this
            <span class="keyword1"><span class="command">with</span></span> balanced_no <span class="keyword1"><span class="command">have</span></span> hno_Null<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">no</span> <span class="main">=</span> Null"</span></span> 
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">from</span></span> lno_Null hno_Null <span class="keyword1"><span class="command">have</span></span> isLeaf_no<span class="main">:</span> <span class="quoted"><span class="quoted">"isLeaf_pt <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isLeaf_pt_def<span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> True while_share_red_exp 
            <span class="keyword1"><span class="command">have</span></span> while_low_Null<span class="main">:</span> 
              <span class="quoted"><span class="quoted">"<span class="skolem">repa</span> <span class="skolem">no</span> <span class="main">=</span> hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">prx</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span> <span class="main">∧</span>
                  <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">repa</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repa</span> <span class="skolem">no</span> <span class="main">∧</span> 
                  <span class="main">(</span><span class="main">∀</span><span class="bound">no1</span><span class="main">∈</span>set <span class="skolem">prx</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> 
              <span class="main">∧</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">repa</span> <span class="bound">no1</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> no_in_take_n 
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">prx</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> filter_not_empty<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repNodes_eq_def<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> hd_term_n_Sucn<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="skolem">prx</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span> <span class="main">=</span> 
                  hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> hd_filter_app <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">have</span></span> all_nodes_in_nl_Leafs<span class="main">:</span> 
              <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span> isLeaf_pt <span class="bound">x</span> <span class="skolem">low</span> <span class="skolem">high</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ballI<span class="main">)</span>
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
              <span class="keyword3"><span class="command">assume</span></span> x_in_nodeslist<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">from</span></span> isLeaf_no isLeaf_var_no <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">no</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">with</span></span> all_nodes_same_var <span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> x_in_nodeslist no_in_nl<span class="main">]</span> 
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">with</span></span> nodes_balanced_ordered <span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> x_in_nodeslist<span class="main">]</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"isLeaf_pt <span class="skolem">x</span> <span class="skolem">low</span> <span class="skolem">high</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isLeaf_pt_def<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">from</span></span> no_in_take_Sucn <span class="keyword1"><span class="command">have</span></span> 
              filter_Sucn_no_notempty<span class="main">:</span> 
              <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> filter_not_empty<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repNodes_eq_def<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> hd_term_in_take_Sucn<span class="main">:</span> 
              <span class="quoted"><span class="quoted">"hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span> 
                  <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hd_filter_in_list<span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> hd_term_in_nl<span class="main">:</span> 
              <span class="quoted"><span class="quoted">"hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span> 
              <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
            <span class="keyword1"><span class="command">with</span></span> all_nodes_in_nl_Leafs 
            <span class="keyword1"><span class="command">have</span></span> hd_term_Leaf<span class="main">:</span> <span class="quoted"><span class="quoted">"isLeaf_pt <span class="main">(</span>hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span> <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> 
              repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span><span class="main">)</span> <span class="skolem">low</span> <span class="skolem">high</span> "</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>            
            <span class="keyword1"><span class="command">from</span></span> while_low_Null <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repa</span> <span class="main">(</span><span class="skolem">repa</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repa</span> <span class="skolem">no</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">with</span></span> no_notin_nl repa_repb_nc 
            <span class="keyword1"><span class="command">have</span></span> repa_repb_no_repb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repa</span> <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repb</span> <span class="skolem">no</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">have</span></span> repb_repb_no<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repb</span> <span class="skolem">no</span>"</span></span> 
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">node</span>"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">with</span></span> repa_repb_nc repa_repb_no_repb <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">assume</span></span> repb_no_nln<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">repb</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">node</span>"</span></span>
              <span class="keyword1"><span class="command">with</span></span> hd_term_Leaf isLeaf_no all_nodes_in_nl_Leafs  
              <span class="keyword1"><span class="command">have</span></span> nested_hd_repa_repb<span class="main">:</span> 
                <span class="quoted"><span class="quoted">"hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> 
                   <span class="main">(</span>hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span><span class="main">)</span> 
                        <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span> <span class="main">=</span>  
                 hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> 
                    <span class="main">(</span> hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span><span class="main">)</span> 
                        <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isLeaf_pt_def repNodes_eq_def null_comp_def<span class="main">)</span>
              <span class="keyword1"><span class="command">from</span></span>  hd_term_in_take_Sucn 
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> 
                      <span class="main">(</span>hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span><span class="main">)</span> 
                       <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> filter_not_empty<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repNodes_eq_def<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> 
                    <span class="main">(</span> hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span><span class="main">)</span> 
                          <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span> <span class="main">=</span> 
                    hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> 
                    <span class="main">(</span> hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span><span class="main">)</span> 
                           <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> hd_filter_app <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> hd_term_nodeslist_Sucn<span class="main">:</span> 
                <span class="quoted"><span class="quoted">"hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> 
                    <span class="main">(</span> hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span><span class="main">)</span> 
                             <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span> <span class="main">=</span>
                    hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> 
                    <span class="main">(</span> hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span><span class="main">)</span> 
                          <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">from</span></span> no_in_take_Sucn filter_Sucn_no_notempty 
              <span class="keyword1"><span class="command">have</span></span> filter_filter<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span>  
                    <span class="main">(</span>hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span><span class="main">)</span> 
                          <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span> <span class="main">=</span>  
                    hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> filter_hd_P_rep_indep<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repNodes_eq_def<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">from</span></span> repb_no_def repb_no_nln repb_node 
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span>  hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> 
                    <span class="main">(</span> hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span><span class="main">)</span> 
                           <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">with</span></span> nested_hd_repa_repb 
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span>  hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> 
                    <span class="main">(</span>hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span><span class="main">)</span> 
                        <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">with</span></span> hd_term_nodeslist_Sucn 
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span>  hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> 
                    <span class="main">(</span> hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span><span class="main">)</span> 
                         <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">with</span></span> filter_filter 
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> 
                repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">with</span></span> repb_no_def <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">have</span></span> two_nodes_repb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">no1</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> 
                  <span class="main">(</span><span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> 
                  <span class="main">∧</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">repb</span> <span class="bound">no1</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ballI<span class="main">)</span>
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">no1</span>
              <span class="keyword3"><span class="command">assume</span></span> no1_in_take_Sucn<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">no1</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">no1</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">with</span></span> all_nodes_in_nl_Leafs 
              <span class="keyword1"><span class="command">have</span></span> isLeaf_no1<span class="main">:</span> <span class="quoted"><span class="quoted">"isLeaf_pt <span class="skolem">no1</span> <span class="skolem">low</span> <span class="skolem">high</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">with</span></span> isLeaf_no 
              <span class="keyword1"><span class="command">have</span></span> repbchildren_eq_no_no1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> 
                <span class="main">∧</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def isLeaf_pt_def<span class="main">)</span>
              <span class="keyword1"><span class="command">from</span></span> isLeaf_no1 isLeaf_no 
              <span class="keyword1"><span class="command">have</span></span> repachildren_eq_no_no1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> 
                <span class="main">∧</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def isLeaf_pt_def<span class="main">)</span>
              <span class="keyword1"><span class="command">from</span></span> while_low_Null 
              <span class="keyword1"><span class="command">have</span></span> while_low_same_rep<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">no1</span><span class="main">∈</span>set <span class="skolem">prx</span><span class="main">.</span> 
                <span class="main">(</span><span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> 
                    <span class="main">∧</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">repa</span> <span class="bound">no1</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span> 
                    <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">repb</span> <span class="skolem">no1</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">no1</span> <span class="main">=</span> <span class="skolem">node</span>"</span></span><span class="main">)</span>
                <span class="keyword3"><span class="command">case</span></span> False
                <span class="keyword1"><span class="command">with</span></span> no1_in_take_Sucn <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">no1</span> <span class="main">∈</span> set <span class="skolem">prx</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">with</span></span> while_low_same_rep repachildren_eq_no_no1 
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repa</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">repa</span> <span class="skolem">no1</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">with</span></span> repa_repb_nc no_notin_nl False repbchildren_eq_no_no1 
                <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">next</span></span>
                <span class="keyword3"><span class="command">assume</span></span> no1_nln<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">no1</span> <span class="main">=</span> <span class="skolem">node</span>"</span></span>
                <span class="keyword1"><span class="command">hence</span></span> no1_in_take_Sucn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">no1</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">hence</span></span> no1_in_nl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">no1</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">from</span></span> nodes_balanced_ordered <span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> 
                  balanced_no1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">low</span> <span class="skolem">no1</span> <span class="main">=</span> Null<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no1</span> <span class="main">=</span> Null<span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">with</span></span> no1_in_take_Sucn repb_no_share_def isLeaf_no1 
                <span class="keyword1"><span class="command">have</span></span> repb_no1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">no1</span> <span class="main">=</span> hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> 
                  repNodes_eq <span class="bound">sn</span> <span class="skolem">no1</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isLeaf_pt_def<span class="main">)</span>
                <span class="keyword1"><span class="command">from</span></span> balanced_no1 isLeaf_no1 isLeaf_no balanced_no 
                <span class="keyword1"><span class="command">have</span></span> repbchildren_eq_no1_no<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> 
                      <span class="main">∧</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def isLeaf_pt_def<span class="main">)</span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span>  repNodes_eq <span class="bound">x</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span> 
                  <span class="main">=</span>  repNodes_eq <span class="bound">x</span> <span class="skolem">no1</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ballI<span class="main">)</span>
                  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
                  <span class="keyword3"><span class="command">assume</span></span> x_in_take_Sucn<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">with</span></span> repbchildren_eq_no1_no <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"repNodes_eq <span class="skolem">x</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span> 
                    <span class="main">=</span> repNodes_eq <span class="skolem">x</span> <span class="skolem">no1</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repNodes_eq_def<span class="main">)</span>
                <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span> 
                      <span class="main">=</span> <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no1</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> P_eq_list_filter<span class="main">)</span>
                <span class="keyword1"><span class="command">with</span></span> repb_no_def repb_no1 <span class="keyword1"><span class="command">have</span></span> repb_no_no1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">repb</span> <span class="skolem">no1</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">with</span></span> repbchildren_eq_no1_no <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">with</span></span> repb_repb_no repb_no_share_def no_in_take_Sucn share_case_repb 
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_depth_limit</span><span class="main"><span class="main">=</span></span>4<span class="main">]</span><span class="main">]</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">assume</span></span> lno_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">no</span> <span class="main">≠</span> Null"</span></span>
            <span class="keyword1"><span class="command">with</span></span> share_case_repb 
            <span class="keyword1"><span class="command">have</span></span> repbchildren_neq_no<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">≠</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> balanced_no lno_nNull 
            <span class="keyword1"><span class="command">have</span></span> hno_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">no</span> <span class="main">≠</span> Null"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">with</span></span> repbchildren_neq_no lno_nNull repa_repb_nc 
              lno_notin_nl hno_notin_nl nodes_notin_nl_neq_nln 
            <span class="keyword1"><span class="command">have</span></span> repachildren_neq_no<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">≠</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_depth_limit</span><span class="main"><span class="main">=</span></span>2<span class="main">]</span><span class="main">]</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> while_share_red_exp 
            <span class="keyword1"><span class="command">have</span></span> repa_while_inv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repa</span> <span class="main">(</span><span class="skolem">repa</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repa</span> <span class="skolem">no</span> 
              <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">no1</span><span class="main">∈</span>set <span class="skolem">prx</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> 
              <span class="main">∧</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">repa</span> <span class="bound">no1</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> lno_nNull hno_nNull 
            <span class="keyword1"><span class="command">have</span></span> no_nLeaf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> isLeaf_pt <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isLeaf_pt_def<span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> all_nodes_in_nl_nLeafs<span class="main">:</span> 
              <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span> <span class="main">¬</span> isLeaf_pt <span class="bound">x</span> <span class="skolem">low</span> <span class="skolem">high</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ballI<span class="main">)</span>
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
              <span class="keyword3"><span class="command">assume</span></span> x_in_nodeslist<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">from</span></span> no_nLeaf isLeaf_var_no <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">no</span> "</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">with</span></span> all_nodes_same_var <span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> x_in_nodeslist no_in_nl<span class="main">]</span> 
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">x</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">with</span></span> nodes_balanced_ordered <span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> x_in_nodeslist<span class="main">]</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">¬</span> isLeaf_pt <span class="skolem">x</span> <span class="skolem">low</span> <span class="skolem">high</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_depth_limit</span> <span class="main"><span class="main">=</span></span> 2<span class="main">]</span><span class="main">]</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isLeaf_pt_def<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">have</span></span> repb_repb_no<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repb</span> <span class="skolem">no</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">from</span></span> repa_while_inv no_notin_nl repa_repb_nc 
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repa</span> <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repb</span> <span class="skolem">no</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">from</span></span> hd_filter_Sucn_in_Sucn repb_no_def 
              <span class="keyword1"><span class="command">have</span></span> repb_no_in_take_Sucn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">no</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">hence</span></span> repb_no_in_nl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">no</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">from</span></span> all_nodes_in_nl_nLeafs repb_no_in_nl 
              <span class="keyword1"><span class="command">have</span></span> repb_no_nLeaf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> isLeaf_pt <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">no</span><span class="main">)</span> <span class="skolem">low</span> <span class="skolem">high</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">from</span></span> nodes_balanced_ordered <span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> repb_no_in_nl<span class="main">]</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">low</span> <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> Null<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">high</span> <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> Null<span class="main">)</span> 
                <span class="main">∧</span> <span class="skolem">low</span> <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span> <span class="main">∧</span> 
                <span class="skolem">high</span> <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">from</span></span> filter_take_Sucn_not_empty 
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" repNodes_eq <span class="main">(</span>hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> 
                repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span><span class="main">)</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hd_filter_prop<span class="main">)</span>
              <span class="keyword1"><span class="command">with</span></span> repb_no_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"repNodes_eq <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">no</span><span class="main">)</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> 
                <span class="main">∧</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repNodes_eq_def<span class="main">)</span>
              <span class="keyword1"><span class="command">with</span></span> repbchildren_neq_no <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">no</span><span class="main">)</span> 
                <span class="main">≠</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">no</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">with</span></span> repb_no_in_take_Sucn repb_no_share_def 
              <span class="keyword1"><span class="command">have</span></span> repb_repb_no_double_hd<span class="main">:</span> 
                <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> 
                repNodes_eq <span class="bound">sn</span> <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">no</span><span class="main">)</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">from</span></span> filter_take_Sucn_not_empty 
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> 
                repNodes_eq <span class="bound">sn</span> <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">no</span><span class="main">)</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span> <span class="main">=</span> <span class="skolem">repb</span> <span class="skolem">no</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> repb_no_def <span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> filter_hd_P_rep_indep<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repNodes_eq_def<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">with</span></span> repb_repb_no_double_hd <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">no1</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> 
                <span class="main">(</span><span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span> 
                <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">repb</span> <span class="bound">no1</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ballI<span class="main">)</span>
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">no1</span>
              <span class="keyword3"><span class="command">assume</span></span> no1_in_take_Sucn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">no1</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">hence</span></span> no1_in_nl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">no1</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">from</span></span> all_nodes_in_nl_nLeafs no1_in_nl 
              <span class="keyword1"><span class="command">have</span></span> no1_nLeaf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> isLeaf_pt <span class="skolem">no1</span> <span class="skolem">low</span> <span class="skolem">high</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">from</span></span> nodes_balanced_ordered <span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> no1_in_nl<span class="main">]</span>
              <span class="keyword1"><span class="command">have</span></span> no1_props<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">low</span> <span class="skolem">no1</span> <span class="main">=</span> Null<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no1</span> <span class="main">=</span> Null<span class="main">)</span> 
                <span class="main">∧</span> <span class="skolem">low</span> <span class="skolem">no1</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">high</span> <span class="skolem">no1</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> 
                <span class="main">∧</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">repb</span> <span class="skolem">no1</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">no1</span> <span class="main">=</span> <span class="skolem">node</span>"</span></span><span class="main">)</span>
                <span class="keyword3"><span class="command">case</span></span> False
                <span class="keyword1"><span class="command">note</span></span> no1_neq_nln<span class="main">=</span>this
                <span class="keyword1"><span class="command">with</span></span> no1_in_take_Sucn 
                <span class="keyword1"><span class="command">have</span></span> no1_in_take_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">no1</span> <span class="main">∈</span> set <span class="skolem">prx</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">with</span></span> repa_while_inv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> 
                  <span class="main">∧</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">repa</span> <span class="skolem">no1</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                <span class="keyword1"><span class="command">with</span></span> no1_props no1_nLeaf no_nLeaf balanced_no lno_notin_nl 
                  hno_notin_nl nodes_notin_nl_neq_nln no_notin_nl 
                  no1_neq_nln repa_repb_nc
                <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_depth_limit</span><span class="main"><span class="main">=</span></span>1<span class="main">]</span><span class="main">]</span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def isLeaf_pt_def<span class="main">)</span>
              <span class="keyword1"><span class="command">next</span></span>
                <span class="keyword3"><span class="command">assume</span></span> no1_nln<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">no1</span> <span class="main">=</span> <span class="skolem">node</span>"</span></span>
                <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">proof</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> repbchildren_eq_no1_no<span class="main">:</span> 
                    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> 
                    <span class="main">∧</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
                  <span class="keyword1"><span class="command">with</span></span> repbchildren_neq_no 
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no1</span> <span class="main">≠</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no1</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">with</span></span> repb_no_share_def no1_in_take_Sucn 
                  <span class="keyword1"><span class="command">have</span></span> repb_no1_def<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">repb</span> <span class="skolem">no1</span> <span class="main">=</span> hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> 
                    repNodes_eq <span class="bound">sn</span> <span class="skolem">no1</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">have</span></span> filter_no1_eq_filter_no<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> 
                    repNodes_eq <span class="bound">sn</span> <span class="skolem">no1</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span> <span class="main">=</span>  
                    <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span>"</span></span>
                  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> 
                      repNodes_eq <span class="bound">x</span> <span class="skolem">no1</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span> <span class="main">=</span> 
                      repNodes_eq <span class="bound">x</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span>"</span></span>
                    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ballI<span class="main">)</span>
                      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
                      <span class="keyword3"><span class="command">assume</span></span> x_in_take_Sucn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">with</span></span> repbchildren_eq_no1_no 
                      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"repNodes_eq <span class="skolem">x</span> <span class="skolem">no1</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span> <span class="main">=</span> 
                        repNodes_eq <span class="skolem">x</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repNodes_eq_def<span class="main">)</span>
                    <span class="keyword1"><span class="command">qed</span></span>
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> P_eq_list_filter<span class="main">)</span>
                  <span class="keyword1"><span class="command">qed</span></span>
                  <span class="keyword1"><span class="command">with</span></span> repb_no1_def repb_no_def <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">repb</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">repb</span> <span class="skolem">no1</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">next</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> repb_no_no1_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">repb</span> <span class="skolem">no1</span>"</span></span>
                  <span class="keyword1"><span class="command">from</span></span> no1_nln repb_node repb_no_def <span class="keyword1"><span class="command">have</span></span> repb_no1_def<span class="main">:</span> 
                    <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">no1</span> <span class="main">=</span>  
                    hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">node</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">with</span></span> no1_nln repb_no_def repb_no_no1_eq 
                  <span class="keyword1"><span class="command">have</span></span> repb_Sucn_repa_nl_hd<span class="main">:</span> <span class="quoted"><span class="quoted">" hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> 
                    repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span> <span class="main">=</span> 
                    hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no1</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">from</span></span> filter_take_Sucn_not_empty 
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span> 
                    <span class="main">=</span>  hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span>"</span></span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> hd_filter_app <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> hd_Sucn_hd_whole_list<span class="main">:</span> 
                    <span class="quoted"><span class="quoted">"hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span> <span class="main">.</span> 
                    repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span> <span class="main">=</span>  
                    hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span> <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">have</span></span> hd_nl_repb_repa<span class="main">:</span> 
                    <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">sn</span><span class="main">←</span> <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span> 
                    <span class="main">=</span> <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span>"</span></span>
                  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span>  
                      repNodes_eq <span class="bound">x</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span> <span class="main">=</span>  
                      repNodes_eq <span class="bound">x</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span>"</span></span>
                    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ballI<span class="main">)</span>
                      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
                      <span class="keyword3"><span class="command">assume</span></span> x_in_nl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">from</span></span> all_nodes_in_nl_nLeafs x_in_nl 
                      <span class="keyword1"><span class="command">have</span></span> x_nLeaf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> isLeaf_pt <span class="skolem">x</span> <span class="skolem">low</span> <span class="skolem">high</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">from</span></span>  nodes_balanced_ordered <span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> x_in_nl<span class="main">]</span>
                      <span class="keyword1"><span class="command">have</span></span> x_props<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">low</span> <span class="skolem">x</span> <span class="main">=</span> Null<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">x</span> <span class="main">=</span> Null<span class="main">)</span> <span class="main">∧</span> 
                        <span class="skolem">low</span> <span class="skolem">x</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">high</span> <span class="skolem">x</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">with</span></span> x_nLeaf lno_nNull hno_nNull lno_notin_nl hno_notin_nl 
                        nodes_notin_nl_neq_nln repa_repb_nc 
                      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"repNodes_eq <span class="skolem">x</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span> <span class="main">=</span> 
                        repNodes_eq <span class="skolem">x</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_depth_limit</span><span class="main"><span class="main">=</span></span>1<span class="main">]</span><span class="main">]</span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repNodes_eq_def isLeaf_pt_def null_comp_def<span class="main">)</span>
                    <span class="keyword1"><span class="command">qed</span></span>
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> P_eq_list_filter<span class="main">)</span>
                  <span class="keyword1"><span class="command">qed</span></span>
                  <span class="keyword1"><span class="command">with</span></span> repb_Sucn_repa_nl_hd hd_Sucn_hd_whole_list 
                  <span class="keyword1"><span class="command">have</span></span> filter_nl_no_no1<span class="main">:</span> 
                    <span class="quoted"><span class="quoted">"hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span> 
                    <span class="main">=</span>  hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no1</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">from</span></span> no_in_nl <span class="keyword1"><span class="command">have</span></span> filter_no_not_empty<span class="main">:</span> 
                    <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> filter_not_empty<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repNodes_eq_def<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                  <span class="keyword1"><span class="command">from</span></span> no1_in_nl <span class="keyword1"><span class="command">have</span></span> filter_no1_not_empty<span class="main">:</span> 
                    <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no1</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> filter_not_empty<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repNodes_eq_def<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                  <span class="keyword1"><span class="command">from</span></span> repb_no_def hd_Sucn_hd_whole_list hd_nl_repb_repa 
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">no</span> <span class="main">=</span>
                    hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span>"</span></span> 
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">with</span></span> hd_filter_prop <span class="main">[</span><span class="operator">OF</span> filter_no_not_empty <span class="main">]</span>
                  <span class="keyword1"><span class="command">have</span></span> repNodes_no_repa<span class="main">:</span> <span class="quoted"><span class="quoted">"repNodes_eq <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">no</span><span class="main">)</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">from</span></span> repb_no1_def no1_nln 
                  <span class="keyword1"><span class="command">have</span></span> 
                    <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">no1</span> <span class="main">=</span> hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no1</span> 
                    <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">with</span></span> hd_filter_prop <span class="main">[</span><span class="operator">OF</span> filter_no1_not_empty <span class="main">]</span>
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"repNodes_eq <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">no1</span><span class="main">)</span> <span class="skolem">no1</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">with</span></span> filter_nl_no_no1 repNodes_no_repa repb_no_no1_eq 
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no1</span> <span class="main">=</span> 
                    <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repNodes_eq_def<span class="main">)</span>
                  <span class="keyword1"><span class="command">with</span></span> hno_nNull no1_props no1_nLeaf lno_nNull lno_notin_nl 
                    hno_notin_nl nodes_notin_nl_neq_nln repa_repb_nc
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no1</span> <span class="main">=</span> 
                    <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_depth_limit</span><span class="main"><span class="main">=</span></span>1<span class="main">]</span><span class="main">]</span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isLeaf_pt_def null_comp_def<span class="main">)</span>
                <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">with</span></span> repb_repb_no repb_no_share_def share_case_repb no_in_take_Sucn 
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_depth_limit</span><span class="main"><span class="main">=</span></span>1<span class="main">]</span><span class="main">]</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">with</span></span> repb_no_nNull <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> no_nln<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">=</span> <span class="skolem">node</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> repb_node <span class="keyword1"><span class="command">have</span></span> repb_no_def<span class="main">:</span> 
          <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">no</span> <span class="main">=</span> hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> no_nln <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> filter_nl_repa_not_empty<span class="main">:</span> 
          <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> filter_not_empty<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repNodes_eq_def<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> hd_filter_nl_in_nl<span class="main">:</span> 
          <span class="quoted"><span class="quoted">"hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repa</span><span class="main">]</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hd_filter_in_list<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> repb_no_def 
        <span class="keyword1"><span class="command">have</span></span> repb_no_in_nodeslist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">no</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> nodes_balanced_ordered <span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">OF</span> this<span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> repb_no_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">no</span> <span class="main">≠</span> Null"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> share_cond no_nln <span class="keyword1"><span class="command">have</span></span> share_cond_or<span class="main">:</span> 
          <span class="quoted"><span class="quoted">"isLeaf_pt <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="main">∨</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> share_reduce_if<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span> <span class="skolem">low</span> <span class="skolem">no</span> <span class="main">≠</span> Null 
              <span class="keyword1">then</span> <span class="skolem">repb</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span>
              <span class="keyword1">else</span> <span class="skolem">repb</span> <span class="skolem">no</span> <span class="main">=</span> hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span> <span class="main">∧</span>
              <span class="skolem">repb</span> <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repb</span> <span class="skolem">no</span> 
              <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">no1</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> 
              <span class="main">∧</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">repb</span> <span class="bound">no1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"isLeaf_pt <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">note</span></span> isLeaf_no<span class="main">=</span>this
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> lno_Null<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">no</span> <span class="main">=</span> Null"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isLeaf_pt_def<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> isLeaf_no no_in_take_Sucn repb_no_share_def 
          <span class="keyword1"><span class="command">have</span></span> repb_no_repb_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">no</span> 
                <span class="main">=</span> hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isLeaf_pt_def<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> isLeaf_no nodes_balanced_ordered <span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> no_in_nl<span class="main">]</span>
          <span class="keyword1"><span class="command">have</span></span> var_no<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">no</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> all_nodes_nl_var_l_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span> <span class="skolem">var</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ballI<span class="main">)</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
            <span class="keyword3"><span class="command">assume</span></span> x_in_nl<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">from</span></span> all_nodes_same_var <span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> x_in_nl no_in_nl<span class="main">]</span> var_no 
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">var</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>              
          <span class="keyword1"><span class="command">have</span></span> all_nodes_nl_Leafs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span> isLeaf_pt <span class="bound">x</span> <span class="skolem">low</span> <span class="skolem">high</span>"</span></span> 
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ballI<span class="main">)</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
            <span class="keyword3"><span class="command">assume</span></span> x_in_nl<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">with</span></span> all_nodes_nl_var_l_1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">with</span></span> nodes_balanced_ordered <span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> x_in_nl <span class="main">]</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"isLeaf_pt <span class="skolem">x</span> <span class="skolem">low</span> <span class="skolem">high</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span> 
          <span class="keyword1"><span class="command">have</span></span> repb_repb_no<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repb</span> <span class="skolem">no</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">from</span></span> repb_no_share_def no_in_take_Sucn lno_Null 
            <span class="keyword1"><span class="command">have</span></span> repb_no_def<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">repb</span> <span class="skolem">no</span> <span class="main">=</span> 
              hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">with</span></span> hd_filter_Sucn_in_Sucn 
            <span class="keyword1"><span class="command">have</span></span> repb_no_in_take_Sucn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">no</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">hence</span></span> repb_no_in_nl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">no</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">with</span></span> all_nodes_nl_Leafs 
            <span class="keyword1"><span class="command">have</span></span> repb_no_Leaf<span class="main">:</span> <span class="quoted"><span class="quoted">"isLeaf_pt <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">no</span><span class="main">)</span> <span class="skolem">low</span> <span class="skolem">high</span>"</span></span> 
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">with</span></span> repb_no_in_take_Sucn repb_no_share_def 
            <span class="keyword1"><span class="command">have</span></span> repb_repb_no_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> 
              hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">no</span><span class="main">)</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span> "</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isLeaf_pt_def<span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> filter_take_Sucn_not_empty 
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> repb_repb_no_def  <span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> repb_no_def<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> filter_hd_P_rep_indep<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repNodes_eq_def<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">have</span></span> two_nodes_repb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">no1</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> 
                <span class="main">(</span><span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span> 
                <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">repb</span> <span class="bound">no1</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ballI<span class="main">)</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">no1</span> 
            <span class="keyword3"><span class="command">assume</span></span> no1_in_take_Sucn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">no1</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">from</span></span> no1_in_take_Sucn 
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">no1</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">with</span></span> all_nodes_nl_Leafs 
            <span class="keyword1"><span class="command">have</span></span> isLeaf_no1<span class="main">:</span> <span class="quoted"><span class="quoted">"isLeaf_pt <span class="skolem">no1</span> <span class="skolem">low</span> <span class="skolem">high</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">with</span></span> repb_no_share_def no1_in_take_Sucn 
            <span class="keyword1"><span class="command">have</span></span> repb_no1_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">no1</span> <span class="main">=</span>  
                  hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no1</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span>"</span></span> 
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isLeaf_pt_def<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> 
                  <span class="main">∧</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">repb</span> <span class="skolem">no1</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> 
              <span class="keyword3"><span class="command">assume</span></span> repbchildren_eq_no1_no<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> 
                    <span class="main">∧</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no1</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span> 
                    <span class="main">=</span> <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> 
                      repNodes_eq <span class="bound">x</span> <span class="skolem">no1</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span> <span class="main">=</span> repNodes_eq <span class="bound">x</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ballI<span class="main">)</span>
                  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
                  <span class="keyword3"><span class="command">assume</span></span> x_in_take_Sucn<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">with</span></span> repbchildren_eq_no1_no 
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" repNodes_eq <span class="skolem">x</span> <span class="skolem">no1</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span> <span class="main">=</span> repNodes_eq <span class="skolem">x</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repNodes_eq_def<span class="main">)</span>
                <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> P_eq_list_filter<span class="main">)</span>
              <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">with</span></span> repb_no1_def repb_no_repb_def 
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">repb</span> <span class="skolem">no1</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">assume</span></span> repb_no_no1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">repb</span> <span class="skolem">no1</span>"</span></span>
              <span class="keyword1"><span class="command">with</span></span> isLeaf_no isLeaf_no1 
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> 
                <span class="main">∧</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def isLeaf_pt_def<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">with</span></span> repb_repb_no lno_Null no_in_take_Sucn repb_no_share_def <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> no_nLeaf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> isLeaf_pt <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> balanced_no <span class="keyword3"><span class="command">obtain</span></span> 
            lno_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">no</span> <span class="main">≠</span> Null"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
            hno_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">no</span> <span class="main">≠</span> Null"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isLeaf_pt_def<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> no_nLeaf nodes_balanced_ordered <span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> no_in_nl<span class="main">]</span>
          <span class="keyword1"><span class="command">have</span></span> var_no<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">no</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> all_nodes_nl_var_l_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="bound">x</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ballI<span class="main">)</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
            <span class="keyword3"><span class="command">assume</span></span> x_in_nl<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">with</span></span> all_nodes_same_var <span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> x_in_nl no_in_nl<span class="main">]</span> var_no 
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">x</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>         
          <span class="keyword1"><span class="command">have</span></span> all_nodes_nl_nLeafs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span><span class="main">.</span> <span class="main">¬</span> isLeaf_pt <span class="bound">x</span> <span class="skolem">low</span> <span class="skolem">high</span>"</span></span> 
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ballI<span class="main">)</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
            <span class="keyword3"><span class="command">assume</span></span> x_in_nl<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">with</span></span> all_nodes_nl_var_l_1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">x</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">with</span></span> nodes_balanced_ordered <span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> x_in_nl<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">¬</span> isLeaf_pt <span class="skolem">x</span> <span class="skolem">low</span> <span class="skolem">high</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span> 
          <span class="keyword1"><span class="command">from</span></span> no_nLeaf share_cond_or 
          <span class="keyword1"><span class="command">have</span></span> repachildren_neq_no<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repa</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">repa</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> lno_nNull hno_nNull 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">≠</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> repa_repb_nc lno_notin_nl hno_notin_nl 
            nodes_notin_nl_neq_nln lno_nNull hno_nNull 
          <span class="keyword1"><span class="command">have</span></span> repbchildren_neq_no<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">≠</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_depth_limit</span><span class="main"><span class="main">=</span></span>1<span class="main">]</span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> repb_repb_no<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repb</span> <span class="skolem">no</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">from</span></span> repb_no_share_def no_in_take_Sucn repbchildren_neq_no 
            <span class="keyword1"><span class="command">have</span></span> repb_no_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">no</span> <span class="main">=</span> 
              hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> filter_take_Sucn_not_empty 
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"repNodes_eq <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">no</span><span class="main">)</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> repb_no_def<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> hd_filter_prop<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">with</span></span> repbchildren_neq_no 
            <span class="keyword1"><span class="command">have</span></span> repbchildren_neq_repb_no<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">no</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repNodes_eq_def<span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> filter_take_Sucn_not_empty 
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">no</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> repb_no_def <span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> hd_filter_in_list<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">with</span></span> repbchildren_neq_repb_no repb_no_share_def 
            <span class="keyword1"><span class="command">have</span></span> repb_repb_no_def<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">repb</span> <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> 
              hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span> <span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">no</span><span class="main">)</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span> "</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> filter_take_Sucn_not_empty <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> repb_repb_no_def <span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> repb_no_def<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> filter_hd_P_rep_indep<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repNodes_eq_def<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">have</span></span> two_nodes_repb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">no1</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> 
            <span class="main">(</span><span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span> 
            <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">repb</span> <span class="bound">no1</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">no1</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">no1</span><span class="main">)</span>"</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ballI<span class="main">)</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">no1</span>
            <span class="keyword3"><span class="command">assume</span></span> no1_in_take_Sucn<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">no1</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> no1_in_nodeslist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">no1</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">with</span></span> all_nodes_nl_nLeafs 
            <span class="keyword1"><span class="command">have</span></span> no1_nLeaf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> isLeaf_pt <span class="skolem">no1</span> <span class="skolem">low</span> <span class="skolem">high</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">no1</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span>
              <span class="keyword3"><span class="command">assume</span></span> repbchildren_eq_no1_no<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> 
                <span class="main">∧</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
              <span class="keyword1"><span class="command">with</span></span> repbchildren_neq_no <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no1</span> <span class="main">≠</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no1</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">with</span></span> no1_in_take_Sucn repb_no_share_def <span class="keyword1"><span class="command">have</span></span> repb_no1_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">no1</span> <span class="main">=</span> 
                hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no1</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">from</span></span> repb_no_share_def no_in_take_Sucn repbchildren_neq_no 
              <span class="keyword1"><span class="command">have</span></span> repb_no_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">no</span> <span class="main">=</span> 
                hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no1</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span> <span class="main">=</span> 
                <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> 
                  repNodes_eq <span class="bound">x</span> <span class="skolem">no1</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span> <span class="main">=</span> repNodes_eq <span class="bound">x</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ballI<span class="main">)</span>
                  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
                  <span class="keyword3"><span class="command">assume</span></span> x_in_take_Sucn<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">with</span></span> repbchildren_eq_no1_no 
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" repNodes_eq <span class="skolem">x</span> <span class="skolem">no1</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span> <span class="main">=</span> repNodes_eq <span class="skolem">x</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repNodes_eq_def<span class="main">)</span>
                <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> P_eq_list_filter<span class="main">)</span>
              <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">with</span></span> repb_no_def repb_no1_def <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">repb</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">repb</span> <span class="skolem">no1</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">assume</span></span> repb_no_no1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">repb</span> <span class="skolem">no1</span>"</span></span>
              <span class="keyword1"><span class="command">from</span></span> repb_no_share_def no_in_take_Sucn repbchildren_neq_no 
              <span class="keyword1"><span class="command">have</span></span> repb_no_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">no</span> <span class="main">=</span> 
                hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">from</span></span> filter_take_Sucn_not_empty 
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">no</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> repb_no_def<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> hd_filter_in_list<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> repb_no_in_nl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">no</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">from</span></span> filter_take_Sucn_not_empty 
              <span class="keyword1"><span class="command">have</span></span> repNodes_repb_no<span class="main">:</span> <span class="quoted"><span class="quoted">"repNodes_eq <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">no</span><span class="main">)</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> repb_no_def<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> hd_filter_prop<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> 
                <span class="main">∧</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no1</span>"</span></span><span class="main">)</span>
                <span class="keyword3"><span class="command">case</span></span> True
                <span class="keyword1"><span class="command">note</span></span> red_cond<span class="main">=</span>this
                <span class="keyword1"><span class="command">from</span></span> no1_in_nodeslist all_nodes_nl_nLeafs
                <span class="keyword1"><span class="command">have</span></span> no1_nLeaf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> isLeaf_pt <span class="skolem">no1</span> <span class="skolem">low</span> <span class="skolem">high</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">from</span></span> nodes_balanced_ordered <span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> no1_in_nodeslist<span class="main">]</span>
                <span class="keyword1"><span class="command">have</span></span> no1_props<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">low</span> <span class="skolem">no1</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span><span class="main">)</span> 
                      <span class="main">∧</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no1</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span><span class="main">(</span><span class="skolem">low</span> <span class="skolem">no1</span> <span class="main">=</span> Null<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no1</span> <span class="main">=</span> Null<span class="main">)</span> 
                      <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no1</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">with</span></span> red_cond no1_nLeaf no1_in_take_Sucn repb_no_red_def 
                <span class="keyword1"><span class="command">have</span></span> repb_no1_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no1</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isLeaf_pt_def<span class="main">)</span>
                <span class="keyword1"><span class="command">with</span></span> no1_nLeaf no1_props <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">no1</span> <span class="main">=</span> <span class="skolem">repb</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no1</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def isLeaf_pt_def<span class="main">)</span>
                <span class="keyword1"><span class="command">from</span></span> no1_props no1_nLeaf <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rep</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no1</span><span class="main">)</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isLeaf_pt_def null_comp_def<span class="main">)</span>
                <span class="keyword1"><span class="command">with</span></span> rep_repb_nc no1_props 
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no1</span><span class="main">)</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">with</span></span> repb_no1_def repb_no_no1 no1_props no1_nLeaf 
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="skolem">node</span><span class="main">#</span><span class="skolem">sfx</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isLeaf_pt_def null_comp_def<span class="main">)</span>
                <span class="keyword1"><span class="command">with</span></span> repb_no_in_nl <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">next</span></span>
                <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no1</span> <span class="main">≠</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no1</span>"</span></span>
                <span class="keyword1"><span class="command">with</span></span> repb_no_share_def no1_in_take_Sucn 
                <span class="keyword1"><span class="command">have</span></span> repb_no1_def<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">repb</span> <span class="skolem">no1</span> <span class="main">=</span> 
                  hd <span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no1</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">from</span></span> no1_in_take_Sucn 
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">sn</span><span class="main">←</span><span class="main">(</span><span class="skolem">prx</span><span class="main">@</span><span class="main">[</span><span class="skolem">node</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> repNodes_eq <span class="bound">sn</span> <span class="skolem">no1</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span><span class="main">]</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> 
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> filter_not_empty<span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repNodes_eq_def<span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                <span class="keyword1"><span class="command">then</span></span> 
                <span class="keyword1"><span class="command">have</span></span> repNodes_repb_no1<span class="main">:</span> <span class="quoted"><span class="quoted">"repNodes_eq <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">no1</span><span class="main">)</span> <span class="skolem">no1</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span>"</span></span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> repb_no1_def <span class="main">)</span> 
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> hd_filter_prop<span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                <span class="keyword1"><span class="command">with</span></span> repNodes_repb_no repb_no_no1 
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"repNodes_eq <span class="skolem">no1</span> <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">repb</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repNodes_eq_def<span class="main">)</span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> repNodes_eq_def<span class="main">)</span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">with</span></span> repb_repb_no repb_no_share_def no_in_take_Sucn repbchildren_neq_no
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_depth_limit</span><span class="main"><span class="main">=</span></span>2<span class="main">]</span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">with</span></span> repb_no_nNull <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> rep_repb_nc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>




</pre>
</div><div id="RepointProof">
<div class="head">
<h1>Theory RepointProof</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       BDD

    Author:      Veronika Ortner and Norbert Schirmer, 2004
    Maintainer:  Norbert Schirmer,  norbert.schirmer at web de
    License:     LGPL
*)</span>

<span class="comment1">(*  
RepointProof.thy

Copyright (C) 2004-2008 Veronika Ortner and Norbert Schirmer 
Some rights reserved, TU Muenchen

This library is free software; you can redistribute it and/or modify
it under the terms of the GNU Lesser General Public License as
published by the Free Software Foundation; either version 2.1 of the
License, or (at your option) any later version.

This library is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
Lesser General Public License for more details.

You should have received a copy of the GNU Lesser General Public
License along with this library; if not, write to the Free Software
Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307
USA
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Proof of Procedure Repoint›</span></span>
<span class="keyword1"><span class="command">theory</span></span> RepointProof <span class="keyword2"><span class="keyword">imports</span></span> <a href="ProcedureSpecs.html">ProcedureSpecs</a> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> DistinctTreeProver.set_of tree.Node tree.Tip

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Repoint_impl<span class="main">)</span> Repoint_modifies<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">σ</span><span class="main">.</span> <span class="free">Γ</span><span class="main">⊢</span><span class="main">{</span><span class="bound">σ</span><span class="main">}</span> <span class="main">´</span>p <span class="main">:==</span>  <span class="keyword1">PROC</span> Repoint <span class="main">(</span><span class="main">´</span>p<span class="main">)</span>
        <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="keyword1">may_only_modify_globals</span> <span class="bound">σ</span> <span class="keyword1">in</span> <span class="main">[</span>low<span class="main">,</span>high<span class="main">]</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">hoare_rule</span> HoarePartial.ProcRec1<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">vcg</span> spec<span class="main"><span class="main">=</span></span>modifies<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="RepointProof-low_high_exchange_dag"><span class="command">lemma</span></span> low_high_exchange_dag<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> pt_same<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">pt</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∉</span> set_of <span class="free">lt</span> <span class="main">⟶</span> <span class="free">low</span> <span class="bound">pt</span> <span class="main">=</span> <span class="free">lowa</span> <span class="bound">pt</span> <span class="main">∧</span> <span class="free">high</span> <span class="bound">pt</span> <span class="main">=</span> <span class="free">higha</span> <span class="bound">pt</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> pt_changed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">pt</span> <span class="main">∈</span> set_of <span class="free">lt</span><span class="main">.</span> <span class="free">lowa</span> <span class="bound">pt</span> <span class="main">=</span> <span class="main">(</span><span class="free">rep</span> <span class="main">∝</span> <span class="free">low</span><span class="main">)</span> <span class="bound">pt</span> <span class="main">∧</span> 
                            <span class="free">higha</span> <span class="bound">pt</span> <span class="main">=</span> <span class="main">(</span><span class="free">rep</span> <span class="main">∝</span> <span class="free">high</span><span class="main">)</span> <span class="bound">pt</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> rep_pt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">pt</span> <span class="main">∈</span> set_of <span class="free">rt</span><span class="main">.</span> <span class="free">rep</span> <span class="bound">pt</span> <span class="main">=</span> <span class="bound">pt</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">q</span><span class="main">.</span>  Dag <span class="bound">q</span> <span class="main">(</span><span class="free">rep</span> <span class="main">∝</span> <span class="free">low</span><span class="main">)</span> <span class="main">(</span><span class="free">rep</span> <span class="main">∝</span> <span class="free">high</span><span class="main">)</span> <span class="free">rt</span> <span class="main">⟹</span> 
            Dag <span class="bound">q</span> <span class="main">(</span><span class="free">rep</span> <span class="main">∝</span> <span class="free">lowa</span><span class="main">)</span> <span class="main">(</span><span class="free">rep</span> <span class="main">∝</span> <span class="free">higha</span><span class="main">)</span> <span class="free">rt</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> rep_pt
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">rt</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Tip <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">lrt</span> <span class="skolem">q'</span> <span class="skolem">rrt</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Dag <span class="skolem">q</span> <span class="main">(</span><span class="free">rep</span> <span class="main">∝</span> <span class="free">low</span><span class="main">)</span> <span class="main">(</span><span class="free">rep</span> <span class="main">∝</span> <span class="free">high</span><span class="main">)</span> <span class="main">(</span>Node <span class="skolem">lrt</span> <span class="skolem">q'</span> <span class="skolem">rrt</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> 
    q'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="skolem">q'</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span>
    q_notNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> Null"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
    lrt<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="main">(</span><span class="free">rep</span> <span class="main">∝</span> <span class="free">low</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span><span class="free">rep</span> <span class="main">∝</span> <span class="free">low</span><span class="main">)</span> <span class="main">(</span><span class="free">rep</span> <span class="main">∝</span> <span class="free">high</span><span class="main">)</span> <span class="skolem">lrt</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    rrt<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="main">(</span><span class="free">rep</span> <span class="main">∝</span> <span class="free">high</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span><span class="free">rep</span> <span class="main">∝</span> <span class="free">low</span><span class="main">)</span> <span class="main">(</span><span class="free">rep</span> <span class="main">∝</span> <span class="free">high</span><span class="main">)</span> <span class="skolem">rrt</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> rlowa_rlow<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">rep</span> <span class="main">∝</span> <span class="free">lowa</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">rep</span> <span class="main">∝</span> <span class="free">low</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set_of <span class="free">lt</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">note</span></span> q_in_lt<span class="main">=</span>this
    <span class="keyword1"><span class="command">with</span></span> pt_changed <span class="keyword1"><span class="command">have</span></span> lowa_q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">lowa</span> <span class="skolem">q</span> <span class="main">=</span> <span class="main">(</span><span class="free">rep</span> <span class="main">∝</span> <span class="free">low</span><span class="main">)</span> <span class="skolem">q</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">rep</span> <span class="main">∝</span> <span class="free">lowa</span><span class="main">)</span> <span class="skolem">q</span> <span class="main">=</span> <span class="main">(</span><span class="free">rep</span> <span class="main">∝</span> <span class="free">low</span><span class="main">)</span> <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">low</span> <span class="skolem">q</span> <span class="main">=</span> Null"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> lowa_q <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">lowa</span> <span class="skolem">q</span> <span class="main">=</span> Null"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> lq_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">low</span> <span class="skolem">q</span> <span class="main">≠</span> Null"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">rep</span> <span class="main">∝</span> <span class="free">low</span><span class="main">)</span> <span class="skolem">q</span> <span class="main">=</span> Null"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True 
        <span class="keyword1"><span class="command">with</span></span> lowa_q <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">lowa</span> <span class="skolem">q</span> <span class="main">=</span> Null"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> rlq_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">rep</span> <span class="main">∝</span> <span class="free">low</span><span class="main">)</span> <span class="skolem">q</span> <span class="main">≠</span> Null"</span></span>
        <span class="keyword1"><span class="command">with</span></span> lrt lowa_q <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">lowa</span> <span class="skolem">q</span> <span class="main">∈</span> set_of <span class="skolem">lrt</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> Node.prems Node <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">lowa</span> <span class="skolem">q</span> <span class="main">∈</span> set_of <span class="main">(</span>Node <span class="skolem">lrt</span> <span class="skolem">q'</span> <span class="skolem">rrt</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> Node.prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">rep</span> <span class="main">(</span><span class="free">lowa</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">lowa</span> <span class="skolem">q</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> lowa_q rlq_nNull <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> q_notin_lt<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">q</span> <span class="main">∉</span> set_of <span class="free">lt</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> pt_same <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">low</span> <span class="skolem">q</span> <span class="main">=</span> <span class="free">lowa</span> <span class="skolem">q</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> rhigha_rhigh<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">rep</span> <span class="main">∝</span> <span class="free">higha</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">rep</span> <span class="main">∝</span> <span class="free">high</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set_of <span class="free">lt</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">note</span></span> q_in_lt<span class="main">=</span>this
    <span class="keyword1"><span class="command">with</span></span> pt_changed <span class="keyword1"><span class="command">have</span></span> higha_q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">higha</span> <span class="skolem">q</span> <span class="main">=</span> <span class="main">(</span><span class="free">rep</span> <span class="main">∝</span> <span class="free">high</span><span class="main">)</span> <span class="skolem">q</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">high</span> <span class="skolem">q</span> <span class="main">=</span> Null"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> higha_q <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">higha</span> <span class="skolem">q</span> <span class="main">=</span> Null"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> hq_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">high</span> <span class="skolem">q</span> <span class="main">≠</span> Null"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">rep</span> <span class="main">∝</span> <span class="free">high</span><span class="main">)</span> <span class="skolem">q</span> <span class="main">=</span> Null"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True 
        <span class="keyword1"><span class="command">with</span></span> higha_q <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">higha</span> <span class="skolem">q</span> <span class="main">=</span> Null"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> rhq_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">rep</span> <span class="main">∝</span> <span class="free">high</span><span class="main">)</span> <span class="skolem">q</span> <span class="main">≠</span> Null"</span></span>
        <span class="keyword1"><span class="command">with</span></span> rrt higha_q <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">higha</span> <span class="skolem">q</span> <span class="main">∈</span> set_of <span class="skolem">rrt</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> Node.prems Node <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">higha</span> <span class="skolem">q</span> <span class="main">∈</span> set_of <span class="main">(</span>Node <span class="skolem">lrt</span> <span class="skolem">q'</span> <span class="skolem">rrt</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> Node.prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">rep</span> <span class="main">(</span><span class="free">higha</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">higha</span> <span class="skolem">q</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> higha_q rhq_nNull <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> q_notin_lt<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">q</span> <span class="main">∉</span> set_of <span class="free">lt</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> pt_same <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">high</span> <span class="skolem">q</span> <span class="main">=</span> <span class="free">higha</span> <span class="skolem">q</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> rrt <span class="keyword1"><span class="command">have</span></span> rhigha_mixed_dag<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="main">(</span><span class="free">rep</span> <span class="main">∝</span> <span class="free">higha</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span><span class="free">rep</span> <span class="main">∝</span> <span class="free">low</span><span class="main">)</span> <span class="main">(</span><span class="free">rep</span> <span class="main">∝</span> <span class="free">high</span><span class="main">)</span> <span class="skolem">rrt</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> lrt rlowa_rlow <span class="keyword1"><span class="command">have</span></span> rlowa_mixed_dag<span class="main">:</span> 
    <span class="quoted"><span class="quoted">" Dag <span class="main">(</span><span class="main">(</span><span class="free">rep</span> <span class="main">∝</span> <span class="free">lowa</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span><span class="free">rep</span> <span class="main">∝</span> <span class="free">low</span><span class="main">)</span> <span class="main">(</span><span class="free">rep</span> <span class="main">∝</span> <span class="free">high</span><span class="main">)</span> <span class="skolem">lrt</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> Node.prems <span class="keyword1"><span class="command">have</span></span> lrt_rep_eq<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">pt</span><span class="main">∈</span>set_of <span class="skolem">lrt</span><span class="main">.</span> <span class="free">rep</span> <span class="bound">pt</span> <span class="main">=</span> <span class="bound">pt</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> Node.prems <span class="keyword1"><span class="command">have</span></span> rrt_rep_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">pt</span><span class="main">∈</span>set_of <span class="skolem">rrt</span><span class="main">.</span> <span class="free">rep</span> <span class="bound">pt</span> <span class="main">=</span> <span class="bound">pt</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> rlowa_mixed_dag lrt_rep_eq <span class="keyword1"><span class="command">have</span></span> lowa_lrt<span class="main">:</span> 
    <span class="quoted"><span class="quoted">" Dag <span class="main">(</span><span class="main">(</span><span class="free">rep</span> <span class="main">∝</span> <span class="free">lowa</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span><span class="free">rep</span> <span class="main">∝</span> <span class="free">lowa</span><span class="main">)</span> <span class="main">(</span><span class="free">rep</span> <span class="main">∝</span> <span class="free">higha</span><span class="main">)</span> <span class="skolem">lrt</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Node.hyps<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">from</span></span> rhigha_mixed_dag rrt_rep_eq <span class="keyword1"><span class="command">have</span></span> higha_rrt<span class="main">:</span> 
    <span class="quoted"><span class="quoted">" Dag <span class="main">(</span><span class="main">(</span><span class="free">rep</span> <span class="main">∝</span> <span class="free">higha</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span><span class="free">rep</span> <span class="main">∝</span> <span class="free">lowa</span><span class="main">)</span> <span class="main">(</span><span class="free">rep</span> <span class="main">∝</span> <span class="free">higha</span><span class="main">)</span> <span class="skolem">rrt</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Node.hyps<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">with</span></span> lowa_lrt q' q_notNull 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" Dag <span class="skolem">q</span> <span class="main">(</span><span class="free">rep</span> <span class="main">∝</span> <span class="free">lowa</span><span class="main">)</span> <span class="main">(</span><span class="free">rep</span> <span class="main">∝</span> <span class="free">higha</span><span class="main">)</span> <span class="main">(</span>Node <span class="skolem">lrt</span> <span class="skolem">q'</span> <span class="skolem">rrt</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*lemma Repoint_spec :
includes Repoint_impl 
shows  
  "∀σ rept. Γ⊢ ⦃σ. (Dag ((<span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>rep ∝ id) <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>p) (<span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>rep ∝ <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>low) (<span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>rep ∝ <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>high) rept) 
  ∧ (∀ no ∈ set_of rept. <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>rep no = no) ⦄
  ´p :== CALL Repoint (´p)
  ⦃Dag ´p ´low ´high rept ∧
  (∀pt. pt ∉ set_of rept ⟶ <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>low pt = ´low pt ∧ <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>high pt = ´high pt)⦄"
apply (hoare_rule CallRec1_SamePost)
apply (vcg)
apply  (rule conjI)
apply  clarify
prefer 2
apply (intro impI allI )
apply (simp add: null_comp_def)
apply (rule conjI)
prefer 2
apply (clarsimp)
apply clarify
*)</span>



<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Repoint_impl<span class="main">)</span> Repoint_spec'<span class="main">:</span>
<span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">σ</span><span class="main">.</span> <span class="free">Γ</span><span class="main">⊢</span> <span class="main">{</span><span class="bound">σ</span><span class="main">}</span>
  <span class="main">´</span>p <span class="main">:==</span> <span class="keyword1">PROC</span> Repoint <span class="main">(</span><span class="main">´</span>p<span class="main">)</span>
  <span class="main">⦃</span><span class="main">∀</span> <span class="bound">rept</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>Dag <span class="main">(</span><span class="main">(</span><span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>rep <span class="main">∝</span> id<span class="main">)</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>p<span class="main">)</span> <span class="main">(</span><span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>rep <span class="main">∝</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>low<span class="main">)</span> <span class="main">(</span><span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>rep <span class="main">∝</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>high<span class="main">)</span> <span class="bound">rept</span><span class="main">)</span> 
  <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">no</span> <span class="main">∈</span> set_of <span class="bound">rept</span><span class="main">.</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>rep <span class="bound">no</span> <span class="main">=</span> <span class="bound">no</span><span class="main">)</span><span class="main">)</span>
  <span class="main">⟶</span> Dag <span class="main">´</span>p <span class="main">´</span>low <span class="main">´</span>high <span class="bound">rept</span> <span class="main">∧</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound">pt</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∉</span> set_of <span class="bound">rept</span> <span class="main">⟶</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>low <span class="bound">pt</span> <span class="main">=</span> <span class="main">´</span>low <span class="bound">pt</span> <span class="main">∧</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>high <span class="bound">pt</span> <span class="main">=</span> <span class="main">´</span>high <span class="bound">pt</span><span class="main">)</span><span class="main">⦄</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">hoare_rule</span> HoarePartial.ProcRec1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">vcg</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">clarify</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> impI allI <span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">p</span> <span class="skolem">rep</span> <span class="skolem">lowa</span> <span class="skolem">higha</span> <span class="skolem">pa</span> <span class="skolem">lowb</span> <span class="skolem">highb</span> <span class="skolem">pb</span> <span class="skolem">rept</span>
  <span class="keyword3"><span class="command">assume</span></span> p_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> Null"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> rp_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">≠</span> Null"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> rec_spec_lrept<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">rept</span><span class="main">.</span> Dag <span class="main">(</span><span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> id<span class="main">)</span> <span class="main">(</span><span class="skolem">low</span> <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">rept</span>
    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set_of <span class="bound">rept</span><span class="main">.</span> <span class="skolem">rep</span> <span class="bound">no</span> <span class="main">=</span> <span class="bound">no</span><span class="main">)</span>
    <span class="main">⟶</span> Dag <span class="skolem">pa</span> <span class="skolem">lowa</span> <span class="skolem">higha</span> <span class="bound">rept</span> <span class="main">∧</span> 
        <span class="main">(</span><span class="main">∀</span><span class="bound">pt</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∉</span> set_of <span class="bound">rept</span> <span class="main">⟶</span> <span class="skolem">low</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">lowa</span> <span class="bound">pt</span> <span class="main">∧</span> <span class="skolem">high</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">higha</span> <span class="bound">pt</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> rec_spec_rrept<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">rept</span><span class="main">.</span> Dag <span class="main">(</span><span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> id<span class="main">)</span> <span class="main">(</span><span class="skolem">higha</span> <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">lowa</span><span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">pa</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">higha</span><span class="main">)</span> <span class="bound">rept</span>
    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set_of <span class="bound">rept</span><span class="main">.</span> <span class="skolem">rep</span> <span class="bound">no</span> <span class="main">=</span> <span class="bound">no</span><span class="main">)</span>
    <span class="main">⟶</span> Dag <span class="skolem">pb</span> <span class="skolem">lowb</span> <span class="skolem">highb</span> <span class="bound">rept</span> <span class="main">∧</span> 
        <span class="main">(</span><span class="main">∀</span><span class="bound">pt</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∉</span> set_of <span class="bound">rept</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">lowa</span><span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">pa</span><span class="main">)</span><span class="main">)</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">lowb</span> <span class="bound">pt</span> <span class="main">∧</span> <span class="skolem">higha</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">highb</span> <span class="bound">pt</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> rept_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> id<span class="main">)</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">rept</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> rno_rept<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set_of <span class="skolem">rept</span><span class="main">.</span> <span class="skolem">rep</span> <span class="bound">no</span> <span class="main">=</span> <span class="bound">no</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" Dag <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">lowb</span> <span class="main">(</span><span class="skolem">highb</span><span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">pb</span><span class="main">)</span><span class="main">)</span> <span class="skolem">rept</span> <span class="main">∧</span> 
    <span class="main">(</span><span class="main">∀</span><span class="bound">pt</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∉</span> set_of <span class="skolem">rept</span> <span class="main">⟶</span> <span class="skolem">low</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">lowb</span> <span class="bound">pt</span> <span class="main">∧</span> <span class="skolem">high</span> <span class="bound">pt</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">highb</span><span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">pb</span><span class="main">)</span><span class="main">)</span> <span class="bound">pt</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> rp_nNull rept_dag p_nNull <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lrept</span></span> <span class="skolem"><span class="skolem">rrept</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      rept_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rept</span> <span class="main">=</span> Node <span class="skolem">lrept</span> <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">rrept</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> rept_dag p_nNull <span class="keyword1"><span class="command">have</span></span> lrept_dag<span class="main">:</span> 
      <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">lrept</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> rept_def rept_dag p_nNull <span class="keyword1"><span class="command">have</span></span> rrept_dag<span class="main">:</span> 
      <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">rrept</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> rno_rept rept_def <span class="keyword1"><span class="command">have</span></span> rno_lrept<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">no</span> <span class="main">∈</span> set_of <span class="skolem">lrept</span><span class="main">.</span> <span class="skolem">rep</span> <span class="bound">no</span> <span class="main">=</span> <span class="bound">no</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> rno_rept rept_def <span class="keyword1"><span class="command">have</span></span> rno_rrept<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">no</span> <span class="main">∈</span> set_of <span class="skolem">rrept</span><span class="main">.</span> <span class="skolem">rep</span> <span class="bound">no</span> <span class="main">=</span> <span class="bound">no</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> repoint_post_low<span class="main">:</span> 
      <span class="quoted"><span class="quoted">" Dag <span class="skolem">pa</span> <span class="skolem">lowa</span> <span class="skolem">higha</span> <span class="skolem">lrept</span> <span class="main">∧</span> 
      <span class="main">(</span><span class="main">∀</span><span class="bound">pt</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∉</span> set_of <span class="skolem">lrept</span> <span class="main">⟶</span> <span class="skolem">low</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">lowa</span> <span class="bound">pt</span> <span class="main">∧</span> <span class="skolem">high</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">higha</span> <span class="bound">pt</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> lrept_dag <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" Dag <span class="main">(</span><span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> id<span class="main">)</span> <span class="main">(</span><span class="skolem">low</span> <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">lrept</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> id_trans<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span>  rec_spec_lrept rno_lrept <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">lrept</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> low_lowa_nc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">pt</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∉</span> set_of <span class="skolem">lrept</span> <span class="main">⟶</span> <span class="skolem">low</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">lowa</span> <span class="bound">pt</span> <span class="main">∧</span> <span class="skolem">high</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">higha</span> <span class="bound">pt</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> lrept_dag  repoint_post_low <span class="keyword3"><span class="command">obtain</span></span> 
      pa_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">pa</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      lowa_higha_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">no</span> <span class="main">∈</span> set_of <span class="skolem">lrept</span><span class="main">.</span> <span class="skolem">lowa</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no</span> <span class="main">∧</span> <span class="skolem">higha</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> Dags_eq_hp_eq<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">from</span></span> rept_dag <span class="keyword1"><span class="command">have</span></span> rept_DAG<span class="main">:</span> <span class="quoted"><span class="quoted">"DAG <span class="skolem">rept</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Dag_is_DAG<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> rept_def <span class="keyword1"><span class="command">have</span></span> rp_notin_lrept<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">∉</span> set_of <span class="skolem">lrept</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> rept_DAG rept_def <span class="keyword1"><span class="command">have</span></span> rp_notin_rrept<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">∉</span> set_of <span class="skolem">rrept</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> id<span class="main">)</span> <span class="main">(</span><span class="skolem">higha</span> <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">lowa</span><span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">pa</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">higha</span><span class="main">)</span> <span class="skolem">rrept</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> low_lowa_nc rp_notin_lrept <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">higha</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> rrept_dag <span class="keyword1"><span class="command">have</span></span> higha_mixed_rrept<span class="main">:</span> 
        <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> id<span class="main">)</span> <span class="main">(</span><span class="skolem">higha</span> <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">rrept</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> id_trans<span class="main">)</span>
      <span class="keyword1"><span class="command">thm</span></span> low_high_exchange_dag
      <span class="keyword1"><span class="command">with</span></span> low_lowa_nc lowa_higha_def rno_rrept <span class="keyword1"><span class="command">have</span></span> lowa_higha_rrept<span class="main">:</span>
        <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> id<span class="main">)</span> <span class="main">(</span><span class="skolem">higha</span> <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">lowa</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">higha</span><span class="main">)</span> <span class="skolem">rrept</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> low_high_exchange_dag<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> id<span class="main">)</span> <span class="main">(</span><span class="skolem">higha</span> <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">lowa</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">higha</span><span class="main">)</span> <span class="skolem">rrept</span> <span class="main">=</span> 
        Dag <span class="main">(</span><span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> id<span class="main">)</span> <span class="main">(</span><span class="skolem">higha</span> <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">lowa</span><span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">pa</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">higha</span><span class="main">)</span> <span class="skolem">rrept</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">no</span> <span class="main">∈</span> set_of <span class="skolem">rrept</span><span class="main">.</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">lowa</span><span class="main">)</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">lowa</span><span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">pa</span><span class="main">)</span><span class="main">)</span> <span class="bound">no</span> <span class="main">∧</span>
          <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">higha</span><span class="main">)</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">higha</span><span class="main">)</span> <span class="bound">no</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> 
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">no</span>
          <span class="keyword3"><span class="command">assume</span></span> no_in_rrept<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">∈</span> set_of <span class="skolem">rrept</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> rp_notin_rrept <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">≠</span> <span class="skolem">rep</span> <span class="skolem">p</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">lowa</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">lowa</span><span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">pa</span><span class="main">)</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span> 
            <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">higha</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">higha</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> heaps_eq_Dag_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">with</span></span> lowa_higha_rrept <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> rec_spec_rrept rno_rrept <span class="keyword1"><span class="command">have</span></span> repoint_rrept<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="skolem">pb</span> <span class="skolem">lowb</span> <span class="skolem">highb</span> <span class="skolem">rrept</span> <span class="main">∧</span> 
      <span class="main">(</span><span class="main">∀</span><span class="bound">pt</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∉</span> set_of <span class="skolem">rrept</span> <span class="main">⟶</span> 
      <span class="main">(</span><span class="skolem">lowa</span><span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">pa</span><span class="main">)</span><span class="main">)</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">lowb</span> <span class="bound">pt</span> <span class="main">∧</span> <span class="skolem">higha</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">highb</span> <span class="bound">pt</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">rrept</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ab_nc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">pt</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∉</span> set_of <span class="skolem">rrept</span> <span class="main">⟶</span> 
      <span class="main">(</span><span class="skolem">lowa</span><span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">pa</span><span class="main">)</span><span class="main">)</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">lowb</span> <span class="bound">pt</span> <span class="main">∧</span> <span class="skolem">higha</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">highb</span> <span class="bound">pt</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> repoint_rrept rrept_dag <span class="keyword3"><span class="command">obtain</span></span>
      pb_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">pb</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      lowb_highb_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">no</span> <span class="main">∈</span> set_of <span class="skolem">rrept</span><span class="main">.</span> <span class="skolem">lowb</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no</span> <span class="main">∧</span> <span class="skolem">highb</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> Dags_eq_hp_eq<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">have</span></span> rept_end_dag<span class="main">:</span> <span class="quoted"><span class="quoted">" Dag <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">lowb</span> <span class="main">(</span><span class="skolem">highb</span><span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">pb</span><span class="main">)</span><span class="main">)</span> <span class="skolem">rept</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">no</span> <span class="main">∈</span> set_of <span class="skolem">rept</span><span class="main">.</span> <span class="skolem">lowb</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">highb</span><span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">pb</span><span class="main">)</span><span class="main">)</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">no</span>
        <span class="keyword3"><span class="command">assume</span></span> no_in_rept<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">no</span> <span class="main">∈</span> set_of <span class="skolem">rept</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lowb</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">highb</span><span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">pb</span><span class="main">)</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">∈</span> set_of <span class="skolem">rrept</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">with</span></span> lowb_highb_def pb_def <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> no_notin_rrept<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">no</span> <span class="main">∉</span> set_of <span class="skolem">rrept</span>"</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">∈</span> set_of <span class="skolem">lrept</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">with</span></span> no_notin_rrept rp_notin_lrept ab_nc
            <span class="keyword1"><span class="command">have</span></span> ab_nc_no<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lowa</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">lowb</span> <span class="skolem">no</span> <span class="main">∧</span> <span class="skolem">higha</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">highb</span> <span class="skolem">no</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">no</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">≠</span> <span class="skolem">rep</span> <span class="skolem">p</span>"</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">from</span></span> lowa_higha_def True <span class="keyword1"><span class="command">have</span></span> 
              <span class="quoted"><span class="quoted">"<span class="skolem">lowa</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span> <span class="skolem">higha</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">with</span></span> ab_nc_no <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lowb</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span> <span class="skolem">highb</span> <span class="skolem">no</span> <span class="main">=</span><span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span>"</span></span> 
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">with</span></span> rp_notin_lrept True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">≠</span> <span class="skolem">rep</span> <span class="skolem">p</span>"</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">assume</span></span> no_notin_lrept<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">no</span> <span class="main">∉</span> set_of <span class="skolem">lrept</span>"</span></span>
            <span class="keyword1"><span class="command">with</span></span> no_in_rept rept_def no_notin_rrept <span class="keyword1"><span class="command">have</span></span> no_rp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">=</span> <span class="skolem">rep</span> <span class="skolem">p</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">with</span></span> rp_notin_lrept low_lowa_nc <span class="keyword1"><span class="command">have</span></span> a_nc<span class="main">:</span>  
              <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">lowa</span> <span class="skolem">no</span> <span class="main">∧</span> <span class="skolem">high</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">higha</span> <span class="skolem">no</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> rp_notin_rrept no_rp ab_nc <span class="keyword1"><span class="command">have</span></span> 
              <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">lowa</span><span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">pa</span><span class="main">)</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">lowb</span> <span class="skolem">no</span> <span class="main">∧</span> <span class="skolem">higha</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">highb</span> <span class="skolem">no</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">with</span></span> a_nc pa_def no_rp <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">lowb</span> <span class="skolem">no</span> <span class="main">∧</span> <span class="skolem">high</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">highb</span> <span class="skolem">no</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">with</span></span> pb_def no_rp <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">with</span></span> rept_dag <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" Dag <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">lowb</span> <span class="main">(</span><span class="skolem">highb</span><span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">pb</span><span class="main">)</span><span class="main">)</span> <span class="skolem">rept</span> <span class="main">=</span> 
        Dag <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">rept</span>"</span></span>      
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">thm</span></span> heaps_eq_Dag_eq
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> heaps_eq_Dag_eq<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">with</span></span> rept_dag p_nNull <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">pt</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∉</span> set_of <span class="skolem">rept</span> <span class="main">⟶</span> <span class="skolem">low</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">lowb</span> <span class="bound">pt</span> <span class="main">∧</span> <span class="skolem">high</span> <span class="bound">pt</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">highb</span><span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">pb</span><span class="main">)</span><span class="main">)</span> <span class="bound">pt</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">pt</span>
      <span class="keyword3"><span class="command">assume</span></span> pt_notin_rept<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">pt</span> <span class="main">∉</span> set_of <span class="skolem">rept</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> rept_def <span class="keyword3"><span class="command">obtain</span></span>
        pt_notin_lrept<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">pt</span> <span class="main">∉</span> set_of <span class="skolem">lrept</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        pt_notin_rrept<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">pt</span> <span class="main">∉</span> set_of <span class="skolem">rrept</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        pt_neq_rp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">pt</span> <span class="main">≠</span> <span class="skolem">rep</span> <span class="skolem">p</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> low_lowa_nc ab_nc <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">pt</span> <span class="main">=</span> <span class="skolem">lowb</span> <span class="skolem">pt</span> <span class="main">∧</span> <span class="skolem">high</span> <span class="skolem">pt</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">highb</span><span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">pb</span><span class="main">)</span><span class="main">)</span> <span class="skolem">pt</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> rept_end_dag <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
        
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Repoint_impl<span class="main">)</span> Repoint_spec<span class="main">:</span>
<span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">σ</span> <span class="bound">rept</span><span class="main">.</span> <span class="free">Γ</span><span class="main">⊢</span> <span class="main">⦃</span><span class="bound">σ</span><span class="main">.</span> Dag <span class="main">(</span><span class="main">(</span><span class="main">´</span>rep <span class="main">∝</span> id<span class="main">)</span> <span class="main">´</span>p<span class="main">)</span> <span class="main">(</span><span class="main">´</span>rep <span class="main">∝</span> <span class="main">´</span>low<span class="main">)</span> <span class="main">(</span><span class="main">´</span>rep <span class="main">∝</span> <span class="main">´</span>high<span class="main">)</span> <span class="bound">rept</span> 
  <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">no</span> <span class="main">∈</span> set_of <span class="bound">rept</span><span class="main">.</span> <span class="main">´</span>rep <span class="bound">no</span> <span class="main">=</span> <span class="bound">no</span><span class="main">)</span> <span class="main">⦄</span> 
  <span class="main">´</span>p <span class="main">:==</span> <span class="keyword1">PROC</span> Repoint <span class="main">(</span><span class="main">´</span>p<span class="main">)</span>
  <span class="main">⦃</span>Dag <span class="main">´</span>p <span class="main">´</span>low <span class="main">´</span>high <span class="bound">rept</span> <span class="main">∧</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound">pt</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∉</span> set_of <span class="bound">rept</span> <span class="main">⟶</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>low <span class="bound">pt</span> <span class="main">=</span> <span class="main">´</span>low <span class="bound">pt</span> <span class="main">∧</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>high <span class="bound">pt</span> <span class="main">=</span> <span class="main">´</span>high <span class="bound">pt</span><span class="main">)</span><span class="main">⦄</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">hoare_rule</span> HoarePartial.ProcRec1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">vcg</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">rept</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">rep</span> <span class="skolem">p</span>
  <span class="keyword3"><span class="command">assume</span></span> rept_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> id<span class="main">)</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">rept</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> rno_rept<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set_of <span class="skolem">rept</span><span class="main">.</span> <span class="skolem">rep</span> <span class="bound">no</span> <span class="main">=</span> <span class="bound">no</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> p_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> Null"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> rp_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">≠</span> Null"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">lrept</span><span class="main">.</span>
             Dag <span class="main">(</span><span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> id<span class="main">)</span> <span class="main">(</span><span class="skolem">low</span> <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">lrept</span> <span class="main">∧</span>
             <span class="main">(</span><span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set_of <span class="bound">lrept</span><span class="main">.</span> <span class="skolem">rep</span> <span class="bound">no</span> <span class="main">=</span> <span class="bound">no</span><span class="main">)</span> <span class="main">∧</span>
             <span class="main">(</span><span class="main">∀</span><span class="bound">lowa</span> <span class="bound">higha</span> <span class="bound">pa</span><span class="main">.</span>
                 Dag <span class="bound">pa</span> <span class="bound">lowa</span> <span class="bound">higha</span> <span class="bound">lrept</span> <span class="main">∧</span>
                 <span class="main">(</span><span class="main">∀</span><span class="bound">pt</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∉</span> set_of <span class="bound">lrept</span> <span class="main">⟶</span>
                       <span class="skolem">low</span> <span class="bound">pt</span> <span class="main">=</span> <span class="bound">lowa</span> <span class="bound">pt</span> <span class="main">∧</span> <span class="skolem">high</span> <span class="bound">pt</span> <span class="main">=</span> <span class="bound">higha</span> <span class="bound">pt</span><span class="main">)</span> <span class="main">⟶</span>
                 <span class="main">(</span><span class="main">∃</span><span class="bound">rrept</span><span class="main">.</span>
                     Dag <span class="main">(</span><span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> id<span class="main">)</span> <span class="main">(</span><span class="bound">higha</span> <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="bound">lowa</span><span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="bound">pa</span><span class="main">)</span><span class="main">)</span>
                      <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="bound">higha</span><span class="main">)</span> <span class="bound">rrept</span> <span class="main">∧</span>
                     <span class="main">(</span><span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set_of <span class="bound">rrept</span><span class="main">.</span> <span class="skolem">rep</span> <span class="bound">no</span> <span class="main">=</span> <span class="bound">no</span><span class="main">)</span> <span class="main">∧</span>
                     <span class="main">(</span><span class="main">∀</span><span class="bound">lowb</span> <span class="bound">highb</span> <span class="bound">pb</span><span class="main">.</span>
                         Dag <span class="bound">pb</span> <span class="bound">lowb</span> <span class="bound">highb</span> <span class="bound">rrept</span> <span class="main">∧</span>
                         <span class="main">(</span><span class="main">∀</span><span class="bound">pt</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∉</span> set_of <span class="bound">rrept</span> <span class="main">⟶</span>
                               <span class="main">(</span><span class="bound">lowa</span><span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="bound">pa</span><span class="main">)</span><span class="main">)</span> <span class="bound">pt</span> <span class="main">=</span> <span class="bound">lowb</span> <span class="bound">pt</span> <span class="main">∧</span>
                               <span class="bound">higha</span> <span class="bound">pt</span> <span class="main">=</span> <span class="bound">highb</span> <span class="bound">pt</span><span class="main">)</span> <span class="main">⟶</span>
                         Dag <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span> <span class="bound">lowb</span> <span class="main">(</span><span class="bound">highb</span><span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="bound">pb</span><span class="main">)</span><span class="main">)</span> <span class="skolem">rept</span> <span class="main">∧</span>
                         <span class="main">(</span><span class="main">∀</span><span class="bound">pt</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∉</span> set_of <span class="skolem">rept</span> <span class="main">⟶</span>
                               <span class="skolem">low</span> <span class="bound">pt</span> <span class="main">=</span> <span class="bound">lowb</span> <span class="bound">pt</span> <span class="main">∧</span>
                               <span class="skolem">high</span> <span class="bound">pt</span> <span class="main">=</span> <span class="main">(</span><span class="bound">highb</span><span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="bound">pb</span><span class="main">)</span><span class="main">)</span> <span class="bound">pt</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> rp_nNull rept_dag p_nNull <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lrept</span></span> <span class="skolem"><span class="skolem">rrept</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      rept_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rept</span> <span class="main">=</span> Node <span class="skolem">lrept</span> <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">rrept</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> rept_dag p_nNull <span class="keyword1"><span class="command">have</span></span> lrept_dag<span class="main">:</span> 
      <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">lrept</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> rept_def rept_dag p_nNull <span class="keyword1"><span class="command">have</span></span> rrept_dag<span class="main">:</span> 
      <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">rrept</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> rno_rept rept_def <span class="keyword1"><span class="command">have</span></span> rno_lrept<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">no</span> <span class="main">∈</span> set_of <span class="skolem">lrept</span><span class="main">.</span> <span class="skolem">rep</span> <span class="bound">no</span> <span class="main">=</span> <span class="bound">no</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> rno_rept rept_def <span class="keyword1"><span class="command">have</span></span> rno_rrept<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">no</span> <span class="main">∈</span> set_of <span class="skolem">rrept</span><span class="main">.</span> <span class="skolem">rep</span> <span class="bound">no</span> <span class="main">=</span> <span class="bound">no</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">lrept</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> id_trans lrept_dag<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rno_lrept<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">premises</span></span> prems <span class="keyword2"><span class="keyword">for</span></span> lowa higha pa
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> lrepta<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="skolem">pa</span> <span class="skolem">lowa</span> <span class="skolem">higha</span> <span class="skolem">lrept</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
        <span class="keyword1"><span class="command">have</span></span> low_lowa_nc<span class="main">:</span> 
          <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">pt</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∉</span> set_of <span class="skolem">lrept</span> <span class="main">⟶</span> <span class="skolem">low</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">lowa</span> <span class="bound">pt</span> <span class="main">∧</span> <span class="skolem">high</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">higha</span> <span class="bound">pt</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
        <span class="keyword1"><span class="command">from</span></span> lrept_dag lrepta  <span class="keyword3"><span class="command">obtain</span></span> 
          pa_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">pa</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          lowa_higha_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span> <span class="main">∈</span> set_of <span class="skolem">lrept</span><span class="main">.</span> 
          <span class="skolem">lowa</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no</span> <span class="main">∧</span> <span class="skolem">higha</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> Dags_eq_hp_eq<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">from</span></span> rept_dag <span class="keyword1"><span class="command">have</span></span> rept_DAG<span class="main">:</span> <span class="quoted"><span class="quoted">"DAG <span class="skolem">rept</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Dag_is_DAG<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> rept_def <span class="keyword1"><span class="command">have</span></span> rp_notin_lrept<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">∉</span> set_of <span class="skolem">lrept</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> rept_DAG rept_def <span class="keyword1"><span class="command">have</span></span> rp_notin_rrept<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">∉</span> set_of <span class="skolem">rrept</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> rrepta<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> id<span class="main">)</span> <span class="main">(</span><span class="skolem">higha</span> <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                         <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">lowa</span><span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">pa</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">higha</span><span class="main">)</span> <span class="skolem">rrept</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">from</span></span> low_lowa_nc rp_notin_lrept 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">higha</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> rrept_dag <span class="keyword1"><span class="command">have</span></span> higha_mixed_rrept<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> id<span class="main">)</span> <span class="main">(</span><span class="skolem">higha</span> <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">rrept</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> id_trans<span class="main">)</span>
          <span class="keyword1"><span class="command">thm</span></span> low_high_exchange_dag
          <span class="keyword1"><span class="command">with</span></span> low_lowa_nc lowa_higha_def rno_rrept 
          <span class="keyword1"><span class="command">have</span></span> lowa_higha_rrept<span class="main">:</span>
              <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> id<span class="main">)</span> <span class="main">(</span><span class="skolem">higha</span> <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">lowa</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">higha</span><span class="main">)</span> <span class="skolem">rrept</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> low_high_exchange_dag<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> id<span class="main">)</span> <span class="main">(</span><span class="skolem">higha</span> <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">lowa</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">higha</span><span class="main">)</span> <span class="skolem">rrept</span> <span class="main">=</span> 
                Dag <span class="main">(</span><span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> id<span class="main">)</span> <span class="main">(</span><span class="skolem">higha</span> <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                        <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">lowa</span><span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">pa</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">higha</span><span class="main">)</span> <span class="skolem">rrept</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span> <span class="main">∈</span> set_of <span class="skolem">rrept</span><span class="main">.</span> 
                      <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">lowa</span><span class="main">)</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">lowa</span><span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">pa</span><span class="main">)</span><span class="main">)</span> <span class="bound">no</span> <span class="main">∧</span>
                      <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">higha</span><span class="main">)</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">higha</span><span class="main">)</span> <span class="bound">no</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> 
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">no</span>
              <span class="keyword3"><span class="command">assume</span></span> no_in_rrept<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">∈</span> set_of <span class="skolem">rrept</span>"</span></span>
              <span class="keyword1"><span class="command">with</span></span> rp_notin_rrept <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">≠</span> <span class="skolem">rep</span> <span class="skolem">p</span>"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">lowa</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">lowa</span><span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">pa</span><span class="main">)</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span> 
                <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">higha</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">higha</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> heaps_eq_Dag_eq<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">with</span></span> lowa_higha_rrept <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">rrept</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">rule</span> rrepta<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">rule</span> rno_rrept<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">premises</span></span> prems <span class="keyword2"><span class="keyword">for</span></span> lowb highb pb
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> rreptb<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="skolem">pb</span> <span class="skolem">lowb</span> <span class="skolem">highb</span> <span class="skolem">rrept</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
            <span class="keyword1"><span class="command">have</span></span> ab_nc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">pt</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∉</span> set_of <span class="skolem">rrept</span> <span class="main">⟶</span> 
                            <span class="main">(</span><span class="skolem">lowa</span><span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">pa</span><span class="main">)</span><span class="main">)</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">lowb</span> <span class="bound">pt</span> <span class="main">∧</span> <span class="skolem">higha</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">highb</span> <span class="bound">pt</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
            <span class="keyword1"><span class="command">from</span></span> rreptb rrept_dag <span class="keyword3"><span class="command">obtain</span></span>
              pb_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">pb</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
              lowb_highb_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span> <span class="main">∈</span> set_of <span class="skolem">rrept</span><span class="main">.</span> 
                                  <span class="skolem">lowb</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no</span> <span class="main">∧</span> <span class="skolem">highb</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> Dags_eq_hp_eq<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">have</span></span> rept_end_dag<span class="main">:</span> <span class="quoted"><span class="quoted">" Dag <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">lowb</span> <span class="main">(</span><span class="skolem">highb</span><span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">pb</span><span class="main">)</span><span class="main">)</span> <span class="skolem">rept</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span> <span class="main">∈</span> set_of <span class="skolem">rept</span><span class="main">.</span> 
                    <span class="skolem">lowb</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">highb</span><span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">pb</span><span class="main">)</span><span class="main">)</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span>
                <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">no</span>
                <span class="keyword3"><span class="command">assume</span></span> no_in_rept<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">no</span> <span class="main">∈</span> set_of <span class="skolem">rept</span>"</span></span>
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lowb</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span> 
                      <span class="main">(</span><span class="skolem">highb</span><span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">pb</span><span class="main">)</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">∈</span> set_of <span class="skolem">rrept</span>"</span></span><span class="main">)</span>
                  <span class="keyword3"><span class="command">case</span></span> True
                  <span class="keyword1"><span class="command">with</span></span> lowb_highb_def pb_def <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">next</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> no_notin_rrept<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">no</span> <span class="main">∉</span> set_of <span class="skolem">rrept</span>"</span></span>
                  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">∈</span> set_of <span class="skolem">lrept</span>"</span></span><span class="main">)</span>
                    <span class="keyword3"><span class="command">case</span></span> True
                    <span class="keyword1"><span class="command">with</span></span> no_notin_rrept rp_notin_lrept ab_nc
                    <span class="keyword1"><span class="command">have</span></span> ab_nc_no<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lowa</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">lowb</span> <span class="skolem">no</span> <span class="main">∧</span> <span class="skolem">higha</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">highb</span> <span class="skolem">no</span>"</span></span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">no</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">≠</span> <span class="skolem">rep</span> <span class="skolem">p</span>"</span></span><span class="main">)</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                    <span class="keyword1"><span class="command">from</span></span> lowa_higha_def True <span class="keyword1"><span class="command">have</span></span> 
                      <span class="quoted"><span class="quoted">"<span class="skolem">lowa</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span> <span class="skolem">higha</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">with</span></span> ab_nc_no 
                    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lowb</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span> <span class="skolem">highb</span> <span class="skolem">no</span> <span class="main">=</span><span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span>"</span></span> 
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">with</span></span> rp_notin_lrept True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">≠</span> <span class="skolem">rep</span> <span class="skolem">p</span>"</span></span><span class="main">)</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                  <span class="keyword1"><span class="command">next</span></span>
                    <span class="keyword3"><span class="command">assume</span></span> no_notin_lrept<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">no</span> <span class="main">∉</span> set_of <span class="skolem">lrept</span>"</span></span>
                    <span class="keyword1"><span class="command">with</span></span> no_in_rept rept_def no_notin_rrept <span class="keyword1"><span class="command">have</span></span> no_rp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">=</span> <span class="skolem">rep</span> <span class="skolem">p</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">with</span></span> rp_notin_lrept low_lowa_nc 
                    <span class="keyword1"><span class="command">have</span></span> a_nc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">lowa</span> <span class="skolem">no</span> <span class="main">∧</span> <span class="skolem">high</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">higha</span> <span class="skolem">no</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">from</span></span> rp_notin_rrept no_rp ab_nc 
                    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">lowa</span><span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">pa</span><span class="main">)</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">lowb</span> <span class="skolem">no</span> <span class="main">∧</span> <span class="skolem">higha</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">highb</span> <span class="skolem">no</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">with</span></span> a_nc pa_def no_rp 
                    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">lowb</span> <span class="skolem">no</span> <span class="main">∧</span> <span class="skolem">high</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">highb</span> <span class="skolem">no</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">with</span></span> pb_def no_rp <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">with</span></span> rept_dag 
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">lowb</span> <span class="main">(</span><span class="skolem">highb</span><span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">pb</span><span class="main">)</span><span class="main">)</span> <span class="skolem">rept</span> <span class="main">=</span> 
                    Dag <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">rept</span>"</span></span>      
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> heaps_eq_Dag_eq<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">with</span></span> rept_dag p_nNull <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">pt</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∉</span> set_of <span class="skolem">rept</span> <span class="main">⟶</span> <span class="skolem">low</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">lowb</span> <span class="bound">pt</span> <span class="main">∧</span> 
                        <span class="skolem">high</span> <span class="bound">pt</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">highb</span><span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">pb</span><span class="main">)</span><span class="main">)</span> <span class="bound">pt</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">pt</span>
              <span class="keyword3"><span class="command">assume</span></span> pt_notin_rept<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">pt</span> <span class="main">∉</span> set_of <span class="skolem">rept</span>"</span></span>
              <span class="keyword1"><span class="command">with</span></span> rept_def <span class="keyword3"><span class="command">obtain</span></span>
                pt_notin_lrept<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">pt</span> <span class="main">∉</span> set_of <span class="skolem">lrept</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
                pt_notin_rrept<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">pt</span> <span class="main">∉</span> set_of <span class="skolem">rrept</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
                pt_neq_rp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">pt</span> <span class="main">≠</span> <span class="skolem">rep</span> <span class="skolem">p</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">with</span></span> low_lowa_nc ab_nc 
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">pt</span> <span class="main">=</span> <span class="skolem">lowb</span> <span class="skolem">pt</span> <span class="main">∧</span> <span class="skolem">high</span> <span class="skolem">pt</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">highb</span><span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">pb</span><span class="main">)</span><span class="main">)</span> <span class="skolem">pt</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">with</span></span> rept_end_dag <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Repoint_impl<span class="main">)</span> Repoint_spec_total<span class="main">:</span>
<span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">σ</span> <span class="bound">rept</span><span class="main">.</span> <span class="free">Γ</span><span class="keyword1">⊢<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">⦃</span><span class="bound">σ</span><span class="main">.</span> Dag <span class="main">(</span><span class="main">(</span><span class="main">´</span>rep <span class="main">∝</span> id<span class="main">)</span> <span class="main">´</span>p<span class="main">)</span> <span class="main">(</span><span class="main">´</span>rep <span class="main">∝</span> <span class="main">´</span>low<span class="main">)</span> <span class="main">(</span><span class="main">´</span>rep <span class="main">∝</span> <span class="main">´</span>high<span class="main">)</span> <span class="bound">rept</span> 
  <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">no</span> <span class="main">∈</span> set_of <span class="bound">rept</span><span class="main">.</span> <span class="main">´</span>rep <span class="bound">no</span> <span class="main">=</span> <span class="bound">no</span><span class="main">)</span> <span class="main">⦄</span> 
  <span class="main">´</span>p <span class="main">:==</span> <span class="keyword1">PROC</span> Repoint <span class="main">(</span><span class="main">´</span>p<span class="main">)</span>
  <span class="main">⦃</span>Dag <span class="main">´</span>p <span class="main">´</span>low <span class="main">´</span>high <span class="bound">rept</span> <span class="main">∧</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound">pt</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∉</span> set_of <span class="bound">rept</span> <span class="main">⟶</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>low <span class="bound">pt</span> <span class="main">=</span> <span class="main">´</span>low <span class="bound">pt</span> <span class="main">∧</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>high <span class="bound">pt</span> <span class="main">=</span> <span class="main">´</span>high <span class="bound">pt</span><span class="main">)</span><span class="main">⦄</span>"</span></span>

<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">hoare_rule</span> HoareTotal.ProcRec1
          <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> r<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"measure <span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">s</span></span><span class="main"><span class="main">,</span></span><span class="bound"><span class="bound">p</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">.</span></span> size 
                       <span class="main"><span class="main">(</span></span>dag <span class="main"><span class="main">(</span></span><span class="main"><span class="main">(</span></span><span class="hidden">⇗</span><sup>s</sup><span class="hidden">⇖</span>rep <span class="main"><span class="main">∝</span></span> id<span class="main"><span class="main">)</span></span> <span class="hidden">⇗</span><sup>s</sup><span class="hidden">⇖</span>p<span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span><span class="hidden">⇗</span><sup>s</sup><span class="hidden">⇖</span>rep <span class="main"><span class="main">∝</span></span> <span class="hidden">⇗</span><sup>s</sup><span class="hidden">⇖</span>low<span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span><span class="hidden">⇗</span><sup>s</sup><span class="hidden">⇖</span>rep <span class="main"><span class="main">∝</span></span> <span class="hidden">⇗</span><sup>s</sup><span class="hidden">⇖</span>high<span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">vcg</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">rept</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">rep</span> <span class="skolem">p</span>
  <span class="keyword3"><span class="command">assume</span></span> rept_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> id<span class="main">)</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">rept</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> rno_rept<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set_of <span class="skolem">rept</span><span class="main">.</span> <span class="skolem">rep</span> <span class="bound">no</span> <span class="main">=</span> <span class="bound">no</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> p_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> Null"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> rp_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">≠</span> Null"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">lrept</span><span class="main">.</span>
             Dag <span class="main">(</span><span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> id<span class="main">)</span> <span class="main">(</span><span class="skolem">low</span> <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">lrept</span> <span class="main">∧</span>
             <span class="main">(</span><span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set_of <span class="bound">lrept</span><span class="main">.</span> <span class="skolem">rep</span> <span class="bound">no</span> <span class="main">=</span> <span class="bound">no</span><span class="main">)</span> <span class="main">∧</span>
             size <span class="main">(</span>dag <span class="main">(</span><span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> id<span class="main">)</span> <span class="main">(</span><span class="skolem">low</span> <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span><span class="main">)</span>
             <span class="main">&lt;</span> size <span class="main">(</span>dag <span class="main">(</span><span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> id<span class="main">)</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
             <span class="main">(</span><span class="main">∀</span><span class="bound">lowa</span> <span class="bound">higha</span> <span class="bound">pa</span><span class="main">.</span>
                 Dag <span class="bound">pa</span> <span class="bound">lowa</span> <span class="bound">higha</span> <span class="bound">lrept</span> <span class="main">∧</span>
                 <span class="main">(</span><span class="main">∀</span><span class="bound">pt</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∉</span> set_of <span class="bound">lrept</span> <span class="main">⟶</span>
                       <span class="skolem">low</span> <span class="bound">pt</span> <span class="main">=</span> <span class="bound">lowa</span> <span class="bound">pt</span> <span class="main">∧</span> <span class="skolem">high</span> <span class="bound">pt</span> <span class="main">=</span> <span class="bound">higha</span> <span class="bound">pt</span><span class="main">)</span> <span class="main">⟶</span>
                 <span class="main">(</span><span class="main">∃</span><span class="bound">rrept</span><span class="main">.</span>
                     Dag <span class="main">(</span><span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> id<span class="main">)</span> <span class="main">(</span><span class="bound">higha</span> <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="bound">lowa</span><span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="bound">pa</span><span class="main">)</span><span class="main">)</span>
                      <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="bound">higha</span><span class="main">)</span> <span class="bound">rrept</span> <span class="main">∧</span>
                     <span class="main">(</span><span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set_of <span class="bound">rrept</span><span class="main">.</span> <span class="skolem">rep</span> <span class="bound">no</span> <span class="main">=</span> <span class="bound">no</span><span class="main">)</span> <span class="main">∧</span>
                     size <span class="main">(</span>dag <span class="main">(</span><span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> id<span class="main">)</span> <span class="main">(</span><span class="bound">higha</span> <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                            <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="bound">lowa</span><span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="bound">pa</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="bound">higha</span><span class="main">)</span><span class="main">)</span>
                     <span class="main">&lt;</span> size <span class="main">(</span>dag <span class="main">(</span><span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> id<span class="main">)</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                     <span class="main">(</span><span class="main">∀</span><span class="bound">lowb</span> <span class="bound">highb</span> <span class="bound">pb</span><span class="main">.</span>
                         Dag <span class="bound">pb</span> <span class="bound">lowb</span> <span class="bound">highb</span> <span class="bound">rrept</span> <span class="main">∧</span>
                         <span class="main">(</span><span class="main">∀</span><span class="bound">pt</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∉</span> set_of <span class="bound">rrept</span> <span class="main">⟶</span>
                               <span class="main">(</span><span class="bound">lowa</span><span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="bound">pa</span><span class="main">)</span><span class="main">)</span> <span class="bound">pt</span> <span class="main">=</span> <span class="bound">lowb</span> <span class="bound">pt</span> <span class="main">∧</span>
                               <span class="bound">higha</span> <span class="bound">pt</span> <span class="main">=</span> <span class="bound">highb</span> <span class="bound">pt</span><span class="main">)</span> <span class="main">⟶</span>
                         Dag <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span> <span class="bound">lowb</span> <span class="main">(</span><span class="bound">highb</span><span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="bound">pb</span><span class="main">)</span><span class="main">)</span> <span class="skolem">rept</span> <span class="main">∧</span>
                         <span class="main">(</span><span class="main">∀</span><span class="bound">pt</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∉</span> set_of <span class="skolem">rept</span> <span class="main">⟶</span>
                               <span class="skolem">low</span> <span class="bound">pt</span> <span class="main">=</span> <span class="bound">lowb</span> <span class="bound">pt</span> <span class="main">∧</span>
                               <span class="skolem">high</span> <span class="bound">pt</span> <span class="main">=</span> <span class="main">(</span><span class="bound">highb</span><span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="bound">pb</span><span class="main">)</span><span class="main">)</span> <span class="bound">pt</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> rp_nNull rept_dag p_nNull <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lrept</span></span> <span class="skolem"><span class="skolem">rrept</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      rept_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rept</span> <span class="main">=</span> Node <span class="skolem">lrept</span> <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">rrept</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> rept_dag p_nNull <span class="keyword1"><span class="command">have</span></span> lrept_dag<span class="main">:</span> 
      <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">lrept</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> rept_def rept_dag p_nNull <span class="keyword1"><span class="command">have</span></span> rrept_dag<span class="main">:</span> 
      <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">rrept</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> rno_rept rept_def <span class="keyword1"><span class="command">have</span></span> rno_lrept<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">no</span> <span class="main">∈</span> set_of <span class="skolem">lrept</span><span class="main">.</span> <span class="skolem">rep</span> <span class="bound">no</span> <span class="main">=</span> <span class="bound">no</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> rno_rept rept_def <span class="keyword1"><span class="command">have</span></span> rno_rrept<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">no</span> <span class="main">∈</span> set_of <span class="skolem">rrept</span><span class="main">.</span> <span class="skolem">rep</span> <span class="bound">no</span> <span class="main">=</span> <span class="bound">no</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">lrept</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> id_trans lrept_dag<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rno_lrept<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> rept_dag rept_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Dag_dag<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> id_trans Dag_dag<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">premises</span></span> prems <span class="keyword2"><span class="keyword">for</span></span> lowa higha pa
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> lrepta<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="skolem">pa</span> <span class="skolem">lowa</span> <span class="skolem">higha</span> <span class="skolem">lrept</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
        <span class="keyword1"><span class="command">have</span></span> low_lowa_nc<span class="main">:</span> 
          <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">pt</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∉</span> set_of <span class="skolem">lrept</span> <span class="main">⟶</span> <span class="skolem">low</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">lowa</span> <span class="bound">pt</span> <span class="main">∧</span> <span class="skolem">high</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">higha</span> <span class="bound">pt</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
        <span class="keyword1"><span class="command">from</span></span> lrept_dag lrepta  <span class="keyword3"><span class="command">obtain</span></span> 
          pa_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">pa</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          lowa_higha_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span> <span class="main">∈</span> set_of <span class="skolem">lrept</span><span class="main">.</span> 
          <span class="skolem">lowa</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no</span> <span class="main">∧</span> <span class="skolem">higha</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> Dags_eq_hp_eq<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">from</span></span> rept_dag <span class="keyword1"><span class="command">have</span></span> rept_DAG<span class="main">:</span> <span class="quoted"><span class="quoted">"DAG <span class="skolem">rept</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Dag_is_DAG<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> rept_def <span class="keyword1"><span class="command">have</span></span> rp_notin_lrept<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">∉</span> set_of <span class="skolem">lrept</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> rept_DAG rept_def <span class="keyword1"><span class="command">have</span></span> rp_notin_rrept<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">∉</span> set_of <span class="skolem">rrept</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> rrepta<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> id<span class="main">)</span> <span class="main">(</span><span class="skolem">higha</span> <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                         <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">lowa</span><span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">pa</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">higha</span><span class="main">)</span> <span class="skolem">rrept</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">from</span></span> low_lowa_nc rp_notin_lrept 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">higha</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> rrept_dag <span class="keyword1"><span class="command">have</span></span> higha_mixed_rrept<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> id<span class="main">)</span> <span class="main">(</span><span class="skolem">higha</span> <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">rrept</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> id_trans<span class="main">)</span>
          <span class="keyword1"><span class="command">thm</span></span> low_high_exchange_dag
          <span class="keyword1"><span class="command">with</span></span> low_lowa_nc lowa_higha_def rno_rrept 
          <span class="keyword1"><span class="command">have</span></span> lowa_higha_rrept<span class="main">:</span>
              <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> id<span class="main">)</span> <span class="main">(</span><span class="skolem">higha</span> <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">lowa</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">higha</span><span class="main">)</span> <span class="skolem">rrept</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> low_high_exchange_dag<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> id<span class="main">)</span> <span class="main">(</span><span class="skolem">higha</span> <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">lowa</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">higha</span><span class="main">)</span> <span class="skolem">rrept</span> <span class="main">=</span> 
                Dag <span class="main">(</span><span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> id<span class="main">)</span> <span class="main">(</span><span class="skolem">higha</span> <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                        <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">lowa</span><span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">pa</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">higha</span><span class="main">)</span> <span class="skolem">rrept</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span> <span class="main">∈</span> set_of <span class="skolem">rrept</span><span class="main">.</span> 
                      <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">lowa</span><span class="main">)</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">lowa</span><span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">pa</span><span class="main">)</span><span class="main">)</span> <span class="bound">no</span> <span class="main">∧</span>
                      <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">higha</span><span class="main">)</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">higha</span><span class="main">)</span> <span class="bound">no</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> 
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">no</span>
              <span class="keyword3"><span class="command">assume</span></span> no_in_rrept<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">∈</span> set_of <span class="skolem">rrept</span>"</span></span>
              <span class="keyword1"><span class="command">with</span></span> rp_notin_rrept <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">≠</span> <span class="skolem">rep</span> <span class="skolem">p</span>"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">lowa</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">lowa</span><span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">pa</span><span class="main">)</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span> 
                <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">higha</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">higha</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> heaps_eq_Dag_eq<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">with</span></span> lowa_higha_rrept <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">rrept</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">rule</span> rrepta<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">rule</span> rno_rrept<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> rept_dag rept_def rrepta
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Dag_dag<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> id_trans Dag_dag<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">premises</span></span> prems <span class="keyword2"><span class="keyword">for</span></span> lowb highb pb
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> rreptb<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="skolem">pb</span> <span class="skolem">lowb</span> <span class="skolem">highb</span> <span class="skolem">rrept</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
            <span class="keyword1"><span class="command">have</span></span> ab_nc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">pt</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∉</span> set_of <span class="skolem">rrept</span> <span class="main">⟶</span> 
                            <span class="main">(</span><span class="skolem">lowa</span><span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">pa</span><span class="main">)</span><span class="main">)</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">lowb</span> <span class="bound">pt</span> <span class="main">∧</span> <span class="skolem">higha</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">highb</span> <span class="bound">pt</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
            <span class="keyword1"><span class="command">from</span></span> rreptb rrept_dag <span class="keyword3"><span class="command">obtain</span></span>
              pb_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">pb</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
              lowb_highb_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span> <span class="main">∈</span> set_of <span class="skolem">rrept</span><span class="main">.</span> 
                                  <span class="skolem">lowb</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no</span> <span class="main">∧</span> <span class="skolem">highb</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> Dags_eq_hp_eq<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">have</span></span> rept_end_dag<span class="main">:</span> <span class="quoted"><span class="quoted">" Dag <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">lowb</span> <span class="main">(</span><span class="skolem">highb</span><span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">pb</span><span class="main">)</span><span class="main">)</span> <span class="skolem">rept</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span> <span class="main">∈</span> set_of <span class="skolem">rept</span><span class="main">.</span> 
                    <span class="skolem">lowb</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">highb</span><span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">pb</span><span class="main">)</span><span class="main">)</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span>
                <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">no</span>
                <span class="keyword3"><span class="command">assume</span></span> no_in_rept<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">no</span> <span class="main">∈</span> set_of <span class="skolem">rept</span>"</span></span>
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lowb</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span> 
                      <span class="main">(</span><span class="skolem">highb</span><span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">pb</span><span class="main">)</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">∈</span> set_of <span class="skolem">rrept</span>"</span></span><span class="main">)</span>
                  <span class="keyword3"><span class="command">case</span></span> True
                  <span class="keyword1"><span class="command">with</span></span> lowb_highb_def pb_def <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">next</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> no_notin_rrept<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">no</span> <span class="main">∉</span> set_of <span class="skolem">rrept</span>"</span></span>
                  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">∈</span> set_of <span class="skolem">lrept</span>"</span></span><span class="main">)</span>
                    <span class="keyword3"><span class="command">case</span></span> True
                    <span class="keyword1"><span class="command">with</span></span> no_notin_rrept rp_notin_lrept ab_nc
                    <span class="keyword1"><span class="command">have</span></span> ab_nc_no<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lowa</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">lowb</span> <span class="skolem">no</span> <span class="main">∧</span> <span class="skolem">higha</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">highb</span> <span class="skolem">no</span>"</span></span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">no</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">≠</span> <span class="skolem">rep</span> <span class="skolem">p</span>"</span></span><span class="main">)</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                    <span class="keyword1"><span class="command">from</span></span> lowa_higha_def True <span class="keyword1"><span class="command">have</span></span> 
                      <span class="quoted"><span class="quoted">"<span class="skolem">lowa</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span> <span class="skolem">higha</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">with</span></span> ab_nc_no 
                    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lowb</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span> <span class="skolem">highb</span> <span class="skolem">no</span> <span class="main">=</span><span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span>"</span></span> 
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">with</span></span> rp_notin_lrept True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">≠</span> <span class="skolem">rep</span> <span class="skolem">p</span>"</span></span><span class="main">)</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                  <span class="keyword1"><span class="command">next</span></span>
                    <span class="keyword3"><span class="command">assume</span></span> no_notin_lrept<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">no</span> <span class="main">∉</span> set_of <span class="skolem">lrept</span>"</span></span>
                    <span class="keyword1"><span class="command">with</span></span> no_in_rept rept_def no_notin_rrept <span class="keyword1"><span class="command">have</span></span> no_rp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">=</span> <span class="skolem">rep</span> <span class="skolem">p</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">with</span></span> rp_notin_lrept low_lowa_nc 
                    <span class="keyword1"><span class="command">have</span></span> a_nc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">lowa</span> <span class="skolem">no</span> <span class="main">∧</span> <span class="skolem">high</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">higha</span> <span class="skolem">no</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">from</span></span> rp_notin_rrept no_rp ab_nc 
                    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">lowa</span><span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">pa</span><span class="main">)</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">lowb</span> <span class="skolem">no</span> <span class="main">∧</span> <span class="skolem">higha</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">highb</span> <span class="skolem">no</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">with</span></span> a_nc pa_def no_rp 
                    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">lowb</span> <span class="skolem">no</span> <span class="main">∧</span> <span class="skolem">high</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">highb</span> <span class="skolem">no</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">with</span></span> pb_def no_rp <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">with</span></span> rept_dag 
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">lowb</span> <span class="main">(</span><span class="skolem">highb</span><span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">pb</span><span class="main">)</span><span class="main">)</span> <span class="skolem">rept</span> <span class="main">=</span> 
                    Dag <span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">rep</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">rept</span>"</span></span>      
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> heaps_eq_Dag_eq<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">with</span></span> rept_dag p_nNull <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">pt</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∉</span> set_of <span class="skolem">rept</span> <span class="main">⟶</span> <span class="skolem">low</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">lowb</span> <span class="bound">pt</span> <span class="main">∧</span> 
                        <span class="skolem">high</span> <span class="bound">pt</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">highb</span><span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">pb</span><span class="main">)</span><span class="main">)</span> <span class="bound">pt</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">pt</span>
              <span class="keyword3"><span class="command">assume</span></span> pt_notin_rept<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">pt</span> <span class="main">∉</span> set_of <span class="skolem">rept</span>"</span></span>
              <span class="keyword1"><span class="command">with</span></span> rept_def <span class="keyword3"><span class="command">obtain</span></span>
                pt_notin_lrept<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">pt</span> <span class="main">∉</span> set_of <span class="skolem">lrept</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
                pt_notin_rrept<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">pt</span> <span class="main">∉</span> set_of <span class="skolem">rrept</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
                pt_neq_rp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">pt</span> <span class="main">≠</span> <span class="skolem">rep</span> <span class="skolem">p</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">with</span></span> low_lowa_nc ab_nc 
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">pt</span> <span class="main">=</span> <span class="skolem">lowb</span> <span class="skolem">pt</span> <span class="main">∧</span> <span class="skolem">high</span> <span class="skolem">pt</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">highb</span><span class="main">(</span><span class="skolem">rep</span> <span class="skolem">p</span> <span class="main">:=</span> <span class="skolem">pb</span><span class="main">)</span><span class="main">)</span> <span class="skolem">pt</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">with</span></span> rept_end_dag <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
     
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="NormalizeTotalProof">
<div class="head">
<h1>Theory NormalizeTotalProof</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       BDD
    Author:      Veronika Ortner and Norbert Schirmer, 2004
    Maintainer:  Norbert Schirmer,  norbert.schirmer at web de
    License:     LGPL
*)</span>

<span class="comment1">(*  
NormalizeTotalProof.thy

Copyright (C) 2004-2008 Veronika Ortner and Norbert Schirmer 
Some rights reserved, TU Muenchen

This library is free software; you can redistribute it and/or modify
it under the terms of the GNU Lesser General Public License as
published by the Free Software Foundation; either version 2.1 of the
License, or (at your option) any later version.

This library is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
Lesser General Public License for more details.

You should have received a copy of the GNU Lesser General Public
License along with this library; if not, write to the Free Software
Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307
USA
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Proof of Procedure Normalize›</span></span>
<span class="keyword1"><span class="command">theory</span></span> NormalizeTotalProof <span class="keyword2"><span class="keyword">imports</span></span> <a href="LevellistProof.html">LevellistProof</a> <a href="ShareReduceRepListProof.html">ShareReduceRepListProof</a> 
                        <a href="RepointProof.html">RepointProof</a> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> DistinctTreeProver.set_of tree.Node tree.Tip

<span class="keyword1"><span class="command">lemma</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Normalize_impl<span class="main">)</span> Normalize_modifies<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">σ</span><span class="main">.</span> <span class="free">Γ</span><span class="main">⊢</span><span class="main">{</span><span class="bound">σ</span><span class="main">}</span> <span class="main">´</span>p <span class="main">:==</span> <span class="keyword1">PROC</span> Normalize <span class="main">(</span><span class="main">´</span>p<span class="main">)</span> 
     <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="keyword1">may_only_modify_globals</span> <span class="bound">σ</span> <span class="keyword1">in</span> <span class="main">[</span>rep<span class="main">,</span>mark<span class="main">,</span>low<span class="main">,</span>high<span class="main">,</span>next<span class="main">]</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">hoare_rule</span> HoarePartial.ProcRec1<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">vcg</span> spec<span class="main"><span class="main">=</span></span>modifies<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Normalize_impl<span class="main">)</span> Normalize_spec<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">σ</span> <span class="bound">pret</span> <span class="bound">prebdt</span><span class="main">.</span> <span class="free">Γ</span><span class="keyword1">⊢<span class="hidden">⇩</span><sub>t</sub></span>
  <span class="main">⦃</span><span class="bound">σ</span><span class="main">.</span> Dag <span class="main">´</span>p <span class="main">´</span>low <span class="main">´</span>high <span class="bound">pret</span> <span class="main">∧</span> ordered <span class="bound">pret</span> <span class="main">´</span>var <span class="main">∧</span> 
   <span class="main">´</span>p <span class="main">≠</span> Null <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">∈</span> set_of <span class="bound">pret</span> <span class="main">⟶</span> <span class="main">´</span>mark <span class="bound">n</span> <span class="main">=</span> <span class="main">´</span>mark <span class="main">´</span>p<span class="main">)</span> <span class="main">∧</span> 
   bdt <span class="bound">pret</span> <span class="main">´</span>var <span class="main">=</span> Some <span class="bound">prebdt</span><span class="main">⦄</span>  
  <span class="main">´</span>p <span class="main">:==</span> <span class="keyword1">PROC</span> Normalize<span class="main">(</span><span class="main">´</span>p<span class="main">)</span>
  <span class="main">⦃</span><span class="main">(</span><span class="main">∀</span><span class="bound">pt</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∉</span> set_of <span class="bound">pret</span> 
    <span class="main">⟶</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>rep <span class="bound">pt</span> <span class="main">=</span> <span class="main">´</span>rep <span class="bound">pt</span> <span class="main">∧</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>low <span class="bound">pt</span> <span class="main">=</span> <span class="main">´</span>low <span class="bound">pt</span> <span class="main">∧</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>high <span class="bound">pt</span> <span class="main">=</span> <span class="main">´</span>high <span class="bound">pt</span> <span class="main">∧</span> 
        <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>mark <span class="bound">pt</span> <span class="main">=</span> <span class="main">´</span>mark <span class="bound">pt</span> <span class="main">∧</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>next <span class="bound">pt</span> <span class="main">=</span> <span class="main">´</span>next <span class="bound">pt</span><span class="main">)</span> <span class="main">∧</span> 
  <span class="main">(</span><span class="main">∃</span><span class="bound">postt</span><span class="main">.</span> Dag <span class="main">´</span>p <span class="main">´</span>low <span class="main">´</span>high <span class="bound">postt</span> <span class="main">∧</span> reduced <span class="bound">postt</span> <span class="main">∧</span> 
  shared <span class="bound">postt</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>var <span class="main">∧</span> ordered <span class="bound">postt</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>var <span class="main">∧</span>
  set_of <span class="bound">postt</span> <span class="main">⊆</span> set_of <span class="bound">pret</span> <span class="main">∧</span> 
  <span class="main">(</span><span class="main">∃</span><span class="bound">postbdt</span><span class="main">.</span>  bdt <span class="bound">postt</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>var <span class="main">=</span> Some <span class="bound">postbdt</span> <span class="main">∧</span> <span class="bound">prebdt</span> <span class="main">∼</span> <span class="bound">postbdt</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
  <span class="main">(</span><span class="main">∀</span> <span class="bound">no</span><span class="main">.</span> <span class="bound">no</span> <span class="main">∈</span> set_of <span class="bound">pret</span> <span class="main">⟶</span> <span class="main">´</span>mark <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>mark <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>p<span class="main">)</span><span class="main">)</span> <span class="main">⦄</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">hoare_rule</span> HoareTotal.ProcNoRec1<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">hoare_rule</span> anno<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"
    <span class="main">´</span>levellist <span class="main">:==</span>replicate <span class="main">(</span><span class="main">´</span>p<span class="main">→</span><span class="main">´</span>var <span class="main">+</span> <span class="main">1</span><span class="main">)</span> Null<span class="main">;;</span>
    <span class="main">´</span>levellist <span class="main">:==</span> <span class="keyword1">CALL</span> Levellist <span class="main">(</span><span class="main">´</span>p<span class="main">,</span> <span class="main">(</span><span class="main">¬</span> <span class="main">´</span>p<span class="main">→</span><span class="main">´</span>mark<span class="main">)</span> <span class="main">,</span> <span class="main">´</span>levellist<span class="main">)</span><span class="main">;;</span>
    <span class="main">(</span><span class="keyword1">ANNO</span> <span class="main">(</span><span class="bound"><span class="bound"><span class="bound"><span class="bound">τ</span></span></span></span><span class="main">,</span><span class="bound"><span class="bound"><span class="bound"><span class="bound">ll</span></span></span></span><span class="main">)</span><span class="main">.</span> <span class="main">⦃</span><span class="bound">τ</span><span class="main">.</span> Levellist <span class="main">´</span>levellist <span class="main">´</span>next <span class="bound">ll</span> <span class="main">∧</span>
                   Dag <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>p <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>low <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>high <span class="improper">pret</span> <span class="main">∧</span> ordered <span class="improper">pret</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>var <span class="main">∧</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>p <span class="main">≠</span> Null <span class="main">∧</span> 
                 <span class="main">(</span>bdt <span class="improper">pret</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>var  <span class="main">=</span> Some <span class="improper">prebdt</span><span class="main">)</span> <span class="main">∧</span> 
                 wf_ll <span class="improper">pret</span> <span class="bound">ll</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>var <span class="main">∧</span> 
                 length <span class="main">´</span>levellist <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>p <span class="main">→</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>var<span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span> 
                 wf_marking <span class="improper">pret</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>mark <span class="main">´</span>mark <span class="main">(</span><span class="main">¬</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>mark <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>p<span class="main">)</span> <span class="main">∧</span> 
                 <span class="main">(</span><span class="main">∀</span><span class="bound">pt</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∉</span> set_of <span class="improper">pret</span> <span class="main">⟶</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>next <span class="bound">pt</span> <span class="main">=</span> <span class="main">´</span>next <span class="bound">pt</span><span class="main">)</span> <span class="main">∧</span>
                 <span class="main">´</span>low <span class="main">=</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>low <span class="main">∧</span> <span class="main">´</span>high <span class="main">=</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>high  <span class="main">∧</span>  <span class="main">´</span>p <span class="main">=</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>p <span class="main">∧</span> <span class="main">´</span>rep <span class="main">=</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>rep <span class="main">∧</span> 
                 <span class="main">´</span>var <span class="main">=</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>var<span class="main">⦄</span> 
    <span class="main">´</span>n <span class="main">:==</span><span class="main">0</span><span class="main">;;</span>
    <span class="keyword1">WHILE</span> <span class="main">(</span><span class="main">´</span>n <span class="main">&lt;</span> length <span class="main">´</span>levellist<span class="main">)</span> 
    <span class="keyword1">INV</span> <span class="main">⦃</span>Levellist <span class="main">´</span>levellist <span class="main">´</span>next <span class="bound">ll</span> <span class="main">∧</span>
         Dag <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>p <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>low <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>high <span class="improper">pret</span> <span class="main">∧</span> ordered <span class="improper">pret</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>var <span class="main">∧</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>p <span class="main">≠</span> Null <span class="main">∧</span> 
         <span class="main">(</span>bdt <span class="improper">pret</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>var  <span class="main">=</span> Some <span class="improper">prebdt</span><span class="main">)</span> <span class="main">∧</span> wf_ll <span class="improper">pret</span> <span class="bound">ll</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>var  <span class="main">∧</span> 
         length <span class="hidden">⇗</span><sup>τ</sup><span class="hidden">⇖</span>levellist <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>p <span class="main">→</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>var<span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span> 
         wf_marking <span class="improper">pret</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>mark <span class="hidden">⇗</span><sup>τ</sup><span class="hidden">⇖</span>mark <span class="main">(</span><span class="main">¬</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>mark <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>p<span class="main">)</span> <span class="main">∧</span>
         <span class="hidden">⇗</span><sup>τ</sup><span class="hidden">⇖</span>low <span class="main">=</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>low <span class="main">∧</span> <span class="hidden">⇗</span><sup>τ</sup><span class="hidden">⇖</span>high <span class="main">=</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>high  <span class="main">∧</span>  <span class="hidden">⇗</span><sup>τ</sup><span class="hidden">⇖</span>p <span class="main">=</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>p <span class="main">∧</span> <span class="hidden">⇗</span><sup>τ</sup><span class="hidden">⇖</span>rep <span class="main">=</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>rep  <span class="main">∧</span> <span class="hidden">⇗</span><sup>τ</sup><span class="hidden">⇖</span>var <span class="main">=</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>var <span class="main">∧</span>
         <span class="main">´</span>n <span class="main">≤</span> length  <span class="hidden">⇗</span><sup>τ</sup><span class="hidden">⇖</span>levellist <span class="main">∧</span>
         <span class="main">(</span><span class="main">∀</span><span class="bound">pt</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="bound">pt</span> <span class="main">∉</span> set_of <span class="improper">pret</span> <span class="main">∨</span> <span class="main">(</span><span class="main">´</span>n <span class="main">&lt;=</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">pt</span> <span class="main">∈</span> set <span class="main">(</span><span class="bound">ll</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∧</span>
                  <span class="bound">i</span> <span class="main">&lt;</span>length <span class="hidden">⇗</span><sup>τ</sup><span class="hidden">⇖</span>levellist <span class="main">)</span> 
                  <span class="main">⟶</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>rep <span class="bound">pt</span> <span class="main">=</span> <span class="main">´</span>rep <span class="bound">pt</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
         <span class="main">´</span>rep <span class="main">`</span> Nodes <span class="main">´</span>n <span class="bound">ll</span> <span class="main">⊆</span> Nodes <span class="main">´</span>n <span class="bound">ll</span> <span class="main">∧</span> 
         <span class="main">(</span><span class="main">∀</span><span class="bound">no</span> <span class="main">∈</span> Nodes <span class="main">´</span>n <span class="bound">ll</span><span class="main">.</span>
            <span class="bound">no</span><span class="main">→</span><span class="main">´</span>rep<span class="main">→</span><span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>var <span class="main">&lt;=</span> <span class="bound">no</span><span class="main">→</span><span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>var <span class="main">∧</span> 
            <span class="main">(</span><span class="main">∃</span><span class="bound">not</span> <span class="bound">nort</span><span class="main">.</span> Dag <span class="main">(</span><span class="main">´</span>rep <span class="bound">no</span><span class="main">)</span> <span class="main">(</span><span class="main">´</span>rep <span class="main">∝</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>low <span class="main">)</span> <span class="main">(</span><span class="main">´</span>rep <span class="main">∝</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>high <span class="main">)</span> <span class="bound">nort</span> <span class="main">∧</span>
               Dag <span class="bound">no</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>low <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>high <span class="bound">not</span> <span class="main">∧</span> reduced <span class="bound">nort</span> <span class="main">∧</span> 
               ordered <span class="bound">nort</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>var <span class="main">∧</span> set_of <span class="bound">nort</span> <span class="main">⊆</span> <span class="main">´</span>rep <span class="main">`</span> Nodes <span class="main">´</span>n <span class="bound">ll</span> <span class="main">∧</span> 
               <span class="main">(</span><span class="main">∀</span> <span class="bound">no</span> <span class="main">∈</span> set_of <span class="bound">nort</span><span class="main">.</span> <span class="main">´</span>rep <span class="bound">no</span> <span class="main">=</span> <span class="bound">no</span><span class="main">)</span> <span class="main">∧</span> 
               <span class="main">(</span><span class="main">∃</span><span class="bound">nobdt</span> <span class="bound">norbdt</span><span class="main">.</span> bdt <span class="bound">not</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>var <span class="main">=</span> Some <span class="bound">nobdt</span> <span class="main">∧</span> 
                  bdt <span class="bound">nort</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>var <span class="main">=</span> Some <span class="bound">norbdt</span> <span class="main">∧</span> <span class="bound">nobdt</span> <span class="main">∼</span> <span class="bound">norbdt</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
         <span class="main">(</span><span class="main">∀</span><span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> 
             <span class="bound">t1</span><span class="main">∈</span>Dags <span class="main">(</span><span class="main">´</span>rep <span class="main">`</span><span class="main">(</span>Nodes <span class="main">´</span>n <span class="bound">ll</span><span class="main">)</span><span class="main">)</span><span class="main">(</span><span class="main">´</span>rep <span class="main">∝</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>low <span class="main">)</span><span class="main">(</span><span class="main">´</span>rep <span class="main">∝</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>high<span class="main">)</span><span class="main">∧</span>
             <span class="bound">t2</span><span class="main">∈</span>Dags <span class="main">(</span><span class="main">´</span>rep <span class="main">`</span><span class="main">(</span>Nodes <span class="main">´</span>n <span class="bound">ll</span><span class="main">)</span><span class="main">)</span><span class="main">(</span><span class="main">´</span>rep <span class="main">∝</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>low <span class="main">)</span><span class="main">(</span><span class="main">´</span>rep <span class="main">∝</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>high<span class="main">)</span>
             <span class="main">⟶</span> 
             isomorphic_dags_eq <span class="bound">t1</span> <span class="bound">t2</span>  <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>var<span class="main">)</span> <span class="main">∧</span>
         <span class="main">´</span>levellist <span class="main">=</span> <span class="hidden">⇗</span><sup>τ</sup><span class="hidden">⇖</span>levellist <span class="main">∧</span> <span class="main">´</span>next <span class="main">=</span> <span class="hidden">⇗</span><sup>τ</sup><span class="hidden">⇖</span>next <span class="main">∧</span> <span class="main">´</span>mark <span class="main">=</span> <span class="hidden">⇗</span><sup>τ</sup><span class="hidden">⇖</span>mark <span class="main">∧</span> <span class="main">´</span>low <span class="main">=</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>low <span class="main">∧</span> 
         <span class="main">´</span>high <span class="main">=</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>high  <span class="main">∧</span> <span class="main">´</span>p <span class="main">=</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>p <span class="main">∧</span>  <span class="main">´</span>var <span class="main">=</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>var <span class="main">⦄</span>
    <span class="keyword1">VAR</span> <span class="keyword1">MEASURE</span> <span class="main">(</span>length <span class="main">´</span>levellist <span class="main">-</span> <span class="main">´</span>n<span class="main">)</span>
    <span class="keyword1">DO</span>
    <span class="keyword1">CALL</span> ShareReduceRepList<span class="main">(</span><span class="main">´</span>levellist <span class="main">!</span> <span class="main">´</span>n<span class="main">)</span><span class="main">;;</span>
    <span class="main">´</span>n <span class="main">:==</span><span class="main">´</span>n <span class="main">+</span> <span class="main">1</span>
    <span class="keyword1">OD</span>
    <span class="main">⦃</span><span class="main">(</span><span class="main">∃</span><span class="bound">postnormt</span><span class="main">.</span> Dag <span class="main">(</span><span class="main">´</span>rep <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>p<span class="main">)</span> <span class="main">(</span><span class="main">´</span>rep <span class="main">∝</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>low <span class="main">)</span> <span class="main">(</span><span class="main">´</span>rep <span class="main">∝</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>high <span class="main">)</span> <span class="bound">postnormt</span> <span class="main">∧</span> 
      reduced <span class="bound">postnormt</span> <span class="main">∧</span> shared <span class="bound">postnormt</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>var <span class="main">∧</span> 
      ordered <span class="bound">postnormt</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>var <span class="main">∧</span> set_of <span class="bound">postnormt</span> <span class="main">⊆</span> set_of <span class="improper">pret</span> <span class="main">∧</span> 
      <span class="main">(</span><span class="main">∃</span><span class="bound">postnormbdt</span><span class="main">.</span> bdt <span class="bound">postnormt</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>var <span class="main">=</span> Some <span class="bound">postnormbdt</span> <span class="main">∧</span> <span class="improper">prebdt</span> <span class="main">∼</span> <span class="bound">postnormbdt</span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">(</span><span class="main">∀</span> <span class="bound">no</span> <span class="main">∈</span> set_of <span class="bound">postnormt</span><span class="main">.</span> <span class="main">(</span><span class="main">´</span>rep <span class="bound">no</span> <span class="main">=</span> <span class="bound">no</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
      ordered <span class="improper">pret</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>var  <span class="main">∧</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>p <span class="main">≠</span> Null <span class="main">∧</span> 
      <span class="main">(</span><span class="main">∀</span> <span class="bound">pt</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∉</span> set_of <span class="improper">pret</span> <span class="main">⟶</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>rep <span class="bound">pt</span> <span class="main">=</span> <span class="main">´</span>rep <span class="bound">pt</span><span class="main">)</span> <span class="main">∧</span> 
      <span class="main">´</span>levellist <span class="main">=</span> <span class="hidden">⇗</span><sup>τ</sup><span class="hidden">⇖</span>levellist <span class="main">∧</span> <span class="main">´</span>next <span class="main">=</span> <span class="hidden">⇗</span><sup>τ</sup><span class="hidden">⇖</span>next <span class="main">∧</span> <span class="main">´</span>mark <span class="main">=</span> <span class="hidden">⇗</span><sup>τ</sup><span class="hidden">⇖</span>mark <span class="main">∧</span> <span class="main">´</span>low <span class="main">=</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>low <span class="main">∧</span> <span class="main">´</span>high <span class="main">=</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>high <span class="main">∧</span>
      <span class="main">´</span>p <span class="main">=</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>p <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">no</span><span class="main">.</span> <span class="bound">no</span> <span class="main">∈</span> set_of <span class="improper">pret</span> <span class="main">⟶</span> <span class="main">´</span>mark <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>mark <span class="hidden">⇗</span><sup>σ</sup><span class="hidden">⇖</span>p<span class="main">)</span><span class="main">)</span> <span class="main">⦄</span><span class="main">)</span>
    <span class="main">;;</span>
    <span class="main">´</span>p <span class="main">:==</span> <span class="keyword1">CALL</span> Repoint <span class="main">(</span><span class="main">´</span>p<span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> HoareTotal.annotateI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">vcg</span> spec<span class="main"><span class="main">=</span></span>spec_total<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
    <span class="comment1">(*from precondition of inner spec to invariant *)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nodes_def null_comp_def<span class="main">)</span>
    <span class="comment1">(*from inner spec to postcondition *)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">pret</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="operator">clarify</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">i</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>     <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="operator">clarify</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_use</span><span class="main"><span class="main">)</span></span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> simp_thms<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">ll</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="operator">assumption</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="operator">clarify</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> simp_thms triv_forall_equality True_implies_equals<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">postnormt</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>    <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="operator">clarify</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_simp</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
    <span class="comment1">(*while-while-Fall: while nb und Schleifenbdg gelten ⟶ while (nb+1)*)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="operator">clarify</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> simp_thms triv_forall_equality True_implies_equals<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">ll</span><span class="main">!</span><span class="improper">n</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Levellist_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 3
    <span class="comment1">(*while-end-Fall: INV nb gilt und Schleifenbdg falsch ⟶ Nachbdg while*)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>   <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_use</span><span class="main"><span class="main">)</span></span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> simp_thms triv_forall_equality True_implies_equals<span class="main">)</span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="comment1">― ‹End of while (invariant + false condition) to end of inner SPEC›</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">var</span> <span class="skolem">p</span> <span class="skolem">rep</span> <span class="skolem">mark</span> <span class="skolem">vara</span> <span class="skolem">lowa</span> <span class="skolem">higha</span> <span class="skolem">pa</span> <span class="skolem">levellista</span> <span class="skolem">repa</span> <span class="skolem">marka</span> <span class="skolem">nexta</span> <span class="skolem">varb</span> <span class="skolem">ll</span>  
    <span class="skolem">nb</span> <span class="skolem">pret</span> <span class="skolem">prebdt</span>  <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">low</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ref <span class="main">⇒</span> ref"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
    <span class="skolem">high</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ref <span class="main">⇒</span> ref"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">repb</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ref <span class="main">⇒</span> ref"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> ll<span class="main">:</span> <span class="quoted"><span class="quoted">"Levellist <span class="skolem">levellista</span> <span class="skolem">nexta</span> <span class="skolem">ll</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> wf_lla<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_ll <span class="skolem">pret</span> <span class="skolem">ll</span> <span class="skolem">var</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> length_lla<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">levellista</span> <span class="main">=</span> <span class="skolem">var</span> <span class="skolem">p</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> ord_pret<span class="main">:</span> <span class="quoted"><span class="quoted">"ordered <span class="skolem">pret</span> <span class="skolem">var</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> pnN<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">p</span> <span class="main">≠</span> Null"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> rep_repb_nc<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">pt</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∉</span> set_of <span class="skolem">pret</span> <span class="main">∨</span> <span class="skolem">nb</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">pt</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∧</span> 
    <span class="bound">i</span> <span class="main">&lt;</span> length <span class="skolem">levellista</span> 
    <span class="main">⟶</span> <span class="skolem">rep</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">repb</span> <span class="bound">pt</span>"</span></span>

  <span class="keyword3"><span class="command">assume</span></span> wf_marking_prop<span class="main">:</span> <span class="quoted"><span class="quoted">" wf_marking <span class="skolem">pret</span> <span class="skolem">mark</span> <span class="skolem">marka</span> <span class="main">(</span><span class="main">¬</span> <span class="skolem">mark</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> pret_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="skolem">p</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">pret</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> prebdt<span class="main">:</span> <span class="quoted"><span class="quoted">"bdt <span class="skolem">pret</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="skolem">prebdt</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> not_nbslla<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">nb</span> <span class="main">&lt;</span> length <span class="skolem">levellista</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> nb_le_lla<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">nb</span> <span class="main">≤</span> length <span class="skolem">levellista</span>"</span></span>
  
  <span class="keyword3"><span class="command">assume</span></span> normalize_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>Nodes <span class="skolem">nb</span> <span class="skolem">ll</span><span class="main">.</span>
    <span class="skolem">var</span> <span class="main">(</span><span class="skolem">repb</span> <span class="bound">no</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">var</span> <span class="bound">no</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">not</span> <span class="bound">nort</span><span class="main">.</span> Dag <span class="main">(</span><span class="skolem">repb</span> <span class="bound">no</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">nort</span> <span class="main">∧</span>
    Dag <span class="bound">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="bound">not</span> <span class="main">∧</span> reduced <span class="bound">nort</span> <span class="main">∧</span> ordered <span class="bound">nort</span> <span class="skolem">var</span> <span class="main">∧</span> 
    set_of <span class="bound">nort</span> <span class="main">⊆</span> <span class="skolem">repb</span> <span class="main">`</span> Nodes <span class="skolem">nb</span> <span class="skolem">ll</span> <span class="main">∧</span> 
    <span class="main">(</span><span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set_of <span class="bound">nort</span><span class="main">.</span> <span class="skolem">repb</span> <span class="bound">no</span> <span class="main">=</span> <span class="bound">no</span><span class="main">)</span> <span class="main">∧</span> 
    <span class="main">(</span><span class="main">∃</span><span class="bound">nobdt</span> <span class="bound">norbdt</span><span class="main">.</span> bdt <span class="bound">not</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="bound">nobdt</span> <span class="main">∧</span> 
    bdt <span class="bound">nort</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="bound">norbdt</span> <span class="main">∧</span> <span class="bound">nobdt</span> <span class="main">∼</span> <span class="bound">norbdt</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> repbNodes_in_Nodes<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">repb</span> <span class="main">`</span> Nodes <span class="skolem">nb</span> <span class="skolem">ll</span> <span class="main">⊆</span> Nodes <span class="skolem">nb</span> <span class="skolem">ll</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> shared_mult_dags<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="bound">t1</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="skolem">repb</span> <span class="main">`</span> Nodes <span class="skolem">nb</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">∧</span> 
    <span class="bound">t2</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="skolem">repb</span> <span class="main">`</span> Nodes <span class="skolem">nb</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> 
    <span class="main">⟶</span> isomorphic_dags_eq <span class="bound">t1</span> <span class="bound">t2</span> <span class="skolem">var</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">postnormt</span><span class="main">.</span> Dag <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">postnormt</span> <span class="main">∧</span>
    reduced <span class="bound">postnormt</span> <span class="main">∧</span> shared <span class="bound">postnormt</span> <span class="skolem">var</span> <span class="main">∧</span>
    ordered <span class="bound">postnormt</span> <span class="skolem">var</span> <span class="main">∧</span> set_of <span class="bound">postnormt</span> <span class="main">⊆</span> set_of <span class="skolem">pret</span> <span class="main">∧</span> 
    <span class="main">(</span><span class="main">∃</span><span class="bound">postnormbdt</span><span class="main">.</span> 
    bdt <span class="bound">postnormt</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="bound">postnormbdt</span> <span class="main">∧</span> <span class="skolem">prebdt</span> <span class="main">∼</span> <span class="bound">postnormbdt</span><span class="main">)</span> <span class="main">∧</span> 
    <span class="main">(</span><span class="main">∀</span> <span class="bound">no</span> <span class="main">∈</span> set_of <span class="bound">postnormt</span><span class="main">.</span> <span class="skolem">repb</span> <span class="bound">no</span> <span class="main">=</span> <span class="bound">no</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
    ordered <span class="skolem">pret</span> <span class="skolem">var</span> <span class="main">∧</span> <span class="skolem">p</span> <span class="main">≠</span> Null <span class="main">∧</span> 
    <span class="main">(</span><span class="main">∀</span><span class="bound">pt</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∉</span> set_of <span class="skolem">pret</span> <span class="main">⟶</span> <span class="skolem">rep</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">repb</span> <span class="bound">pt</span><span class="main">)</span> <span class="main">∧</span>  
    <span class="main">(</span><span class="main">∀</span><span class="bound">no</span><span class="main">.</span> <span class="bound">no</span> <span class="main">∈</span> set_of <span class="skolem">pret</span> <span class="main">⟶</span> <span class="skolem">marka</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="skolem">mark</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> ll <span class="keyword1"><span class="command">have</span></span> length_ll_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">levellista</span> <span class="main">=</span> length <span class="skolem">ll</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Levellist_length<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> rep_repb_nc <span class="keyword1"><span class="command">have</span></span> rep_nc_post<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">pt</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∉</span> set_of <span class="skolem">pret</span> <span class="main">⟶</span> <span class="skolem">rep</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">repb</span> <span class="bound">pt</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> pnN pret_dag <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lt</span></span> <span class="skolem"><span class="skolem">rt</span></span> <span class="keyword2"><span class="keyword">where</span></span> pret_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">pret</span> <span class="main">=</span> Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> wf_marking_prop pret_def 
    <span class="keyword1"><span class="command">have</span></span> marking_inverted<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">no</span><span class="main">.</span> <span class="bound">no</span> <span class="main">∈</span> set_of <span class="skolem">pret</span> <span class="main">⟶</span> <span class="skolem">marka</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="skolem">mark</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_marking_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> not_nbslla nb_le_lla <span class="keyword1"><span class="command">have</span></span> nb_length_lla<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">nb</span> <span class="main">=</span> length <span class="skolem">levellista</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> length_lla <span class="keyword1"><span class="command">have</span></span> varp_s_nb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">p</span> <span class="main">&lt;</span> <span class="skolem">nb</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> pret_def <span class="keyword1"><span class="command">have</span></span> p_in_pret<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> set_of <span class="skolem">pret</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> wf_lla <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">var</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ll_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> varp_s_nb <span class="keyword1"><span class="command">have</span></span> p_in_Nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> Nodes <span class="skolem">nb</span> <span class="skolem">ll</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nodes_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> normalize_prop <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">not</span></span> <span class="skolem"><span class="skolem">nort</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      varrepno_varno<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">var</span> <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">var</span> <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      nort_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">nort</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      not_dag<span class="main">:</span> <span class="quoted"><span class="quoted">" Dag <span class="skolem">p</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">not</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      red_nort<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced <span class="skolem">nort</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      ord_nort<span class="main">:</span> <span class="quoted"><span class="quoted">"ordered <span class="skolem">nort</span> <span class="skolem">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      nort_in_repNodes<span class="main">:</span> <span class="quoted"><span class="quoted">" set_of <span class="skolem">nort</span> <span class="main">⊆</span> <span class="skolem">repb</span> <span class="main">`</span> Nodes <span class="skolem">nb</span> <span class="skolem">ll</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      nort_repb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set_of <span class="skolem">nort</span><span class="main">.</span> <span class="skolem">repb</span> <span class="bound">no</span> <span class="main">=</span> <span class="bound">no</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      bdt_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">nobdt</span> <span class="bound">norbdt</span><span class="main">.</span> bdt <span class="skolem">not</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="bound">nobdt</span> <span class="main">∧</span> bdt <span class="skolem">nort</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="bound">norbdt</span> <span class="main">∧</span>
      <span class="bound">nobdt</span> <span class="main">∼</span> <span class="bound">norbdt</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
    <span class="keyword1"><span class="command">from</span></span> wf_lla nb_length_lla <span class="keyword1"><span class="command">have</span></span> Nodes_in_pret<span class="main">:</span> <span class="quoted"><span class="quoted">"Nodes <span class="skolem">nb</span> <span class="skolem">ll</span> <span class="main">⊆</span> set_of <span class="skolem">pret</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Nodes_in_pret<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_ll_eq<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">from</span></span> pret_dag wf_lla nb_length_lla <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Null <span class="main">∉</span> Nodes <span class="skolem">nb</span> <span class="skolem">ll</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Null_notin_Nodes<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_ll_eq<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">with</span></span> p_in_Nodes repbNodes_in_Nodes <span class="keyword1"><span class="command">have</span></span> rp_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">p</span> <span class="main">≠</span> Null"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> nort_dag <span class="keyword1"><span class="command">have</span></span> nort_nTip<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">nort</span><span class="main">≠</span> Tip"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">postnormt</span><span class="main">.</span> Dag <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">postnormt</span> <span class="main">∧</span>
      reduced <span class="bound">postnormt</span> <span class="main">∧</span> shared <span class="bound">postnormt</span> <span class="skolem">var</span> <span class="main">∧</span>
      ordered <span class="bound">postnormt</span> <span class="skolem">var</span> <span class="main">∧</span> set_of <span class="bound">postnormt</span> <span class="main">⊆</span> set_of <span class="skolem">pret</span> <span class="main">∧</span> 
      <span class="main">(</span><span class="main">∃</span><span class="bound">postnormbdt</span><span class="main">.</span>  
      bdt <span class="bound">postnormt</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="bound">postnormbdt</span> <span class="main">∧</span> <span class="skolem">prebdt</span> <span class="main">∼</span> <span class="bound">postnormbdt</span><span class="main">)</span> <span class="main">∧</span> 
      <span class="main">(</span><span class="main">∀</span><span class="bound">no</span> <span class="main">∈</span> set_of <span class="bound">postnormt</span><span class="main">.</span> <span class="skolem">repb</span> <span class="bound">no</span> <span class="main">=</span> <span class="bound">no</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">nort</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> nort_in_repNodes repbNodes_in_Nodes Nodes_in_pret 
      <span class="keyword1"><span class="command">have</span></span> nort_in_pret<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">nort</span> <span class="main">⊆</span> set_of <span class="skolem">pret</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> not_dag pret_dag <span class="keyword1"><span class="command">have</span></span> not_pret<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">not</span> <span class="main">=</span> <span class="skolem">pret</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Dag_unique<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> bdt_prop prebdt <span class="keyword1"><span class="command">have</span></span> pret_bdt_prop<span class="main">:</span> 
        <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">postnormbdt</span><span class="main">.</span>
        bdt <span class="skolem">nort</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="bound">postnormbdt</span> <span class="main">∧</span> <span class="skolem">prebdt</span> <span class="main">∼</span> <span class="bound">postnormbdt</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> shared_mult_dags <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"shared <span class="skolem">nort</span> <span class="skolem">var</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shared_def isomorphic_dags_eq_def<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">st1</span> <span class="skolem">st2</span> <span class="skolem">bdt1</span>
        <span class="keyword3"><span class="command">assume</span></span> shared_imp<span class="main">:</span> 
          <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="bound">t1</span><span class="main">∈</span>Dags <span class="main">(</span><span class="skolem">repb</span> <span class="main">`</span> Nodes <span class="skolem">nb</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">∧</span> 
          <span class="bound">t2</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="skolem">repb</span> <span class="main">`</span> Nodes <span class="skolem">nb</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span>
          <span class="main">⟶</span>
          <span class="main">(</span><span class="main">∃</span><span class="bound">bdt1</span><span class="main">.</span> bdt <span class="bound">t1</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="bound">bdt1</span> <span class="main">∧</span> bdt <span class="bound">t2</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="bound">bdt1</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">t1</span> <span class="main">=</span> <span class="bound">t2</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> st1_nort<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">st1</span> <span class="main">≤</span> <span class="skolem">nort</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> st2_nort<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">st2</span> <span class="main">≤</span> <span class="skolem">nort</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> bdt_st1<span class="main">:</span> <span class="quoted"><span class="quoted">"bdt <span class="skolem">st1</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="skolem">bdt1</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> bdt_st2<span class="main">:</span> <span class="quoted"><span class="quoted">" bdt <span class="skolem">st2</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="skolem">bdt1</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> nort_in_repNodes nort_dag nort_nTip 
        <span class="keyword1"><span class="command">have</span></span> nort_in_DagsrNodes<span class="main">:</span> 
          <span class="quoted"><span class="quoted">"<span class="skolem">nort</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="skolem">repb</span> <span class="main">`</span><span class="main">(</span>Nodes <span class="skolem">nb</span> <span class="skolem">ll</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> DagsI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">st1</span> <span class="main">=</span> <span class="skolem">st2</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">st1</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> Tip
          <span class="keyword1"><span class="command">note</span></span> st1_Tip<span class="main">=</span>this
          <span class="keyword1"><span class="command">with</span></span> bdt_st1 bdt_st2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">lst1</span> <span class="skolem">st1p</span> <span class="skolem">rst1</span><span class="main">)</span>
          <span class="keyword1"><span class="command">note</span></span> st1_Node<span class="main">=</span>this
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> st1_nTip<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">st1</span> <span class="main">≠</span> Tip"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">st2</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> Tip
            <span class="keyword1"><span class="command">with</span></span> bdt_st1 bdt_st2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">lst2</span> <span class="skolem">st2p</span> <span class="skolem">rst2</span><span class="main">)</span>
            <span class="keyword1"><span class="command">note</span></span> st2_Node<span class="main">=</span>this
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> st2_nTip<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">st2</span> <span class="main">≠</span> Tip"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
            <span class="keyword1"><span class="command">from</span></span> nort_in_DagsrNodes st1_nort ord_nort wf_lla st1_nTip 
            <span class="keyword1"><span class="command">have</span></span> st1_in_Dags<span class="main">:</span> 
              <span class="quoted"><span class="quoted">"<span class="skolem">st1</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="skolem">repb</span> <span class="main">`</span> Nodes <span class="skolem">nb</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Dags_subdags<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">from</span></span> nort_in_DagsrNodes st2_nort ord_nort wf_lla  st2_nTip 
            <span class="keyword1"><span class="command">have</span></span> st2_in_Dags<span class="main">:</span> 
              <span class="quoted"><span class="quoted">"<span class="skolem">st2</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="skolem">repb</span> <span class="main">`</span> Nodes <span class="skolem">nb</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Dags_subdags<span class="main">)</span> 
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">from</span></span> st1_in_Dags st2_in_Dags bdt_st1 bdt_st2 shared_imp <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">st1</span><span class="main">=</span><span class="skolem">st2</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">with</span></span> nort_dag red_nort ord_nort nort_in_pret pret_bdt_prop nort_repb 
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">nort</span> <span class="main">∧</span>
        reduced <span class="skolem">nort</span> <span class="main">∧</span> shared <span class="skolem">nort</span> <span class="skolem">var</span> <span class="main">∧</span> ordered <span class="skolem">nort</span> <span class="skolem">var</span> <span class="main">∧</span> 
        set_of <span class="skolem">nort</span> <span class="main">⊆</span> set_of <span class="skolem">pret</span> <span class="main">∧</span> 
        <span class="main">(</span><span class="main">∃</span><span class="bound">postnormbdt</span><span class="main">.</span> 
        bdt <span class="skolem">nort</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="bound">postnormbdt</span> <span class="main">∧</span> <span class="skolem">prebdt</span> <span class="main">∼</span> <span class="bound">postnormbdt</span><span class="main">)</span> <span class="main">∧</span> 
        <span class="main">(</span><span class="main">∀</span><span class="bound">no</span> <span class="main">∈</span> set_of <span class="skolem">nort</span><span class="main">.</span>  <span class="skolem">repb</span> <span class="bound">no</span> <span class="main">=</span> <span class="bound">no</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> wf_lla length_lla ord_pret pnN rep_nc_post marking_inverted
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="comment1">― ‹From postcondition inner SPEC to final postcondition›</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">var</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">p</span> <span class="skolem">rep</span> <span class="skolem">levellist</span> <span class="skolem">marka</span> <span class="quoted">"<span class="skolem">next</span>"</span> 
    <span class="skolem">nexta</span> <span class="skolem">lowb</span> <span class="skolem">highb</span> <span class="skolem">pb</span> <span class="skolem">levellista</span> <span class="skolem">ll</span> <span class="skolem">repa</span> <span class="skolem">pret</span> <span class="skolem">prebdt</span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">mark</span><span class="main">::</span><span class="quoted"><span class="quoted">"ref<span class="main">⇒</span>bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">postnormt</span> <span class="skolem">postnormbdt</span>
  <span class="keyword3"><span class="command">assume</span></span> ll<span class="main">:</span> <span class="quoted"><span class="quoted">"Levellist <span class="skolem">levellista</span> <span class="skolem">nexta</span> <span class="skolem">ll</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> repoint_spec<span class="main">:</span> 
         <span class="quoted"><span class="quoted">"Dag <span class="skolem">pb</span> <span class="skolem">lowb</span> <span class="skolem">highb</span> <span class="skolem">postnormt</span>"</span></span>
         <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">pt</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∉</span> set_of <span class="skolem">postnormt</span> <span class="main">⟶</span> <span class="skolem">low</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">lowb</span> <span class="bound">pt</span> <span class="main">∧</span> <span class="skolem">high</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">highb</span> <span class="bound">pt</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> pret_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="skolem">p</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">pret</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> ord_pret<span class="main">:</span> <span class="quoted"><span class="quoted">"ordered <span class="skolem">pret</span> <span class="skolem">var</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> pnN<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">p</span> <span class="main">≠</span> Null"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> onemark_pret<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">∈</span> set_of <span class="skolem">pret</span> <span class="main">⟶</span> <span class="skolem">mark</span> <span class="bound">n</span> <span class="main">=</span> <span class="skolem">mark</span> <span class="skolem">p</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="var">?in_pret</span> <span class="bound">n</span> <span class="main">⟶</span> <span class="var">?eq_mark_p</span> <span class="bound">n</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> pret_bdt<span class="main">:</span> <span class="quoted"><span class="quoted">" bdt <span class="skolem">pret</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="skolem">prebdt</span>"</span></span>
  
  <span class="keyword3"><span class="command">assume</span></span>  wf_ll<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_ll <span class="skolem">pret</span> <span class="skolem">ll</span> <span class="skolem">var</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span>
    length_ll<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="skolem">levellist</span> <span class="main">=</span><span class="skolem">var</span> <span class="skolem">p</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    wf_marking_ll<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_marking <span class="skolem">pret</span> <span class="skolem">mark</span> <span class="skolem">marka</span> <span class="main">(</span><span class="main">¬</span> <span class="skolem">mark</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span>  
    postnormt_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repa</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">postnormt</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    reduced_postnormt<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced <span class="skolem">postnormt</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    shared_postnormt<span class="main">:</span> <span class="quoted"><span class="quoted">"shared <span class="skolem">postnormt</span> <span class="skolem">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    ordered_postnormt<span class="main">:</span> <span class="quoted"><span class="quoted">"ordered <span class="skolem">postnormt</span> <span class="skolem">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    subset_pret<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">postnormt</span> <span class="main">⊆</span> set_of <span class="skolem">pret</span>"</span></span><span class="keyword2"><span class="keyword">and</span></span>
    sim_bdt<span class="main">:</span> <span class="quoted"><span class="quoted">"bdt <span class="skolem">postnormt</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="skolem">postnormbdt</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">prebdt</span> <span class="main">∼</span> <span class="skolem">postnormbdt</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span>
    postdag_repa<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span> <span class="main">∈</span> set_of <span class="skolem">postnormt</span><span class="main">.</span> <span class="skolem">repa</span> <span class="bound">no</span> <span class="main">=</span> <span class="bound">no</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    rep_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">pt</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∉</span> set_of <span class="skolem">pret</span> <span class="main">⟶</span> <span class="skolem">rep</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">repa</span> <span class="bound">pt</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span>
    pret_marked<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span><span class="main">.</span> <span class="bound">no</span> <span class="main">∈</span> set_of <span class="skolem">pret</span> <span class="main">⟶</span> <span class="skolem">marka</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="skolem">mark</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> unmodif_next<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∉</span> set_of <span class="skolem">pret</span> <span class="main">⟶</span> <span class="skolem">next</span> <span class="bound">p</span> <span class="main">=</span> <span class="skolem">nexta</span> <span class="bound">p</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">pt</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∉</span> set_of <span class="skolem">pret</span> 
    <span class="main">⟶</span> <span class="skolem">low</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">lowb</span> <span class="bound">pt</span> <span class="main">∧</span> <span class="skolem">high</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">highb</span> <span class="bound">pt</span> <span class="main">∧</span> 
    <span class="skolem">mark</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">marka</span> <span class="bound">pt</span> <span class="main">)</span> "</span></span>

  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> ll <span class="keyword1"><span class="command">have</span></span> length_ll_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">levellista</span> <span class="main">=</span> length <span class="skolem">ll</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Levellist_length<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> repoint_spec  pnN subset_pret
    <span class="keyword1"><span class="command">have</span></span> repoint_nc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">pt</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∉</span> set_of <span class="skolem">pret</span> 
      <span class="main">⟶</span> <span class="skolem">low</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">lowb</span> <span class="bound">pt</span> <span class="main">∧</span> <span class="skolem">high</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">highb</span> <span class="bound">pt</span><span class="main">)</span> <span class="main">∧</span> Dag <span class="skolem">pb</span> <span class="skolem">lowb</span> <span class="skolem">highb</span> <span class="skolem">postnormt</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> lowhigh_b_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">pt</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∉</span> set_of <span class="skolem">pret</span> 
      <span class="main">⟶</span> <span class="skolem">low</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">lowb</span> <span class="bound">pt</span> <span class="main">∧</span> <span class="skolem">high</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">highb</span> <span class="bound">pt</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">from</span></span> wf_marking_ll pret_dag pnN 
    <span class="keyword1"><span class="command">have</span></span> mark_b_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">pt</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∉</span> set_of <span class="skolem">pret</span> <span class="main">⟶</span> <span class="skolem">mark</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">marka</span> <span class="bound">pt</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_marking_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> dag.splits<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> conjE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">pt</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">with</span></span> lowhigh_b_eq rep_eq unmodif_next
    <span class="keyword1"><span class="command">have</span></span> pret_nc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">pt</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∉</span> set_of <span class="skolem">pret</span> 
      <span class="main">⟶</span> <span class="skolem">rep</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">repa</span> <span class="bound">pt</span> <span class="main">∧</span> <span class="skolem">low</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">lowb</span> <span class="bound">pt</span> <span class="main">∧</span> <span class="skolem">high</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">highb</span> <span class="bound">pt</span> <span class="main">∧</span> 
      <span class="skolem">mark</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">marka</span> <span class="bound">pt</span> <span class="main">∧</span> <span class="skolem">next</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">nexta</span> <span class="bound">pt</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="comment1">(*    from repoint_nc have rept_dag: "Dag pb lowb highb postnormt"
      by simp
    with reduced_postnormt shared_postnormt ordered_postnormt subset_pret sim_bdt 
      pret_bdt 
    have post_same_prop: 
      "∃postt. Dag pb lowb highb postt ∧ reduced postt ∧
      shared postt var ∧ ordered postt var ∧ set_of postt ⊆ set_of pret ∧
      (∃postbdt. bdt postt var = Some postbdt ∧ prebdt ∼ postbdt)" 
      apply -
      apply (rule_tac x=postnormt in exI)
      apply fastforce
      done*)</span>
    <span class="keyword1"><span class="command">from</span></span> pret_nc  
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="comment1">― ‹invariant to invariant›</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">var</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">p</span> <span class="skolem">rep</span> <span class="skolem">mark</span> <span class="skolem">pret</span> <span class="skolem">prebdt</span> <span class="skolem">levellist</span> <span class="skolem">ll</span> <span class="quoted">"<span class="skolem">next</span>"</span> <span class="skolem">marka</span> <span class="skolem">n</span> <span class="skolem">repc</span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">repb</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ref <span class="main">⇒</span> ref"</span></span>  
  <span class="keyword3"><span class="command">assume</span></span> ll<span class="main">:</span> <span class="quoted"><span class="quoted">"Levellist <span class="skolem">levellist</span> <span class="skolem">next</span> <span class="skolem">ll</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> pret_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="skolem">p</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">pret</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> ord_pret<span class="main">:</span> <span class="quoted"><span class="quoted">" ordered <span class="skolem">pret</span> <span class="skolem">var</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> pnN<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> Null"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> prebdt_pret<span class="main">:</span> <span class="quoted"><span class="quoted">"bdt <span class="skolem">pret</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="skolem">prebdt</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> wf_ll<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_ll <span class="skolem">pret</span> <span class="skolem">ll</span> <span class="skolem">var</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> lll<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">levellist</span> <span class="main">=</span> <span class="skolem">var</span> <span class="skolem">p</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> n_Suc_var_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">p</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> wf_marking_m_ma<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_marking <span class="skolem">pret</span> <span class="skolem">mark</span> <span class="skolem">marka</span> <span class="main">(</span><span class="main">¬</span> <span class="skolem">mark</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>

<span class="comment1">(*  assume rep_nc: " ∀pt. pt ∉ set_of pret ∨ 
    (∃i. n ≤ i ∧ pt ∈ set (ll ! i) ∧ i &lt; var p + 1) 
    ⟶ rep pt = repb pt" *)</span>
  <span class="keyword3"><span class="command">assume</span></span> rep_nc<span class="main">:</span>      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">pt</span> <span class="bound">i</span><span class="main">.</span>
           <span class="bound">pt</span> <span class="main">∉</span> set_of <span class="skolem">pret</span> <span class="main">∨</span> <span class="skolem">n</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">pt</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">p</span> <span class="main">+</span> <span class="main">1</span> <span class="main">⟶</span>
           <span class="skolem">rep</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">repb</span> <span class="bound">pt</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> repbNodes_in_Nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span> <span class="main">⊆</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span>
    normalize_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">.</span>
    <span class="skolem">var</span> <span class="main">(</span><span class="skolem">repb</span> <span class="bound">no</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">var</span> <span class="bound">no</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">not</span> <span class="bound">nort</span><span class="main">.</span> Dag <span class="main">(</span><span class="skolem">repb</span> <span class="bound">no</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">nort</span> <span class="main">∧</span>
    Dag <span class="bound">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="bound">not</span> <span class="main">∧</span> reduced <span class="bound">nort</span> <span class="main">∧</span> ordered <span class="bound">nort</span> <span class="skolem">var</span> <span class="main">∧</span>
    set_of <span class="bound">nort</span> <span class="main">⊆</span> <span class="skolem">repb</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set_of <span class="bound">nort</span><span class="main">.</span> <span class="skolem">repb</span> <span class="bound">no</span> <span class="main">=</span> <span class="bound">no</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">nobdt</span><span class="main">.</span> bdt <span class="bound">not</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="bound">nobdt</span> <span class="main">∧</span> 
    <span class="main">(</span><span class="main">∃</span><span class="bound">norbdt</span><span class="main">.</span> bdt <span class="bound">nort</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="bound">norbdt</span> <span class="main">∧</span> 
    <span class="bound">nobdt</span> <span class="main">∼</span> <span class="bound">norbdt</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> 
    isomorphic_dags_eq<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="bound">t1</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="skolem">repb</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span><span class="main">∧</span>
    <span class="bound">t2</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="skolem">repb</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> 
    <span class="main">⟶</span> isomorphic_dags_eq <span class="bound">t1</span> <span class="bound">t2</span> <span class="skolem">var</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span><span class="main">.</span>
              <span class="bound">no</span> <span class="main">≠</span> Null <span class="main">∧</span>
              <span class="main">(</span><span class="skolem">low</span> <span class="bound">no</span> <span class="main">=</span> Null<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">high</span> <span class="bound">no</span> <span class="main">=</span> Null<span class="main">)</span> <span class="main">∧</span>
              <span class="skolem">low</span> <span class="bound">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">∧</span>
              <span class="skolem">high</span> <span class="bound">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">∧</span>
              isLeaf_pt <span class="bound">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">var</span> <span class="bound">no</span> <span class="main">≤</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span>
              <span class="main">(</span><span class="skolem">low</span> <span class="bound">no</span> <span class="main">≠</span> Null <span class="main">⟶</span> <span class="skolem">repb</span> <span class="main">(</span><span class="skolem">low</span> <span class="bound">no</span><span class="main">)</span> <span class="main">≠</span> Null<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
          <span class="main">(</span><span class="main">∀</span><span class="bound">no1</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span><span class="bound">no2</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span><span class="main">.</span> <span class="skolem">var</span> <span class="bound">no1</span> <span class="main">=</span> <span class="skolem">var</span> <span class="bound">no2</span><span class="main">)</span> <span class="main">∧</span>
          <span class="main">(</span><span class="main">∀</span><span class="bound">repa</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">no</span><span class="main">.</span> <span class="bound">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">⟶</span> <span class="skolem">repb</span> <span class="bound">no</span> <span class="main">=</span> <span class="bound">repa</span> <span class="bound">no</span><span class="main">)</span> <span class="main">∧</span>
                  <span class="main">(</span><span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span><span class="main">.</span>
                      <span class="bound">repa</span> <span class="bound">no</span> <span class="main">≠</span> Null <span class="main">∧</span>
                      <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="bound">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="bound">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no</span> <span class="main">∧</span> <span class="skolem">low</span> <span class="bound">no</span> <span class="main">≠</span> Null
                       <span class="keyword1">then</span> <span class="bound">repa</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="bound">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no</span>
                       <span class="keyword1">else</span> <span class="bound">repa</span> <span class="bound">no</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">∧</span>
                            <span class="bound">repa</span> <span class="main">(</span><span class="bound">repa</span> <span class="bound">no</span><span class="main">)</span> <span class="main">=</span> <span class="bound">repa</span> <span class="bound">no</span> <span class="main">∧</span>
                            <span class="main">(</span><span class="main">∀</span><span class="bound">no1</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span><span class="main">.</span>
                                <span class="main">(</span><span class="main">(</span><span class="bound">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="bound">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no</span> <span class="main">∧</span>
                                 <span class="main">(</span><span class="bound">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="bound">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no</span><span class="main">)</span> <span class="main">=</span>
                                <span class="main">(</span><span class="bound">repa</span> <span class="bound">no</span> <span class="main">=</span> <span class="bound">repa</span> <span class="bound">no1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
                  <span class="skolem">var</span> <span class="skolem">p</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">p</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">n</span> <span class="main">∧</span>
                  <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">var</span> <span class="skolem">p</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span>
                  <span class="main">(</span><span class="main">∀</span><span class="bound">pt</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∉</span> set_of <span class="skolem">pret</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">pt</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">⟶</span>
                        <span class="skolem">rep</span> <span class="bound">pt</span> <span class="main">=</span> <span class="bound">repa</span> <span class="bound">pt</span><span class="main">)</span> <span class="main">∧</span>
                  <span class="bound">repa</span> <span class="main">`</span> Nodes <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">ll</span> <span class="main">⊆</span> Nodes <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">ll</span> <span class="main">∧</span>
                  <span class="main">(</span><span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>Nodes <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">ll</span><span class="main">.</span>
                      <span class="skolem">var</span> <span class="main">(</span><span class="bound">repa</span> <span class="bound">no</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">var</span> <span class="bound">no</span> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">∃</span><span class="bound">not</span> <span class="bound">nort</span><span class="main">.</span>
                          Dag <span class="main">(</span><span class="bound">repa</span> <span class="bound">no</span><span class="main">)</span> <span class="main">(</span><span class="bound">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="bound">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">nort</span> <span class="main">∧</span>
                          Dag <span class="bound">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="bound">not</span> <span class="main">∧</span>
                          reduced <span class="bound">nort</span> <span class="main">∧</span>
                          ordered <span class="bound">nort</span> <span class="skolem">var</span> <span class="main">∧</span>
                          set_of <span class="bound">nort</span> <span class="main">⊆</span> <span class="bound">repa</span> <span class="main">`</span> Nodes <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">ll</span> <span class="main">∧</span>
                          <span class="main">(</span><span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set_of <span class="bound">nort</span><span class="main">.</span> <span class="bound">repa</span> <span class="bound">no</span> <span class="main">=</span> <span class="bound">no</span><span class="main">)</span> <span class="main">∧</span>
                          <span class="main">(</span><span class="main">∃</span><span class="bound">nobdt</span><span class="main">.</span>
                              bdt <span class="bound">not</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="bound">nobdt</span> <span class="main">∧</span>
                              <span class="main">(</span><span class="main">∃</span><span class="bound">norbdt</span><span class="main">.</span> bdt <span class="bound">nort</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="bound">norbdt</span> <span class="main">∧</span> <span class="bound">nobdt</span> <span class="main">∼</span> <span class="bound">norbdt</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                  <span class="main">(</span><span class="main">∀</span><span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span>
                      <span class="bound">t1</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="bound">repa</span> <span class="main">`</span> Nodes <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">(</span><span class="bound">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="bound">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">∧</span>
                      <span class="bound">t2</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="bound">repa</span> <span class="main">`</span> Nodes <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">(</span><span class="bound">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="bound">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">⟶</span>
                      isomorphic_dags_eq <span class="bound">t1</span> <span class="bound">t2</span> <span class="skolem">var</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> ll <span class="keyword1"><span class="command">have</span></span> length_ll_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">levellist</span> <span class="main">=</span> length <span class="skolem">ll</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Levellist_length<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> n_Suc_var_p lll <span class="keyword1"><span class="command">have</span></span> nsll<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> length <span class="skolem">levellist</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> nseqll<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> length <span class="skolem">levellist</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> srrl_precond<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">no</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span><span class="main">.</span>
      <span class="bound">no</span> <span class="main">≠</span> Null <span class="main">∧</span>
      <span class="main">(</span><span class="skolem">low</span> <span class="bound">no</span> <span class="main">=</span> Null<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">high</span> <span class="bound">no</span> <span class="main">=</span> Null<span class="main">)</span> <span class="main">∧</span>
      <span class="skolem">low</span> <span class="bound">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">∧</span>
      <span class="skolem">high</span> <span class="bound">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">∧</span> 
      isLeaf_pt <span class="bound">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">var</span> <span class="bound">no</span> <span class="main">≤</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span> 
      <span class="main">(</span><span class="skolem">low</span> <span class="bound">no</span> <span class="main">≠</span> Null <span class="main">⟶</span> <span class="skolem">repb</span> <span class="main">(</span><span class="skolem">low</span> <span class="bound">no</span><span class="main">)</span> <span class="main">≠</span> Null<span class="main">)</span> <span class="main">∧</span> 
      <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ballI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">no</span>
      <span class="keyword3"><span class="command">assume</span></span> no_in_lln<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> wf_ll nsll <span class="keyword1"><span class="command">have</span></span> no_in_pret_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">∈</span> set_of <span class="skolem">pret</span> <span class="main">∧</span> <span class="skolem">var</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ll_def length_ll_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> pret_dag <span class="keyword1"><span class="command">have</span></span> no_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">≠</span> Null"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_of_nn<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">from</span></span> pret_dag prebdt_pret no_in_pret_var 
      <span class="keyword1"><span class="command">have</span></span> balanced_no<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span> <span class="main">=</span> Null<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span> <span class="main">=</span> Null<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> conjE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> p<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> low<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">low</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> balanced_bdt<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">have</span></span> low_no_notin_lln<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">no</span> <span class="main">=</span> Null"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">note</span></span> lno_Null<span class="main">=</span>this
        <span class="keyword1"><span class="command">with</span></span> balanced_no <span class="keyword1"><span class="command">have</span></span> hno_Null<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">no</span> <span class="main">=</span> Null"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">no</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span><span class="main">)</span> 
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">with</span></span> wf_ll nsll <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">no</span> <span class="main">∈</span> set_of <span class="skolem">pret</span> <span class="main">∧</span> <span class="skolem">var</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ll_def length_ll_eq<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> pret_dag <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">no</span> <span class="main">≠</span> Null"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_of_nn<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">with</span></span> lno_Null <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> lno_notin_lln<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> lno_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">no</span> <span class="main">≠</span> Null"</span></span>
        <span class="keyword1"><span class="command">with</span></span> balanced_no <span class="keyword1"><span class="command">have</span></span> hno_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">no</span> <span class="main">≠</span> Null"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> lno_nNull pret_dag ord_pret no_in_pret_var 
        <span class="keyword1"><span class="command">have</span></span> var_children_smaller<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">no</span> <span class="main">∧</span> <span class="skolem">var</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">no</span>"</span></span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> var_ordered_children<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">no</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">with</span></span> wf_ll nsll <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">no</span> <span class="main">∈</span> set_of <span class="skolem">pret</span> <span class="main">∧</span> <span class="skolem">var</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ll_def length_ll_eq<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> var_children_smaller no_in_pret_var <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> high_no_notin_lln<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">no</span> <span class="main">=</span> Null"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">note</span></span> hno_Null<span class="main">=</span>this
        <span class="keyword1"><span class="command">with</span></span> balanced_no <span class="keyword1"><span class="command">have</span></span> lno_Null<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">no</span> <span class="main">=</span> Null"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">no</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span><span class="main">)</span> 
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">with</span></span> wf_ll nsll <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">no</span> <span class="main">∈</span> set_of <span class="skolem">pret</span> <span class="main">∧</span> <span class="skolem">var</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ll_def length_ll_eq<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> pret_dag <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">no</span> <span class="main">≠</span> Null"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_of_nn<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">with</span></span> hno_Null <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> hno_notin_lln<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> hno_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">no</span> <span class="main">≠</span> Null"</span></span>
        <span class="keyword1"><span class="command">with</span></span> balanced_no <span class="keyword1"><span class="command">have</span></span> lno_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">no</span> <span class="main">≠</span> Null"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> hno_nNull pret_dag ord_pret no_in_pret_var 
        <span class="keyword1"><span class="command">have</span></span> var_children_smaller<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">no</span> <span class="main">∧</span> <span class="skolem">var</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">no</span>"</span></span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> var_ordered_children<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">no</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">with</span></span> wf_ll nsll <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">no</span> <span class="main">∈</span> set_of <span class="skolem">pret</span> <span class="main">∧</span> <span class="skolem">var</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ll_def length_ll_eq<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> var_children_smaller no_in_pret_var <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span> 
      <span class="keyword1"><span class="command">from</span></span> no_in_pret_var pret_dag no_nNull <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">not</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
        no_dag_ex<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">not</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rotate_tac</span> 2<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> subnode_dag_cons<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Dag_Ref<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">with</span></span> pret_dag prebdt_pret no_in_pret_var <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nobdt</span></span> 
        <span class="keyword2"><span class="keyword">where</span></span> nobdt_ex<span class="main">:</span> 
        <span class="quoted"><span class="quoted">"bdt <span class="skolem">not</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="skolem">nobdt</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> subbdt_ex_dag_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">have</span></span> isLeaf_var<span class="main">:</span> <span class="quoted"><span class="quoted">"isLeaf_pt <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">var</span> <span class="skolem">no</span> <span class="main">≤</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> no_isLeaf<span class="main">:</span> <span class="quoted"><span class="quoted">"isLeaf_pt <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> nobdt_ex no_dag_ex no_isLeaf <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">no</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> bdt_Some_Leaf_var_le_1<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> varno_le_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">no</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"isLeaf_pt <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">with</span></span> nobdt_ex no_nNull no_dag_ex <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">not</span> <span class="main">=</span> Node Tip <span class="skolem">no</span> Tip"</span></span> 
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> bdt_Some_var0_Zero<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">with</span></span> no_dag_ex <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"isLeaf_pt <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isLeaf_pt_def<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">no</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> varno_le_1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> nobdt_ex no_nNull no_dag_ex <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">not</span> <span class="main">=</span> Node Tip <span class="skolem">no</span> Tip"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> bdt_Some_var1_One<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">with</span></span> no_dag_ex <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"isLeaf_pt <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isLeaf_pt_def<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> repb_low_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span> <span class="main">≠</span> Null <span class="main">⟶</span> <span class="skolem">repb</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">≠</span> Null<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> lno_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">no</span> <span class="main">≠</span> Null"</span></span>
        <span class="keyword1"><span class="command">with</span></span> no_nNull no_in_pret_var pret_dag <span class="keyword1"><span class="command">have</span></span> lno_in_pret<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">no</span> <span class="main">∈</span> set_of <span class="skolem">pret</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> low<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">low</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subelem_set_of_low<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">from</span></span> lno_nNull balanced_no <span class="keyword1"><span class="command">have</span></span> hno_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">no</span> <span class="main">≠</span> Null"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> lno_nNull pret_dag ord_pret no_in_pret_var 
        <span class="keyword1"><span class="command">have</span></span> var_children_smaller<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">no</span> <span class="main">∧</span> <span class="skolem">var</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">no</span>"</span></span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> var_ordered_children<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
        <span class="keyword1"><span class="command">with</span></span> no_in_pret_var <span class="keyword1"><span class="command">have</span></span> var_lno_l_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">&lt;</span><span class="skolem">n</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> wf_ll lno_in_pret nsll <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">no</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">var</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ll_def length_ll_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> lno_in_pret var_lno_l_n <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">no</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nodes_def<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">repb</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> repbNodes_in_Nodes <span class="keyword1"><span class="command">have</span></span> repb_lno_in_Nodes<span class="main">:</span> 
          <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> pret_dag wf_ll nsll <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Null <span class="main">∉</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Null_notin_Nodes<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_ll_eq<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
        <span class="keyword1"><span class="command">with</span></span> repb_lno_in_Nodes <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">≠</span> Null"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> Null_notin_lln<span class="main">:</span> <span class="quoted"><span class="quoted">"Null <span class="main">∉</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Null <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> wf_ll nsll <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Null <span class="main">∈</span> set_of <span class="skolem">pret</span> <span class="main">∧</span> <span class="skolem">var</span> <span class="main">(</span>Null<span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ll_def length_ll_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> pret_dag <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Null <span class="main">≠</span> Null"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_of_nn<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Null <span class="main">∉</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">no</span> <span class="main">=</span> Null"</span></span><span class="main">)</span>  
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> Null_notin_lln <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> lno_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">no</span> <span class="main">≠</span> Null"</span></span>
        <span class="keyword1"><span class="command">with</span></span> no_nNull no_in_pret_var pret_dag <span class="keyword1"><span class="command">have</span></span> lno_in_pret<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">no</span> <span class="main">∈</span> set_of <span class="skolem">pret</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> low<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">low</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subelem_set_of_low<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">from</span></span> lno_nNull <span class="keyword1"><span class="command">have</span></span> propto_eq_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">repb</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> lno_nNull balanced_no <span class="keyword1"><span class="command">have</span></span> hno_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">no</span> <span class="main">≠</span> Null"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> lno_nNull pret_dag ord_pret no_in_pret_var 
        <span class="keyword1"><span class="command">have</span></span> var_children_smaller<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">no</span> <span class="main">∧</span> <span class="skolem">var</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">no</span>"</span></span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> var_ordered_children<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
        <span class="keyword1"><span class="command">with</span></span> no_in_pret_var <span class="keyword1"><span class="command">have</span></span> var_lno_l_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">&lt;</span><span class="skolem">n</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> wf_ll lno_in_pret nsll <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">no</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">var</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ll_def length_ll_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> lno_in_pret var_lno_l_n <span class="keyword1"><span class="command">have</span></span> lno_in_Nodes_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">no</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nodes_def<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">repb</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span>  repbNodes_in_Nodes <span class="keyword1"><span class="command">have</span></span> repb_lno_in_Nodes<span class="main">:</span> 
          <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">with</span></span> lno_in_Nodes_n normalize_prop <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">var</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> var_lno_l_n <span class="keyword1"><span class="command">have</span></span> var_rep_lno_l_n<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">var</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> repb_lno_in_Nodes <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound"><span class="bound">k</span></span> <span class="main">&lt;</span> <span class="skolem">n</span><span class="main">.</span> <span class="skolem">repb</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nodes_def<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> wf_ll propto_eq_comp nsll <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> i<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">k</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> j<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> no_in_one_ll<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_ll_eq<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">with</span></span> no_nNull balanced_no low_no_notin_lln high_no_notin_lln isLeaf_var repb_low_nNull
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">no</span> <span class="main">≠</span> Null <span class="main">∧</span>
        <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span> <span class="main">=</span> Null<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span> <span class="main">=</span> Null<span class="main">)</span> <span class="main">∧</span>
        <span class="skolem">low</span> <span class="skolem">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">high</span> <span class="skolem">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">∧</span> 
        isLeaf_pt <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">var</span> <span class="skolem">no</span> <span class="main">≤</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span> 
        <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span> <span class="main">≠</span> Null <span class="main">⟶</span> <span class="skolem">repb</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">≠</span> Null<span class="main">)</span> <span class="main">∧</span> 
        <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> all_nodes_same_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no1</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span><span class="bound">no2</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span><span class="main">.</span> <span class="skolem">var</span> <span class="bound">no1</span> <span class="main">=</span> <span class="skolem">var</span> <span class="bound">no2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ballI impI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">no1</span> <span class="skolem">no2</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">no1</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> wf_ll nsll <span class="keyword1"><span class="command">have</span></span> var_lln_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">no1</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ll_def length_ll_eq<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">no2</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> wf_ll nsll <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">no2</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ll_def length_ll_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> var_lln_i <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">var</span> <span class="skolem">no1</span> <span class="main">=</span> <span class="skolem">var</span> <span class="skolem">no2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">repa</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">no</span><span class="main">.</span> <span class="bound">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">⟶</span> <span class="skolem">repb</span> <span class="bound">no</span> <span class="main">=</span> <span class="bound">repa</span> <span class="bound">no</span><span class="main">)</span> <span class="main">∧</span>
                  <span class="main">(</span><span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span><span class="main">.</span>
                      <span class="bound">repa</span> <span class="bound">no</span> <span class="main">≠</span> Null <span class="main">∧</span>
                      <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="bound">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="bound">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no</span> <span class="main">∧</span> <span class="skolem">low</span> <span class="bound">no</span> <span class="main">≠</span> Null
                       <span class="keyword1">then</span> <span class="bound">repa</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="bound">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no</span>
                       <span class="keyword1">else</span> <span class="bound">repa</span> <span class="bound">no</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">∧</span>
                            <span class="bound">repa</span> <span class="main">(</span><span class="bound">repa</span> <span class="bound">no</span><span class="main">)</span> <span class="main">=</span> <span class="bound">repa</span> <span class="bound">no</span> <span class="main">∧</span>
                            <span class="main">(</span><span class="main">∀</span><span class="bound">no1</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span><span class="main">.</span>
                                <span class="main">(</span><span class="main">(</span><span class="bound">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="bound">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no</span> <span class="main">∧</span>
                                 <span class="main">(</span><span class="bound">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="bound">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no</span><span class="main">)</span> <span class="main">=</span>
                                <span class="main">(</span><span class="bound">repa</span> <span class="bound">no</span> <span class="main">=</span> <span class="bound">repa</span> <span class="bound">no1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
                  <span class="skolem">var</span> <span class="skolem">p</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">p</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">n</span> <span class="main">∧</span>
                  <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">var</span> <span class="skolem">p</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span>
                  <span class="main">(</span><span class="main">∀</span><span class="bound">pt</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∉</span> set_of <span class="skolem">pret</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">pt</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">⟶</span>
                        <span class="skolem">rep</span> <span class="bound">pt</span> <span class="main">=</span> <span class="bound">repa</span> <span class="bound">pt</span><span class="main">)</span> <span class="main">∧</span>
                  <span class="bound">repa</span> <span class="main">`</span> Nodes <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">ll</span> <span class="main">⊆</span> Nodes <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">ll</span> <span class="main">∧</span>
                  <span class="main">(</span><span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>Nodes <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">ll</span><span class="main">.</span>
                      <span class="skolem">var</span> <span class="main">(</span><span class="bound">repa</span> <span class="bound">no</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">var</span> <span class="bound">no</span> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">∃</span><span class="bound">not</span> <span class="bound">nort</span><span class="main">.</span>
                          Dag <span class="main">(</span><span class="bound">repa</span> <span class="bound">no</span><span class="main">)</span> <span class="main">(</span><span class="bound">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="bound">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">nort</span> <span class="main">∧</span>
                          Dag <span class="bound">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="bound">not</span> <span class="main">∧</span>
                          reduced <span class="bound">nort</span> <span class="main">∧</span>
                          ordered <span class="bound">nort</span> <span class="skolem">var</span> <span class="main">∧</span>
                          set_of <span class="bound">nort</span> <span class="main">⊆</span> <span class="bound">repa</span> <span class="main">`</span> Nodes <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">ll</span> <span class="main">∧</span>
                          <span class="main">(</span><span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set_of <span class="bound">nort</span><span class="main">.</span> <span class="bound">repa</span> <span class="bound">no</span> <span class="main">=</span> <span class="bound">no</span><span class="main">)</span> <span class="main">∧</span>
                          <span class="main">(</span><span class="main">∃</span><span class="bound">nobdt</span><span class="main">.</span>
                              bdt <span class="bound">not</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="bound">nobdt</span> <span class="main">∧</span>
                              <span class="main">(</span><span class="main">∃</span><span class="bound">norbdt</span><span class="main">.</span> bdt <span class="bound">nort</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="bound">norbdt</span> <span class="main">∧</span> <span class="bound">nobdt</span> <span class="main">∼</span> <span class="bound">norbdt</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                  <span class="main">(</span><span class="main">∀</span><span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span>
                      <span class="bound">t1</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="bound">repa</span> <span class="main">`</span> Nodes <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">(</span><span class="bound">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="bound">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">∧</span>
                      <span class="bound">t2</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="bound">repa</span> <span class="main">`</span> Nodes <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">(</span><span class="bound">repa</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="bound">repa</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">⟶</span>
                      isomorphic_dags_eq <span class="bound">t1</span> <span class="bound">t2</span> <span class="skolem">var</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">repc</span><span class="main">.</span> <span class="var">?srrl_post</span> <span class="bound">repc</span> <span class="main">⟶</span> <span class="var">?norm_inv</span> <span class="bound">repc</span><span class="main">)</span> "</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> conjE<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">repc</span>
      <span class="keyword3"><span class="command">assume</span></span> repbc_nc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span><span class="main">.</span> <span class="bound">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">⟶</span> <span class="skolem">repb</span> <span class="bound">no</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="bound">no</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> rep_prop<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span><span class="main">.</span>
        <span class="skolem">repc</span> <span class="bound">no</span> <span class="main">≠</span> Null <span class="main">∧</span>
               <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no</span> <span class="main">∧</span> <span class="skolem">low</span> <span class="bound">no</span> <span class="main">≠</span> Null
                <span class="keyword1">then</span> <span class="skolem">repc</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no</span>
                <span class="keyword1">else</span> <span class="skolem">repc</span> <span class="bound">no</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">∧</span>
                     <span class="skolem">repc</span> <span class="main">(</span><span class="skolem">repc</span> <span class="bound">no</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="bound">no</span> <span class="main">∧</span>
                     <span class="main">(</span><span class="main">∀</span><span class="bound">no1</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span><span class="main">.</span>
                         <span class="main">(</span><span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no</span> <span class="main">∧</span>
                          <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no</span><span class="main">)</span> <span class="main">=</span>
                         <span class="main">(</span><span class="skolem">repc</span> <span class="bound">no</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="bound">no1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?norm_inv</span> <span class="skolem">repc</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> n_Suc_var_p <span class="keyword1"><span class="command">have</span></span> termi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">p</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">p</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">n</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
        <span class="keyword1"><span class="command">from</span></span> wf_ll repbc_nc nsll 
        <span class="keyword1"><span class="command">have</span></span> Nodes_n_rep_nc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span> <span class="main">⟶</span> <span class="skolem">repb</span> <span class="bound">p</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="bound">p</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nodes_def<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">p</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> i<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> j<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> no_in_one_ll<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_ll_eq<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">from</span></span> repbNodes_in_Nodes 
        <span class="keyword1"><span class="command">have</span></span> Nodes_n_rep_in_Nodesn<span class="main">:</span> 
          <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span> <span class="main">⟶</span> <span class="skolem">repb</span> <span class="bound">p</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> wf_ll nsll <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Nodes <span class="skolem">n</span> <span class="skolem">ll</span> <span class="main">⊆</span> set_of <span class="skolem">pret</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Nodes_in_pret<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_ll_eq<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">with</span></span> Nodes_n_rep_in_Nodesn  
        <span class="keyword1"><span class="command">have</span></span> Nodes_n_rep_in_pret<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span> <span class="main">⟶</span> <span class="skolem">repb</span> <span class="bound">p</span> <span class="main">∈</span> set_of <span class="skolem">pret</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">have</span></span> Nodes_repbc_Dags_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span> 
          <span class="main">⟶</span> Dag <span class="main">(</span><span class="skolem">repb</span> <span class="bound">p</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">t</span> <span class="main">=</span> 
          Dag <span class="main">(</span><span class="skolem">repc</span> <span class="bound">p</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">t</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">t</span>
          <span class="keyword3"><span class="command">assume</span></span> p_in_Nodes<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">p</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> repp_nc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">p</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="skolem">p</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Nodes_n_rep_nc <span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> p_in_Nodes normalize_prop <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nort</span></span> <span class="keyword2"><span class="keyword">where</span></span>
            nort_repb_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">nort</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
            nort_in_repbNodes<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">nort</span> <span class="main">⊆</span> <span class="skolem">repb</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">from</span></span> nort_in_repbNodes repbNodes_in_Nodes 
          <span class="keyword1"><span class="command">have</span></span> nort_in_Nodesn<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">nort</span> <span class="main">⊆</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">from</span></span> pret_dag wf_ll nsll <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Null <span class="main">∉</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Null_notin_Nodes<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_ll_eq<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">with</span></span> p_in_Nodes repbNodes_in_Nodes <span class="keyword1"><span class="command">have</span></span> repp_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">p</span> <span class="main">≠</span> Null"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> nort_repb_dag repp_nc 
          <span class="keyword1"><span class="command">have</span></span> nort_repbc_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">nort</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">from</span></span> nort_in_Nodesn <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set_of <span class="skolem">nort</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">with</span></span> wf_ll nsll  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set_of <span class="skolem">nort</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set_of <span class="skolem">pret</span> <span class="main">∧</span> <span class="skolem">var</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> wf_ll_Nodes_pret<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_ll_eq<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">with</span></span> pret_dag prebdt_pret nort_repbc_dag ord_pret wf_ll  nsll repbc_nc 
          <span class="keyword1"><span class="command">have</span></span> 
            <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> set_of <span class="skolem">nort</span><span class="main">.</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">x</span> <span class="main">∧</span> 
            <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">x</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> nort_null_comp<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_ll_eq<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">with</span></span> nort_repbc_dag repp_nc 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">nort</span> <span class="main">=</span> 
            Dag <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">nort</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> heaps_eq_Dag_eq<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> conjE<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">with</span></span> nort_repbc_dag repp_nc <span class="keyword3"><span class="command">show</span></span> 
            <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">=</span> 
            Dag <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">t</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rotate_tac</span> 2<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> Dag_unique<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rotate_tac</span> 1<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> Dag_unique<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rotate_tac</span> 3<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">from</span></span> rep_prop <span class="keyword1"><span class="command">have</span></span> repbc_changes<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span><span class="main">.</span>
          <span class="skolem">repc</span> <span class="bound">no</span> <span class="main">≠</span> Null <span class="main">∧</span>
          <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no</span> <span class="main">∧</span> <span class="skolem">low</span> <span class="bound">no</span> <span class="main">≠</span> Null 
          <span class="keyword1">then</span> <span class="skolem">repc</span> <span class="bound">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no</span>
          <span class="keyword1">else</span> <span class="skolem">repc</span> <span class="bound">no</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">repc</span> <span class="main">(</span><span class="skolem">repc</span> <span class="bound">no</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="bound">no</span> <span class="main">∧</span> 
          <span class="main">(</span><span class="main">∀</span><span class="bound">no1</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no</span> <span class="main">∧</span> 
          <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="bound">no</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="bound">no1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> nsll lll  <span class="keyword1"><span class="command">have</span></span> n_var_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span> <span class="main">&lt;=</span> <span class="skolem">var</span> <span class="skolem">p</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> rep_nc <span class="keyword1"><span class="command">have</span></span> Sucn_repb_nc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">pt</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∉</span> set_of <span class="skolem">pret</span> <span class="main">∨</span> 
          <span class="main">(</span><span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">pt</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>  
          <span class="main">⟶</span> <span class="skolem">rep</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">repb</span> <span class="bound">pt</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">pt</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">have</span></span> repc_nc<span class="main">:</span> 
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">pt</span><span class="main">.</span> <span class="bound">pt</span> <span class="main">∉</span> set_of <span class="skolem">pret</span> <span class="main">∨</span> 
          <span class="main">(</span><span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">pt</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> 
          <span class="main">⟶</span> <span class="skolem">rep</span> <span class="bound">pt</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="bound">pt</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">pt</span> 
          <span class="keyword3"><span class="command">assume</span></span> pt_notin_lower_ll<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">pt</span> <span class="main">∉</span> set_of <span class="skolem">pret</span> <span class="main">∨</span> 
            <span class="main">(</span><span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">∧</span> <span class="skolem">pt</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rep</span> <span class="skolem">pt</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="skolem">pt</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">pt</span> <span class="main">∉</span> set_of <span class="skolem">pret</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">with</span></span> wf_ll nsll <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pt</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ll_def length_ll_eq<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">pt</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">pt</span> <span class="main">∈</span> set_of <span class="skolem">pret</span>"</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">with</span></span> repbc_nc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">pt</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="skolem">pt</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">with</span></span> Sucn_repb_nc True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">assume</span></span> pt_in_pret<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">pt</span> <span class="main">∉</span> set_of <span class="skolem">pret</span>"</span></span>
            <span class="keyword1"><span class="command">with</span></span> pt_notin_lower_ll <span class="keyword1"><span class="command">have</span></span> pt_in_higher_ll<span class="main">:</span> 
              <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">∧</span> <span class="skolem">pt</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">p</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">with</span></span> nsll wf_ll lll <span class="keyword1"><span class="command">have</span></span> pt_notin_lln<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">pt</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> i<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> j<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> no_in_one_ll<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_ll_eq<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">with</span></span> repbc_nc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">pt</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="skolem">pt</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">with</span></span> Sucn_repb_nc pt_in_higher_ll <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">from</span></span> wf_ll nsll  
        <span class="keyword1"><span class="command">have</span></span> Nodesn_notin_lln<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">.</span> <span class="bound">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nodes_def<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> no_in_one_ll<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_ll_eq<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">with</span></span> repbc_nc  
        <span class="keyword1"><span class="command">have</span></span> Nodesn_repnc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">.</span> <span class="skolem">repb</span> <span class="bound">no</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="bound">no</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">no</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> repbNodes_repcNodes<span class="main">:</span> 
          <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="main">`</span><span class="main">(</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="main">`</span><span class="main">(</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> imageE<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">xa</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">have</span></span> repcNodes_in_Nodes<span class="main">:</span> 
          <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">ll</span> <span class="main">⊆</span> Nodes <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">ll</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
          <span class="keyword3"><span class="command">assume</span></span> x_in_repcNodesSucn<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">ll</span>"</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> Nodes <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">ll</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">repc</span> <span class="main">`</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">with</span></span> repbNodes_repcNodes repbNodes_in_Nodes <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span> 
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">with</span></span> Nodes_subset <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">x</span> <span class="main">∉</span> <span class="skolem">repc</span> <span class="main">`</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
            <span class="keyword1"><span class="command">with</span></span> x_in_repcNodesSucn <span class="keyword1"><span class="command">have</span></span> x_in_repclln<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">repc</span> <span class="main">`</span>set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nodes_def<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">k</span><span class="main">&lt;</span><span class="skolem">n</span>"</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">k</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">arith</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">from</span></span> x_in_repclln <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> imageE<span class="main">)</span>
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
              <span class="keyword3"><span class="command">assume</span></span> x_repcy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="skolem">y</span>"</span></span>
              <span class="keyword3"><span class="command">assume</span></span> y_in_repclln<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">from</span></span> rep_prop y_in_repclln  <span class="keyword3"><span class="command">obtain</span></span>
                repcy_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="skolem">y</span> <span class="main">≠</span> Null"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
                red_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">y</span> <span class="main">∧</span> 
                <span class="skolem">low</span> <span class="skolem">y</span> <span class="main">≠</span> Null <span class="main">⟶</span> <span class="skolem">repc</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
                share_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">y</span> <span class="main">⟶</span> <span class="skolem">low</span> <span class="skolem">y</span> <span class="main">=</span> Null<span class="main">)</span> 
                <span class="main">⟶</span> <span class="skolem">repc</span> <span class="skolem">y</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">repc</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="skolem">y</span> <span class="main">∧</span> 
                <span class="main">(</span><span class="main">∀</span><span class="bound">no1</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span><span class="main">.</span> 
                <span class="main">(</span><span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">y</span> <span class="main">∧</span> 
                <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="bound">no1</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_depth_limit</span> <span class="main"><span class="main">=</span></span> 4<span class="main">]</span><span class="main">]</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">from</span></span> wf_ll nsll  y_in_repclln <span class="keyword3"><span class="command">obtain</span></span>
                y_in_pret<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> set_of <span class="skolem">pret</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
                vary_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ll_def length_ll_eq<span class="main">)</span>
              <span class="keyword1"><span class="command">from</span></span> y_in_pret pret_dag <span class="keyword1"><span class="command">have</span></span> y_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≠</span> Null"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_of_nn<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> Nodes <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">ll</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">y</span> <span class="main">=</span> Null"</span></span><span class="main">)</span>
                <span class="keyword3"><span class="command">case</span></span> True
                <span class="keyword1"><span class="command">from</span></span> pret_dag prebdt_pret True y_in_pret 
                <span class="keyword1"><span class="command">have</span></span> highy_Null<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">y</span> <span class="main">=</span> Null"</span></span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> balanced_bdt<span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                <span class="keyword1"><span class="command">with</span></span> share_prop True <span class="keyword3"><span class="command">obtain</span></span> 
                  repcy_in_llb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="skolem">y</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
                  rry_ry<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">repc</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
                  y_other_node_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no1</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span><span class="main">.</span> 
                  <span class="main">(</span><span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">y</span> <span class="main">∧</span> 
                  <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="bound">no1</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">from</span></span> repcy_in_llb  x_repcy <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nodes_def<span class="main">)</span>
              <span class="keyword1"><span class="command">next</span></span>
                <span class="keyword3"><span class="command">assume</span></span> lowy_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">y</span> <span class="main">≠</span> Null"</span></span>
                <span class="keyword1"><span class="command">with</span></span> pret_dag prebdt_pret y_in_pret 
                <span class="keyword1"><span class="command">have</span></span> highy_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">y</span> <span class="main">≠</span> Null"</span></span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> balanced_bdt<span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">y</span>"</span></span><span class="main">)</span>
                  <span class="keyword3"><span class="command">case</span></span> True
                  <span class="keyword1"><span class="command">with</span></span> red_prop lowy_nNull <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">y</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">with</span></span> highy_nNull <span class="keyword1"><span class="command">have</span></span> red_repc_y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
                  <span class="keyword1"><span class="command">from</span></span> pret_dag ord_pret y_in_pret lowy_nNull  highy_nNull 
                  
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="skolem">var</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">y</span>"</span></span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> var_ordered_children<span class="main">)</span> 
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                  <span class="keyword1"><span class="command">with</span></span>  vary_n <span class="keyword1"><span class="command">have</span></span> varhighy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">from</span></span> y_in_pret y_nNull highy_nNull pret_dag  
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">y</span> <span class="main">∈</span> set_of <span class="skolem">pret</span>"</span></span> 
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> subelem_set_of_high<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                  <span class="keyword1"><span class="command">with</span></span> wf_ll varhighy <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">y</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ll_def Nodes_def<span class="main">)</span>
                  <span class="keyword1"><span class="command">with</span></span> red_repc_y <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">repc</span> <span class="main">`</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">with</span></span> x_repcy <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">repc</span> <span class="main">`</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">with</span></span> repbNodes_repcNodes repbNodes_in_Nodes 
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span> 
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">with</span></span> Nodes_subset <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">next</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">y</span> <span class="main">≠</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">y</span>"</span></span>
                  <span class="keyword1"><span class="command">with</span></span> share_prop <span class="keyword3"><span class="command">obtain</span></span> 
                    repcy_in_llbn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="skolem">y</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
                    rry_ry<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
                    y_other_node_share<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no1</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span><span class="main">.</span> 
                    <span class="main">(</span><span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">y</span> <span class="main">∧</span> 
                    <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="bound">no1</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">with</span></span> repcy_in_llbn  x_repcy <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nodes_def<span class="main">)</span>
                <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>Nodes <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">ll</span><span class="main">.</span>
          <span class="skolem">var</span> <span class="main">(</span><span class="skolem">repc</span> <span class="bound">no</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">var</span> <span class="bound">no</span> <span class="main">∧</span> 
          <span class="main">(</span><span class="main">∃</span><span class="bound">not</span> <span class="bound">nort</span><span class="main">.</span> Dag <span class="main">(</span><span class="skolem">repc</span> <span class="bound">no</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">nort</span> <span class="main">∧</span>
          Dag <span class="bound">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="bound">not</span> <span class="main">∧</span>
          reduced <span class="bound">nort</span> <span class="main">∧</span> ordered <span class="bound">nort</span> <span class="skolem">var</span> <span class="main">∧</span> 
          set_of <span class="bound">nort</span> <span class="main">⊆</span> <span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">ll</span> <span class="main">∧</span> 
          <span class="main">(</span><span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set_of <span class="bound">nort</span><span class="main">.</span> <span class="skolem">repc</span> <span class="bound">no</span> <span class="main">=</span> <span class="bound">no</span><span class="main">)</span> <span class="main">∧</span>
          <span class="main">(</span><span class="main">∃</span><span class="bound">nobdt</span><span class="main">.</span> bdt <span class="bound">not</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="bound">nobdt</span> <span class="main">∧</span> 
          <span class="main">(</span><span class="main">∃</span><span class="bound">norbdt</span><span class="main">.</span> bdt <span class="bound">nort</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="bound">norbdt</span> <span class="main">∧</span> <span class="bound">nobdt</span> <span class="main">∼</span> <span class="bound">norbdt</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>Nodes <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">ll</span><span class="main">.</span> <span class="var">?Q</span> <span class="free">i</span> <span class="bound">no</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ballI<span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">no</span>
          <span class="keyword3"><span class="command">assume</span></span> no_in_Nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">∈</span> Nodes <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">ll</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> wf_ll no_in_Nodes nsll  <span class="keyword1"><span class="command">have</span></span> no_in_pret<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">∈</span> set_of <span class="skolem">pret</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ll_def Nodes_def length_ll_eq<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> conjE<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">∈</span> set_of <span class="skolem">pret</span> <span class="main">⟶</span> <span class="bound">q</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">var</span> <span class="bound">q</span><span class="main">)</span>"</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">arith</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">no</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">from</span></span> pret_dag no_in_pret <span class="keyword1"><span class="command">have</span></span> nonNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span><span class="main">≠</span> Null"</span></span> 
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_of_nn <span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>  
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="free">i</span> <span class="skolem">no</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">note</span></span> no_in_Nodesn<span class="main">=</span>this
            <span class="keyword1"><span class="command">with</span></span> wf_ll nsll  no_in_Nodes 
            <span class="keyword1"><span class="command">have</span></span> no_notin_llbn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nodes_def length_ll_eq<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> exE<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> <span class="var">?i</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">xa</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="var">?j</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> no_in_one_ll<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">arith</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">with</span></span> repbc_nc <span class="keyword1"><span class="command">have</span></span> repb_no_eq_repc_no<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="skolem">no</span>"</span></span> 
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">from</span></span> repbc_nc no_in_Nodes no_notin_llbn normalize_prop True 
            <span class="keyword1"><span class="command">have</span></span> varrep_eq_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">var</span> <span class="skolem">no</span>"</span></span> 
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">no</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">no</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">moreover</span></span>
            <span class="keyword1"><span class="command">from</span></span> True normalize_prop no_in_Nodes <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">not</span></span> <span class="skolem"><span class="skolem">nort</span></span> <span class="keyword2"><span class="keyword">where</span></span>
              nort_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">nort</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
              ord_nort<span class="main">:</span> <span class="quoted"><span class="quoted">"ordered <span class="skolem">nort</span> <span class="skolem">var</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
              subset_nort_not<span class="main">:</span>  <span class="quoted"><span class="quoted">"set_of <span class="skolem">nort</span> <span class="main">⊆</span> <span class="skolem">repb</span> <span class="main">`</span><span class="main">(</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
              not_dag<span class="main">:</span>  <span class="quoted"><span class="quoted">" Dag <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">not</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
              red_nort<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced <span class="skolem">nort</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
              nort_repb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set_of <span class="skolem">nort</span><span class="main">.</span> <span class="skolem">repb</span> <span class="bound">no</span> <span class="main">=</span> <span class="bound">no</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
              bdt_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">nobdt</span> <span class="bound">norbdt</span><span class="main">.</span> bdt <span class="skolem">not</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="bound">nobdt</span> <span class="main">∧</span> 
              bdt <span class="skolem">nort</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="bound">norbdt</span> <span class="main">∧</span> <span class="bound">nobdt</span> <span class="main">∼</span> <span class="bound">norbdt</span>"</span></span> 
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">moreover</span></span>
            <span class="keyword1"><span class="command">from</span></span> Nodesn_notin_lln repbc_nc nort_repb subset_nort_not repbNodes_in_Nodes 
            <span class="keyword1"><span class="command">have</span></span> nort_repc<span class="main">:</span> 
              <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set_of <span class="skolem">nort</span><span class="main">.</span> <span class="skolem">repc</span> <span class="bound">no</span> <span class="main">=</span> <span class="bound">no</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">no</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">moreover</span></span>
            <span class="keyword1"><span class="command">from</span></span> nort_dag <span class="keyword1"><span class="command">have</span></span> nortnodesnN<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">no</span><span class="main">.</span> <span class="bound">no</span> <span class="main">∈</span> set_of <span class="skolem">nort</span> <span class="main">⟶</span> <span class="bound">no</span> <span class="main">≠</span> Null<span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_of_nn<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">moreover</span></span>  
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">nort</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">from</span></span> no_notin_llbn repbc_nc <span class="keyword1"><span class="command">have</span></span> repbc_no<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">repb</span> <span class="skolem">no</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
              <span class="keyword1"><span class="command">with</span></span> nort_dag 
              <span class="keyword1"><span class="command">have</span></span> nortrepbc_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">nort</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">from</span></span> wf_ll nseqll <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Nodes <span class="skolem">n</span> <span class="skolem">ll</span> <span class="main">⊆</span> set_of <span class="skolem">pret</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Nodes_levellist_subset_t<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_ll_eq<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">with</span></span> repbNodes_in_Nodes subset_nort_not 
              <span class="keyword1"><span class="command">have</span></span> subset_nort_pret<span class="main">:</span>  <span class="quoted"><span class="quoted">"set_of <span class="skolem">nort</span> <span class="main">⊆</span> set_of <span class="skolem">pret</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">have</span></span> vxsn_in_pret<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> set_of <span class="skolem">nort</span><span class="main">.</span> <span class="skolem">var</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∈</span> set_of <span class="skolem">pret</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
                <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
                <span class="keyword3"><span class="command">assume</span></span> x_in_nort<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set_of <span class="skolem">nort</span>"</span></span>
                <span class="keyword1"><span class="command">from</span></span> x_in_nort subset_nort_not repbNodes_in_Nodes 
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                <span class="keyword1"><span class="command">with</span></span> wf_ll nsll  <span class="keyword1"><span class="command">have</span></span> xsn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ll_def Nodes_def length_ll_eq<span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> conjE<span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">∈</span> set_of <span class="skolem">pret</span> <span class="main">⟶</span> <span class="bound">q</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">var</span> <span class="bound">q</span><span class="main">)</span>"</span></span><span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">xa</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">arith</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                <span class="keyword1"><span class="command">from</span></span> x_in_nort subset_nort_pret <span class="keyword1"><span class="command">have</span></span> x_in_pret<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set_of <span class="skolem">pret</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                <span class="keyword1"><span class="command">with</span></span> xsn <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">∈</span> set_of <span class="skolem">pret</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">with</span></span> pret_dag prebdt_pret nortrepbc_dag ord_pret wf_ll  nsll 
                repbc_nc 
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> set_of <span class="skolem">nort</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">x</span> <span class="main">∧</span> 
                <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> nort_null_comp<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_ll_eq<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">with</span></span> nort_dag 
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">nort</span> <span class="main">=</span> 
                Dag <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">nort</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> heaps_eq_Dag_eq<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">with</span></span> nortrepbc_dag <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">moreover</span></span> 
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">nort</span> <span class="main">⊆</span> <span class="skolem">repc</span> <span class="main">`</span><span class="main">(</span>Nodes <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">ll</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> Nodesn_in_NodesSucn<span class="main">:</span> <span class="quoted"><span class="quoted">"Nodes <span class="skolem">n</span> <span class="skolem">ll</span> <span class="main">⊆</span> Nodes <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">ll</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nodes_def set_split<span class="main">)</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> repbNodesn_in_repbNodesSucn<span class="main">:</span> 
                <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="main">`</span><span class="main">(</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">repb</span> <span class="main">`</span><span class="main">(</span>Nodes <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">ll</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">from</span></span> wf_ll nsll  
              <span class="keyword1"><span class="command">have</span></span> Nodes_n_notin_lln<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">.</span> <span class="bound">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nodes_def length_ll_eq<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> no_in_one_ll<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">with</span></span> repbc_nc  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">.</span> <span class="skolem">repb</span> <span class="bound">no</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="bound">no</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">no</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> repbNodes_repcNodes<span class="main">:</span> 
                <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="main">`</span><span class="main">(</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="main">`</span><span class="main">(</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> imageE<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">xa</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">from</span></span> Nodesn_in_NodesSucn 
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">`</span><span class="main">(</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">repc</span> <span class="main">`</span><span class="main">(</span>Nodes <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">ll</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">with</span></span> repbNodes_repcNodes subset_nort_not repbNodesn_in_repbNodesSucn 
              <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">no</span> <span class="main">∉</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
            <span class="keyword1"><span class="command">with</span></span> no_in_Nodes  <span class="keyword1"><span class="command">have</span></span> no_in_llbn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">no</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nodes_def<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">x</span><span class="main">&lt;</span><span class="skolem">n</span>"</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> conjE<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">x</span><span class="main">=</span><span class="skolem">n</span>"</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">arith</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">with</span></span> wf_ll  nsll <span class="keyword1"><span class="command">have</span></span> varno<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ll_def length_ll_eq<span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> repbc_changes no_in_llbn 
            <span class="keyword1"><span class="command">have</span></span> repbcno_changes<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="skolem">no</span> <span class="main">≠</span> Null <span class="main">∧</span>
              <span class="main">(</span><span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span> <span class="skolem">low</span> <span class="skolem">no</span> <span class="main">≠</span> Null 
              <span class="main">⟶</span> <span class="skolem">repc</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">∧</span>
              <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">⟶</span> <span class="skolem">low</span> <span class="skolem">no</span> <span class="main">=</span> Null<span class="main">)</span> 
              <span class="main">⟶</span> <span class="skolem">repc</span> <span class="skolem">no</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>  <span class="main">∧</span> <span class="skolem">repc</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="skolem">no</span> <span class="main">∧</span> 
              <span class="main">(</span><span class="main">∀</span><span class="bound">no1</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span>
              <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="bound">no1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rnonN</span> <span class="main">∧</span> <span class="var">?repreduce</span> <span class="main">∧</span> <span class="var">?repshare</span>"</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_depth_limit</span><span class="main"><span class="main">=</span></span>4<span class="main">]</span><span class="main">]</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split<span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> 
              rnonN<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?rnonN</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
              repreduce<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?repreduce</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
              repshare<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?repshare</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">have</span></span> repcn_normalize<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">var</span> <span class="skolem">no</span> <span class="main">∧</span>
              <span class="main">(</span><span class="main">∃</span><span class="bound">not</span> <span class="bound">nort</span><span class="main">.</span> Dag <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">nort</span> <span class="main">∧</span>
              Dag <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="bound">not</span> <span class="main">∧</span> reduced <span class="bound">nort</span> <span class="main">∧</span> ordered <span class="bound">nort</span> <span class="skolem">var</span> <span class="main">∧</span>
              set_of <span class="bound">nort</span> <span class="main">⊆</span> <span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">ll</span> <span class="main">∧</span>
              <span class="main">(</span><span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set_of <span class="bound">nort</span><span class="main">.</span> <span class="skolem">repc</span> <span class="bound">no</span> <span class="main">=</span> <span class="bound">no</span><span class="main">)</span> <span class="main">∧</span>
              <span class="main">(</span><span class="main">∃</span><span class="bound">nobdt</span><span class="main">.</span> bdt <span class="bound">not</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="bound">nobdt</span> <span class="main">∧</span> 
              <span class="main">(</span><span class="main">∃</span><span class="bound">norbdt</span><span class="main">.</span> bdt <span class="bound">nort</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="bound">norbdt</span> <span class="main">∧</span> <span class="bound">nobdt</span> <span class="main">∼</span> <span class="bound">norbdt</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?varrep</span> <span class="main">∧</span> <span class="var">?repcn_prop</span>"</span></span> 
                <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?varrep</span> <span class="main">∧</span> 
                <span class="main">(</span><span class="main">∃</span><span class="bound">not</span> <span class="bound">nort</span><span class="main">.</span> <span class="var">?nort_dag</span> <span class="bound">nort</span> <span class="main">∧</span> <span class="var">?not_dag</span> <span class="bound">not</span> <span class="main">∧</span> <span class="var">?red</span> <span class="bound">nort</span> <span class="main">∧</span> 
                <span class="var">?ord</span> <span class="bound">nort</span> <span class="main">∧</span> <span class="var">?nort_in_Nodes</span> <span class="bound">nort</span> <span class="main">∧</span> <span class="var">?repcno_no_n</span> <span class="bound">nort</span> <span class="main">∧</span> <span class="var">?bdt_equ</span> <span class="bound">not</span> <span class="bound">nort</span><span class="main">)</span>"</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">no</span> <span class="main">=</span> Null"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">note</span></span> highnoNull<span class="main">=</span>this
              <span class="keyword1"><span class="command">with</span></span> pret_dag prebdt_pret no_in_pret   
              <span class="keyword1"><span class="command">have</span></span> lownoNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">no</span> <span class="main">=</span> Null"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> balanced_bdt<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">with</span></span> repshare <span class="keyword1"><span class="command">have</span></span> repcnoinlln<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="skolem">no</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">with</span></span> wf_ll  nsll <span class="keyword1"><span class="command">have</span></span> varrno_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ll_def length_ll_eq<span class="main">)</span>
              <span class="keyword1"><span class="command">with</span></span> varno <span class="keyword1"><span class="command">have</span></span> varrep<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?varrep</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">from</span></span> wf_ll  nsll no_in_llbn varrno_n 
              <span class="keyword1"><span class="command">have</span></span> varrno_varno<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">var</span> <span class="skolem">no</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ll_def length_ll_eq<span class="main">)</span>
              <span class="keyword1"><span class="command">from</span></span> wf_ll  nsll repcnoinlln 
              <span class="keyword1"><span class="command">have</span></span> rno_in_pret<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="skolem">no</span> <span class="main">∈</span> set_of <span class="skolem">pret</span>"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ll_def length_ll_eq<span class="main">)</span>
              <span class="keyword1"><span class="command">from</span></span> repcnoinlln repshare lownoNull 
              <span class="keyword1"><span class="command">have</span></span> reprep_eq_rep<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="skolem">no</span>"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">with</span></span> repcnoinlln repshare lownoNull 
              <span class="keyword1"><span class="command">have</span></span> repchildreneq<span class="main">:</span> 
                <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span> 
                <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">have</span></span> repcn_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?repcn_prop</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>         
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>Node Tip <span class="skolem">no</span> Tip<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>Node Tip <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span> Tip<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 3
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 3
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command">from</span></span> pret_dag pnN rno_in_pret <span class="keyword1"><span class="command">have</span></span> rnonN<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="skolem">no</span> <span class="main">≠</span> Null"</span></span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="skolem">no</span> <span class="main">=</span> Null"</span></span><span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                <span class="keyword1"><span class="command">from</span></span> highnoNull repchildreneq 
                <span class="keyword1"><span class="command">have</span></span> rhighNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> Null"</span></span> 
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
                <span class="keyword1"><span class="command">from</span></span> lownoNull repchildreneq 
                <span class="keyword1"><span class="command">have</span></span> rlowNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> Null"</span></span> 
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
                <span class="keyword1"><span class="command">with</span></span> rhighNull rnonN   
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="skolem">no</span> <span class="main">≠</span> Null <span class="main">∧</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> Null <span class="main">∧</span> 
                  <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> Null"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">next</span></span>
                <span class="keyword1"><span class="command">from</span></span> nonNull lownoNull highnoNull   
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?not_dag</span> <span class="main">(</span>Node Tip <span class="skolem">no</span> Tip<span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">next</span></span>
                <span class="keyword1"><span class="command">from</span></span> no_in_Nodes 
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set_of <span class="main">(</span>Node Tip <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span> Tip<span class="main">)</span> <span class="main">⊆</span>  <span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">ll</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">next</span></span>
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set_of <span class="main">(</span>Node Tip <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span> Tip<span class="main">)</span><span class="main">.</span> <span class="skolem">repc</span> <span class="bound">no</span> <span class="main">=</span> <span class="bound">no</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span> 
                  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">pt</span>
                  <span class="keyword3"><span class="command">assume</span></span> pt_in_repcLeaf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">pt</span> <span class="main">∈</span> set_of <span class="main">(</span>Node Tip <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span> Tip<span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">with</span></span> reprep_eq_rep <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="skolem">pt</span> <span class="main">=</span> <span class="skolem">pt</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">next</span></span>
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?bdt_equ</span> <span class="main">(</span>Node Tip <span class="skolem">no</span> Tip<span class="main">)</span> <span class="main">(</span>Node Tip <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span> Tip<span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
                  <span class="keyword3"><span class="command">case</span></span> True 
                  <span class="keyword1"><span class="command">note</span></span> vno_Null<span class="main">=</span>this
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> nobdt<span class="main">:</span> <span class="quoted"><span class="quoted">"bdt <span class="main">(</span>Node Tip <span class="skolem">no</span> Tip<span class="main">)</span> <span class="skolem">var</span> <span class="main">=</span> Some Zero"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">from</span></span> varrep  vno_Null <span class="keyword1"><span class="command">have</span></span> varrno<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> norbdt<span class="main">:</span> <span class="quoted"><span class="quoted">"bdt <span class="main">(</span>Node Tip <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span> Tip<span class="main">)</span> <span class="skolem">var</span> <span class="main">=</span> Some Zero"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">from</span></span> nobdt norbdt vno_Null varrno <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cong_eval_def<span class="main">)</span>
                <span class="keyword1"><span class="command">next</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> vno_not_Null<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">no</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
                  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main">)</span>
                    <span class="keyword3"><span class="command">case</span></span> True
                    <span class="keyword1"><span class="command">note</span></span> vno_One<span class="main">=</span>this
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> nobdt<span class="main">:</span> <span class="quoted"><span class="quoted">"bdt <span class="main">(</span>Node Tip <span class="skolem">no</span> Tip<span class="main">)</span> <span class="skolem">var</span> <span class="main">=</span> Some One"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">from</span></span> varrno_varno vno_One 
                    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bdt <span class="main">(</span>Node Tip <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span> Tip<span class="main">)</span> <span class="skolem">var</span> <span class="main">=</span> Some One"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                    <span class="keyword1"><span class="command">with</span></span> nobdt <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cong_eval_def<span class="main">)</span>
                  <span class="keyword1"><span class="command">next</span></span>
                    <span class="keyword3"><span class="command">assume</span></span> vno_nOne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">no</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
                    <span class="keyword1"><span class="command">with</span></span> vno_not_Null <span class="keyword1"><span class="command">have</span></span> onesvno<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">no</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">from</span></span> nonNull lownoNull highnoNull   
                    <span class="keyword1"><span class="command">have</span></span> no_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="main">(</span>Node Tip <span class="skolem">no</span> Tip<span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                    <span class="keyword1"><span class="command">with</span></span> pret_dag no_in_pret <span class="keyword1"><span class="command">have</span></span> not_in_pret<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Node Tip <span class="skolem">no</span> Tip<span class="main">)</span> <span class="main">≤</span> <span class="skolem">pret</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> set_of_subdag<span class="main">)</span>
                    <span class="keyword1"><span class="command">with</span></span> prebdt_pret <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">bdt2</span><span class="main">.</span> bdt <span class="main">(</span>Node Tip <span class="skolem">no</span> Tip<span class="main">)</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="bound">bdt2</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subbdt_ex<span class="main">)</span>
                    <span class="keyword1"><span class="command">with</span></span> onesvno <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">with</span></span> varrep reprep_eq_rep <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">assume</span></span> hno_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">no</span> <span class="main">≠</span> Null"</span></span>
              <span class="keyword1"><span class="command">with</span></span> pret_dag prebdt_pret no_in_pret   <span class="keyword1"><span class="command">have</span></span> lno_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">no</span> <span class="main">≠</span> Null"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> balanced_bdt<span class="main">)</span>
                  <span class="comment1">(*-------------------normalize_prop fuer (high no)------------------------*)</span>
              
              <span class="keyword1"><span class="command">from</span></span> no_in_pret nonNull hno_nNull pret_dag  
              <span class="keyword1"><span class="command">have</span></span> hno_in_pret<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">no</span> <span class="main">∈</span> set_of <span class="skolem">pret</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subelem_set_of_high<span class="main">)</span>
              <span class="keyword1"><span class="command">with</span></span> wf_ll 
              <span class="keyword1"><span class="command">have</span></span> hno_in_ll<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">no</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">var</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ll_def<span class="main">)</span>
              <span class="keyword1"><span class="command">from</span></span> pret_dag ord_pret  no_in_pret lno_nNull hno_nNull 
              
              <span class="keyword1"><span class="command">have</span></span> varhnos_varno<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">no</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> var_ordered_children<span class="main">)</span>
              <span class="keyword1"><span class="command">with</span></span> varno <span class="keyword1"><span class="command">have</span></span> varhnos_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">with</span></span> hno_in_ll <span class="keyword1"><span class="command">have</span></span> hno_in_Nodesn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">no</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nodes_def<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">from</span></span> wf_ll nsll hno_in_ll   varhnos_n 
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> no_in_one_ll<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_ll_eq<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">with</span></span> repbc_nc <span class="keyword1"><span class="command">have</span></span> repb_repc_high<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">with</span></span> normalize_prop hno_in_Nodesn varhnos_varno varno 
              <span class="keyword1"><span class="command">have</span></span> high_normalize<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">var</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">∧</span>
                <span class="main">(</span><span class="main">∃</span><span class="bound">not</span> <span class="bound">nort</span><span class="main">.</span> Dag <span class="main">(</span><span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">nort</span> <span class="main">∧</span>
                Dag <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="bound">not</span> <span class="main">∧</span> reduced <span class="bound">nort</span> <span class="main">∧</span>
                ordered <span class="bound">nort</span> <span class="skolem">var</span> <span class="main">∧</span> set_of <span class="bound">nort</span> <span class="main">⊆</span> <span class="skolem">repb</span> <span class="main">`</span><span class="main">(</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">∧</span>
                <span class="main">(</span><span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set_of <span class="bound">nort</span><span class="main">.</span> <span class="skolem">repb</span> <span class="bound">no</span> <span class="main">=</span> <span class="bound">no</span><span class="main">)</span> <span class="main">∧</span>
                <span class="main">(</span><span class="main">∃</span><span class="bound">nobdt</span> <span class="bound">norbdt</span><span class="main">.</span> bdt <span class="bound">not</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="bound">nobdt</span> <span class="main">∧</span> bdt <span class="bound">nort</span> <span class="skolem">var</span> <span class="main">=</span> 
                Some <span class="bound">norbdt</span> <span class="main">∧</span> <span class="bound">nobdt</span> <span class="main">∼</span> <span class="bound">norbdt</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?varrep_high</span> <span class="main">∧</span> 
                  <span class="main">(</span><span class="main">∃</span><span class="bound">not</span> <span class="bound">nort</span><span class="main">.</span> <span class="var">?repbchigh_dag</span> <span class="bound">nort</span> <span class="main">∧</span> <span class="var">?high_dag</span> <span class="bound">not</span> <span class="main">∧</span> 
                  <span class="var">?redhigh</span> <span class="bound">nort</span> <span class="main">∧</span> <span class="var">?ordhigh</span> <span class="bound">nort</span> <span class="main">∧</span> <span class="var">?rephigh_in_Nodes</span> <span class="bound">nort</span> <span class="main">∧</span> 
                  <span class="var">?repbno_no</span> <span class="bound">nort</span> <span class="main">∧</span> <span class="var">?highdd_prop</span> <span class="bound">not</span> <span class="bound">nort</span><span class="main">)</span>"</span></span>
                  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?varrep_high</span> <span class="main">∧</span> <span class="var">?not_nort_prop</span>"</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">no</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Dag_Ref<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> varrep_high<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?varrep_high</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">from</span></span> varhnos_n varrep_high <span class="keyword1"><span class="command">have</span></span> varrephno_s_n<span class="main">:</span> 
                <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">from</span></span> Nodes_subset 
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Nodes <span class="skolem">n</span> <span class="skolem">ll</span> <span class="main">⊆</span> Nodes <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ll</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">with</span></span> hno_in_Nodesn repcNodes_in_Nodes 
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">∈</span> Nodes <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ll</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">with</span></span> wf_ll nsll  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">∈</span> set_of <span class="skolem">pret</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ll_def Nodes_def length_ll_eq<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> conjE exE<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">∈</span> set_of <span class="skolem">pret</span> <span class="main">⟶</span> <span class="bound">q</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">var</span> <span class="bound">q</span><span class="main">)</span>"</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">with</span></span> wf_ll varrephno_s_n 
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound"><span class="bound">k</span></span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> <span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ll_def<span class="main">)</span>
              <span class="keyword1"><span class="command">with</span></span> wf_ll nsll  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> i<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">k</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> j<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> no_in_one_ll<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_ll_eq<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">with</span></span> repbc_nc 
              <span class="keyword1"><span class="command">have</span></span> repbchigh_idem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">from</span></span> high_normalize 
              <span class="keyword1"><span class="command">have</span></span> not_nort_prop_high<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?not_nort_prop</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Dag_Ref<span class="main">)</span>
              <span class="keyword1"><span class="command">from</span></span> not_nort_prop_high <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">hnot</span></span> <span class="keyword2"><span class="keyword">where</span></span> high_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?high_dag</span> <span class="skolem">hnot</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">from</span></span> wf_ll nsll  
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">.</span> <span class="bound">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nodes_def length_ll_eq<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> no_in_one_ll<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">with</span></span> repbc_nc  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">.</span> <span class="skolem">repb</span> <span class="bound">no</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="bound">no</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">no</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">then</span></span> 
              <span class="keyword1"><span class="command">have</span></span> repbNodes_repcNodes<span class="main">:</span> 
                <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="main">`</span><span class="main">(</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="main">`</span><span class="main">(</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> imageE<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">xa</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> repcNodes_repbNodes<span class="main">:</span> 
                <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">`</span><span class="main">(</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repb</span> <span class="main">`</span><span class="main">(</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">from</span></span> pret_dag nsll  wf_ll 
              <span class="keyword1"><span class="command">have</span></span> null_notin_Nodesn<span class="main">:</span> <span class="quoted"><span class="quoted">"Null <span class="main">∉</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Null_notin_Nodes<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_ll_eq<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">from</span></span> hno_in_Nodesn <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">repc</span> <span class="main">`</span><span class="main">(</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">with</span></span> repbNodes_in_Nodes repcNodes_repbNodes 
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">with</span></span> null_notin_Nodesn <span class="keyword1"><span class="command">have</span></span> rhn_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">≠</span> Null"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

                  <span class="comment1">(*-------------------normalize_prop fuer (low no)--------------------------*)</span>

              <span class="keyword1"><span class="command">from</span></span> no_in_pret nonNull lno_nNull pret_dag  
              <span class="keyword1"><span class="command">have</span></span> lno_in_pret<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">no</span> <span class="main">∈</span> set_of <span class="skolem">pret</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subelem_set_of_low<span class="main">)</span>
              <span class="keyword1"><span class="command">with</span></span> wf_ll 
              <span class="keyword1"><span class="command">have</span></span> lno_in_ll<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">no</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">var</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ll_def<span class="main">)</span>
              <span class="keyword1"><span class="command">from</span></span> pret_dag ord_pret  no_in_pret lno_nNull hno_nNull  
              <span class="keyword1"><span class="command">have</span></span> varlnos_varno<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">no</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> var_ordered_children<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">with</span></span> varno <span class="keyword1"><span class="command">have</span></span> varlnos_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">with</span></span> lno_in_ll <span class="keyword1"><span class="command">have</span></span> lno_in_Nodesn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">no</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nodes_def<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">from</span></span> varlnos_n wf_ll nsll lno_in_ll   
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> no_in_one_ll<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_ll_eq<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">with</span></span> repbc_nc <span class="keyword1"><span class="command">have</span></span> repb_repc_low<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">with</span></span> normalize_prop lno_in_Nodesn varlnos_varno varno 
              <span class="keyword1"><span class="command">have</span></span> low_normalize<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">var</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">∧</span>
                <span class="main">(</span><span class="main">∃</span><span class="bound">not</span> <span class="bound">nort</span><span class="main">.</span> Dag <span class="main">(</span><span class="skolem">repc</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">nort</span> <span class="main">∧</span>
                Dag <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="bound">not</span> <span class="main">∧</span> reduced <span class="bound">nort</span> <span class="main">∧</span> ordered <span class="bound">nort</span> <span class="skolem">var</span> <span class="main">∧</span>
                set_of <span class="bound">nort</span> <span class="main">⊆</span> <span class="skolem">repb</span> <span class="main">`</span><span class="main">(</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">∧</span>
                <span class="main">(</span><span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set_of <span class="bound">nort</span><span class="main">.</span> <span class="skolem">repb</span> <span class="bound">no</span> <span class="main">=</span> <span class="bound">no</span><span class="main">)</span> <span class="main">∧</span>
                <span class="main">(</span><span class="main">∃</span><span class="bound">nobdt</span> <span class="bound">norbdt</span><span class="main">.</span> bdt <span class="bound">not</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="bound">nobdt</span> <span class="main">∧</span> bdt <span class="bound">nort</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="bound">norbdt</span> <span class="main">∧</span> 
                <span class="bound">nobdt</span> <span class="main">∼</span> <span class="bound">norbdt</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?varrep_low</span> <span class="main">∧</span> 
                  <span class="main">(</span><span class="main">∃</span><span class="bound">not</span> <span class="bound">nort</span><span class="main">.</span> <span class="var">?repbclow_dag</span> <span class="bound">nort</span> <span class="main">∧</span> <span class="var">?low_dag</span> <span class="bound">not</span> <span class="main">∧</span> <span class="var">?redhigh</span> <span class="bound">nort</span> <span class="main">∧</span> 
                  <span class="var">?ordhigh</span> <span class="bound">nort</span> <span class="main">∧</span> <span class="var">?replow_in_Nodes</span> <span class="bound">nort</span>  <span class="main">∧</span> <span class="var">?low_repno_no</span> <span class="bound">nort</span> 
                  <span class="main">∧</span> <span class="var">?lowdd_prop</span> <span class="bound">not</span> <span class="bound">nort</span><span class="main">)</span>"</span></span>
                  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?varrep_low</span> <span class="main">∧</span> <span class="var">?not_nort_prop_low</span>"</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">no</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Dag_Ref<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> varrep_low<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?varrep_low</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">from</span></span> low_normalize <span class="keyword1"><span class="command">have</span></span> not_nort_prop_low<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?not_nort_prop_low</span>"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Dag_Ref<span class="main">)</span>
              <span class="keyword1"><span class="command">from</span></span> lno_in_Nodesn <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">repc</span> <span class="main">`</span><span class="main">(</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">with</span></span> repbNodes_in_Nodes repcNodes_repbNodes 
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">with</span></span> null_notin_Nodesn <span class="keyword1"><span class="command">have</span></span> rln_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">≠</span> Null"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

              
              <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span>"</span></span><span class="main">)</span>
                <span class="keyword3"><span class="command">case</span></span> True
                <span class="keyword1"><span class="command">note</span></span> red_case<span class="main">=</span>this
                <span class="keyword1"><span class="command">with</span></span> repreduce lno_nNull hno_nNull 
                <span class="keyword1"><span class="command">have</span></span> rno_eq_hrno<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span>"</span></span> 
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
                <span class="keyword1"><span class="command">from</span></span> varhnos_varno rno_eq_hrno varrep_high <span class="keyword1"><span class="command">have</span></span> varrep<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?varrep</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">from</span></span> not_nort_prop_high not_nort_prop_low <span class="keyword1"><span class="command">have</span></span> repcn_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?repcn_prop</span>"</span></span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> exE<span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> rnot lnot rnort lnort <span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>Node <span class="improper">lnot</span> <span class="skolem">no</span> <span class="improper">rnot</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">rnort</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> conjE<span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 7
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> exE<span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> rnot lnot rnort lnort rnobdt lnobdt rnorbdt lnorbdt<span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> conjE<span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span>  <span class="quoted"><span class="quoted">"Suc <span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">no</span>"</span></span><span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>Bdt_Node <span class="improper">lnobdt</span> <span class="main">(</span><span class="skolem">var</span> <span class="skolem">no</span><span class="main">)</span> <span class="improper">rnobdt</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">rnorbdt</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">rnot</span> <span class="skolem">lnot</span> <span class="skolem">rnort</span> <span class="skolem">lnort</span>
                  <span class="keyword3"><span class="command">assume</span></span> highnort_dag<span class="main">:</span> 
                    <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">rnort</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> ord_nort<span class="main">:</span> <span class="quoted"><span class="quoted">" ordered <span class="skolem">rnort</span> <span class="skolem">var</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> rnort_in_repNodes<span class="main">:</span> <span class="quoted"><span class="quoted">" set_of <span class="skolem">rnort</span> <span class="main">⊆</span>  <span class="skolem">repb</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                  <span class="keyword1"><span class="command">from</span></span> rnort_in_repNodes repbNodes_in_Nodes 
                  <span class="keyword1"><span class="command">have</span></span> nort_in_Nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">rnort</span> <span class="main">⊆</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                  <span class="keyword1"><span class="command">from</span></span> varhnos_n varrep_high 
                  <span class="keyword1"><span class="command">have</span></span> vrhnos_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">from</span></span> rhn_nNull highnort_dag 
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">lno</span> <span class="bound">rno</span><span class="main">.</span> <span class="skolem">rnort</span> <span class="main">=</span> Node <span class="bound">lno</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span><span class="main">)</span> <span class="bound">rno</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                  <span class="keyword1"><span class="command">with</span></span> highnort_dag rhn_nNull <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"root <span class="skolem">rnort</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">with</span></span> ord_nort <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set_of <span class="skolem">rnort</span><span class="main">.</span> <span class="skolem">var</span> <span class="bound">x</span> <span class="main">&lt;=</span> <span class="skolem">var</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> ordered_set_of<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                  <span class="keyword1"><span class="command">with</span></span> vrhnos_n <span class="keyword1"><span class="command">have</span></span> vxsn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set_of <span class="skolem">rnort</span><span class="main">.</span> <span class="skolem">var</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> 
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                  <span class="keyword1"><span class="command">from</span></span> nort_in_Nodes <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set_of <span class="skolem">rnort</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span> 
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">with</span></span> wf_ll nsll  
                  <span class="keyword1"><span class="command">have</span></span> x_in_pret<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set_of <span class="skolem">rnort</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set_of <span class="skolem">pret</span>"</span></span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> wf_ll_Nodes_pret<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_ll_eq<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                  <span class="keyword1"><span class="command">from</span></span> vxsn x_in_pret 
                  <span class="keyword1"><span class="command">have</span></span> vxsn_in_nort<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set_of <span class="skolem">rnort</span><span class="main">.</span> <span class="skolem">var</span> <span class="bound">x</span> <span class="main">&lt;</span><span class="skolem">n</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∈</span> set_of <span class="skolem">pret</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">with</span></span> pret_dag prebdt_pret highnort_dag ord_pret wf_ll  nsll 
                    repbc_nc 
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set_of <span class="skolem">rnort</span><span class="main">.</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">x</span> <span class="main">∧</span> 
                    <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">x</span>"</span></span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> nort_null_comp<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_ll_eq<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                  <span class="keyword1"><span class="command">with</span></span> rno_eq_hrno 
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">rnort</span> <span class="main">=</span> 
                    Dag <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">rnort</span>"</span></span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> heaps_eq_Dag_eq<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                  <span class="keyword1"><span class="command">with</span></span> highnort_dag rno_eq_hrno 
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">rnort</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">next</span></span>
                  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">rnot</span> <span class="skolem">lnot</span> <span class="skolem">rnort</span> <span class="skolem">lnort</span>
                  <span class="keyword3"><span class="command">assume</span></span> lnot_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">lnot</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> rnot_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">rnot</span>"</span></span>
                  <span class="keyword1"><span class="command">with</span></span> lnot_dag   nonNull 
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Dag <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="main">(</span>Node <span class="skolem">lnot</span> <span class="skolem">no</span> <span class="skolem">rnot</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">next</span></span>
                  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">rnot</span> <span class="skolem">lnot</span> <span class="skolem">rnort</span> <span class="skolem">lnort</span>
                  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">" reduced <span class="skolem">rnort</span>"</span></span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"reduced <span class="skolem">rnort</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">next</span></span>
                  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">rnort</span>
                  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ordered <span class="skolem">rnort</span> <span class="skolem">var</span>"</span></span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ordered <span class="skolem">rnort</span> <span class="skolem">var</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">next</span></span>
                  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">rnort</span>
                  <span class="keyword3"><span class="command">assume</span></span> rnort_in_Nodes<span class="main">:</span> <span class="quoted"><span class="quoted">" set_of <span class="skolem">rnort</span> <span class="main">⊆</span> <span class="skolem">repb</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Nodes <span class="skolem">n</span> <span class="skolem">ll</span> <span class="main">⊆</span> Nodes <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">ll</span>"</span></span> 
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nodes_def set_split<span class="main">)</span> 
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span> <span class="main">⊆</span> <span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">ll</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                  <span class="keyword1"><span class="command">with</span></span> rnort_in_Nodes repbNodes_repcNodes 
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" set_of <span class="skolem">rnort</span> <span class="main">⊆</span> <span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">ll</span>"</span></span> 
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nodes_def<span class="main">)</span>
                <span class="keyword1"><span class="command">next</span></span>
                  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">rnort</span> <span class="skolem">rnorbdt</span>
                  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">" bdt <span class="skolem">rnort</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="skolem">rnorbdt</span>"</span></span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" bdt <span class="skolem">rnort</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="skolem">rnorbdt</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">next</span></span>
                  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">rnot</span> <span class="skolem">lnot</span> <span class="skolem">rnort</span> <span class="skolem">lnort</span> <span class="skolem">rnobdt</span> <span class="skolem">lnobdt</span> <span class="skolem">rnorbdt</span> <span class="skolem">lnorbdt</span>
                  <span class="keyword3"><span class="command">assume</span></span> rcongeval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rnobdt</span> <span class="main">∼</span> <span class="skolem">rnorbdt</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> lnort_dag<span class="main">:</span> 
                    <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repc</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">lnort</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> rnort_dag<span class="main">:</span> 
                    <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">rnort</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> lnorbdt_def<span class="main">:</span> <span class="quoted"><span class="quoted">" bdt <span class="skolem">lnort</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="skolem">lnorbdt</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> rnorbdt_def<span class="main">:</span> <span class="quoted"><span class="quoted">" bdt <span class="skolem">rnort</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="skolem">rnorbdt</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> lcongeval<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">lnobdt</span> <span class="main">∼</span> <span class="skolem">lnorbdt</span>"</span></span>
                  <span class="keyword1"><span class="command">from</span></span> red_case lnort_dag rnort_dag 
                  <span class="keyword1"><span class="command">have</span></span> lnort_rnort<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lnort</span> <span class="main">=</span> <span class="skolem">rnort</span>"</span></span> 
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Dag_unique <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Dag_Ref<span class="main">)</span>
                  <span class="keyword1"><span class="command">with</span></span> lnorbdt_def lcongeval rnorbdt_def 
                  <span class="keyword1"><span class="command">have</span></span> lnobdt_rnorbdt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lnobdt</span> <span class="main">∼</span> <span class="skolem">rnorbdt</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">with</span></span> rcongeval <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lnobdt</span> <span class="main">∼</span> <span class="skolem">rnobdt</span>"</span></span> 
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cong_eval_trans<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cong_eval_sym<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" Bdt_Node <span class="skolem">lnobdt</span> <span class="main">(</span><span class="skolem">var</span> <span class="skolem">no</span><span class="main">)</span> <span class="skolem">rnobdt</span> <span class="main">∼</span> <span class="skolem">rnobdt</span>"</span></span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cong_eval_sym <span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cong_eval_child_high<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                  <span class="keyword1"><span class="command">with</span></span> rcongeval <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Bdt_Node <span class="skolem">lnobdt</span> <span class="main">(</span><span class="skolem">var</span> <span class="skolem">no</span><span class="main">)</span> <span class="skolem">rnobdt</span> <span class="main">∼</span> <span class="skolem">rnorbdt</span>"</span></span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rotate_tac</span> 1<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cong_eval_trans<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                <span class="keyword1"><span class="command">next</span></span>
                  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">lnot</span> <span class="skolem">rnot</span> <span class="skolem">lnobdt</span> <span class="skolem">rnobdt</span>
                  <span class="keyword3"><span class="command">assume</span></span> lnot_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">lnot</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> rnot_dag<span class="main">:</span> <span class="quoted"><span class="quoted">" Dag <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">rnot</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> lnobdt_def<span class="main">:</span> <span class="quoted"><span class="quoted">" bdt <span class="skolem">lnot</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="skolem">lnobdt</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> rnobdt_def<span class="main">:</span> <span class="quoted"><span class="quoted">" bdt <span class="skolem">rnot</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="skolem">rnobdt</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> onesvarno<span class="main">:</span> <span class="quoted"><span class="quoted">" Suc <span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">no</span>"</span></span>
                  <span class="keyword1"><span class="command">with</span></span> rnobdt_def lnot_dag rnot_dag lnobdt_def 
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bdt <span class="main">(</span>Node <span class="skolem">lnot</span> <span class="skolem">no</span> <span class="skolem">rnot</span><span class="main">)</span> <span class="skolem">var</span> <span class="main">=</span> 
                    Some <span class="main">(</span>Bdt_Node <span class="skolem">lnobdt</span> <span class="main">(</span><span class="skolem">var</span> <span class="skolem">no</span><span class="main">)</span> <span class="skolem">rnobdt</span><span class="main">)</span>"</span></span> 
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">next</span></span>
                  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">rnot</span> <span class="skolem">lnot</span> <span class="skolem">rnort</span> <span class="skolem">lnort</span> <span class="skolem">rnobdt</span> <span class="skolem">lnobdt</span> <span class="skolem">rnorbdt</span> <span class="skolem">lnorbdt</span>
                  <span class="keyword3"><span class="command">assume</span></span> lnobdt_def<span class="main">:</span> <span class="quoted"><span class="quoted">" bdt <span class="skolem">lnot</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="skolem">lnobdt</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> rnobdt_def<span class="main">:</span> <span class="quoted"><span class="quoted">" bdt <span class="skolem">rnot</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="skolem">rnobdt</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> rnorbdt_def<span class="main">:</span> <span class="quoted"><span class="quoted">" bdt <span class="skolem">rnort</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="skolem">rnorbdt</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> cong_rno_rnor<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">rnobdt</span> <span class="main">∼</span> <span class="skolem">rnorbdt</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> lnot_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">lnot</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> rnot_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">rnot</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Suc <span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">no</span>"</span></span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> varnoseq1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">var</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">nobdt</span><span class="main">.</span> bdt <span class="main">(</span>Node <span class="skolem">lnot</span> <span class="skolem">no</span> <span class="skolem">rnot</span><span class="main">)</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="bound">nobdt</span> <span class="main">∧</span> 
                    <span class="main">(</span><span class="main">∃</span><span class="bound">norbdt</span><span class="main">.</span> bdt <span class="skolem">rnort</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="bound">norbdt</span> <span class="main">∧</span> <span class="bound">nobdt</span> <span class="main">∼</span> <span class="bound">norbdt</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
                    <span class="keyword3"><span class="command">case</span></span> True
                    <span class="keyword1"><span class="command">note</span></span> vnoNull<span class="main">=</span>this
                    <span class="keyword1"><span class="command">with</span></span> pret_dag ord_pret no_in_pret lno_nNull hno_nNull  
                    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> var_ordered_children<span class="main">)</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                  <span class="keyword1"><span class="command">next</span></span>
                    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">no</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
                    <span class="keyword1"><span class="command">with</span></span> varnoseq1 <span class="keyword1"><span class="command">have</span></span> vnoOne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">from</span></span> pret_dag  ord_pret no_in_pret lno_nNull hno_nNull  
                      vnoOne 
                    <span class="keyword1"><span class="command">have</span></span> vlvrNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="skolem">var</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> var_ordered_children<span class="main">)</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> vlNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">from</span></span> vlvrNull <span class="keyword1"><span class="command">have</span></span> vrNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">from</span></span> lnobdt_def lnot_dag vlNull  lno_nNull 
                    <span class="keyword1"><span class="command">have</span></span> lnobdt_Zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lnobdt</span> <span class="main">=</span> Zero"</span></span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> bdt_Some_var0_Zero<span class="main">)</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                    <span class="keyword1"><span class="command">from</span></span> rnobdt_def rnot_dag vrNull  hno_nNull 
                    <span class="keyword1"><span class="command">have</span></span> rnobdt_Zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rnobdt</span> <span class="main">=</span> Zero"</span></span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> bdt_Some_var0_Zero<span class="main">)</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                    <span class="keyword1"><span class="command">from</span></span> lnobdt_Zero lnobdt_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bdt <span class="skolem">lnot</span> <span class="skolem">var</span> <span class="main">=</span> Some Zero"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">with</span></span> lnot_dag vlNull  
                    <span class="keyword1"><span class="command">have</span></span> lnot_Node<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lnot</span> <span class="main">=</span> <span class="main">(</span>Node Tip <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> Tip<span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">from</span></span> rnobdt_Zero rnobdt_def rnot_dag vrNull  
                    <span class="keyword1"><span class="command">have</span></span> rnot_Node<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rnot</span> <span class="main">=</span> <span class="main">(</span>Node Tip <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span> Tip<span class="main">)</span>"</span></span> 
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">from</span></span> pret_dag no_in_pret <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">not</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
                      not_ex<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">not</span>"</span></span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> dag_setof_exD<span class="main">)</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                    <span class="keyword1"><span class="command">with</span></span> pret_dag no_in_pret <span class="keyword1"><span class="command">have</span></span> not_ex_in_pret<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">not</span> <span class="main">&lt;=</span> <span class="skolem">pret</span>"</span></span> 
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_of_subdag<span class="main">)</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                    <span class="keyword1"><span class="command">from</span></span> not_ex lnot_dag rnot_dag   nonNull 
                    <span class="keyword1"><span class="command">have</span></span> not_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">not</span> <span class="main">=</span> <span class="main">(</span>Node <span class="skolem">lnot</span> <span class="skolem">no</span> <span class="skolem">rnot</span><span class="main">)</span>"</span></span> 
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Dag_unique <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Dag_Ref<span class="main">)</span>
                    <span class="keyword1"><span class="command">with</span></span> not_ex_in_pret prebdt_pret 
                    <span class="keyword1"><span class="command">have</span></span> nobdt_ex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">nobdt</span><span class="main">.</span> bdt <span class="main">(</span>Node <span class="skolem">lnot</span> <span class="skolem">no</span> <span class="skolem">rnot</span><span class="main">)</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="bound">nobdt</span>"</span></span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subbdt_ex<span class="main">)</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nobdt</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
                      nobdt_def<span class="main">:</span> <span class="quoted"><span class="quoted">"bdt <span class="main">(</span>Node <span class="skolem">lnot</span> <span class="skolem">no</span> <span class="skolem">rnot</span><span class="main">)</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="skolem">nobdt</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">from</span></span> not_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"root <span class="skolem">not</span> <span class="main">=</span> <span class="skolem">no</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">with</span></span> nobdt_def vnoOne not_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">not</span> <span class="main">=</span> <span class="main">(</span>Node Tip <span class="skolem">no</span> Tip<span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> bdt_Some_var1_One<span class="main">)</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                    <span class="keyword1"><span class="command">with</span></span> not_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rnot</span> <span class="main">=</span> Tip"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">with</span></span> rnot_Node <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">next</span></span>
                  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">rnot</span> <span class="skolem">lnot</span> <span class="skolem">rnort</span> <span class="skolem">lnort</span>
                  <span class="keyword3"><span class="command">assume</span></span> rnort_in_repb_Nodesn<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">rnort</span> <span class="main">⊆</span> <span class="skolem">repb</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> rnort_repb_no<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set_of <span class="skolem">rnort</span><span class="main">.</span> <span class="skolem">repb</span> <span class="bound">no</span> <span class="main">=</span> <span class="bound">no</span>"</span></span>
                  <span class="keyword1"><span class="command">from</span></span> repbNodes_in_Nodes rnort_in_repb_Nodesn 
                  <span class="keyword1"><span class="command">have</span></span> rnort_in_Nodesn<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">rnort</span> <span class="main">⊆</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set_of <span class="skolem">rnort</span><span class="main">.</span> <span class="skolem">repc</span> <span class="bound">no</span> <span class="main">=</span> <span class="bound">no</span>"</span></span>
                  <span class="keyword1"><span class="command">proof</span></span>
                    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">pt</span>
                    <span class="keyword3"><span class="command">assume</span></span> pt_in_rnort<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">pt</span> <span class="main">∈</span> set_of <span class="skolem">rnort</span>"</span></span>
                    <span class="keyword1"><span class="command">with</span></span> rnort_in_Nodesn <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pt</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span> 
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                    <span class="keyword1"><span class="command">with</span></span> Nodesn_notin_lln <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pt</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">with</span></span> repbc_nc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">pt</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="skolem">pt</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">with</span></span> rnort_repb_no pt_in_rnort <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="skolem">pt</span> <span class="main">=</span> <span class="skolem">pt</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">with</span></span> varrep <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">next</span></span>
                <span class="keyword3"><span class="command">assume</span></span> share_case_cond<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">with</span></span> lno_nNull hno_nNull 
                <span class="keyword1"><span class="command">have</span></span> share_case_cond_propto<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">≠</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
                <span class="keyword1"><span class="command">with</span></span> repshare <span class="keyword3"><span class="command">obtain</span></span> 
                  rno_in_llbn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="skolem">no</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
                  rrno_eq_rno<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="skolem">no</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
                  twonodes_in_llbn_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">no1</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span><span class="main">.</span> 
                  <span class="main">(</span><span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span> 
                  <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="bound">no1</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">from</span></span> wf_ll rno_in_llbn  nsll 
                <span class="keyword1"><span class="command">have</span></span> varrepno_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> 
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ll_def length_ll_eq<span class="main">)</span>
                <span class="keyword1"><span class="command">with</span></span> varno <span class="keyword1"><span class="command">have</span></span> varrep<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?varrep</span>"</span></span> 
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">from</span></span> not_nort_prop_high not_nort_prop_low <span class="keyword1"><span class="command">have</span></span> repcn_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?repcn_prop</span>"</span></span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="operator">-</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> exE<span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> rnot lnot rnort lnort<span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Node <span class="improper">lnot</span> <span class="skolem">no</span> <span class="improper">rnot</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Node <span class="improper">lnort</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span> <span class="improper">rnort</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> conjE<span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 7
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> exE<span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> rnot lnot rnort lnort rnobdt lnobdt rnorbdt lnorbdt<span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> conjE<span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span>  <span class="quoted"><span class="quoted">"Suc <span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">no</span>"</span></span><span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>Bdt_Node <span class="improper">lnobdt</span> <span class="main">(</span><span class="skolem">var</span> <span class="skolem">no</span><span class="main">)</span> <span class="improper">rnobdt</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>Bdt_Node <span class="improper">lnorbdt</span> <span class="main">(</span><span class="skolem">var</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span><span class="main">)</span> <span class="improper">rnorbdt</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">rnot</span> <span class="skolem">lnot</span> <span class="skolem">rnort</span> <span class="skolem">lnort</span>
                  <span class="keyword3"><span class="command">assume</span></span> rnort_dag<span class="main">:</span> 
                    <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">rnort</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> lnort_dag<span class="main">:</span> 
                    <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repc</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">lnort</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> rnort_in_repNodes<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">rnort</span> <span class="main">⊆</span> <span class="skolem">repb</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> lnort_in_repNodes<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">lnort</span> <span class="main">⊆</span> <span class="skolem">repb</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                  <span class="keyword1"><span class="command">from</span></span> rnort_in_repNodes repbNodes_in_Nodes 
                  <span class="keyword1"><span class="command">have</span></span> rnort_in_Nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">rnort</span> <span class="main">⊆</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">from</span></span> lnort_in_repNodes repbNodes_in_Nodes 
                  <span class="keyword1"><span class="command">have</span></span> lnort_in_Nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">lnort</span> <span class="main">⊆</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">from</span></span> rnort_in_Nodes 
                  <span class="keyword1"><span class="command">have</span></span> rnortx_in_Nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> set_of <span class="skolem">rnort</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                  <span class="keyword1"><span class="command">with</span></span> wf_ll nsll  
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> set_of <span class="skolem">rnort</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set_of <span class="skolem">pret</span> <span class="main">∧</span> <span class="skolem">var</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> wf_ll_Nodes_pret<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_ll_eq<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                  <span class="keyword1"><span class="command">with</span></span> pret_dag prebdt_pret rnort_dag ord_pret wf_ll  nsll 
                    repbc_nc 
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set_of <span class="skolem">rnort</span><span class="main">.</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">x</span> <span class="main">∧</span> 
                    <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">x</span>"</span></span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> nort_null_comp<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_ll_eq<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">rnort</span> <span class="main">=</span> 
                    Dag <span class="main">(</span><span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">rnort</span>"</span></span> 
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> heaps_eq_Dag_eq<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                  <span class="keyword1"><span class="command">with</span></span> rnort_dag 
                  <span class="keyword1"><span class="command">have</span></span> rnort_dag_repc<span class="main">:</span> 
                    <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">rnort</span>"</span></span> 
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">from</span></span> lnort_in_Nodes 
                  <span class="keyword1"><span class="command">have</span></span> lnortx_in_Nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set_of <span class="skolem">lnort</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                  <span class="keyword1"><span class="command">with</span></span> wf_ll nsll  
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> set_of <span class="skolem">lnort</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set_of <span class="skolem">pret</span> <span class="main">∧</span> <span class="skolem">var</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> wf_ll_Nodes_pret<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_ll_eq<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                  <span class="keyword1"><span class="command">with</span></span> pret_dag prebdt_pret lnort_dag ord_pret wf_ll  nsll 
                    repbc_nc 
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> set_of <span class="skolem">lnort</span><span class="main">.</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">x</span> <span class="main">∧</span> 
                    <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">x</span>"</span></span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> nort_null_comp<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_ll_eq<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 
                    <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repc</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">lnort</span> <span class="main">=</span> 
                    Dag <span class="main">(</span><span class="skolem">repc</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">lnort</span>"</span></span> 
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> heaps_eq_Dag_eq<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                  <span class="keyword1"><span class="command">with</span></span> lnort_dag 
                  <span class="keyword1"><span class="command">have</span></span> lnort_dag_repc<span class="main">:</span> 
                    <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repc</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">lnort</span>"</span></span> 
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">from</span></span> lno_nNull hno_nNull   
                  <span class="keyword1"><span class="command">have</span></span> propto_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">∧</span> 
                    <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span>"</span></span> 
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
                  <span class="keyword1"><span class="command">from</span></span> rno_in_llbn twonodes_in_llbn_prop rrno_eq_rno 
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">no</span> <span class="main">∧</span> 
                    <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">no</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">with</span></span> propto_comp lnort_dag_repc rnort_dag_repc lno_nNull hno_nNull 
                    rnonN   
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Dag<span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span><span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span><span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span><span class="main">(</span>Node <span class="skolem">lnort</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span> <span class="skolem">rnort</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">next</span></span>
                  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">rnot</span> <span class="skolem">lnot</span> <span class="skolem">rnort</span> <span class="skolem">lnort</span>
                  <span class="keyword3"><span class="command">assume</span></span> rnot_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">rnot</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> lnot_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">lnot</span>"</span></span>
                  <span class="keyword1"><span class="command">with</span></span> rnot_dag nonNull   
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Dag <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="main">(</span>Node <span class="skolem">lnot</span> <span class="skolem">no</span> <span class="skolem">rnot</span><span class="main">)</span>"</span></span> 
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">next</span></span>
                  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">rnort</span> <span class="skolem">lnort</span>
                  <span class="keyword3"><span class="command">assume</span></span> rnort_dag<span class="main">:</span> 
                    <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">rnort</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> lnort_dag<span class="main">:</span> 
                    <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repc</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">lnort</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> red_rnort<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced <span class="skolem">rnort</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> red_lnort<span class="main">:</span> <span class="quoted"><span class="quoted">" reduced <span class="skolem">lnort</span>"</span></span>
                  <span class="keyword1"><span class="command">from</span></span> rhn_nNull rnort_dag <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lrnort</span></span> <span class="skolem"><span class="skolem">rrnort</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
                    rnort_Node<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rnort</span> <span class="main">=</span> <span class="main">(</span>Node <span class="skolem">lrnort</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span><span class="main">)</span> <span class="skolem">rrnort</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">from</span></span> rln_nNull lnort_dag <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">llnort</span></span> <span class="skolem"><span class="skolem">rlnort</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
                    lnort_Node<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lnort</span> <span class="main">=</span> <span class="main">(</span>Node <span class="skolem">llnort</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span><span class="main">)</span> <span class="skolem">rlnort</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">from</span></span> twonodes_in_llbn_prop rrno_eq_rno rno_in_llbn hno_nNull lno_nNull 
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">∧</span> 
                    <span class="main">(</span><span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="skolem">no</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                  <span class="keyword1"><span class="command">with</span></span> share_case_cond 
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">with</span></span> red_lnort red_rnort rnort_Node lnort_Node share_case_cond 
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"reduced <span class="main">(</span>Node <span class="skolem">lnort</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span> <span class="skolem">rnort</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> lp<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> rp<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> 
                      llt<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">llnort</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> rlt <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">rlnort</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> lrt<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">lrnort</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> rrt<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">rrnort</span></span> 
                      <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> reduced_children_parent<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                <span class="keyword1"><span class="command">next</span></span>
                  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">lnort</span> <span class="skolem">rnort</span>
                  <span class="keyword3"><span class="command">assume</span></span> lnort_dag<span class="main">:</span> 
                    <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repc</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">lnort</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> ord_lnort<span class="main">:</span> <span class="quoted"><span class="quoted">"ordered <span class="skolem">lnort</span> <span class="skolem">var</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> rnort_dag<span class="main">:</span> 
                    <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">rnort</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> ord_rnort<span class="main">:</span> <span class="quoted"><span class="quoted">" ordered <span class="skolem">rnort</span> <span class="skolem">var</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> lnort_in_repNodes<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">lnort</span> <span class="main">⊆</span> <span class="skolem">repb</span> <span class="main">`</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> rnort_in_repNodes<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">rnort</span> <span class="main">⊆</span> <span class="skolem">repb</span> <span class="main">`</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                  <span class="keyword1"><span class="command">from</span></span> lnort_in_repNodes repbNodes_in_Nodes 
                  <span class="keyword1"><span class="command">have</span></span> lnort_in_Nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">lnort</span> <span class="main">⊆</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">from</span></span> rnort_in_repNodes repbNodes_in_Nodes 
                  <span class="keyword1"><span class="command">have</span></span> rnort_in_Nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">rnort</span> <span class="main">⊆</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

                  <span class="keyword1"><span class="command">from</span></span> rhn_nNull rnort_dag <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lrnort</span></span> <span class="skolem"><span class="skolem">rrnort</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
                    rnort_Node<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rnort</span> <span class="main">=</span> <span class="main">(</span>Node <span class="skolem">lrnort</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span><span class="main">)</span> <span class="skolem">rrnort</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">from</span></span> rln_nNull lnort_dag <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">llnort</span></span> <span class="skolem"><span class="skolem">rlnort</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
                    lnort_Node<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lnort</span> <span class="main">=</span> <span class="main">(</span>Node <span class="skolem">llnort</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span><span class="main">)</span> <span class="skolem">rlnort</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">from</span></span> lnort_dag rln_nNull lnort_in_Nodes 
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">∈</span> set_of <span class="skolem">lnort</span>"</span></span> 
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">with</span></span> lnort_in_Nodes 
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                  <span class="keyword1"><span class="command">with</span></span> wf_ll nsll  
                  <span class="keyword1"><span class="command">have</span></span> vrlno_sn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> wf_ll_Nodes_pret<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_ll_eq<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                  <span class="keyword1"><span class="command">from</span></span> rnort_dag rhn_nNull rnort_in_Nodes 
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">∈</span> set_of <span class="skolem">rnort</span>"</span></span> 
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">with</span></span> rnort_in_Nodes 
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                  <span class="keyword1"><span class="command">with</span></span> wf_ll nsll  <span class="keyword1"><span class="command">have</span></span> vrhno_sn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> wf_ll_Nodes_pret<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_ll_eq<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                  <span class="keyword1"><span class="command">with</span></span> varrepno_n vrlno_sn lnort_dag ord_lnort rnort_dag rnort_Node 
                    lnort_Node ord_rnort 
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ordered <span class="main">(</span>Node <span class="skolem">lnort</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span> <span class="skolem">rnort</span><span class="main">)</span> <span class="skolem">var</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">next</span></span>
                  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">lnort</span> <span class="skolem">rnort</span>
                  <span class="keyword3"><span class="command">assume</span></span> lnort_in_Nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">lnort</span> <span class="main">⊆</span> <span class="skolem">repb</span> <span class="main">`</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> rnort_in_Nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">rnort</span> <span class="main">⊆</span> <span class="skolem">repb</span> <span class="main">`</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                  <span class="keyword1"><span class="command">from</span></span> lnort_in_Nodes repbNodes_repcNodes 
                  <span class="keyword1"><span class="command">have</span></span> lnort_in_repcNodes<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">lnort</span> <span class="main">⊆</span> <span class="skolem">repc</span> <span class="main">`</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">from</span></span> rnort_in_Nodes repbNodes_repcNodes 
                  <span class="keyword1"><span class="command">have</span></span> rnort_in_repcNodes<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">rnort</span> <span class="main">⊆</span> <span class="skolem">repc</span> <span class="main">`</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">have</span></span> nNodessubset<span class="main">:</span> <span class="quoted"><span class="quoted">"Nodes <span class="skolem">n</span> <span class="skolem">ll</span> <span class="main">⊆</span> Nodes <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="skolem">ll</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nodes_subset<span class="main">)</span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> repc_Nodes_subset<span class="main">:</span>
                    <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">`</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span> <span class="main">⊆</span> <span class="skolem">repc</span> <span class="main">`</span>Nodes <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="skolem">ll</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                  <span class="keyword1"><span class="command">from</span></span> no_in_Nodes <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="skolem">no</span> <span class="main">∈</span> <span class="skolem">repc</span> <span class="main">`</span>Nodes <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="skolem">ll</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                  <span class="keyword1"><span class="command">with</span></span> repc_Nodes_subset lnort_in_repcNodes rnort_in_repcNodes 
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set_of <span class="main">(</span>Node <span class="skolem">lnort</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span> <span class="skolem">rnort</span><span class="main">)</span> <span class="main">⊆</span> 
                    <span class="skolem">repc</span> <span class="main">`</span>Nodes <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">ll</span>"</span></span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                <span class="keyword1"><span class="command">next</span></span>
                  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">rnot</span> <span class="skolem">lnot</span> <span class="skolem">rnort</span> <span class="skolem">lnort</span> <span class="skolem">rnobdt</span> <span class="skolem">lnobdt</span> <span class="skolem">rnorbdt</span> <span class="skolem">lnorbdt</span>
                  <span class="keyword3"><span class="command">assume</span></span> lnobdt_def<span class="main">:</span> <span class="quoted"><span class="quoted">" bdt <span class="skolem">lnot</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="skolem">lnobdt</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> rnobdt_def<span class="main">:</span> <span class="quoted"><span class="quoted">" bdt <span class="skolem">rnot</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="skolem">rnobdt</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> rnorbdt_def<span class="main">:</span> <span class="quoted"><span class="quoted">" bdt <span class="skolem">rnort</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="skolem">rnorbdt</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> cong_rno_rnor<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">rnobdt</span> <span class="main">∼</span> <span class="skolem">rnorbdt</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> lnot_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">lnot</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> rnot_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">rnot</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Suc <span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">no</span>"</span></span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> varnoseq1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">var</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">nobdt</span><span class="main">.</span> bdt <span class="main">(</span>Node <span class="skolem">lnot</span> <span class="skolem">no</span> <span class="skolem">rnot</span><span class="main">)</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="bound">nobdt</span> <span class="main">∧</span> 
                    <span class="main">(</span><span class="main">∃</span><span class="bound">norbdt</span><span class="main">.</span> bdt <span class="main">(</span>Node <span class="skolem">lnort</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span> <span class="skolem">rnort</span><span class="main">)</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="bound">norbdt</span> <span class="main">∧</span> 
                    <span class="bound">nobdt</span> <span class="main">∼</span> <span class="bound">norbdt</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
                    <span class="keyword3"><span class="command">case</span></span> True
                    <span class="keyword1"><span class="command">note</span></span> vnoNull<span class="main">=</span>this
                    <span class="keyword1"><span class="command">with</span></span> pret_dag ord_pret no_in_pret lno_nNull hno_nNull  
                    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> var_ordered_children<span class="main">)</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                  <span class="keyword1"><span class="command">next</span></span>
                    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">no</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
                    <span class="keyword1"><span class="command">with</span></span> varnoseq1 <span class="keyword1"><span class="command">have</span></span> vnoOne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">no</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">from</span></span> pret_dag  ord_pret no_in_pret lno_nNull hno_nNull  
                      vnoOne 
                    <span class="keyword1"><span class="command">have</span></span> vlvrNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="skolem">var</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> var_ordered_children<span class="main">)</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> vlNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">from</span></span> vlvrNull <span class="keyword1"><span class="command">have</span></span> vrNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">from</span></span> lnobdt_def lnot_dag vlNull  lno_nNull 
                    <span class="keyword1"><span class="command">have</span></span> lnobdt_Zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lnobdt</span> <span class="main">=</span> Zero"</span></span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> bdt_Some_var0_Zero<span class="main">)</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                    <span class="keyword1"><span class="command">from</span></span> rnobdt_def rnot_dag vrNull  hno_nNull 
                    <span class="keyword1"><span class="command">have</span></span> rnobdt_Zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rnobdt</span> <span class="main">=</span> Zero"</span></span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> bdt_Some_var0_Zero<span class="main">)</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                    <span class="keyword1"><span class="command">from</span></span> lnobdt_Zero lnobdt_def 
                    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bdt <span class="skolem">lnot</span> <span class="skolem">var</span> <span class="main">=</span> Some Zero"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">with</span></span> lnot_dag vlNull  
                    <span class="keyword1"><span class="command">have</span></span> lnot_Node<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lnot</span> <span class="main">=</span> <span class="main">(</span>Node Tip <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> Tip<span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">from</span></span> rnobdt_Zero rnobdt_def rnot_dag vrNull  
                    <span class="keyword1"><span class="command">have</span></span> rnot_Node<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rnot</span> <span class="main">=</span> <span class="main">(</span>Node Tip <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span> Tip<span class="main">)</span>"</span></span> 
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">from</span></span> pret_dag no_in_pret <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">not</span></span> 
                      <span class="keyword2"><span class="keyword">where</span></span> not_ex<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="skolem">no</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">not</span>"</span></span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> dag_setof_exD<span class="main">)</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                    <span class="keyword1"><span class="command">with</span></span> pret_dag no_in_pret <span class="keyword1"><span class="command">have</span></span> not_ex_in_pret<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">not</span> <span class="main">&lt;=</span> <span class="skolem">pret</span>"</span></span> 
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_of_subdag<span class="main">)</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                    <span class="keyword1"><span class="command">from</span></span> not_ex lnot_dag rnot_dag   nonNull 
                    <span class="keyword1"><span class="command">have</span></span> not_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">not</span> <span class="main">=</span> <span class="main">(</span>Node <span class="skolem">lnot</span> <span class="skolem">no</span> <span class="skolem">rnot</span><span class="main">)</span>"</span></span> 
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Dag_unique <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Dag_Ref<span class="main">)</span>
                    <span class="keyword1"><span class="command">with</span></span> not_ex_in_pret prebdt_pret 
                    <span class="keyword1"><span class="command">have</span></span> nobdt_ex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">nobdt</span><span class="main">.</span> bdt <span class="main">(</span>Node <span class="skolem">lnot</span> <span class="skolem">no</span> <span class="skolem">rnot</span><span class="main">)</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="bound">nobdt</span>"</span></span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subbdt_ex<span class="main">)</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nobdt</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
                      nobdt_def<span class="main">:</span> <span class="quoted"><span class="quoted">"bdt <span class="main">(</span>Node <span class="skolem">lnot</span> <span class="skolem">no</span> <span class="skolem">rnot</span><span class="main">)</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="skolem">nobdt</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">from</span></span> not_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"root <span class="skolem">not</span> <span class="main">=</span> <span class="skolem">no</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">with</span></span> nobdt_def vnoOne not_def 
                    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">not</span> <span class="main">=</span> <span class="main">(</span>Node Tip <span class="skolem">no</span> Tip<span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> bdt_Some_var1_One<span class="main">)</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                    <span class="keyword1"><span class="command">with</span></span> not_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rnot</span> <span class="main">=</span> Tip"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">with</span></span> rnot_Node <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">next</span></span>
                  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">lnot</span> <span class="skolem">rnot</span> <span class="skolem">lnobdt</span> <span class="skolem">rnobdt</span>
                  <span class="keyword3"><span class="command">assume</span></span> lnot_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">lnot</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> rnot_dag<span class="main">:</span> <span class="quoted"><span class="quoted">" Dag <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span> <span class="skolem">low</span> <span class="skolem">high</span> <span class="skolem">rnot</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> lnobdt_def<span class="main">:</span> <span class="quoted"><span class="quoted">" bdt <span class="skolem">lnot</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="skolem">lnobdt</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> rnobdt_def<span class="main">:</span> <span class="quoted"><span class="quoted">" bdt <span class="skolem">rnot</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="skolem">rnobdt</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> onesvarno<span class="main">:</span> <span class="quoted"><span class="quoted">" Suc <span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">no</span>"</span></span>
                  <span class="keyword1"><span class="command">with</span></span> rnobdt_def lnot_dag rnot_dag lnobdt_def 
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bdt <span class="main">(</span>Node <span class="skolem">lnot</span> <span class="skolem">no</span> <span class="skolem">rnot</span><span class="main">)</span> <span class="skolem">var</span> <span class="main">=</span> 
                    Some <span class="main">(</span>Bdt_Node <span class="skolem">lnobdt</span> <span class="main">(</span><span class="skolem">var</span> <span class="skolem">no</span><span class="main">)</span> <span class="skolem">rnobdt</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">next</span></span>
                  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">rnot</span> <span class="skolem">lnot</span> <span class="skolem">rnort</span> <span class="skolem">lnort</span> <span class="skolem">rnobdt</span> <span class="skolem">lnobdt</span> <span class="skolem">rnorbdt</span> <span class="skolem">lnorbdt</span>
                  <span class="keyword3"><span class="command">assume</span></span> rnort_dag<span class="main">:</span> 
                    <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">no</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">rnort</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> lnort_dag<span class="main">:</span> 
                    <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repc</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">no</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">lnort</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> rnorbdt_def<span class="main">:</span> <span class="quoted"><span class="quoted">" bdt <span class="skolem">rnort</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="skolem">rnorbdt</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> lnorbdt_def<span class="main">:</span> <span class="quoted"><span class="quoted">"bdt <span class="skolem">lnort</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="skolem">lnorbdt</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> varno_bOne<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">no</span>"</span></span>
                  <span class="keyword1"><span class="command">with</span></span> varno <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">with</span></span> varrepno_n <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">with</span></span> rnorbdt_def lnorbdt_def 
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bdt <span class="main">(</span>Node <span class="skolem">lnort</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span> <span class="skolem">rnort</span><span class="main">)</span> <span class="skolem">var</span> <span class="main">=</span> 
                    Some <span class="main">(</span>Bdt_Node <span class="skolem">lnorbdt</span> <span class="main">(</span><span class="skolem">var</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span><span class="main">)</span> <span class="skolem">rnorbdt</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">next</span></span>
                  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">rnobdt</span> <span class="skolem">lnobdt</span> <span class="skolem">rnorbdt</span> <span class="skolem">lnorbdt</span> 
                  <span class="keyword3"><span class="command">assume</span></span> lcong_eval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lnobdt</span> <span class="main">∼</span> <span class="skolem">lnorbdt</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> rcong_eval<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">rnobdt</span> <span class="main">∼</span> <span class="skolem">rnorbdt</span>"</span></span>
                  <span class="keyword1"><span class="command">from</span></span> varno varrepno_n <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">var</span> <span class="skolem">no</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">with</span></span> lcong_eval rcong_eval 
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Bdt_Node <span class="skolem">lnobdt</span> <span class="main">(</span><span class="skolem">var</span> <span class="skolem">no</span><span class="main">)</span> <span class="skolem">rnobdt</span> <span class="main">∼</span> 
                    Bdt_Node <span class="skolem">lnorbdt</span> <span class="main">(</span><span class="skolem">var</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span><span class="main">)</span> <span class="skolem">rnorbdt</span>"</span></span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> cong_eval_def<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">next</span></span>
                  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">rnot</span> <span class="skolem">lnot</span> <span class="skolem">rnort</span> <span class="skolem">lnort</span>
                  <span class="keyword3"><span class="command">assume</span></span> lnort_repb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set_of <span class="skolem">lnort</span><span class="main">.</span> <span class="skolem">repb</span> <span class="bound">no</span> <span class="main">=</span> <span class="bound">no</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> rnort_repb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set_of <span class="skolem">rnort</span><span class="main">.</span> <span class="skolem">repb</span> <span class="bound">no</span> <span class="main">=</span> <span class="bound">no</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> rnort_in_repb_Nodesn<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">rnort</span> <span class="main">⊆</span> <span class="skolem">repb</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> lnort_in_repb_Nodesn<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">lnort</span> <span class="main">⊆</span> <span class="skolem">repb</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                  <span class="keyword1"><span class="command">from</span></span> repbNodes_in_Nodes rnort_in_repb_Nodesn 
                  <span class="keyword1"><span class="command">have</span></span> rnort_in_Nodesn<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">rnort</span> <span class="main">⊆</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                  <span class="keyword1"><span class="command">from</span></span> repbNodes_in_Nodes lnort_in_repb_Nodesn 
                  <span class="keyword1"><span class="command">have</span></span> lnort_in_Nodesn<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">lnort</span> <span class="main">⊆</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                  <span class="keyword1"><span class="command">have</span></span> rnort_repc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set_of <span class="skolem">rnort</span><span class="main">.</span> <span class="skolem">repc</span> <span class="bound">no</span> <span class="main">=</span> <span class="bound">no</span>"</span></span>
                  <span class="keyword1"><span class="command">proof</span></span>
                    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">pt</span>
                    <span class="keyword3"><span class="command">assume</span></span> pt_in_rnort<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">pt</span> <span class="main">∈</span> set_of <span class="skolem">rnort</span>"</span></span>
                    <span class="keyword1"><span class="command">with</span></span> rnort_in_Nodesn <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pt</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span> 
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                    <span class="keyword1"><span class="command">with</span></span> Nodesn_notin_lln <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pt</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">with</span></span> repbc_nc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">pt</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="skolem">pt</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">with</span></span> rnort_repb pt_in_rnort <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="skolem">pt</span> <span class="main">=</span> <span class="skolem">pt</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">qed</span></span>
                  <span class="keyword1"><span class="command">have</span></span> lnort_repc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set_of <span class="skolem">lnort</span><span class="main">.</span> <span class="skolem">repc</span> <span class="bound">no</span> <span class="main">=</span> <span class="bound">no</span>"</span></span>
                  <span class="keyword1"><span class="command">proof</span></span>
                    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">pt</span>
                    <span class="keyword3"><span class="command">assume</span></span> pt_in_lnort<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">pt</span> <span class="main">∈</span> set_of <span class="skolem">lnort</span>"</span></span>
                    <span class="keyword1"><span class="command">with</span></span> lnort_in_Nodesn <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pt</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span> 
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                    <span class="keyword1"><span class="command">with</span></span> Nodesn_notin_lln <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pt</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">with</span></span> repbc_nc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">pt</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="skolem">pt</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">with</span></span> lnort_repb pt_in_lnort <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="skolem">pt</span> <span class="main">=</span> <span class="skolem">pt</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">qed</span></span>
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set_of <span class="main">(</span>Node <span class="skolem">lnort</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span> <span class="skolem">rnort</span><span class="main">)</span><span class="main">.</span> <span class="skolem">repc</span> <span class="bound">no</span> <span class="main">=</span> <span class="bound">no</span>"</span></span>
                  <span class="keyword1"><span class="command">proof</span></span>
                    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">pt</span>
                    <span class="keyword3"><span class="command">assume</span></span> pt_in_rept<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">pt</span> <span class="main">∈</span> set_of <span class="main">(</span>Node <span class="skolem">lnort</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">no</span><span class="main">)</span> <span class="skolem">rnort</span><span class="main">)</span>"</span></span>
                    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="skolem">pt</span> <span class="main">=</span> <span class="skolem">pt</span>"</span></span>
                    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">pt</span> <span class="main">∈</span> set_of <span class="skolem">lnort</span>"</span></span><span class="main">)</span>
                      <span class="keyword3"><span class="command">case</span></span> True
                      <span class="keyword1"><span class="command">with</span></span> lnort_repc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">next</span></span>
                      <span class="keyword3"><span class="command">assume</span></span> pt_notin_lnort<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">pt</span> <span class="main">∉</span> set_of <span class="skolem">lnort</span>"</span></span>
                      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">pt</span> <span class="main">∈</span> set_of <span class="skolem">rnort</span>"</span></span><span class="main">)</span>
                        <span class="keyword3"><span class="command">case</span></span> True
                        <span class="keyword1"><span class="command">with</span></span> rnort_repc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">next</span></span> 
                        <span class="keyword3"><span class="command">assume</span></span> pt_notin_rnort<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">pt</span> <span class="main">∉</span> set_of <span class="skolem">rnort</span>"</span></span>
                        <span class="keyword1"><span class="command">with</span></span> pt_notin_lnort pt_in_rept <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pt</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="skolem">no</span>"</span></span>
                          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                        <span class="keyword1"><span class="command">with</span></span> rrno_eq_rno <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="skolem">pt</span> <span class="main">=</span> <span class="skolem">pt</span>"</span></span>
                          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command">qed</span></span>
                    <span class="keyword1"><span class="command">qed</span></span>
                  <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">qed</span></span>
                
                <span class="keyword1"><span class="command">with</span></span> varrep rrno_eq_rno <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">with</span></span> rnonN <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">note</span></span> while_while_prop<span class="main">=</span>this
        <span class="keyword1"><span class="command">from</span></span> wf_ll nsll  
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">.</span> <span class="bound">no</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nodes_def length_ll_eq<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> no_in_one_ll<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">with</span></span> repbc_nc  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">.</span> <span class="skolem">repb</span> <span class="bound">no</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="bound">no</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">no</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> repbNodes_repcNodes<span class="main">:</span> 
          <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="main">`</span><span class="main">(</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="main">`</span><span class="main">(</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> imageE<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">xa</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> repcNodes_repbNodes<span class="main">:</span> 
          <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">`</span><span class="main">(</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repb</span> <span class="main">`</span><span class="main">(</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> repbc_dags_eq<span class="main">:</span> 
          <span class="quoted"><span class="quoted">"Dags <span class="main">(</span><span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">=</span> 
          Dags <span class="main">(</span><span class="skolem">repb</span>  <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> Dags.cases<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> DagsI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 4
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> Dags.cases<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> DagsI<span class="main">)</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">p</span> <span class="skolem">t</span>
          <span class="keyword3"><span class="command">assume</span></span> t_in_repcNodes<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">t</span> <span class="main">⊆</span> <span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> x_t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="skolem">t</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> t_in_repcNodes repcNodes_repbNodes 
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">x</span> <span class="main">⊆</span> <span class="skolem">repb</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">p</span> <span class="skolem">t</span>
          <span class="keyword3"><span class="command">assume</span></span> t_in_repcNodes<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">t</span> <span class="main">⊆</span> <span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> t_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="skolem">p</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">t</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> t_nTip<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">t</span> <span class="main">≠</span> Tip"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> x_t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="skolem">t</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> t_nTip t_dag <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> Null"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span>Null"</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">with</span></span> t_nTip t_dag <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lt</span></span> <span class="skolem"><span class="skolem">rt</span></span> <span class="keyword2"><span class="keyword">where</span></span> t_Node<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">=</span>Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> t_in_repcNodes t_dag t_nTip t_Node <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
            rq_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="skolem">q</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q_in_Nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> conjE<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> imageE<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">from</span></span> q_in_Nodes <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">q</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="skolem">q</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Nodes_n_rep_nc <span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> rq_p <span class="keyword1"><span class="command">have</span></span> repbq_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">q</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">from</span></span> q_in_Nodes 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">=</span> 
            Dag <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">t</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Nodes_repbc_Dags_eq <span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> t_dag rq_p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> repbq_p x_t <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Dag <span class="skolem">p</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">p</span> <span class="skolem">t</span>
          <span class="keyword3"><span class="command">assume</span></span> t_in_repcNodes<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">t</span> <span class="main">⊆</span> <span class="skolem">repb</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> x_t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="skolem">t</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> t_in_repcNodes repbNodes_repcNodes 
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">x</span> <span class="main">⊆</span> <span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">p</span> <span class="skolem">t</span>
          <span class="keyword3"><span class="command">assume</span></span> t_in_repcNodes<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">t</span> <span class="main">⊆</span> <span class="skolem">repb</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> t_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="skolem">p</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">t</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> t_nTip<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">t</span> <span class="main">≠</span> Tip"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> x_t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="skolem">t</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> t_nTip t_dag <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> Null"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span>Null"</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">with</span></span> t_nTip t_dag <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lt</span></span> <span class="skolem"><span class="skolem">rt</span></span> <span class="keyword2"><span class="keyword">where</span></span> t_Node<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">=</span>Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> t_in_repcNodes t_dag t_nTip t_Node <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
            rq_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">q</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q_in_Nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> conjE<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> imageE<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">from</span></span> q_in_Nodes <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repb</span> <span class="skolem">q</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="skolem">q</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Nodes_n_rep_nc <span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> rq_p <span class="keyword1"><span class="command">have</span></span> repbq_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="skolem">q</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">from</span></span> q_in_Nodes 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">=</span> 
            Dag <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">t</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Nodes_repbc_Dags_eq <span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> t_dag rq_p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> repbq_p x_t <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Dag <span class="skolem">p</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">p</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">t</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"dag"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> x_t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> t_nTip<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">t</span> <span class="main">≠</span> Tip"</span></span>
          <span class="keyword1"><span class="command">with</span></span> x_t <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≠</span> Tip"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">p</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">t</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"dag"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> x_t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> t_nTip<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">t</span> <span class="main">≠</span> Tip"</span></span>
          <span class="keyword1"><span class="command">with</span></span> x_t <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≠</span> Tip"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">from</span></span> pret_dag wf_ll nsll 
        <span class="keyword1"><span class="command">have</span></span> null_notin_Nodes_Suc_n<span class="main">:</span> <span class="quoted"><span class="quoted">"Null <span class="main">∉</span> Nodes <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ll</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span>  <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> Null_notin_Nodes<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_ll_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t1</span> <span class="skolem">t2</span>
          <span class="keyword3"><span class="command">assume</span></span> t1_in_DagsNodesn<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"<span class="skolem">t1</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> t2_notin_DagsNodesn<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"<span class="skolem">t2</span> <span class="main">∉</span> Dags <span class="main">(</span><span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> t2_in_DagsNodesSucn<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"<span class="skolem">t2</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> isomorphic_dags_eq_asm<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="bound">t1</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="skolem">repb</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> 
            <span class="main">∧</span> <span class="bound">t2</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="skolem">repb</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> 
            <span class="main">⟶</span> isomorphic_dags_eq <span class="bound">t1</span> <span class="bound">t2</span> <span class="skolem">var</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> repbc_Dags<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"Dags <span class="main">(</span><span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">=</span> 
            Dags <span class="main">(</span><span class="skolem">repb</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> t1_in_DagsNodesn repbc_Dags 
          <span class="keyword1"><span class="command">have</span></span> t1_repb_subnode<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"<span class="skolem">t1</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="skolem">repb</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">from</span></span> t2_in_DagsNodesSucn 
          <span class="keyword1"><span class="command">have</span></span> t2_in_DagsNodesSucn<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"<span class="skolem">t2</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">from</span></span> repbNodes_in_Nodes repbNodes_repcNodes 
          <span class="keyword1"><span class="command">have</span></span> repcNodesn_in_Nodesn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">`</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span> <span class="main">⊆</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">from</span></span> t1_in_DagsNodesn <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
            Dag_q_Nodes_n<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">t1</span> <span class="main">∧</span> <span class="skolem">q</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> Dags.cases<span class="main">)</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">t</span>
            <span class="keyword3"><span class="command">assume</span></span> t1_t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span>
            <span class="keyword3"><span class="command">assume</span></span> t_in_repcNodesn<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">t</span> <span class="main">⊆</span> <span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
            <span class="keyword3"><span class="command">assume</span></span> t_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="skolem">p</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">t</span>"</span></span>
            <span class="keyword3"><span class="command">assume</span></span> t_nTip<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">t</span> <span class="main">≠</span> Tip"</span></span>
            <span class="keyword3"><span class="command">assume</span></span> obtain_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">q</span><span class="main">.</span> Dag <span class="main">(</span><span class="skolem">repc</span> <span class="bound">q</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">t1</span> <span class="main">∧</span> 
              <span class="bound">q</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span> <span class="main">⟹</span> <span class="var">?thesis</span>"</span></span>
            <span class="keyword1"><span class="command">from</span></span> t_nTip t_dag <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> Null"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span>Null"</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">with</span></span> t_nTip t_dag <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lt</span></span> <span class="skolem"><span class="skolem">rt</span></span> <span class="keyword2"><span class="keyword">where</span></span> t_Node<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">=</span>Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> t_in_repcNodesn t_dag t_nTip t_Node <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
              rk_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="skolem">k</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> k_in_Nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> conjE<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> imageE<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">with</span></span> t1_t t_dag obtain_prop rk_p k_in_Nodes <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">with</span></span> wf_ll  nsll  <span class="keyword1"><span class="command">have</span></span> varq_sn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">var</span> <span class="skolem">q</span> <span class="main">&lt;</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>         
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nodes_def<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> conjE<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ll_def length_ll_eq<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> conjE<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">∈</span> set_of <span class="skolem">pret</span> <span class="main">⟶</span> <span class="bound">q</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">var</span> <span class="bound">q</span><span class="main">)</span>"</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">from</span></span> Dag_q_Nodes_n <span class="keyword1"><span class="command">have</span></span> q_in_Nodesn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound"><span class="bound">k</span></span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> <span class="skolem">q</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nodes_def<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> wf_ll nsll  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> i<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">k</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> j<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> no_in_one_ll<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_ll_eq<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">with</span></span> repbc_nc  <span class="keyword1"><span class="command">have</span></span> repbc_q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="skolem">q</span> <span class="main">=</span> <span class="skolem">repb</span> <span class="skolem">q</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">from</span></span> normalize_prop q_in_Nodesn <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">repb</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">&lt;=</span> <span class="skolem">var</span> <span class="skolem">q</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">with</span></span> repbc_q <span class="keyword1"><span class="command">have</span></span> var_repc_q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">&lt;=</span> <span class="skolem">var</span> <span class="skolem">q</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> varq_sn <span class="keyword1"><span class="command">have</span></span> var_repc_q_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          
          <span class="keyword1"><span class="command">from</span></span> Nodes_subset Dag_q_Nodes_n while_while_prop 
          <span class="keyword1"><span class="command">have</span></span> ord_t1_var_rep<span class="main">:</span> <span class="quoted"><span class="quoted">"ordered <span class="skolem">t1</span> <span class="skolem">var</span> <span class="main">∧</span> <span class="skolem">var</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">&lt;=</span> <span class="skolem">var</span> <span class="skolem">q</span>"</span></span> 
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> conjE<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ord_t1<span class="main">:</span> <span class="quoted"><span class="quoted">"ordered <span class="skolem">t1</span> <span class="skolem">var</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">from</span></span> ord_t1_var_rep <span class="keyword1"><span class="command">have</span></span> varrep_q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">&lt;=</span> <span class="skolem">var</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">from</span></span> t2_in_DagsNodesSucn <span class="keyword1"><span class="command">have</span></span> ord_t2<span class="main">:</span> <span class="quoted"><span class="quoted">"ordered <span class="skolem">t2</span> <span class="skolem">var</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> Dags.cases<span class="main">)</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">t</span>
            <span class="keyword3"><span class="command">assume</span></span> t_in_repcNodes<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">t</span> <span class="main">⊆</span> <span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ll</span>"</span></span>
            <span class="keyword3"><span class="command">assume</span></span> t_nTip<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">t</span> <span class="main">≠</span> Tip"</span></span>
            <span class="keyword3"><span class="command">assume</span></span> t2t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t2</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span>
            <span class="keyword3"><span class="command">assume</span></span> t_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="skolem">p</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">t</span>"</span></span>
            <span class="keyword1"><span class="command">from</span></span> t_in_repcNodes <span class="keyword1"><span class="command">have</span></span> x_in_repcNodesSucn<span class="main">:</span>  
              <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set_of <span class="skolem">t</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ll</span>"</span></span> 
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">from</span></span> t_nTip t_dag <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> Null"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span>Null"</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">with</span></span> t_nTip t_dag <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lt</span></span> <span class="skolem"><span class="skolem">rt</span></span> <span class="keyword2"><span class="keyword">where</span></span> t_Node<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">=</span>Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> set_of <span class="skolem">t</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">with</span></span> x_in_repcNodesSucn <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ll</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> repca_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="skolem">repc</span> <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
              a_in_NodesSucn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> Nodes <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ll</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">with</span></span> repca_p while_while_prop t_dag t2t <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> conjE exE<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">nort</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span><span class="main">)</span> 
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Dag_unique<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">from</span></span> while_while_prop <span class="keyword1"><span class="command">have</span></span> while_prop_part<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span> <span class="main">∈</span> Nodes <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ll</span><span class="main">.</span> 
            <span class="skolem">var</span> <span class="main">(</span><span class="skolem">repc</span> <span class="bound">no</span><span class="main">)</span> <span class="main">&lt;=</span> <span class="skolem">var</span> <span class="bound">no</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> while_while_prop <span class="keyword1"><span class="command">have</span></span> rep_rep_nort<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>Nodes <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">ll</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">nort</span><span class="main">.</span> Dag <span class="main">(</span><span class="skolem">repc</span> <span class="bound">no</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">nort</span> <span class="main">∧</span> 
            <span class="main">(</span><span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set_of <span class="bound">nort</span><span class="main">.</span> <span class="skolem">repc</span> <span class="bound">no</span> <span class="main">=</span> <span class="bound">no</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> repcNodes_in_Nodes null_notin_Nodes_Suc_n 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span> <span class="main">∈</span> Nodes <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="skolem">ll</span><span class="main">.</span> <span class="skolem">repc</span> <span class="bound">no</span> <span class="main">≠</span> Null"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> rep_rep_nort <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">no</span> <span class="main">∈</span> Nodes <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="skolem">ll</span><span class="main">.</span> <span class="skolem">repc</span> <span class="main">(</span><span class="skolem">repc</span> <span class="bound">no</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="bound">no</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">no</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">no</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="improper">no</span> <span class="main">∈</span> set_of <span class="improper">nort</span>"</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> conjE<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="improper">no</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> conjE<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set_of <span class="improper">nort</span><span class="main">.</span> <span class="skolem">repc</span> <span class="bound">no</span> <span class="main">=</span> <span class="bound">no</span>"</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">with</span></span> t2_in_DagsNodesSucn t2_notin_DagsNodesn ord_t2 while_prop_part 
            wf_ll nsll  repcNodes_in_Nodes <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span>
            t2_repc_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">t2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
            a_in_lln<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> restrict_root_Node<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_ll_eq<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">with</span></span> wf_ll nsll  <span class="keyword1"><span class="command">have</span></span> a_in_pret<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> set_of <span class="skolem">pret</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ll_def length_ll_eq<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> wf_ll nsll  a_in_lln <span class="keyword1"><span class="command">have</span></span> vara_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ll_def length_ll_eq<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> a_in_lln rep_prop  <span class="keyword3"><span class="command">obtain</span></span>
            repp_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">repc</span> <span class="skolem">a</span> <span class="main">≠</span> Null"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
            repp_reduce<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">a</span> <span class="main">∧</span> <span class="skolem">low</span> <span class="skolem">a</span> <span class="main">≠</span> Null 
            <span class="main">⟶</span> <span class="skolem">repc</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
            repp_share<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">a</span> <span class="main">⟶</span> <span class="skolem">low</span> <span class="skolem">a</span> <span class="main">=</span> Null<span class="main">)</span> 
            <span class="main">⟶</span> <span class="skolem">repc</span> <span class="skolem">a</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">∧</span>
            <span class="skolem">repc</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="skolem">a</span> <span class="main">∧</span> 
            <span class="main">(</span><span class="main">∀</span><span class="bound">no1</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">a</span> <span class="main">∧</span> 
            <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="bound">no1</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_depth_limit</span><span class="main"><span class="main">=</span></span>4<span class="main">]</span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> t2_repc_dag a_in_lln repp_nNull <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lt2</span></span> <span class="skolem"><span class="skolem">rt2</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
            t2_Node<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t2</span> <span class="main">=</span> <span class="main">(</span>Node <span class="skolem">lt2</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">a</span><span class="main">)</span> <span class="skolem">rt2</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"isomorphic_dags_eq <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="skolem">var</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">a</span> <span class="main">∧</span> <span class="skolem">low</span> <span class="skolem">a</span> <span class="main">≠</span> Null"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">note</span></span> red<span class="main">=</span>this
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> red_case<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">a</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">from</span></span> red <span class="keyword1"><span class="command">have</span></span> low_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">a</span> <span class="main">≠</span> Null"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">with</span></span> pret_dag prebdt_pret a_in_pret <span class="keyword1"><span class="command">have</span></span> highp_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">a</span> <span class="main">≠</span> Null"</span></span> 
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> balanced_bdt<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">from</span></span> pret_dag ord_pret a_in_pret low_nNull highp_nNull 
            <span class="keyword1"><span class="command">have</span></span> var_children_smaller<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">a</span> <span class="main">∧</span> <span class="skolem">var</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">a</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> var_ordered_children<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">from</span></span> pret_dag a_in_pret <span class="keyword1"><span class="command">have</span></span> a_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> Null"</span></span> 
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_of_nn <span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">with</span></span> a_in_pret highp_nNull pret_dag <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">a</span> <span class="main">∈</span> set_of <span class="skolem">pret</span>"</span></span> 
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> subelem_set_of_high<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">with</span></span> wf_ll <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">a</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">var</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ll_def<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> a_in_lln t2_repc_dag var_children_smaller vara_n 
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound"><span class="bound">k</span></span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> higha_in_Nodesn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">high</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nodes_def<span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> rhigha_in_rNodesn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">from</span></span> higha_in_Nodesn normalize_prop <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rt</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
              rt_dag<span class="main">:</span>  <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repb</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">rt</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
              rt_in_repbNort<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">rt</span> <span class="main">⊆</span> <span class="skolem">repb</span> <span class="main">`</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">from</span></span> rt_in_repbNort repbNodes_repcNodes 
            <span class="keyword1"><span class="command">have</span></span> rt_in_repcNodesn<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">rt</span> <span class="main">⊆</span> <span class="skolem">repc</span> <span class="main">`</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">from</span></span> rt_dag higha_in_Nodesn 
            <span class="keyword1"><span class="command">have</span></span> repcrt_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">rt</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> Nodes_repbc_Dags_eq <span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">have</span></span> rt_nTip<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rt</span> <span class="main">≠</span> Tip"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">≠</span> Null"</span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command">note</span></span> rhigha_in_rNodesn
                <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">`</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span> <span class="main">⊆</span> <span class="skolem">repc</span> <span class="main">`</span>Nodes <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ll</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> Nodes_subset 
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> Nodes <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ll</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> repcNodes_in_Nodes
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">using</span></span> null_notin_Nodes_Suc_n
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">with</span></span> repcrt_dag <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">from</span></span> a_nNull a_in_pret low_nNull pret_dag <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">a</span> <span class="main">∈</span> set_of <span class="skolem">pret</span>"</span></span> 
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> subelem_set_of_low<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">with</span></span> wf_ll <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">a</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">var</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ll_def<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> a_in_lln t2_repc_dag var_children_smaller vara_n 
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">low</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nodes_def<span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> rlow_in_rNodesn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">from</span></span> repp_reduce low_nNull  highp_nNull  red_case 
              <span class="keyword1"><span class="command">have</span></span> repc_p_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
              <span class="keyword1"><span class="command">with</span></span> rt_in_repcNodesn repcrt_dag rhigha_in_rNodesn a_in_lln t2_repc_dag
                repc_p_def  rt_nTip 
              <span class="keyword1"><span class="command">have</span></span> t2_in_Dags_Nodesn<span class="main">:</span> 
                <span class="quoted"><span class="quoted">"<span class="skolem">t2</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> DagsI<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">t2</span><span class="main">=</span><span class="skolem">rt</span>"</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Dag_unique<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">from</span></span> t1_in_DagsNodesn t2_in_Dags_Nodesn repbc_dags_eq isomorphic_dags_eq_asm 
              <span class="keyword3"><span class="command">show</span></span> shared_t1_t2<span class="main">:</span> <span class="quoted"><span class="quoted">"isomorphic_dags_eq <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="skolem">var</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">t1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">t2</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">assume</span></span> share<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">a</span> <span class="main">∧</span> <span class="skolem">low</span> <span class="skolem">a</span> <span class="main">≠</span> Null<span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">then</span></span>
            <span class="keyword1"><span class="command">have</span></span> share<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">a</span> <span class="main">≠</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">a</span> <span class="main">∨</span> <span class="skolem">low</span> <span class="skolem">a</span> <span class="main">=</span> Null"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_depth_limit</span><span class="main"><span class="main">=</span></span>1<span class="main">]</span><span class="main">]</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">with</span></span> repp_share <span class="keyword3"><span class="command">obtain</span></span> 
              ra_in_llbn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="skolem">a</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
              rra_ra<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
              two_nodes_share<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">no1</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span><span class="main">.</span> 
              <span class="main">(</span><span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">a</span> <span class="main">∧</span> 
              <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="bound">no1</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_depth_limit</span><span class="main"><span class="main">=</span></span>3<span class="main">]</span><span class="main">]</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">from</span></span> wf_ll ra_in_llbn  nsll <span class="keyword1"><span class="command">have</span></span> var_repc_a_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> 
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ll_def length_ll_eq<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isomorphic_dags_eq_def<span class="main">)</span>
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">bdt1</span>
              <span class="keyword3"><span class="command">assume</span></span> bdt_t1<span class="main">:</span> <span class="quoted"><span class="quoted">"bdt <span class="skolem">t1</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="skolem">bdt1</span>"</span></span>
              <span class="keyword3"><span class="command">assume</span></span> bdt_t2<span class="main">:</span> <span class="quoted"><span class="quoted">"bdt <span class="skolem">t2</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="skolem">bdt1</span>"</span></span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span> <span class="main">=</span> <span class="skolem">t2</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">t1</span></span><span class="main">)</span>
                <span class="keyword3"><span class="command">case</span></span> Tip
                <span class="keyword1"><span class="command">with</span></span> bdt_t1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">next</span></span>
                <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">lt1</span> <span class="skolem">p1</span> <span class="skolem">rt1</span><span class="main">)</span>
                <span class="keyword1"><span class="command">note</span></span> t1_Node<span class="main">=</span>this
                <span class="keyword1"><span class="command">with</span></span> Dag_q_Nodes_n <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p1</span><span class="main">=</span><span class="main">(</span><span class="skolem">repc</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">with</span></span> t2_Node bdt_t1 bdt_t2 t1_Node <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">var</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> same_bdt_var<span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                <span class="keyword1"><span class="command">with</span></span> var_repc_q_n var_repc_a_n <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span> <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">note</span></span> mixed_Dags_case <span class="main">=</span> this
        <span class="keyword1"><span class="command">from</span></span> repbc_dags_eq isomorphic_dags_eq 
        <span class="keyword1"><span class="command">have</span></span> dags_shared<span class="main">:</span> 
          <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="bound">t1</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ll</span><span class="main">)</span><span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span><span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span><span class="main">∧</span>
          <span class="bound">t2</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> 
          <span class="main">⟶</span> isomorphic_dags_eq <span class="bound">t1</span> <span class="bound">t2</span> <span class="skolem">var</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Dags_Nodes_cases<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> isomorphic_dags_eq_sym<span class="main">)</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t1</span> <span class="skolem">t2</span>
          <span class="keyword3"><span class="command">assume</span></span> t1_in_Dagsn<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"<span class="skolem">t1</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> t2_in_Dagsn<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"<span class="skolem">t2</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> isomorphic_dags_eq_asm<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="bound">t1</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="skolem">repb</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">∧</span>
            <span class="bound">t2</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="skolem">repb</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> 
            <span class="main">⟶</span> isomorphic_dags_eq <span class="bound">t1</span> <span class="bound">t2</span> <span class="skolem">var</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> repb_repc_Dags<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"Dags <span class="main">(</span><span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">=</span> 
            Dags <span class="main">(</span><span class="skolem">repb</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> t1_in_Dagsn t2_in_Dagsn isomorphic_dags_eq_asm 
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"isomorphic_dags_eq <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="skolem">var</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t1</span> <span class="skolem">t2</span>
          <span class="keyword3"><span class="command">assume</span></span> t1_in_DagsNodesn<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"<span class="skolem">t1</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> t2_notin_DagsNodesn<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"<span class="skolem">t2</span> <span class="main">∉</span> Dags <span class="main">(</span><span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> t2_in_DagsNodesSucn<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"<span class="skolem">t2</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> isomorphic_dags_eq_asm<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="bound">t1</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="skolem">repb</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">∧</span>
            <span class="bound">t2</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="skolem">repb</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> 
            <span class="main">⟶</span> isomorphic_dags_eq <span class="bound">t1</span> <span class="bound">t2</span> <span class="skolem">var</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> repbc_Dags<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"Dags <span class="main">(</span><span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">=</span> 
            Dags <span class="main">(</span><span class="skolem">repb</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> t1_in_DagsNodesn t2_notin_DagsNodesn t2_in_DagsNodesSucn 
            isomorphic_dags_eq_asm repbc_Dags
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"isomorphic_dags_eq <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="skolem">var</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mixed_Dags_case<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t1</span> <span class="skolem">t2</span>
          <span class="keyword3"><span class="command">assume</span></span> t1_in_DagsNodesSucn<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"<span class="skolem">t1</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> t1_notin_DagsNodesn<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"<span class="skolem">t1</span> <span class="main">∉</span> Dags <span class="main">(</span><span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> t2_in_DagsNodesSucn<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"<span class="skolem">t2</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> t2_notin_DagsNodesn<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"<span class="skolem">t2</span> <span class="main">∉</span> Dags <span class="main">(</span><span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span>"</span></span>
          
          
            <span class="comment1">(* ab hier gehts um t1 *)</span>
          <span class="keyword1"><span class="command">from</span></span> t1_in_DagsNodesSucn <span class="keyword1"><span class="command">have</span></span> ord_t1<span class="main">:</span> <span class="quoted"><span class="quoted">"ordered <span class="skolem">t1</span> <span class="skolem">var</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> Dags.cases<span class="main">)</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">t</span>
            <span class="keyword3"><span class="command">assume</span></span> t_in_repcNodes<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">t</span> <span class="main">⊆</span> <span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ll</span>"</span></span>
            <span class="keyword3"><span class="command">assume</span></span> t_nTip<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">t</span> <span class="main">≠</span> Tip"</span></span>
            <span class="keyword3"><span class="command">assume</span></span> t2t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span>
            <span class="keyword3"><span class="command">assume</span></span> t_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="skolem">p</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">t</span>"</span></span>
            <span class="keyword1"><span class="command">from</span></span> t_in_repcNodes 
            <span class="keyword1"><span class="command">have</span></span> x_in_repcNodesSucn<span class="main">:</span>  
              <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set_of <span class="skolem">t</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ll</span>"</span></span> 
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">from</span></span> t_nTip t_dag <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> Null"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span>Null"</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">with</span></span> t_nTip t_dag <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lt</span></span> <span class="skolem"><span class="skolem">rt</span></span> <span class="keyword2"><span class="keyword">where</span></span> t_Node<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">=</span>Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> set_of <span class="skolem">t</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">with</span></span> x_in_repcNodesSucn <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ll</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
              repca_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="skolem">repc</span> <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a_in_NodesSucn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> Nodes <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ll</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">with</span></span> repca_p while_while_prop t_dag t2t <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> conjE exE<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">nort</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span><span class="main">)</span> 
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Dag_unique<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">from</span></span> while_while_prop 
          <span class="keyword1"><span class="command">have</span></span> while_prop_part<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span> <span class="main">∈</span> Nodes <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ll</span><span class="main">.</span> 
            <span class="skolem">var</span> <span class="main">(</span><span class="skolem">repc</span> <span class="bound">no</span><span class="main">)</span> <span class="main">&lt;=</span> <span class="skolem">var</span> <span class="bound">no</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> while_while_prop <span class="keyword1"><span class="command">have</span></span> rep_rep_nort<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>Nodes <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">ll</span><span class="main">.</span> 
               <span class="main">(</span><span class="main">∃</span><span class="bound">nort</span><span class="main">.</span> Dag <span class="main">(</span><span class="skolem">repc</span> <span class="bound">no</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">nort</span> <span class="main">∧</span> 
               <span class="main">(</span><span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set_of <span class="bound">nort</span><span class="main">.</span> <span class="skolem">repc</span> <span class="bound">no</span> <span class="main">=</span> <span class="bound">no</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> repcNodes_in_Nodes null_notin_Nodes_Suc_n 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">no</span> <span class="main">∈</span> Nodes <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="skolem">ll</span><span class="main">.</span> <span class="skolem">repc</span> <span class="bound">no</span> <span class="main">≠</span> Null"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> rep_rep_nort 
          <span class="keyword1"><span class="command">have</span></span> rep_rep_no<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span> <span class="main">∈</span> Nodes <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="skolem">ll</span><span class="main">.</span> <span class="skolem">repc</span> <span class="main">(</span><span class="skolem">repc</span> <span class="bound">no</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="bound">no</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">no</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">no</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="improper">no</span> <span class="main">∈</span> set_of <span class="improper">nort</span>"</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> conjE<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="improper">no</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> conjE<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">no</span><span class="main">∈</span>set_of <span class="improper">nort</span><span class="main">.</span> <span class="skolem">repc</span> <span class="bound">no</span> <span class="main">=</span> <span class="bound">no</span>"</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">with</span></span> t1_in_DagsNodesSucn t1_notin_DagsNodesn ord_t1 while_prop_part wf_ll 
            nsll  repcNodes_in_Nodes <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a1</span></span> <span class="keyword2"><span class="keyword">where</span></span>
            t1_repc_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">a1</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">t1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
            a1_in_lln<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a1</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> restrict_root_Node<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_ll_eq<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">with</span></span> wf_ll nsll  <span class="keyword1"><span class="command">have</span></span> a1_in_pret<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a1</span> <span class="main">∈</span> set_of <span class="skolem">pret</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ll_def length_ll_eq<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> wf_ll nsll  a1_in_lln <span class="keyword1"><span class="command">have</span></span> vara1_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">a1</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ll_def length_ll_eq<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> a1_in_lln rep_prop  <span class="keyword3"><span class="command">obtain</span></span>
            repa1_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">repc</span> <span class="skolem">a1</span> <span class="main">≠</span> Null"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
            repa1_reduce<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">a1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">a1</span> <span class="main">∧</span> <span class="skolem">low</span> <span class="skolem">a1</span> <span class="main">≠</span> Null 
            <span class="main">⟶</span> <span class="skolem">repc</span> <span class="skolem">a1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">a1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
            repa1_share<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">a1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">a1</span> <span class="main">⟶</span> <span class="skolem">low</span> <span class="skolem">a1</span> <span class="main">=</span> Null<span class="main">)</span> 
            <span class="main">⟶</span> <span class="skolem">repc</span> <span class="skolem">a1</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">repc</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">a1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="skolem">a1</span> <span class="main">∧</span> 
            <span class="main">(</span><span class="main">∀</span><span class="bound">no1</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">a1</span> <span class="main">∧</span> 
            <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">a1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">a1</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="bound">no1</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_depth_limit</span><span class="main"><span class="main">=</span></span>4<span class="main">]</span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> t1_repc_dag a1_in_lln repa1_nNull <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lt1</span></span> <span class="skolem"><span class="skolem">rt1</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
            t1_Node<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span> <span class="main">=</span> <span class="main">(</span>Node <span class="skolem">lt1</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">a1</span><span class="main">)</span> <span class="skolem">rt1</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>



              <span class="comment1">(* ab hier gehts um t2 *)</span>
          <span class="keyword1"><span class="command">from</span></span> t2_in_DagsNodesSucn <span class="keyword1"><span class="command">have</span></span> ord_t2<span class="main">:</span> <span class="quoted"><span class="quoted">"ordered <span class="skolem">t2</span> <span class="skolem">var</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> Dags.cases<span class="main">)</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">t</span>
            <span class="keyword3"><span class="command">assume</span></span> t_in_repcNodes<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">t</span> <span class="main">⊆</span> <span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ll</span>"</span></span>
            <span class="keyword3"><span class="command">assume</span></span> t_nTip<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">t</span> <span class="main">≠</span> Tip"</span></span>
            <span class="keyword3"><span class="command">assume</span></span> t2t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t2</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span>
            <span class="keyword3"><span class="command">assume</span></span> t_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="skolem">p</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">t</span>"</span></span>
            <span class="keyword1"><span class="command">from</span></span> t_in_repcNodes 
            <span class="keyword1"><span class="command">have</span></span> x_in_repcNodesSucn<span class="main">:</span>  
              <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set_of <span class="skolem">t</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ll</span>"</span></span> 
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">from</span></span> t_nTip t_dag <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> Null"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span>Null"</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">with</span></span> t_nTip t_dag <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lt</span></span> <span class="skolem"><span class="skolem">rt</span></span> <span class="keyword2"><span class="keyword">where</span></span> t_Node<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">=</span>Node <span class="skolem">lt</span> <span class="skolem">p</span> <span class="skolem">rt</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> set_of <span class="skolem">t</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">with</span></span> x_in_repcNodesSucn <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ll</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
              repca_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="skolem">repc</span> <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a_in_NodesSucn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> Nodes <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ll</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">with</span></span> repca_p while_while_prop t_dag t2t <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> conjE exE<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">nort</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span><span class="main">)</span> 
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Dag_unique<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">from</span></span> rep_rep_no t2_in_DagsNodesSucn t2_notin_DagsNodesn ord_t2 while_prop_part wf_ll 
            nsll  repcNodes_in_Nodes <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a2</span></span> <span class="keyword2"><span class="keyword">where</span></span>
            t2_repc_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">a2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">t2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
            a2_in_lln<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a2</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> restrict_root_Node<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_ll_eq<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">with</span></span> wf_ll nsll  <span class="keyword1"><span class="command">have</span></span> a2_in_pret<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a2</span> <span class="main">∈</span> set_of <span class="skolem">pret</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ll_def length_ll_eq<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> wf_ll nsll  a2_in_lln <span class="keyword1"><span class="command">have</span></span> vara2_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="skolem">a2</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ll_def length_ll_eq<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> a2_in_lln rep_prop  <span class="keyword3"><span class="command">obtain</span></span>
            repa2_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">repc</span> <span class="skolem">a2</span> <span class="main">≠</span> Null"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
            repa2_reduce<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">a2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">a2</span> <span class="main">∧</span> <span class="skolem">low</span> <span class="skolem">a2</span> <span class="main">≠</span> Null 
            <span class="main">⟶</span> <span class="skolem">repc</span> <span class="skolem">a2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">a2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
            repa2_share<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">a2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">a2</span> <span class="main">⟶</span> <span class="skolem">low</span> <span class="skolem">a2</span> <span class="main">=</span> Null<span class="main">)</span> 
            <span class="main">⟶</span> <span class="skolem">repc</span> <span class="skolem">a2</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">repc</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">a2</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="skolem">a2</span> <span class="main">∧</span> 
            <span class="main">(</span><span class="main">∀</span><span class="bound">no1</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">a2</span> <span class="main">∧</span> 
            <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">a2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">a2</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="bound">no1</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_depth_limit</span> <span class="main"><span class="main">=</span></span> 4<span class="main">]</span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> t2_repc_dag a2_in_lln repa2_nNull <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lt2</span></span> <span class="skolem"><span class="skolem">rt2</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
            t2_Node<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t2</span> <span class="main">=</span> <span class="main">(</span>Node <span class="skolem">lt2</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">a2</span><span class="main">)</span> <span class="skolem">rt2</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"isomorphic_dags_eq <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="skolem">var</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">a1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">a1</span> <span class="main">∧</span> <span class="skolem">low</span> <span class="skolem">a1</span> <span class="main">≠</span> Null"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">note</span></span> t1_red_cond<span class="main">=</span>this              
            <span class="keyword1"><span class="command">with</span></span> t1_red_cond <span class="keyword1"><span class="command">have</span></span> t1_red_case<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">a1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">a1</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">from</span></span> t1_red_cond <span class="keyword1"><span class="command">have</span></span> lowa1_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">a1</span> <span class="main">≠</span> Null"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">with</span></span> pret_dag prebdt_pret a1_in_pret <span class="keyword1"><span class="command">have</span></span> higha1_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">a1</span> <span class="main">≠</span> Null"</span></span> 
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> balanced_bdt<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">from</span></span> pret_dag ord_pret a1_in_pret lowa1_nNull higha1_nNull 
            <span class="keyword1"><span class="command">have</span></span> var_children_smaller_a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">a1</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">a1</span> <span class="main">∧</span> <span class="skolem">var</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">a1</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">a1</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> var_ordered_children<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">from</span></span> pret_dag a1_in_pret <span class="keyword1"><span class="command">have</span></span> a1_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a1</span> <span class="main">≠</span> Null"</span></span> 
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_of_nn <span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">with</span></span> a1_in_pret higha1_nNull pret_dag <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">a1</span> <span class="main">∈</span> set_of <span class="skolem">pret</span>"</span></span> 
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> subelem_set_of_high<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">with</span></span> wf_ll <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">a1</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">var</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">a1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ll_def<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> a1_in_lln t1_repc_dag var_children_smaller_a1 vara1_n 
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">a1</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> higha1_in_Nodesn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">high</span> <span class="skolem">a1</span><span class="main">)</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nodes_def<span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> rhigha1_in_rNodesn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">a1</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">from</span></span> higha1_in_Nodesn normalize_prop <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rt1</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
              rt1_dag<span class="main">:</span>  <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repb</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">a1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">rt1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
              rt1_in_repbNort<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">rt1</span> <span class="main">⊆</span> <span class="skolem">repb</span> <span class="main">`</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">a1</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">from</span></span> rt1_in_repbNort repbNodes_repcNodes 
            <span class="keyword1"><span class="command">have</span></span> rt1_in_repcNodesn<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">rt1</span> <span class="main">⊆</span> <span class="skolem">repc</span> <span class="main">`</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">from</span></span> rt1_dag higha1_in_Nodesn 
            <span class="keyword1"><span class="command">have</span></span> repcrt1_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">a1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">rt1</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> Nodes_repbc_Dags_eq <span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">have</span></span> rt1_nTip<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rt1</span> <span class="main">≠</span> Tip"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">a1</span><span class="main">)</span> <span class="main">≠</span> Null"</span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command">note</span></span> rhigha1_in_rNodesn
                <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">`</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span> <span class="main">⊆</span> <span class="skolem">repc</span> <span class="main">`</span>Nodes <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ll</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> Nodes_subset 
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> Nodes <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ll</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> repcNodes_in_Nodes
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">using</span></span> null_notin_Nodes_Suc_n
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">with</span></span> repcrt1_dag <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">from</span></span> repa1_reduce lowa1_nNull  higha1_nNull  t1_red_case 
            <span class="keyword1"><span class="command">have</span></span> repc_a1_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="skolem">a1</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">a1</span><span class="main">)</span>"</span></span> 
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> rt1_in_repcNodesn repcrt1_dag rhigha1_in_rNodesn a1_in_lln 
              t1_repc_dag repc_a1_def  rt1_nTip 
            <span class="keyword1"><span class="command">have</span></span> t1_in_Dags_Nodesn<span class="main">:</span> 
              <span class="quoted"><span class="quoted">"<span class="skolem">t1</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> DagsI<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span><span class="main">=</span><span class="skolem">rt1</span>"</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Dag_unique<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">a2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">a2</span> <span class="main">∧</span> <span class="skolem">low</span> <span class="skolem">a2</span> <span class="main">≠</span> Null"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">note</span></span> t2_red_cond<span class="main">=</span>this              
              <span class="keyword1"><span class="command">with</span></span> t2_red_cond <span class="keyword1"><span class="command">have</span></span> t2_red_case<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">a2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">a2</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">from</span></span> t2_red_cond <span class="keyword1"><span class="command">have</span></span> lowa2_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">a2</span> <span class="main">≠</span> Null"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">with</span></span> pret_dag prebdt_pret a2_in_pret <span class="keyword1"><span class="command">have</span></span> higha2_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">a2</span> <span class="main">≠</span> Null"</span></span> 
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> balanced_bdt<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">from</span></span> pret_dag ord_pret a2_in_pret lowa2_nNull higha2_nNull 
              <span class="keyword1"><span class="command">have</span></span> var_children_smaller_a2<span class="main">:</span> 
                <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">a2</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">a2</span> <span class="main">∧</span> <span class="skolem">var</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">a2</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">a2</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> var_ordered_children<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">from</span></span> pret_dag a2_in_pret <span class="keyword1"><span class="command">have</span></span> a2_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a2</span> <span class="main">≠</span> Null"</span></span> 
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_of_nn <span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">with</span></span> a2_in_pret higha2_nNull pret_dag <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">a2</span> <span class="main">∈</span> set_of <span class="skolem">pret</span>"</span></span> 
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> subelem_set_of_high<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">with</span></span> wf_ll <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">a2</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">var</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">a2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ll_def<span class="main">)</span>
              <span class="keyword1"><span class="command">with</span></span> a2_in_lln t2_repc_dag var_children_smaller_a2 vara2_n 
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound"><span class="bound">k</span></span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">a2</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> higha2_in_Nodesn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">high</span> <span class="skolem">a2</span><span class="main">)</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nodes_def<span class="main">)</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> rhigha2_in_rNodesn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">a2</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">from</span></span> higha2_in_Nodesn normalize_prop <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rt2</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
                rt2_dag<span class="main">:</span>  <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repb</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">a2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">rt2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
                rt2_in_repbNort<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">rt2</span> <span class="main">⊆</span> <span class="skolem">repb</span> <span class="main">`</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">a2</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">from</span></span> rt2_in_repbNort repbNodes_repcNodes 
              <span class="keyword1"><span class="command">have</span></span> rt2_in_repcNodesn<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">rt2</span> <span class="main">⊆</span> <span class="skolem">repc</span> <span class="main">`</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">from</span></span> rt2_dag higha2_in_Nodesn 
              <span class="keyword1"><span class="command">have</span></span> repcrt2_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">a2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">rt2</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> Nodes_repbc_Dags_eq <span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">have</span></span> rt2_nTip<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rt2</span> <span class="main">≠</span> Tip"</span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">a2</span><span class="main">)</span> <span class="main">≠</span> Null"</span></span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                  <span class="keyword1"><span class="command">note</span></span> rhigha2_in_rNodesn
                  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">`</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span> <span class="main">⊆</span> <span class="skolem">repc</span> <span class="main">`</span>Nodes <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ll</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> Nodes_subset 
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> Nodes <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ll</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> repcNodes_in_Nodes
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                    <span class="keyword1"><span class="command">using</span></span> null_notin_Nodes_Suc_n
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">with</span></span> repcrt2_dag <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">from</span></span> repa2_reduce lowa2_nNull  higha2_nNull  t2_red_case 
              <span class="keyword1"><span class="command">have</span></span> repc_a2_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="skolem">a2</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">a2</span><span class="main">)</span>"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
              <span class="keyword1"><span class="command">with</span></span> rt2_in_repcNodesn repcrt2_dag rhigha2_in_rNodesn a2_in_lln 
                t2_repc_dag repc_a2_def  rt2_nTip 
              <span class="keyword1"><span class="command">have</span></span> t2_in_Dags_Nodesn<span class="main">:</span> 
                <span class="quoted"><span class="quoted">"<span class="skolem">t2</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> DagsI<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">t2</span><span class="main">=</span><span class="skolem">rt2</span>"</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Dag_unique<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">from</span></span> isomorphic_dags_eq t1_in_Dags_Nodesn t2_in_Dags_Nodesn repbc_dags_eq 
              <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">assume</span></span> t2_share_cond<span class="main">:</span> 
                <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">a2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">a2</span> <span class="main">∧</span> <span class="skolem">low</span> <span class="skolem">a2</span> <span class="main">≠</span> Null<span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">from</span></span> t1_in_Dags_Nodesn t2_notin_DagsNodesn t2_in_DagsNodesSucn 
                isomorphic_dags_eq repbc_dags_eq
              <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mixed_Dags_case<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">assume</span></span> t1_share_cond<span class="main">:</span> 
              <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">a1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">a1</span> <span class="main">∧</span> <span class="skolem">low</span> <span class="skolem">a1</span> <span class="main">≠</span> Null<span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">with</span></span> repa1_share <span class="keyword3"><span class="command">obtain</span></span>
              repca1_in_llbn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="skolem">a1</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
              reprepa1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">a1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="skolem">a1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
              twonodes_llbn_a1<span class="main">:</span> 
              <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">no1</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">a1</span> <span class="main">∧</span> 
              <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">a1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">a1</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="bound">no1</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_depth_limit</span><span class="main"><span class="main">=</span></span>2<span class="main">]</span><span class="main">]</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">a2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">a2</span> <span class="main">∧</span> <span class="skolem">low</span> <span class="skolem">a2</span> <span class="main">≠</span> Null"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">note</span></span> t2_red_cond<span class="main">=</span>this              
              <span class="keyword1"><span class="command">with</span></span> t2_red_cond <span class="keyword1"><span class="command">have</span></span> t2_red_case<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">a2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">a2</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">from</span></span> t2_red_cond <span class="keyword1"><span class="command">have</span></span> lowa2_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">a2</span> <span class="main">≠</span> Null"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">with</span></span> pret_dag prebdt_pret a2_in_pret <span class="keyword1"><span class="command">have</span></span> higha2_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">a2</span> <span class="main">≠</span> Null"</span></span> 
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> balanced_bdt<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">from</span></span> pret_dag ord_pret a2_in_pret lowa2_nNull higha2_nNull 
              <span class="keyword1"><span class="command">have</span></span> var_children_smaller_a2<span class="main">:</span> 
                <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">a2</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">a2</span> <span class="main">∧</span> <span class="skolem">var</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">a2</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">a2</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> var_ordered_children<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">from</span></span> pret_dag a2_in_pret <span class="keyword1"><span class="command">have</span></span> a2_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a2</span> <span class="main">≠</span> Null"</span></span> 
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_of_nn <span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">with</span></span> a2_in_pret higha2_nNull pret_dag <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">a2</span> <span class="main">∈</span> set_of <span class="skolem">pret</span>"</span></span> 
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> subelem_set_of_high<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">with</span></span> wf_ll 
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">a2</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">var</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">a2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ll_def<span class="main">)</span>
              <span class="keyword1"><span class="command">with</span></span> a2_in_lln t2_repc_dag var_children_smaller_a2 vara2_n 
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound"><span class="bound">k</span></span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">a2</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> higha2_in_Nodesn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">high</span> <span class="skolem">a2</span><span class="main">)</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nodes_def<span class="main">)</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> rhigha2_in_rNodesn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">a2</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">from</span></span> higha2_in_Nodesn normalize_prop <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rt2</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
                rt2_dag<span class="main">:</span>  <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repb</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">a2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">rt2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
                rt2_in_repbNort<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">rt2</span> <span class="main">⊆</span> <span class="skolem">repb</span> <span class="main">`</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">a2</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">from</span></span> rt2_in_repbNort repbNodes_repcNodes 
              <span class="keyword1"><span class="command">have</span></span> rt2_in_repcNodesn<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">rt2</span> <span class="main">⊆</span> <span class="skolem">repc</span> <span class="main">`</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">from</span></span> rt2_dag higha2_in_Nodesn 
              <span class="keyword1"><span class="command">have</span></span> repcrt2_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">a2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">rt2</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> Nodes_repbc_Dags_eq <span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">have</span></span> rt2_nTip<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rt2</span> <span class="main">≠</span> Tip"</span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">a2</span><span class="main">)</span> <span class="main">≠</span> Null"</span></span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                  <span class="keyword1"><span class="command">note</span></span> rhigha2_in_rNodesn
                  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">`</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span> <span class="main">⊆</span> <span class="skolem">repc</span> <span class="main">`</span>Nodes <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ll</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> Nodes_subset 
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> Nodes <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ll</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> repcNodes_in_Nodes
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                    <span class="keyword1"><span class="command">using</span></span> null_notin_Nodes_Suc_n
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">with</span></span> repcrt2_dag <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">from</span></span> repa2_reduce lowa2_nNull  higha2_nNull  t2_red_case 
              <span class="keyword1"><span class="command">have</span></span> repc_a2_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="skolem">a2</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">a2</span><span class="main">)</span>"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
              <span class="keyword1"><span class="command">with</span></span> rt2_in_repcNodesn repcrt2_dag rhigha2_in_rNodesn a2_in_lln 
                t2_repc_dag repc_a2_def  rt2_nTip 
              <span class="keyword1"><span class="command">have</span></span> t2_in_Dags_Nodesn<span class="main">:</span> 
                <span class="quoted"><span class="quoted">"<span class="skolem">t2</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> DagsI<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">t2</span><span class="main">=</span><span class="skolem">rt2</span>"</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Dag_unique<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">from</span></span> t2_in_Dags_Nodesn t1_notin_DagsNodesn t1_in_DagsNodesSucn 
                isomorphic_dags_eq repbc_dags_eq 
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"isomorphic_dags_eq <span class="skolem">t2</span> <span class="skolem">t1</span> <span class="skolem">var</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mixed_Dags_case<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isomorphic_dags_eq_sym<span class="main">)</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">assume</span></span> t2_shared_cond<span class="main">:</span> 
                <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">a2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">a2</span> <span class="main">∧</span> <span class="skolem">low</span> <span class="skolem">a2</span> <span class="main">≠</span> Null<span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">with</span></span> repa2_share <span class="keyword3"><span class="command">obtain</span></span>
                repca2_in_llbn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="skolem">a2</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
                reprepa2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">a2</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="skolem">a2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
                twonodes_llbn_a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">no1</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span><span class="main">.</span> 
                <span class="main">(</span><span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">a2</span> <span class="main">∧</span> 
                <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="bound">no1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">a2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">a2</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="bound">no1</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_depth_limit</span><span class="main"><span class="main">=</span></span>2<span class="main">]</span><span class="main">]</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
              <span class="keyword1"><span class="command">from</span></span> twonodes_llbn_a2 a1_in_lln  
              <span class="keyword1"><span class="command">have</span></span> share_a1_a2<span class="main">:</span> 
                <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">a1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">a2</span> <span class="main">∧</span> 
                <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">a1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">a2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">a2</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="skolem">a1</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">from</span></span> twonodes_llbn_a1 repca1_in_llbn reprepa1   
              <span class="keyword1"><span class="command">have</span></span> children_repc_eq_a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">a1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">a1</span> <span class="main">∧</span> 
                <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">a1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">a1</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">from</span></span> twonodes_llbn_a2 repca2_in_llbn reprepa2  
              <span class="keyword1"><span class="command">have</span></span> children_repc_eq_a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">a2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">a2</span> <span class="main">∧</span> 
                <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">a2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">a2</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">from</span></span>  t1_Node t2_Node <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isomorphic_dags_eq_def<span class="main">)</span>
                <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">bdt1</span>
                <span class="keyword3"><span class="command">assume</span></span> t1_bdt<span class="main">:</span> <span class="quoted"><span class="quoted">"bdt <span class="main">(</span>Node <span class="skolem">lt1</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">a1</span><span class="main">)</span> <span class="skolem">rt1</span><span class="main">)</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="skolem">bdt1</span>"</span></span>
                <span class="keyword3"><span class="command">assume</span></span> t2_bdt<span class="main">:</span> <span class="quoted"><span class="quoted">"bdt <span class="main">(</span>Node <span class="skolem">lt2</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">a2</span><span class="main">)</span> <span class="skolem">rt2</span><span class="main">)</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="skolem">bdt1</span>"</span></span>
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lt1</span> <span class="main">=</span> <span class="skolem">lt2</span> <span class="main">∧</span> <span class="skolem">repc</span> <span class="skolem">a1</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="skolem">a2</span> <span class="main">∧</span> <span class="skolem">rt1</span> <span class="main">=</span> <span class="skolem">rt2</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">bdt1</span></span><span class="main">)</span>
                  <span class="keyword3"><span class="command">case</span></span> Zero
                  <span class="keyword1"><span class="command">with</span></span> t1_bdt t1_Node <span class="keyword3"><span class="command">obtain</span></span>
                    lt1_Tip<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lt1</span> <span class="main">=</span> Tip"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
                    rt1_Tip<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rt1</span> <span class="main">=</span> Tip"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">from</span></span> Zero t2_bdt t2_Node <span class="keyword3"><span class="command">obtain</span></span> 
                    lt2_Tip<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lt2</span> <span class="main">=</span> Tip"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
                    rt2_Tip<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rt2</span> <span class="main">=</span> Tip"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">from</span></span> t1_repc_dag t1_Node lt1_Tip <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">a1</span><span class="main">)</span> <span class="main">=</span> Null"</span></span> 
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">with</span></span> children_repc_eq_a1  
                  <span class="keyword1"><span class="command">have</span></span> repc_low_a1_Null<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">a1</span> <span class="main">=</span> Null"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">from</span></span> t1_repc_dag t1_Node rt1_Tip 
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">a1</span><span class="main">)</span> <span class="main">=</span> Null"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">with</span></span> children_repc_eq_a1  
                  <span class="keyword1"><span class="command">have</span></span> repc_high_a1_Null<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">a1</span> <span class="main">=</span> Null"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">from</span></span> t2_repc_dag t2_Node lt2_Tip <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">a2</span><span class="main">)</span> <span class="main">=</span> Null"</span></span> 
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">with</span></span> children_repc_eq_a2  
                  <span class="keyword1"><span class="command">have</span></span> repc_low_a2_Null<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">a2</span> <span class="main">=</span> Null"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">from</span></span> t2_repc_dag t2_Node rt2_Tip 
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">a2</span><span class="main">)</span> <span class="main">=</span> Null"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">with</span></span> children_repc_eq_a2  
                  <span class="keyword1"><span class="command">have</span></span> repc_high_a2_Null<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">a2</span> <span class="main">=</span> Null"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">with</span></span> share_a1_a2   repc_low_a1_Null repc_high_a1_Null 
                    repc_low_a2_Null repc_high_a2_Null
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="skolem">a2</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="skolem">a1</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">with</span></span> lt1_Tip rt1_Tip lt2_Tip rt2_Tip <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">next</span></span>
                  <span class="keyword3"><span class="command">case</span></span> One
                  <span class="keyword1"><span class="command">with</span></span> t1_bdt t1_Node <span class="keyword3"><span class="command">obtain</span></span>
                    lt1_Tip<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lt1</span> <span class="main">=</span> Tip"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
                    rt1_Tip<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rt1</span> <span class="main">=</span> Tip"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">from</span></span> One t2_bdt t2_Node <span class="keyword3"><span class="command">obtain</span></span> 
                    lt2_Tip<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lt2</span> <span class="main">=</span> Tip"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
                    rt2_Tip<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rt2</span> <span class="main">=</span> Tip"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">from</span></span> t1_repc_dag t1_Node lt1_Tip <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">a1</span><span class="main">)</span> <span class="main">=</span> Null"</span></span> 
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">with</span></span> children_repc_eq_a1  
                  <span class="keyword1"><span class="command">have</span></span> repc_low_a1_Null<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">a1</span> <span class="main">=</span> Null"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">from</span></span> t1_repc_dag t1_Node rt1_Tip <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">a1</span><span class="main">)</span> <span class="main">=</span> Null"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">with</span></span> children_repc_eq_a1  
                  <span class="keyword1"><span class="command">have</span></span> repc_high_a1_Null<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">a1</span> <span class="main">=</span> Null"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">from</span></span> t2_repc_dag t2_Node lt2_Tip <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">a2</span><span class="main">)</span> <span class="main">=</span> Null"</span></span> 
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">with</span></span> children_repc_eq_a2  
                  <span class="keyword1"><span class="command">have</span></span> repc_low_a2_Null<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">a2</span> <span class="main">=</span> Null"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">from</span></span> t2_repc_dag t2_Node rt2_Tip <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">a2</span><span class="main">)</span> <span class="main">=</span> Null"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">with</span></span> children_repc_eq_a2  
                  <span class="keyword1"><span class="command">have</span></span> repc_high_a2_Null<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">a2</span> <span class="main">=</span> Null"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">with</span></span> share_a1_a2   repc_low_a1_Null repc_high_a1_Null 
                    repc_low_a2_Null repc_high_a2_Null
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="skolem">a2</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="skolem">a1</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">with</span></span> lt1_Tip rt1_Tip lt2_Tip rt2_Tip <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">next</span></span>
                  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Bdt_Node <span class="skolem">lbdt</span> <span class="skolem">v</span> <span class="skolem">rbdt</span><span class="main">)</span>
                  <span class="keyword1"><span class="command">note</span></span> bdt_Node_case<span class="main">=</span>this
                  <span class="keyword1"><span class="command">with</span></span> t1_bdt t1_Node <span class="keyword3"><span class="command">obtain</span></span>
                    lbdt_def_lt1<span class="main">:</span> <span class="quoted"><span class="quoted">"bdt <span class="skolem">lt1</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="skolem">lbdt</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
                    rbdt_def_rt1<span class="main">:</span> <span class="quoted"><span class="quoted">"bdt <span class="skolem">rt1</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="skolem">rbdt</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">from</span></span> t2_bdt bdt_Node_case t2_Node <span class="keyword3"><span class="command">obtain</span></span>
                    lbdt_def_lt2<span class="main">:</span> <span class="quoted"><span class="quoted">"bdt <span class="skolem">lt2</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="skolem">lbdt</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
                    rbdt_def_rt2<span class="main">:</span> <span class="quoted"><span class="quoted">"bdt <span class="skolem">rt2</span> <span class="skolem">var</span> <span class="main">=</span> Some <span class="skolem">rbdt</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">from</span></span> lbdt_def_lt1 t1_Node t1_repc_dag children_repc_eq_a1  
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">a1</span> <span class="main">≠</span> Null"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> low_a1_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">low</span> <span class="skolem">a1</span><span class="main">)</span> <span class="main">≠</span> Null"</span></span> 
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
                  <span class="keyword1"><span class="command">from</span></span> rbdt_def_rt1 t1_Node t1_repc_dag children_repc_eq_a1  
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">a1</span> <span class="main">≠</span> Null"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> high_a1_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">high</span> <span class="skolem">a1</span><span class="main">)</span> <span class="main">≠</span> Null"</span></span> 
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
                  <span class="keyword1"><span class="command">from</span></span> lbdt_def_lt2 t2_Node t2_repc_dag children_repc_eq_a2  
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">a2</span> <span class="main">≠</span> Null"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> low_a2_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">low</span> <span class="skolem">a2</span><span class="main">)</span> <span class="main">≠</span> Null"</span></span> 
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
                  <span class="keyword1"><span class="command">from</span></span> rbdt_def_rt2 t2_Node t2_repc_dag children_repc_eq_a2  
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">a2</span> <span class="main">≠</span> Null"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> high_a2_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">high</span> <span class="skolem">a2</span><span class="main">)</span> <span class="main">≠</span> Null"</span></span> 
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>

                      <span class="comment1">(*hier gehts um t1*)</span>
                  <span class="keyword1"><span class="command">from</span></span> pret_dag ord_pret a1_in_pret low_a1_nNull high_a1_nNull 
                  <span class="keyword1"><span class="command">have</span></span> var_children_smaller_a1<span class="main">:</span> 
                    <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">a1</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">a1</span> <span class="main">∧</span> <span class="skolem">var</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">a1</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">a1</span>"</span></span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> var_ordered_children<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                  <span class="keyword1"><span class="command">from</span></span> pret_dag a1_in_pret <span class="keyword1"><span class="command">have</span></span> a1_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a1</span> <span class="main">≠</span> Null"</span></span> 
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_of_nn <span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                  
                      <span class="comment1">(*hier gehts um rt1 *)</span>
                  <span class="keyword1"><span class="command">with</span></span> a1_in_pret high_a1_nNull pret_dag <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">a1</span> <span class="main">∈</span> set_of <span class="skolem">pret</span>"</span></span> 
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> subelem_set_of_high<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                  <span class="keyword1"><span class="command">with</span></span> wf_ll 
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">a1</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">var</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">a1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ll_def<span class="main">)</span>
                  <span class="keyword1"><span class="command">with</span></span> a1_in_lln t1_repc_dag var_children_smaller_a1 vara1_n 
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound"><span class="bound">k</span></span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">a1</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> higha1_in_Nodesn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">high</span> <span class="skolem">a1</span><span class="main">)</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nodes_def<span class="main">)</span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> rhigha1_in_rNodesn<span class="main">:</span> 
                    <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">a1</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">from</span></span> higha1_in_Nodesn normalize_prop <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rt1h</span></span> <span class="keyword2"><span class="keyword">where</span></span>
                    rt1_dag<span class="main">:</span>  <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repb</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">a1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">rt1h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
                    rt1_in_repbNort<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">rt1h</span> <span class="main">⊆</span> <span class="skolem">repb</span> <span class="main">`</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">a1</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                  <span class="keyword1"><span class="command">from</span></span> rt1_in_repbNort repbNodes_repcNodes 
                  <span class="keyword1"><span class="command">have</span></span> rt1_in_repcNodesn<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">rt1h</span> <span class="main">⊆</span> <span class="skolem">repc</span> <span class="main">`</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                  <span class="keyword1"><span class="command">from</span></span> rt1_dag higha1_in_Nodesn 
                  <span class="keyword1"><span class="command">have</span></span> repcrt1_dag<span class="main">:</span> 
                    <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">a1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">rt1h</span>"</span></span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> Nodes_repbc_Dags_eq <span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                  <span class="keyword1"><span class="command">from</span></span> t1_Node t1_repc_dag high_a1_nNull children_repc_eq_a1 
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">a1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">rt1</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
                  <span class="keyword1"><span class="command">with</span></span> repcrt1_dag <span class="keyword1"><span class="command">have</span></span> rt1h_rt1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rt1h</span> <span class="main">=</span> <span class="skolem">rt1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Dag_unique<span class="main">)</span>
                  <span class="keyword1"><span class="command">have</span></span> rt1_nTip<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rt1</span> <span class="main">≠</span> Tip"</span></span>
                  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">a1</span><span class="main">)</span> <span class="main">≠</span> Null"</span></span>
                    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                      <span class="keyword1"><span class="command">note</span></span> rhigha1_in_rNodesn
                      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> 
                        <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">`</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span> <span class="main">⊆</span> <span class="skolem">repc</span> <span class="main">`</span>Nodes <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ll</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> Nodes_subset 
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> Nodes <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ll</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> repcNodes_in_Nodes
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                        <span class="keyword1"><span class="command">using</span></span> null_notin_Nodes_Suc_n
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">qed</span></span>
                    <span class="keyword1"><span class="command">with</span></span> repcrt1_dag rt1h_rt1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">qed</span></span>
                  <span class="keyword1"><span class="command">with</span></span> rt1_in_repcNodesn repcrt1_dag rhigha1_in_rNodesn a1_in_lln 
                    t1_repc_dag  rt1h_rt1 
                  <span class="keyword1"><span class="command">have</span></span> rt1_in_Dags_Nodesn<span class="main">:</span> 
                    <span class="quoted"><span class="quoted">"<span class="skolem">rt1</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> DagsI<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 

                  
                      <span class="comment1">(*hier gehts um lt1 *)</span>
                  <span class="keyword1"><span class="command">from</span></span> a1_nNull a1_in_pret low_a1_nNull pret_dag 
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">a1</span> <span class="main">∈</span> set_of <span class="skolem">pret</span>"</span></span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> subelem_set_of_low<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                  <span class="keyword1"><span class="command">with</span></span> wf_ll <span class="keyword1"><span class="command">have</span></span> 
                    <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">a1</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">var</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">a1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ll_def<span class="main">)</span>
                  <span class="keyword1"><span class="command">with</span></span> a1_in_lln t1_repc_dag var_children_smaller_a1 vara1_n 
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound"><span class="bound">k</span></span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">a1</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> lowa1_in_Nodesn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">low</span> <span class="skolem">a1</span><span class="main">)</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nodes_def<span class="main">)</span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> rlowa1_in_rNodesn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">a1</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">from</span></span> lowa1_in_Nodesn normalize_prop <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lt1h</span></span> <span class="keyword2"><span class="keyword">where</span></span>
                    lt1_dag<span class="main">:</span>  <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repb</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">a1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">lt1h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
                    lt1_in_repbNort<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">lt1h</span> <span class="main">⊆</span> <span class="skolem">repb</span> <span class="main">`</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">a1</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                  <span class="keyword1"><span class="command">from</span></span> lt1_in_repbNort repbNodes_repcNodes 
                  <span class="keyword1"><span class="command">have</span></span> lt1_in_repcNodesn<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">lt1h</span> <span class="main">⊆</span> <span class="skolem">repc</span> <span class="main">`</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                  <span class="keyword1"><span class="command">from</span></span> lt1_dag lowa1_in_Nodesn 
                  <span class="keyword1"><span class="command">have</span></span> repclt1_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repc</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">a1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">lt1h</span>"</span></span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> Nodes_repbc_Dags_eq <span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                  <span class="keyword1"><span class="command">from</span></span> t1_Node t1_repc_dag low_a1_nNull children_repc_eq_a1 
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repc</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">a1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">lt1</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
                  <span class="keyword1"><span class="command">with</span></span> repclt1_dag <span class="keyword1"><span class="command">have</span></span> lt1h_lt1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lt1h</span> <span class="main">=</span> <span class="skolem">lt1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Dag_unique<span class="main">)</span>
                  <span class="keyword1"><span class="command">have</span></span> lt1_nTip<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lt1</span> <span class="main">≠</span> Tip"</span></span>
                  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">a1</span><span class="main">)</span> <span class="main">≠</span> Null"</span></span>
                    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                      <span class="keyword1"><span class="command">note</span></span> rlowa1_in_rNodesn
                      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> 
                        <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">`</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span> <span class="main">⊆</span> <span class="skolem">repc</span> <span class="main">`</span>Nodes <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ll</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> Nodes_subset 
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> Nodes <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ll</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> repcNodes_in_Nodes
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                        <span class="keyword1"><span class="command">using</span></span> null_notin_Nodes_Suc_n
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">qed</span></span>
                    <span class="keyword1"><span class="command">with</span></span> repclt1_dag lt1h_lt1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">qed</span></span>
                  <span class="keyword1"><span class="command">with</span></span> lt1_in_repcNodesn repclt1_dag rlowa1_in_rNodesn a1_in_lln 
                    t1_repc_dag  lt1h_lt1 
                  <span class="keyword1"><span class="command">have</span></span> lt1_in_Dags_Nodesn<span class="main">:</span> 
                    <span class="quoted"><span class="quoted">"<span class="skolem">lt1</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> DagsI<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
                  
                  
                      <span class="comment1">(*hier gehts um t2*)</span>
                  <span class="keyword1"><span class="command">from</span></span> pret_dag ord_pret a2_in_pret low_a2_nNull high_a2_nNull 
                  <span class="keyword1"><span class="command">have</span></span> var_children_smaller_a2<span class="main">:</span> 
                    <span class="quoted"><span class="quoted">"<span class="skolem">var</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">a2</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">a2</span> <span class="main">∧</span> <span class="skolem">var</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">a2</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">var</span> <span class="skolem">a2</span>"</span></span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> var_ordered_children<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                  <span class="keyword1"><span class="command">from</span></span> pret_dag a2_in_pret <span class="keyword1"><span class="command">have</span></span> a2_nNull<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a2</span> <span class="main">≠</span> Null"</span></span> 
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_of_nn <span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                  
                      <span class="comment1">(*hier gehts um rt1 *)</span>
                  <span class="keyword1"><span class="command">with</span></span> a2_in_pret high_a2_nNull pret_dag <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">a2</span> <span class="main">∈</span> set_of <span class="skolem">pret</span>"</span></span> 
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> subelem_set_of_high<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                  <span class="keyword1"><span class="command">with</span></span> wf_ll <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">a2</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">var</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">a2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ll_def<span class="main">)</span>
                  <span class="keyword1"><span class="command">with</span></span> a2_in_lln t2_repc_dag var_children_smaller_a2 vara2_n 
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound"><span class="bound">k</span></span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">a2</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> higha2_in_Nodesn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">high</span> <span class="skolem">a2</span><span class="main">)</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nodes_def<span class="main">)</span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> rhigha2_in_rNodesn<span class="main">:</span> 
                    <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">a2</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">from</span></span> higha2_in_Nodesn normalize_prop <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rt2h</span></span> <span class="keyword2"><span class="keyword">where</span></span>
                    rt2_dag<span class="main">:</span>  <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repb</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">a2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">rt2h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
                    rt2_in_repbNort<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">rt2h</span> <span class="main">⊆</span> <span class="skolem">repb</span> <span class="main">`</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">high</span> <span class="skolem">a2</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                  <span class="keyword1"><span class="command">from</span></span> rt2_in_repbNort repbNodes_repcNodes 
                  <span class="keyword1"><span class="command">have</span></span> rt2_in_repcNodesn<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">rt2h</span> <span class="main">⊆</span> <span class="skolem">repc</span> <span class="main">`</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                  <span class="keyword1"><span class="command">from</span></span> rt2_dag higha2_in_Nodesn 
                  <span class="keyword1"><span class="command">have</span></span> repcrt2_dag<span class="main">:</span> 
                    <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">a2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">rt2h</span>"</span></span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> Nodes_repbc_Dags_eq <span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                  <span class="keyword1"><span class="command">from</span></span> t2_Node t2_repc_dag high_a2_nNull children_repc_eq_a2 
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">a2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">rt2</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
                  <span class="keyword1"><span class="command">with</span></span> repcrt2_dag <span class="keyword1"><span class="command">have</span></span> rt2h_rt2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rt2h</span> <span class="main">=</span> <span class="skolem">rt2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Dag_unique<span class="main">)</span>
                  <span class="keyword1"><span class="command">have</span></span> rt2_nTip<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rt2</span> <span class="main">≠</span> Tip"</span></span>
                  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">(</span><span class="skolem">high</span> <span class="skolem">a2</span><span class="main">)</span> <span class="main">≠</span> Null"</span></span>
                    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                      <span class="keyword1"><span class="command">note</span></span> rhigha2_in_rNodesn
                      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> 
                        <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">`</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span> <span class="main">⊆</span> <span class="skolem">repc</span> <span class="main">`</span>Nodes <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ll</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> Nodes_subset 
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> Nodes <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ll</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> repcNodes_in_Nodes
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                        <span class="keyword1"><span class="command">using</span></span> null_notin_Nodes_Suc_n
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">qed</span></span>
                    <span class="keyword1"><span class="command">with</span></span> repcrt2_dag rt2h_rt2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">qed</span></span>
                  <span class="keyword1"><span class="command">with</span></span> rt2_in_repcNodesn repcrt2_dag rhigha2_in_rNodesn a2_in_lln 
                    t2_repc_dag  rt2h_rt2 
                  <span class="keyword1"><span class="command">have</span></span> rt2_in_Dags_Nodesn<span class="main">:</span> 
                    <span class="quoted"><span class="quoted">"<span class="skolem">rt2</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> DagsI<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 

                  
                      <span class="comment1">(*hier gehts um lt2 *)</span>
                  <span class="keyword1"><span class="command">from</span></span> a2_nNull a2_in_pret low_a2_nNull pret_dag 
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">a2</span> <span class="main">∈</span> set_of <span class="skolem">pret</span>"</span></span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> subelem_set_of_low<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                  <span class="keyword1"><span class="command">with</span></span> wf_ll <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">a2</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">var</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">a2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_ll_def<span class="main">)</span>
                  <span class="keyword1"><span class="command">with</span></span> a2_in_lln t2_repc_dag var_children_smaller_a2 vara2_n 
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound"><span class="bound">k</span></span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">a2</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">ll</span> <span class="main">!</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> lowa2_in_Nodesn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">low</span> <span class="skolem">a2</span><span class="main">)</span> <span class="main">∈</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nodes_def<span class="main">)</span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> rlowa2_in_rNodesn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">a2</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">from</span></span> lowa2_in_Nodesn normalize_prop <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lt2h</span></span> <span class="keyword2"><span class="keyword">where</span></span>
                    lt2_dag<span class="main">:</span>  <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repb</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">a2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repb</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">lt2h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
                    lt2_in_repbNort<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">lt2h</span> <span class="main">⊆</span> <span class="skolem">repb</span> <span class="main">`</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">low</span> <span class="skolem">a2</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                  <span class="keyword1"><span class="command">from</span></span> lt2_in_repbNort repbNodes_repcNodes 
                  <span class="keyword1"><span class="command">have</span></span> lt2_in_repcNodesn<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="skolem">lt2h</span> <span class="main">⊆</span> <span class="skolem">repc</span> <span class="main">`</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                  <span class="keyword1"><span class="command">from</span></span> lt2_dag lowa2_in_Nodesn 
                  <span class="keyword1"><span class="command">have</span></span> repclt2_dag<span class="main">:</span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repc</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">a2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">lt2h</span>"</span></span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> Nodes_repbc_Dags_eq <span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                  <span class="keyword1"><span class="command">from</span></span> t2_Node t2_repc_dag low_a2_nNull children_repc_eq_a2 
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Dag <span class="main">(</span><span class="skolem">repc</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">a2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">lt2</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> null_comp_def<span class="main">)</span>
                  <span class="keyword1"><span class="command">with</span></span> repclt2_dag <span class="keyword1"><span class="command">have</span></span> lt2h_lt2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lt2h</span> <span class="main">=</span> <span class="skolem">lt2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Dag_unique<span class="main">)</span>
                  <span class="keyword1"><span class="command">have</span></span> lt2_nTip<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lt2</span> <span class="main">≠</span> Tip"</span></span>
                  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">(</span><span class="skolem">low</span> <span class="skolem">a2</span><span class="main">)</span> <span class="main">≠</span> Null"</span></span>
                    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                      <span class="keyword1"><span class="command">note</span></span> rlowa2_in_rNodesn
                      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> 
                        <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="main">`</span>Nodes <span class="skolem">n</span> <span class="skolem">ll</span> <span class="main">⊆</span> <span class="skolem">repc</span> <span class="main">`</span>Nodes <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ll</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> Nodes_subset 
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> Nodes <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">ll</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> repcNodes_in_Nodes
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                        <span class="keyword1"><span class="command">using</span></span> null_notin_Nodes_Suc_n
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">qed</span></span>
                    <span class="keyword1"><span class="command">with</span></span> repclt2_dag lt2h_lt2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">qed</span></span>
                  <span class="keyword1"><span class="command">with</span></span> lt2_in_repcNodesn repclt2_dag rlowa2_in_rNodesn a2_in_lln 
                    t2_repc_dag  lt2h_lt2 
                  <span class="keyword1"><span class="command">have</span></span> lt2_in_Dags_Nodesn<span class="main">:</span> 
                    <span class="quoted"><span class="quoted">"<span class="skolem">lt2</span> <span class="main">∈</span> Dags <span class="main">(</span><span class="skolem">repc</span> <span class="main">`</span> Nodes <span class="skolem">n</span> <span class="skolem">ll</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> DagsI<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
                  
                  
                  <span class="keyword1"><span class="command">from</span></span> isomorphic_dags_eq lt1_in_Dags_Nodesn lt2_in_Dags_Nodesn repbc_dags_eq 
                  <span class="keyword1"><span class="command">have</span></span> shared_lt1_lt2<span class="main">:</span> <span class="quoted"><span class="quoted">"isomorphic_dags_eq <span class="skolem">lt1</span> <span class="skolem">lt2</span> <span class="skolem">var</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">from</span></span> isomorphic_dags_eq rt1_in_Dags_Nodesn rt2_in_Dags_Nodesn repbc_dags_eq 
                  <span class="keyword1"><span class="command">have</span></span> shared_rt1_rt2<span class="main">:</span> <span class="quoted"><span class="quoted">"isomorphic_dags_eq <span class="skolem">rt1</span> <span class="skolem">rt2</span> <span class="skolem">var</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  
                  <span class="keyword1"><span class="command">from</span></span> shared_lt1_lt2 lbdt_def_lt1 lbdt_def_lt2 <span class="keyword1"><span class="command">have</span></span> lt1_lt2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lt1</span> <span class="main">=</span> <span class="skolem">lt2</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isomorphic_dags_eq_def<span class="main">)</span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> root_lt1_lt2<span class="main">:</span> <span class="quoted"><span class="quoted">"root <span class="skolem">lt1</span> <span class="main">=</span> root <span class="skolem">lt2</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">from</span></span> lt1_nTip t1_repc_dag t1_Node <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">a1</span><span class="main">)</span> <span class="main">≠</span> Null"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">with</span></span> lt1_nTip t1_repc_dag t1_Node <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">llt1</span></span> <span class="skolem"><span class="skolem">lt1p</span></span> <span class="skolem"><span class="skolem">rlt1</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
                    lt1_Node<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lt1</span> <span class="main">=</span> Node <span class="skolem">llt1</span> <span class="skolem">lt1p</span> <span class="skolem">rlt1</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">with</span></span> t1_repc_dag t1_Node children_repc_eq_a1 lt1_nTip 
                  <span class="keyword1"><span class="command">have</span></span> root_lt1<span class="main">:</span> <span class="quoted"><span class="quoted">"root <span class="skolem">lt1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">a1</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">from</span></span> lt2_nTip t2_repc_dag t2_Node <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">a2</span><span class="main">)</span> <span class="main">≠</span> Null"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">with</span></span> lt2_nTip t2_repc_dag t2_Node <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">llt2</span></span> <span class="skolem"><span class="skolem">lt2p</span></span> <span class="skolem"><span class="skolem">rlt2</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
                    lt2_Node<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lt2</span> <span class="main">=</span> Node <span class="skolem">llt2</span> <span class="skolem">lt2p</span> <span class="skolem">rlt2</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">with</span></span> t2_repc_dag t2_Node children_repc_eq_a2 lt2_nTip 
                  <span class="keyword1"><span class="command">have</span></span> root_lt2<span class="main">:</span> <span class="quoted"><span class="quoted">"root <span class="skolem">lt2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">a2</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">from</span></span> root_lt1_lt2 root_lt2 root_lt1 
                  <span class="keyword1"><span class="command">have</span></span> low_a1_a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">a1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">low</span><span class="main">)</span> <span class="skolem">a2</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">from</span></span> shared_rt1_rt2 rbdt_def_rt1 rbdt_def_rt2 <span class="keyword1"><span class="command">have</span></span> rt1_rt2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rt1</span> <span class="main">=</span> <span class="skolem">rt2</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isomorphic_dags_eq_def<span class="main">)</span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> root_rt1_rt2<span class="main">:</span> <span class="quoted"><span class="quoted">"root <span class="skolem">rt1</span> <span class="main">=</span> root <span class="skolem">rt2</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">from</span></span> rt1_nTip t1_repc_dag t1_Node <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">a1</span><span class="main">)</span> <span class="main">≠</span> Null"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">with</span></span> rt1_nTip t1_repc_dag t1_Node <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lrt1</span></span> <span class="skolem"><span class="skolem">rt1p</span></span> <span class="skolem"><span class="skolem">rrt1</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
                    rt1_Node<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rt1</span> <span class="main">=</span> Node <span class="skolem">lrt1</span> <span class="skolem">rt1p</span> <span class="skolem">rrt1</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">with</span></span> t1_repc_dag t1_Node children_repc_eq_a1 rt1_nTip 
                  <span class="keyword1"><span class="command">have</span></span> root_rt1<span class="main">:</span> <span class="quoted"><span class="quoted">"root <span class="skolem">rt1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">a1</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">from</span></span> rt2_nTip t2_repc_dag t2_Node 
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="main">(</span><span class="skolem">repc</span> <span class="skolem">a2</span><span class="main">)</span> <span class="main">≠</span> Null"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">with</span></span> rt2_nTip t2_repc_dag t2_Node <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lrt2</span></span> <span class="skolem"><span class="skolem">rt2p</span></span> <span class="skolem"><span class="skolem">rrt2</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
                    rt2_Node<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rt2</span> <span class="main">=</span> Node <span class="skolem">lrt2</span> <span class="skolem">rt2p</span> <span class="skolem">rrt2</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">with</span></span> t2_repc_dag t2_Node children_repc_eq_a2 rt2_nTip 
                  <span class="keyword1"><span class="command">have</span></span> root_rt2<span class="main">:</span> <span class="quoted"><span class="quoted">"root <span class="skolem">rt2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">a2</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">from</span></span> root_rt1_rt2 root_rt2 root_rt1 
                  <span class="keyword1"><span class="command">have</span></span> high_a1_a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">a1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">repc</span> <span class="main">∝</span> <span class="skolem">high</span><span class="main">)</span> <span class="skolem">a2</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">from</span></span> low_a1_a2 high_a1_a2 share_a1_a2   
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">repc</span> <span class="skolem">a1</span> <span class="main">=</span> <span class="skolem">repc</span> <span class="skolem">a2</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">with</span></span> lt1_lt2 rt1_rt2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">from</span></span> termi dags_shared while_while_prop repcNodes_in_Nodes repc_nc n_var_prop 
          wf_marking_m_ma  
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> srrl_precond all_nodes_same_var 
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>