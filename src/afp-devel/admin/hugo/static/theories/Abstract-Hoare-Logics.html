<div id="Lang">
<div class="head">
<h1>Theory Lang</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       A while language
    Author:      Tobias Nipkow, 2001/2006
    Maintainer:  Tobias Nipkow
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Hoare Logics for While"</span></span>

<span class="keyword1"><span class="command">theory</span></span> Lang <span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹The language \label{sec:lang}›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We start by declaring a type of states:›</span></span>

<span class="keyword1"><span class="command">typedecl</span></span> state

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹\noindent
Our approach is completely parametric in the state space.
We define expressions (<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>bexp›</span></span></span></span>) as functions from states
to the booleans:›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> bexp <span class="main">=</span> <span class="quoted"><span class="quoted">"state <span class="main">⇒</span> bool"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
Instead of modelling the syntax of boolean expressions, we
model their semantics. The (abstract and concrete)
syntax of our programming is defined as a recursive datatype:
›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> com <span class="main">=</span> Do <span class="quoted"><span class="quoted">"<span class="main">(</span>state <span class="main">⇒</span> state set<span class="main">)</span>"</span></span>
             <span class="main">|</span> Semi  <span class="quoted">com</span> <span class="quoted">com</span>            <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span>  <span class="main">[</span>60<span class="main">,</span> 60<span class="main">]</span> 10<span class="main">)</span>
             <span class="main">|</span> Cond  <span class="quoted">bexp</span> <span class="quoted">com</span> <span class="quoted">com</span>     <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">IF</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">THEN</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">ELSE</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span>  60<span class="main">)</span>
             <span class="main">|</span> While <span class="quoted">bexp</span> <span class="quoted">com</span>           <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">WHILE</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">DO</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span>  60<span class="main">)</span>
             <span class="main">|</span> Local <span class="quoted"><span class="quoted">"<span class="main">(</span>state <span class="main">⇒</span> state<span class="main">)</span>"</span></span> <span class="quoted">com</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>state <span class="main">⇒</span> state <span class="main">⇒</span> state<span class="main">)</span>"</span></span>
               <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">LOCAL</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span> <span class="main">[</span>0<span class="main">,</span>0<span class="main">,</span>60<span class="main">]</span> 60<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹\noindent Statements in this language are called
\emph{commands}.  They are modelled as terms of type <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span>
<span class="quoted"><span class="quoted">com</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span><span class="quoted"><span class="quoted">"Do <span class="free"><span class="free">f</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> represents an atomic nondeterministic command that
changes the state from <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">s</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> to some element of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span><span class="quoted"><span class="quoted">"<span class="free"><span class="free">f</span></span> <span class="free"><span class="free">s</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
Thus the command that does nothing, often called \texttt{skip}, can be
represented by <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span><span class="quoted"><span class="quoted">"Do<span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">s</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">{</span></span><span class="bound"><span class="bound">s</span></span><span class="main"><span class="main">}</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. Again we have chosen to model the
semantics rather than the syntax, which simplifies matters
enormously. Of course it means that we can no longer talk about
certain syntactic matters, but that is just fine.

The constructors <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">Semi</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">Cond</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">While</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
represent sequential composition, conditional and while-loop.
The annotations allow us to write
\begin{center}
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span><span class="quoted"><span class="quoted">"<span class="free"><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main"><span class="main">;</span></span><span class="free"><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> \qquad <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span><span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1">IF</span></span> <span class="free"><span class="free">b</span></span> <span class="keyword1"><span class="keyword1">THEN</span></span> <span class="free"><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="keyword1"><span class="keyword1">ELSE</span></span> <span class="free"><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
 \qquad <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span><span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1">WHILE</span></span> <span class="free"><span class="free">b</span></span> <span class="keyword1"><span class="keyword1">DO</span></span> <span class="free"><span class="free">c</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
\end{center}
instead of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span>[source]<span class="quoted"><span class="quoted">"Semi <span class="free"><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="free"><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span>[source]<span class="quoted"><span class="quoted">"Cond <span class="free"><span class="free">b</span></span> <span class="free"><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="free"><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span>[source]<span class="quoted"><span class="quoted">"While <span class="free"><span class="free">b</span></span> <span class="free"><span class="free">c</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.

The command <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span><span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1">LOCAL</span></span> <span class="free"><span class="free">f</span></span><span class="main"><span class="main">;</span></span><span class="free"><span class="free">c</span></span><span class="main"><span class="main">;</span></span><span class="free"><span class="free">g</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> applies function <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>f›</span></span></span></span> to the state,
executes <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">c</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, and then combines initial and final state via function
<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>g›</span></span></span></span>. More below.
The semantics of commands is defined inductively by a so-called
big-step semantics.›</span></span>

<span class="keyword1"><span class="command">inductive</span></span>
  <span class="entity">exec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"state <span class="main">⇒</span> com <span class="main">⇒</span> state <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword3">/ </span><span class="keyword1">-</span>_<span class="keyword1">→</span><span class="keyword3">/ </span>_"</span> <span class="main">[</span>50<span class="main">,</span>0<span class="main">,</span>50<span class="main">]</span> 50<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="comment1">(*&lt;*)</span>Do<span class="main">:</span><span class="comment1">(*&gt;*)</span><span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span>Do <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span>

<span class="main">|</span> <span class="comment1">(*&lt;*)</span>Semi<span class="main">:</span><span class="comment1">(*&gt;*)</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">s0</span></span></span> <span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">s0</span></span></span> <span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span>"</span></span>

<span class="main">|</span> <span class="comment1">(*&lt;*)</span>IfT<span class="main">:</span><span class="comment1">(*&gt;*)</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span>  <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span>
<span class="main">|</span> <span class="comment1">(*&lt;*)</span>IfF<span class="main">:</span><span class="comment1">(*&gt;*)</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">¬</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span>

<span class="main">|</span> <span class="comment1">(*&lt;*)</span>WhileF<span class="main">:</span><span class="comment1">(*&gt;*)</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span><span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>
<span class="main">|</span> <span class="comment1">(*&lt;*)</span>WhileT<span class="main">:</span><span class="comment1">(*&gt;*)</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main"><span class="free">-</span></span><span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span><span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span>"</span></span>

<span class="main">|</span> <span class="comment1">(*&lt;*)</span>Local<span class="main">:</span><span class="comment1">(*&gt;*)</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span><span class="keyword1">LOCAL</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Assuming that the state is a function from variables to values,
the declaration of a new local variable <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>x›</span></span></span></span> with inital value
<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>a›</span></span></span></span> can be modelled as
<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>LOCAL (λs. s(x := a s)); c; (λs t. t(x := s x))›</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> exec_Do_iff<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">-</span>Do <span class="free">f</span><span class="main">→</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">t</span> <span class="main">∈</span> <span class="free">f</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> exec.cases <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>exec.intros<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">-</span><span class="free">c</span><span class="main">;</span><span class="free">d</span><span class="main">→</span> <span class="free">u</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="free">s</span> <span class="main">-</span><span class="free">c</span><span class="main">→</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">-</span><span class="free">d</span><span class="main">→</span> <span class="free">u</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">best</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> exec.cases <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>exec.intros<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">-</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> <span class="free">c</span> <span class="keyword1">ELSE</span> <span class="free">d</span><span class="main">→</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span>
              <span class="main">(</span><span class="free">s</span> <span class="main">-</span><span class="keyword1">if</span> <span class="free">b</span> <span class="free">s</span> <span class="keyword1">then</span> <span class="free">c</span> <span class="keyword1">else</span> <span class="free">d</span><span class="main">→</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> exec.cases <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>exec.intros<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">-</span><span class="keyword1">LOCAL</span> <span class="free">f</span><span class="main">;</span> <span class="free">c</span><span class="main">;</span> <span class="free">g</span><span class="main">→</span> <span class="free">u</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="free">f</span> <span class="free">s</span> <span class="main">-</span><span class="free">c</span><span class="main">→</span> <span class="bound">t</span> <span class="main">∧</span> <span class="free">u</span> <span class="main">=</span> <span class="free">g</span> <span class="free">s</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> exec.cases <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>exec.intros<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> unfold_while<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">-</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">→</span> <span class="free">u</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="free">s</span> <span class="main">-</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> <span class="free">c</span><span class="main">;</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span> <span class="keyword1">ELSE</span> Do<span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">{</span><span class="bound">s</span><span class="main">}</span><span class="main">)</span><span class="main">→</span> <span class="free">u</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> exec.cases <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>exec.intros <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_split_asm<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> while_lemma<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">-</span><span class="free">w</span><span class="main">→</span> <span class="free">t</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">b</span> <span class="bound">c</span><span class="main">.</span> <span class="free">w</span> <span class="main">=</span> <span class="keyword1">WHILE</span> <span class="bound">b</span> <span class="keyword1">DO</span> <span class="bound">c</span> <span class="main">∧</span> <span class="free">P</span> <span class="free">s</span> <span class="main">∧</span>
                    <span class="main">(</span><span class="main">∀</span><span class="bound">s</span> <span class="bound">s'</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">∧</span> <span class="bound">b</span> <span class="bound">s</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">-</span><span class="bound">c</span><span class="main">→</span> <span class="bound">s'</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">P</span> <span class="free">t</span> <span class="main">∧</span> <span class="main">¬</span><span class="bound">b</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exec.induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="improper">t</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> while_rule<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">s</span> <span class="main">-</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">→</span> <span class="free">t</span><span class="main">;</span> <span class="free">P</span> <span class="free">s</span><span class="main">;</span> <span class="main">∀</span><span class="bound">s</span> <span class="bound">s'</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">∧</span> <span class="free">b</span> <span class="bound">s</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">-</span><span class="free">c</span><span class="main">→</span> <span class="bound">s'</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">s'</span><span class="main">⟧</span>
  <span class="main">⟹</span> <span class="free">P</span> <span class="free">t</span> <span class="main">∧</span> <span class="main">¬</span><span class="free">b</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> while_lemma<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Hoare">
<div class="head">
<h1>Theory Hoare</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Inductive definition of Hoare logic
    Author:      Tobias Nipkow, 2001/2006
    Maintainer:  Tobias Nipkow
*)</span>

<span class="keyword1"><span class="command">theory</span></span> Hoare <span class="keyword2"><span class="keyword">imports</span></span> <a href="Lang.html">Lang</a> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Hoare logic for partial correctness›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We continue our semantic approach by modelling assertions just
like boolean expressions, i.e.\ as functions:›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> assn <span class="main">=</span> <span class="quoted"><span class="quoted">"state <span class="main">⇒</span> bool"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Hoare triples are triples of the form <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>{P} c {Q}›</span></span></span></span>, where
the assertions <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>P›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Q›</span></span></span></span> are the so-called pre and
postconditions. Such a triple is \emph{valid} (denoted by <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>⊨›</span></span></span></span>)
iff every (terminating) execution starting in a state satisfying <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>P›</span></span></span></span>
ends up in a state satisfying <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Q›</span></span></span></span>:›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">hoare_valid</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"assn <span class="main">⇒</span> com <span class="main">⇒</span> assn <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⊨</span> <span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span><span class="keyword3">/ </span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword3">/ </span><span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⊨</span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">s</span> <span class="main">-</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">→</span> <span class="bound">t</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">t</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹\noindent
This notion of validity is called \emph{partial correctness} because
it does not require termination of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">c</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.

Provability in Hoare logic is indicated by <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>⊢›</span></span></span></span> and defined
inductively:›</span></span>

<span class="keyword1"><span class="command">inductive</span></span>
  <span class="entity">hoare</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"assn <span class="main">⇒</span> com <span class="main">⇒</span> assn <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⊢</span> <span class="keyword3">(</span><span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span><span class="keyword3">/ </span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword3">/ </span><span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span><span class="keyword3">)</span>"</span> 50<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="comment1">(*&lt;*)</span>Do<span class="main">:</span><span class="comment1">(*&gt;*)</span><span class="quoted"><span class="quoted">"<span class="main"><span class="free">⊢</span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">∀</span><span class="bound">t</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">t</span><span class="main"><span class="free">}</span></span> Do <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>

<span class="main">|</span> <span class="comment1">(*&lt;*)</span>Semi<span class="main">:</span><span class="comment1">(*&gt;*)</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main"><span class="free">⊢</span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span><span class="main">;</span>  <span class="main"><span class="free">⊢</span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main"><span class="free">}</span></span> <span class="main">⟧</span>  <span class="main">⟹</span>  <span class="main"><span class="free">⊢</span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>

<span class="main">|</span> <span class="comment1">(*&lt;*)</span>If<span class="main">:</span><span class="comment1">(*&gt;*)</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main"><span class="free">⊢</span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">s</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span><span class="main">;</span>  <span class="main"><span class="free">⊢</span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">¬</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span> <span class="main">⟧</span>
  <span class="main">⟹</span> <span class="main"><span class="free">⊢</span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span> <span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>

<span class="main">|</span> <span class="comment1">(*&lt;*)</span>While<span class="main">:</span><span class="comment1">(*&gt;*)</span><span class="quoted"><span class="quoted">"<span class="main"><span class="free">⊢</span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">s</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span>  <span class="main">⟹</span>  <span class="main"><span class="free">⊢</span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">¬</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span><span class="main"><span class="free">}</span></span>"</span></span>

<span class="main">|</span> <span class="comment1">(*&lt;*)</span>Conseq<span class="main">:</span><span class="comment1">(*&gt;*)</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P'</span></span></span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">s</span><span class="main">;</span>  <span class="main"><span class="free">⊢</span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span><span class="main">;</span>  <span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">Q'</span></span></span> <span class="bound">s</span>  <span class="main">⟧</span>  <span class="main">⟹</span>  <span class="main"><span class="free">⊢</span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P'</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q'</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>

<span class="main">|</span> <span class="comment1">(*&lt;*)</span>Local<span class="main">:</span><span class="comment1">(*&gt;*)</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">s</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">P'</span></span></span> <span class="bound">s</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">s</span><span class="main">)</span><span class="main">;</span> <span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="main"><span class="free">⊢</span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P'</span></span></span> <span class="bound">s</span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">∘</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">s</span><span class="main">)</span><span class="main"><span class="free">}</span></span> <span class="main">⟧</span> <span class="main">⟹</span>
        <span class="main"><span class="free">⊢</span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span> <span class="keyword1">LOCAL</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Soundness is proved by induction on the derivation of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">prop</span></span><span class="quoted"><span class="quoted">"<span class="main"><span class="main">⊢</span></span>
<span class="main"><span class="main">{</span></span><span class="free"><span class="free">P</span></span><span class="main"><span class="main">}</span></span> <span class="free"><span class="free">c</span></span> <span class="main"><span class="main">{</span></span><span class="free"><span class="free">Q</span></span><span class="main"><span class="main">}</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>:›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> hoare_sound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span>  <span class="main">⟹</span>  <span class="main">⊨</span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> hoare_valid_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> hoare.induct<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> while_rule<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 3
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> mp<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
Completeness is not quite as straightforward, but still easy. The
proof is best explained in terms of the \emph{weakest precondition}:›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">wp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"com <span class="main">⇒</span> assn <span class="main">⇒</span> assn"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">wp</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="bound">s</span> <span class="main">-</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">→</span> <span class="bound">t</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">t</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹\noindent Dijkstra calls this the weakest \emph{liberal}
precondition to emphasize that it corresponds to partial
correctness. We use ``weakest precondition'' all the time and let the
context determine if we talk about partial or total correctness ---
the latter is introduced further below.

The following lemmas about <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">wp</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> are easily derived:
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wp <span class="main">(</span>Do <span class="free">f</span><span class="main">)</span> <span class="free">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">∀</span><span class="bound">t</span> <span class="main">∈</span> <span class="free">f</span> <span class="bound">s</span><span class="main">.</span> <span class="free">Q</span><span class="main">(</span><span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> wp_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wp <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">;</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">R</span> <span class="main">=</span> wp <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>wp <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">R</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> wp_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"wp <span class="main">(</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">ELSE</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> wp <span class="main">(</span><span class="keyword1">if</span> <span class="free">b</span> <span class="bound">s</span> <span class="keyword1">then</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">else</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">Q</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> wp_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> wp_while<span class="main">:</span>
 <span class="quoted"><span class="quoted">"wp <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span> <span class="main">=</span>
           <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">b</span> <span class="bound">s</span> <span class="keyword1">then</span> wp <span class="main">(</span><span class="free">c</span><span class="main">;</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span> <span class="bound">s</span> <span class="keyword1">else</span> <span class="free">Q</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> wp_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>exec.intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>unfold_while<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>exec.intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>unfold_while<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"wp <span class="main">(</span><span class="keyword1">LOCAL</span> <span class="free">f</span><span class="main">;</span><span class="free">c</span><span class="main">;</span><span class="free">g</span><span class="main">)</span> <span class="free">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> wp <span class="free">c</span> <span class="main">(</span><span class="free">Q</span> <span class="keyword1">o</span> <span class="main">(</span><span class="free">g</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> wp_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> strengthen_pre<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">P'</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">s</span><span class="main">;</span> <span class="main">⊢</span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span>  <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">⊢</span> <span class="main">{</span><span class="free">P'</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">erule</span> hoare.Conseq<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> weaken_post<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">⊢</span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span><span class="main">;</span> <span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">Q'</span> <span class="bound">s</span>  <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">⊢</span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q'</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hoare.Conseq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹By induction on <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">c</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> one can easily prove›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> wp_is_pre<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">{</span>wp <span class="free">c</span> <span class="free">Q</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span><span class="free">Q</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Q</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>hoare.Do hoare.Conseq<span class="main">)</span>

<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>hoare.Semi hoare.Conseq<span class="main">)</span>

<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>hoare.If hoare.Conseq<span class="main">)</span>

<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> weaken_post<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hoare.While<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> strengthen_pre<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> fun_eq_iff<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> wp_while<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> spec<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> fun_eq_iff<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> wp_while<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> spec<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_split_asm<span class="main">)</span>

<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> hoare.Local<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹\noindent
from which completeness follows more or less directly via the
rule of consequence:›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> hoare_relative_complete<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span>  <span class="main">⟹</span>  <span class="main">⊢</span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> strengthen_pre<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ wp_is_pre<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> hoare_valid_def wp_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Termi">
<div class="head">
<h1>Theory Termi</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Inductive definition of termination
    Author:      Tobias Nipkow, 2001/2006
    Maintainer:  Tobias Nipkow
*)</span>

<span class="keyword1"><span class="command">theory</span></span> Termi <span class="keyword2"><span class="keyword">imports</span></span> <a href="Lang.html">Lang</a> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Termination›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Although partial correctness appeals because of its simplicity,
in many cases one would like the additional assurance that the command
is guaranteed to termiate if started in a state that satisfies the
precondition. Even to express this we need to define when a command is
guaranteed to terminate. We can do this without modifying our existing
semantics by merely adding a second inductively defined judgement
<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>c↓s›</span></span></span></span> that expresses guaranteed termination of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">c</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
started in state <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">s</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>:›</span></span>

<span class="keyword1"><span class="command">inductive</span></span>
  <span class="entity">termi</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"com <span class="main">⇒</span> state <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">↓</span>"</span> 50<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="comment1">(*&lt;*)</span>Do<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span><span class="comment1">(*&gt;*)</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> Do <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>

<span class="main">|</span> <span class="comment1">(*&lt;*)</span>Semi<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span><span class="comment1">(*&gt;*)</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>0</sub></span></span></span><span class="main">;</span> <span class="main">∀</span><span class="bound">s<span class="hidden">⇩</span><sub>1</sub></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>0</sub></span></span></span> <span class="main">-</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">→</span> <span class="bound">s<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main"><span class="free">↓</span></span> <span class="bound">s<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>0</sub></span></span></span>"</span></span>

<span class="main">|</span> <span class="comment1">(*&lt;*)</span>IfT<span class="main">[</span><span class="operator">intro</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="comment1">(*&gt;*)</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>  <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>
<span class="main">|</span> <span class="comment1">(*&lt;*)</span>IfF<span class="main">[</span><span class="operator">intro</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="comment1">(*&gt;*)</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">¬</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>

<span class="main">|</span> <span class="comment1">(*&lt;*)</span>WhileFalse<span class="main">:</span><span class="comment1">(*&gt;*)</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟹</span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>
<span class="main">|</span> <span class="comment1">(*&lt;*)</span>WhileTrue<span class="main">:</span><span class="comment1">(*&gt;*)</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">;</span> <span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">-</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">→</span> <span class="bound">t</span> <span class="main">⟶</span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="bound">t</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>

<span class="main">|</span> <span class="comment1">(*&lt;*)</span>Local<span class="main">:</span><span class="comment1">(*&gt;*)</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟹</span> <span class="keyword1">LOCAL</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Do <span class="free">f</span> <span class="main">↓</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="free">s</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">best</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>termi.intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> termi.cases<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">;</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">↓</span> <span class="free">s<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">↓</span> <span class="free">s<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s<span class="hidden">⇩</span><sub>1</sub></span><span class="main">.</span> <span class="free">s<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">-</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">→</span> <span class="bound">s<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟶</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">↓</span> <span class="bound">s<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">best</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>termi.intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> termi.cases<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>            

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">ELSE</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">↓</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span>
              <span class="main">(</span><span class="main">(</span><span class="keyword1">if</span> <span class="free">b</span> <span class="free">s</span> <span class="keyword1">then</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">else</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">↓</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>termi.intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> termi.cases<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>termi.intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> termi.cases<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LOCAL</span> <span class="free">f</span><span class="main">;</span><span class="free">c</span><span class="main">;</span><span class="free">g</span> <span class="main">↓</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">c</span> <span class="main">↓</span> <span class="free">f</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> termi.cases <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>termi.intros<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> termi_while_lemma<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">w</span><span class="main">↓</span><span class="free">fk</span> <span class="main">⟹</span>
 <span class="main">(</span><span class="main">∀</span><span class="bound">k</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">.</span> <span class="free">fk</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">k</span> <span class="main">∧</span> <span class="free">w</span> <span class="main">=</span> <span class="keyword1">WHILE</span> <span class="bound">b</span> <span class="keyword1">DO</span> <span class="bound">c</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">-</span><span class="bound">c</span><span class="main">→</span> <span class="free">f</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span>
          <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span><span class="bound">b</span><span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> termi.induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> termi_while<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="main">↓</span> <span class="free">f</span> <span class="free">k</span><span class="main">;</span>  <span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">-</span><span class="free">c</span><span class="main">→</span> <span class="free">f</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span><span class="free">b</span><span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>termi_while_lemma<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> wf_termi<span class="main">:</span> <span class="quoted"><span class="quoted">"wf <span class="main">{</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span> <span class="main">↓</span> <span class="bound">s</span> <span class="main">∧</span> <span class="free">b</span> <span class="bound">s</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">-</span><span class="free">c</span><span class="main">→</span> <span class="bound">t</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> wf_iff_no_infinite_down_chain<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> termi_while<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="HoareTotal">
<div class="head">
<h1>Theory HoareTotal</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Inductive definition of Hoare logic for total correctness
    Author:      Tobias Nipkow, 2001/2006
    Maintainer:  Tobias Nipkow
*)</span>

<span class="keyword1"><span class="command">theory</span></span> HoareTotal <span class="keyword2"><span class="keyword">imports</span></span> <a href="Hoare.html">Hoare</a> <a href="Termi.html">Termi</a> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Hoare logic for total correctness›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
Now that we have termination, we can define
total validity, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>⊨<span class="hidden">⇩</span><sub>t</sub>›</span></span></span></span>, as partial validity and guaranteed termination:›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">hoare_tvalid</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"assn <span class="main">⇒</span> com <span class="main">⇒</span> assn <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⊨<span class="hidden">⇩</span><sub>t</sub></span> <span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span><span class="keyword3">/ </span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword3">/ </span><span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span> <span class="main">⟷</span> <span class="main">⊨</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">}</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">{</span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">↓</span><span class="bound">s</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Proveability of Hoare triples in the proof system for total
correctness is written <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>⊢<span class="hidden">⇩</span><sub>t</sub> {P}c{Q}›</span></span></span></span> and defined
inductively. The rules for <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>⊢<span class="hidden">⇩</span><sub>t</sub>›</span></span></span></span> differ from those for
<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>⊢›</span></span></span></span> only in the one place where nontermination can arise: the
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">While</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>-rule.›</span></span>

<span class="keyword1"><span class="command">inductive</span></span>
  <span class="entity">thoare</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"assn <span class="main">⇒</span> com <span class="main">⇒</span> assn <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⊢<span class="hidden">⇩</span><sub>t</sub></span> <span class="keyword3">(</span><span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span><span class="keyword3">/ </span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword3">/ </span><span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span><span class="keyword3">)</span>"</span> 50<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  Do<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">t</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">s</span> <span class="main">≠</span> <span class="main">{}</span><span class="main"><span class="free">}</span></span> Do <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>
<span class="main">|</span> Semi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span><span class="main">;</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main"><span class="free">}</span></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>
<span class="main">|</span> If<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">s</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span><span class="main">;</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">~</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span>  <span class="main">⟧</span> <span class="main">⟹</span>
      <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span> <span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>
<span class="main">|</span> While<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>wf <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">;</span>  <span class="main">∀</span><span class="bound">s'</span><span class="main">.</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">s</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">=</span> <span class="bound">s</span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main"><span class="free">}</span></span><span class="main">⟧</span>
   <span class="main">⟹</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">¬</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span><span class="main"><span class="free">}</span></span>"</span></span>
<span class="main">|</span> Conseq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P'</span></span></span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">s</span><span class="main">;</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span><span class="main">;</span> <span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">Q'</span></span></span> <span class="bound">s</span>  <span class="main">⟧</span> <span class="main">⟹</span>
           <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P'</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q'</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>

<span class="main">|</span> Local<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">!!</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">s</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">P'</span></span></span> <span class="bound">s</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">p</span><span class="main">.</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P'</span></span></span> <span class="bound">p</span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="keyword1">o</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">p</span><span class="main">)</span><span class="main"><span class="free">}</span></span> <span class="main">⟹</span>
        <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span> <span class="keyword1">LOCAL</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹\noindent The<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">While</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>- rule is like the one for partial
correctness but it requires additionally that with every execution of
the loop body a wellfounded relation (<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">prop</span></span><span class="quoted"><span class="quoted">"wf <span class="free"><span class="free">r</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>) on the state
space decreases.

The soundness theorem›</span></span>

<span class="comment1">(* Tried to use this lemma to simplify the soundness proof.
   But "⊢<span class="hidden">⇩</span><sub>t</sub> {P}c{Q} ⟹ (!s. P s ⟶ c↓s)" is not provable because too weak
lemma total_implies_partial: "⊢<span class="hidden">⇩</span><sub>t</sub> {P} c {Q} ⟹ ⊢ {P} c {Q}"
apply(erule thoare.induct)
      apply(rule hoare.intros)
        apply (clarify) apply assumption
      apply(rule hoare.intros)
      apply blast
     apply(blast intro:hoare.intros)
    apply(blast intro:hoare.intros)
   defer
   apply(blast intro:hoare.intros)
  apply(blast intro:hoare.intros)
apply(rule hoare.intros)
apply(rule hoare_relative_complete)
apply(unfold hoare_valid_def)
apply(clarify)
apply(erule allE, erule conjE)
apply(drule hoare_sound)
apply(unfold hoare_valid_def)
apply(blast)
done
*)</span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">⊢<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span>  <span class="main">⟹</span>  <span class="keyword1">⊨<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> hoare_tvalid_def hoare_valid_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> thoare.induct<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> allE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> impE<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> asm_rl<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> mp<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_induct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> unfold_while<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">b</span> <span class="improper">x</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> termi.WhileTrue<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> termi.WhileFalse<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹\noindent In the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">While</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>-case we perform a
local proof by wellfounded induction over the given relation <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.

The completeness proof proceeds along the same lines as the one for partial
correctness. First we have to strengthen our notion of weakest precondition
to take termination into account:›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">wpt</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"com <span class="main">⇒</span> assn <span class="main">⇒</span> assn"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>t</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">wp<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> wp <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">s</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">↓</span><span class="bound">s</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> wp_defs <span class="main">=</span> wp_def wpt_def

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span>Do <span class="free">f</span><span class="main">)</span> <span class="free">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">t</span> <span class="main">∈</span> <span class="free">f</span> <span class="bound">s</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span> <span class="free">f</span> <span class="bound">s</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wpt_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">;</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">R</span> <span class="main">=</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">R</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> wp_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">ELSE</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">b</span> <span class="bound">s</span> <span class="keyword1">then</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">else</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">Q</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> wp_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="keyword1">LOCAL</span> <span class="free">f</span><span class="main">;</span><span class="free">c</span><span class="main">;</span><span class="free">g</span><span class="main">)</span> <span class="free">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">c</span> <span class="main">(</span><span class="free">Q</span> <span class="keyword1">o</span> <span class="main">(</span><span class="free">g</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> wp_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> strengthen_pre<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">P'</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">s</span><span class="main">;</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span>  <span class="main">⟧</span> <span class="main">⟹</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">{</span><span class="free">P'</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">erule</span> thoare.Conseq<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> weaken_post<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span><span class="main">;</span> <span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">Q'</span> <span class="bound">s</span>  <span class="main">⟧</span> <span class="main">⟹</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q'</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> thoare.Conseq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span> <span class="main">↓</span> <span class="free">s</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> wp_is_pre<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">⊢<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">{</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">c</span> <span class="free">Q</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span><span class="free">Q</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Q</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>thoare.Do thoare.Conseq<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>thoare.Semi thoare.Conseq<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>thoare.If thoare.Conseq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> thoare.Local<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> b c Q<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> weaken_post<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">c</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> thoare.While<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">c</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> wf_termi<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>wp_defs unfold_while<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> strengthen_pre<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wp_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>exec.intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹\noindent The <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">While</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>-case is interesting because we now have to furnish a
suitable wellfounded relation. Of course the execution of the loop
body directly yields the required relation.
The actual completeness theorem follows directly, in the same manner
as for partial correctness.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">⊨<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span> <span class="main">⟹</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> strengthen_pre<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ wp_is_pre<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> hoare_tvalid_def hoare_valid_def wp_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="PLang">
<div class="head">
<h1>Theory PLang</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       One procedure
    Author:      Tobias Nipkow, 2001/2006
    Maintainer:  Tobias Nipkow
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Hoare Logics for 1 Procedure"</span></span>

<span class="keyword1"><span class="command">theory</span></span> PLang <span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹The language›</span></span>

<span class="keyword1"><span class="command">typedecl</span></span> state

<span class="keyword1"><span class="command">type_synonym</span></span> bexp <span class="main">=</span> <span class="quoted"><span class="quoted">"state <span class="main">⇒</span> bool"</span></span>

<span class="keyword1"><span class="command">datatype</span></span> com <span class="main">=</span> Do <span class="quoted"><span class="quoted">"<span class="main">(</span>state <span class="main">⇒</span> state set<span class="main">)</span>"</span></span>
             <span class="main">|</span> Semi  <span class="quoted">com</span> <span class="quoted">com</span>            <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span>  <span class="main">[</span>60<span class="main">,</span> 60<span class="main">]</span> 10<span class="main">)</span>
             <span class="main">|</span> Cond  <span class="quoted">bexp</span> <span class="quoted">com</span> <span class="quoted">com</span>     <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">IF</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">THEN</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">ELSE</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span>  60<span class="main">)</span>
             <span class="main">|</span> While <span class="quoted">bexp</span> <span class="quoted">com</span>           <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">WHILE</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">DO</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span>  60<span class="main">)</span>
             <span class="main">|</span> CALL
             <span class="main">|</span> Local <span class="quoted"><span class="quoted">"<span class="main">(</span>state <span class="main">⇒</span> state<span class="main">)</span>"</span></span> <span class="quoted">com</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>state <span class="main">⇒</span> state <span class="main">⇒</span> state<span class="main">)</span>"</span></span>
               <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">LOCAL</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span> <span class="main">[</span>0<span class="main">,</span>0<span class="main">,</span>60<span class="main">]</span> 60<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹\noindent There is only one parameterless procedure in the program. Hence
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">CALL</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> does not even need to mention the procedure name. There
is no separate syntax for procedure declarations. Instead we declare a HOL
constant that represents the body of the one procedure in the program.›</span></span>

<span class="keyword1"><span class="command">consts</span></span> body <span class="main">::</span> <span class="quoted">com</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹\noindent
As before, command execution is described by transitions
<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>s -c→ t›</span></span></span></span>. The only new rule is the one for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">CALL</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> ---
it requires no comment:›</span></span>

<span class="keyword1"><span class="command">inductive</span></span>
  <span class="entity">exec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"state <span class="main">⇒</span> com <span class="main">⇒</span> state <span class="main">⇒</span> bool"</span></span>  <span class="main">(</span><span class="quoted">"_<span class="keyword3">/ </span><span class="keyword1">-</span>_<span class="keyword1">→</span><span class="keyword3">/ </span>_"</span> <span class="main">[</span>50<span class="main">,</span>0<span class="main">,</span>50<span class="main">]</span> 50<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
    Do<span class="main">:</span>     <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span>Do <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span>

  <span class="main">|</span> Semi<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">s0</span></span></span> <span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span> <span class="main">⟧</span>
            <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">s0</span></span></span> <span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span>"</span></span>

  <span class="main">|</span> IfTrue<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">;</span>  <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span>
  <span class="main">|</span> IfFalse<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">¬</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span>

  <span class="main">|</span> WhileFalse<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span><span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>
  <span class="main">|</span> WhileTrue<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main"><span class="free">-</span></span><span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">⟧</span>
                <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span><span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span>"</span></span>

  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span>body<span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span>CALL<span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span>

  <span class="main">|</span> Local<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span><span class="keyword1">LOCAL</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">-</span>Do <span class="free">f</span><span class="main">→</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">t</span> <span class="main">∈</span> <span class="free">f</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> exec.cases <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>exec.intros<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">-</span><span class="free">c</span><span class="main">;</span><span class="free">d</span><span class="main">→</span> <span class="free">u</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="free">s</span> <span class="main">-</span><span class="free">c</span><span class="main">→</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">-</span><span class="free">d</span><span class="main">→</span> <span class="free">u</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> exec.cases <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>exec.intros<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">-</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> <span class="free">c</span> <span class="keyword1">ELSE</span> <span class="free">d</span><span class="main">→</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span>
              <span class="main">(</span><span class="free">s</span> <span class="main">-</span><span class="keyword1">if</span> <span class="free">b</span> <span class="free">s</span> <span class="keyword1">then</span> <span class="free">c</span> <span class="keyword1">else</span> <span class="free">d</span><span class="main">→</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> exec.cases <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>exec.intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>exec.intros <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_split_asm<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> unfold_while<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">-</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">→</span> <span class="free">u</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="free">s</span> <span class="main">-</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> <span class="free">c</span><span class="main">;</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span> <span class="keyword1">ELSE</span> Do<span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">{</span><span class="bound">s</span><span class="main">}</span><span class="main">)</span><span class="main">→</span> <span class="free">u</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> exec.cases <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>exec.intros <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_split_asm<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">-</span>CALL<span class="main">→</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span> <span class="main">-</span>body<span class="main">→</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> exec.cases <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>exec.intros<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">-</span><span class="keyword1">LOCAL</span> <span class="free">f</span><span class="main">;</span> <span class="free">c</span><span class="main">;</span> <span class="free">g</span><span class="main">→</span> <span class="free">u</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="free">f</span> <span class="free">s</span> <span class="main">-</span><span class="free">c</span><span class="main">→</span> <span class="bound">t</span> <span class="main">∧</span> <span class="free">u</span> <span class="main">=</span> <span class="free">g</span> <span class="free">s</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> exec.cases <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>exec.intros<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">b</span> <span class="free">s</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">-</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">→</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>exec.intros<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> WhileI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">b</span> <span class="free">s</span><span class="main">;</span> <span class="free">s</span> <span class="main">-</span><span class="free">c</span><span class="main">→</span> <span class="free">t</span><span class="main">;</span> <span class="free">t</span> <span class="main">-</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">→</span> <span class="free">u</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">-</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">→</span> <span class="free">u</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>exec.WhileTrue<span class="main">)</span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This semantics turns out not to be fine-grained
enough. The soundness proof for the Hoare logic below proceeds by
induction on the call depth during execution. To make this work we
define a second semantics \mbox{<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>s -c-n→ t›</span></span></span></span>} which expresses that the
execution uses at most <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> nested procedure invocations, where
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a natural number. The rules are straightforward: <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span>
<span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is just passed around, except for procedure calls, where it is
decremented:›</span></span>

<span class="keyword1"><span class="command">inductive</span></span>
  <span class="entity">execn</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"state <span class="main">⇒</span> com <span class="main">⇒</span> nat <span class="main">⇒</span> state <span class="main">⇒</span> bool"</span></span>   <span class="main">(</span><span class="quoted">"_<span class="keyword3">/ </span><span class="keyword1">-</span>_<span class="keyword1">-</span>_<span class="keyword1">→</span><span class="keyword3">/ </span>_"</span> <span class="main">[</span>50<span class="main">,</span>0<span class="main">,</span>0<span class="main">,</span>50<span class="main">]</span> 50<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span>Do <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span>

<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">s0</span></span></span> <span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">s0</span></span></span> <span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span>"</span></span>

<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>  <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">¬</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span>

<span class="main">|</span> <span class="comment1">(*&lt;*)</span>WhileFalse<span class="main">:</span><span class="comment1">(*&gt;*)</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span><span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>
<span class="main">|</span> <span class="comment1">(*&lt;*)</span>WhileTrue<span class="main">:</span><span class="comment1">(*&gt;*)</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main"><span class="free">-</span></span><span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span><span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span>"</span></span>

<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span>body<span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span>CALL<span class="main"><span class="free">-</span></span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span>

<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span><span class="keyword1">LOCAL</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">-</span>Do <span class="free">f</span><span class="main">-</span><span class="free">n</span><span class="main">→</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">t</span> <span class="main">∈</span> <span class="free">f</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> execn.cases <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>execn.intros<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">-</span><span class="free">c1</span><span class="main">;</span><span class="free">c2</span><span class="main">-</span><span class="free">n</span><span class="main">→</span> <span class="free">u</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="free">s</span> <span class="main">-</span><span class="free">c1</span><span class="main">-</span><span class="free">n</span><span class="main">→</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">-</span><span class="free">c2</span><span class="main">-</span><span class="free">n</span><span class="main">→</span> <span class="free">u</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">best</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> execn.cases <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>execn.intros<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">-</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> <span class="free">c</span> <span class="keyword1">ELSE</span> <span class="free">d</span><span class="main">-</span><span class="free">n</span><span class="main">→</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span>
              <span class="main">(</span><span class="free">s</span> <span class="main">-</span><span class="keyword1">if</span> <span class="free">b</span> <span class="free">s</span> <span class="keyword1">then</span> <span class="free">c</span> <span class="keyword1">else</span> <span class="free">d</span><span class="main">-</span><span class="free">n</span><span class="main">→</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> execn.cases <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>execn.intros<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">-</span>CALL<span class="main">-</span> <span class="main">0</span><span class="main">→</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> False"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> execn.cases <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>execn.intros<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">-</span>CALL<span class="main">-</span>Suc <span class="free">n</span><span class="main">→</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span> <span class="main">-</span>body<span class="main">-</span><span class="free">n</span><span class="main">→</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> execn.cases <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>execn.intros<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">-</span><span class="keyword1">LOCAL</span> <span class="free">f</span><span class="main">;</span> <span class="free">c</span><span class="main">;</span> <span class="free">g</span><span class="main">-</span><span class="free">n</span><span class="main">→</span> <span class="free">u</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="free">f</span> <span class="free">s</span> <span class="main">-</span><span class="free">c</span><span class="main">-</span><span class="free">n</span><span class="main">→</span> <span class="bound">t</span> <span class="main">∧</span> <span class="free">u</span> <span class="main">=</span> <span class="free">g</span> <span class="free">s</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> execn.cases <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>execn.intros<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹\noindent By induction on <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">prop</span></span><span class="quoted"><span class="quoted">"<span class="free"><span class="free">s</span></span> <span class="main"><span class="main">-</span></span><span class="free"><span class="free">c</span></span><span class="main"><span class="main">-</span></span><span class="free"><span class="free">m</span></span><span class="main"><span class="main">→</span></span> <span class="free"><span class="free">t</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> we show
monotonicity w.r.t.\ the call depth:›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> exec_mono<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">-</span><span class="free">c</span><span class="main">-</span><span class="free">m</span><span class="main">→</span> <span class="free">t</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">m</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">⟶</span> <span class="free">s</span> <span class="main">-</span><span class="free">c</span><span class="main">-</span><span class="bound">n</span><span class="main">→</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> execn.induct<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>execn.intros<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>execn.intros<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> m<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">m</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹\noindent With the help of this lemma we prove the expected
relationship between the two semantics:›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> exec_iff_execn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">-</span><span class="free">c</span><span class="main">→</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="free">s</span> <span class="main">-</span><span class="free">c</span><span class="main">-</span><span class="bound">n</span><span class="main">→</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exec.induct<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> m n<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"max <span class="improper">m</span> <span class="improper">n</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>exec.intros exec_mono <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>max_def<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>execn.intros<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> m n<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"max <span class="improper">m</span> <span class="improper">n</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>execn.WhileTrue exec_mono <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>max_def<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> execn.induct<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exec.WhileFalse<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> exec.intros<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">lemma</span></span> while_lemma<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">-</span><span class="free">w</span><span class="main">-</span><span class="free">n</span><span class="main">→</span> <span class="free">t</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">b</span> <span class="bound">c</span><span class="main">.</span> <span class="free">w</span> <span class="main">=</span> <span class="keyword1">WHILE</span> <span class="bound">b</span> <span class="keyword1">DO</span> <span class="bound">c</span> <span class="main">∧</span> <span class="free">P</span> <span class="free">s</span> <span class="main">∧</span>
                    <span class="main">(</span><span class="main">∀</span><span class="bound">s</span> <span class="bound">s'</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">∧</span> <span class="bound">b</span> <span class="bound">s</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">-</span><span class="bound">c</span><span class="main">-</span><span class="free">n</span><span class="main">→</span> <span class="bound">s'</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">P</span> <span class="free">t</span> <span class="main">∧</span> <span class="main">¬</span><span class="bound">b</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> execn.induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="improper">t</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> while_rule<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">s</span> <span class="main">-</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">-</span><span class="free">n</span><span class="main">→</span> <span class="free">t</span><span class="main">;</span> <span class="free">P</span> <span class="free">s</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">s</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">⟦</span><span class="free">P</span> <span class="bound">s</span><span class="main">;</span> <span class="free">b</span> <span class="bound">s</span><span class="main">;</span> <span class="bound">s</span> <span class="main">-</span><span class="free">c</span><span class="main">-</span><span class="free">n</span><span class="main">→</span> <span class="bound">s'</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">s'</span><span class="main">⟧</span>
  <span class="main">⟹</span> <span class="free">P</span> <span class="free">t</span> <span class="main">∧</span> <span class="main">¬</span><span class="free">b</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> while_lemma<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="PHoare">
<div class="head">
<h1>Theory PHoare</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Inductive definition of Hoare logic
    Author:      Tobias Nipkow, 2001/2006
    Maintainer:  Tobias Nipkow
*)</span>

<span class="keyword1"><span class="command">theory</span></span> PHoare <span class="keyword2"><span class="keyword">imports</span></span> <a href="PLang.html">PLang</a> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Hoare logic for partial correctness›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Taking auxiliary variables seriously means that assertions must
now depend on them as well as on the state. Initially we do not fix
the type of auxiliary variables but parameterize the type of
assertions with a type variable <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>:›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> assn <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> state <span class="main">⇒</span> bool"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
The second major change is the need to reason about Hoare
triples in a context: proofs about recursive procedures are conducted
by induction where we assume that all <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">CALL</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>s satisfy the given
pre/postconditions and have to show that the body does as well. The
assumption is stored in a context, which is a set of Hoare triples:›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> cntxt <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> assn <span class="main">×</span> com <span class="main">×</span> <span class="tfree">'a</span> assn<span class="main">)</span>set"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹\noindent In the presence of only a single procedure the context will
always be empty or a singleton set. With multiple procedures, larger
sets can arise.

Now that we have contexts, validity becomes more complicated. Ordinary
validity (w.r.t.\ partial correctness) is still what it used to be,
except that we have to take auxiliary variables into account as well:
›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">valid</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> assn <span class="main">⇒</span> com <span class="main">⇒</span> <span class="tfree">'a</span> assn <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⊨</span> <span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span><span class="keyword3">/ </span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword3">/ </span><span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
     <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⊨</span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">s</span> <span class="main">-</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">→</span> <span class="bound">t</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">z</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹\noindent Auxiliary variables are always denoted by <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">z</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.

Validity of a context and validity of a Hoare triple in a context are defined
as follows:›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">valids</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> cntxt <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">|⊨</span> _"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">|⊨</span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">P</span><span class="main">,</span><span class="bound">c</span><span class="main">,</span><span class="bound">Q</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">.</span> <span class="main">⊨</span> <span class="main">{</span><span class="bound">P</span><span class="main">}</span><span class="bound">c</span><span class="main">{</span><span class="bound">Q</span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">cvalid</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> cntxt <span class="main">⇒</span> <span class="tfree">'a</span> assn <span class="main">⇒</span> com <span class="main">⇒</span> <span class="tfree">'a</span> assn <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">⊨</span><span class="keyword3">/ </span><span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span><span class="keyword3">/ </span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword3">/ </span><span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">⊨</span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span> <span class="main">⟷</span> <span class="main">|⊨</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">⟶</span> <span class="main">⊨</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">}</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">{</span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹\noindent Note that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">prop</span></span><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{}</span></span> <span class="main"><span class="main">⊨</span></span> <span class="main"><span class="main">{</span></span><span class="free"><span class="free">P</span></span><span class="main"><span class="main">}</span></span><span class="free"><span class="free">c</span></span><span class="main"><span class="main">{</span></span><span class="free"><span class="free">Q</span></span><span class="main"><span class="main">}</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is equivalent to
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">prop</span></span><span class="quoted"><span class="quoted">"<span class="main"><span class="main">⊨</span></span> <span class="main"><span class="main">{</span></span><span class="free"><span class="free">P</span></span><span class="main"><span class="main">}</span></span><span class="free"><span class="free">c</span></span><span class="main"><span class="main">{</span></span><span class="free"><span class="free">Q</span></span><span class="main"><span class="main">}</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.

Unfortunately, this is not the end of it. As we have two
semantics, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>-c→›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>-c-n→›</span></span></span></span>, we also need a second notion
of validity parameterized with the recursion depth <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>:›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">nvalid</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> assn <span class="main">⇒</span> com <span class="main">⇒</span> <span class="tfree">'a</span> assn <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⊨</span>_ <span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span><span class="keyword3">/ </span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword3">/ </span><span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⊨</span></span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">s</span> <span class="main">-</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">→</span> <span class="bound">t</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">z</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">nvalids</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> cntxt <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">|⊨'_</span>_<span class="keyword3">/ </span>_"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">|⊨_</span></span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">P</span><span class="main">,</span><span class="bound">c</span><span class="main">,</span><span class="bound">Q</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">.</span> <span class="main">⊨</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">{</span><span class="bound">P</span><span class="main">}</span><span class="bound">c</span><span class="main">{</span><span class="bound">Q</span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">cnvalid</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> cntxt <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> assn <span class="main">⇒</span> com <span class="main">⇒</span> <span class="tfree">'a</span> assn <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">⊨</span>_<span class="keyword3">/ </span><span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span><span class="keyword3">/ </span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword3">/ </span><span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">⊨</span></span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span> <span class="main">⟷</span> <span class="main">|⊨_</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">⟶</span> <span class="main">⊨</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">}</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">{</span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Finally we come to the proof system for deriving triples in a context:›</span></span>

<span class="keyword1"><span class="command">inductive</span></span>
  <span class="entity">hoare</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> cntxt <span class="main">⇒</span> <span class="tfree">'a</span> assn <span class="main">⇒</span> com <span class="main">⇒</span> <span class="tfree">'a</span> assn <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">⊢</span><span class="keyword3">/ </span><span class="keyword3">(</span><span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span><span class="keyword3">/ </span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword3">/ </span><span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span><span class="keyword3">)</span>"</span> 50<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
   <span class="comment1">(*&lt;*)</span>Do<span class="main">:</span><span class="comment1">(*&gt;*)</span><span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="main">∀</span><span class="bound">t</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">s</span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">z</span> <span class="bound">t</span><span class="main"><span class="free">}</span></span> Do <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>

 <span class="main">|</span> <span class="comment1">(*&lt;*)</span>Semi<span class="main">:</span><span class="comment1">(*&gt;*)</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main"><span class="free">}</span></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>

 <span class="main">|</span> <span class="comment1">(*&lt;*)</span>If<span class="main">:</span><span class="comment1">(*&gt;*)</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span><span class="main">;</span>  <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">¬</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span>  <span class="main">⟧</span>
   <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span> <span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>

 <span class="main">|</span> <span class="comment1">(*&lt;*)</span>While<span class="main">:</span><span class="comment1">(*&gt;*)</span><span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span>
   <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">¬</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span><span class="main"><span class="free">}</span></span>"</span></span>

 <span class="main">|</span> <span class="comment1">(*&lt;*)</span>Conseq<span class="main">:</span><span class="comment1">(*&gt;*)</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P'</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q'</span></span></span><span class="main"><span class="free">}</span></span><span class="main">;</span>  <span class="main">∀</span><span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P'</span></span></span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">Q'</span></span></span> <span class="bound">z</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">z</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⟧</span>
   <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>

 <span class="main">|</span> <span class="comment1">(*&lt;*)</span>Call<span class="main">:</span><span class="comment1">(*&gt;*)</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">,</span>CALL<span class="main">,</span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span><span class="main">}</span> <span class="main"><span class="free">⊢</span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span>body<span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span> <span class="main">⟹</span> <span class="main">{}</span> <span class="main"><span class="free">⊢</span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span> CALL <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>

 <span class="main">|</span> <span class="comment1">(*&lt;*)</span>Asm<span class="main">:</span><span class="comment1">(*&gt;*)</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">,</span>CALL<span class="main">,</span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span><span class="main">}</span> <span class="main"><span class="free">⊢</span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span> CALL <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>
 <span class="main">|</span> <span class="comment1">(*&lt;*)</span>Local<span class="main">:</span><span class="comment1">(*&gt;*)</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound">s'</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">z</span> <span class="bound">s'</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">s'</span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">z</span> <span class="bound">t</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">z</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">s'</span> <span class="bound">t</span><span class="main">)</span><span class="main"><span class="free">}</span></span> <span class="main">⟧</span> <span class="main">⟹</span>
        <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span> <span class="keyword1">LOCAL</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">hoare1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> cntxt <span class="main">⇒</span> <span class="tfree">'a</span> assn <span class="main">×</span> com <span class="main">×</span> <span class="tfree">'a</span> assn <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">⊢</span> _"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">⊢</span> <span class="main">{</span>fst <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">}</span>fst <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">{</span>snd <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹\noindent The first four rules are familiar, except for their adaptation
to auxiliary variables. The <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">CALL</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> rule embodies induction and
has already been motivated above. Note that it is only applicable if
the context is empty. This shows that we never need nested induction.
For the same reason the assumption rule (the last rule) is stated with
just a singleton context.

The rule of consequence is explained in the accompanying paper.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> strengthen_pre<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="free">P'</span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">z</span> <span class="bound">s</span><span class="main">;</span> <span class="free">C</span><span class="main">⊢</span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span>  <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">C</span><span class="main">⊢</span> <span class="main">{</span><span class="free">P'</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> hoare.Conseq<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> valid_defs <span class="main">=</span> valid_def valids_def cvalid_def
                    nvalid_def nvalids_def cnvalid_def

<span class="keyword1"><span class="command">theorem</span></span> hoare_sound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">⊢</span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span>  <span class="main">⟹</span>  <span class="free">C</span> <span class="main">⊨</span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">txt</span></span><span class="quoted"><span class="plain_text">‹\noindent requires a generalization: <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">prop</span></span><span class="quoted"><span class="quoted">"<span class="main"><span class="main">∀</span></span><span class="bound"><span class="bound">n</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">C</span></span> <span class="main"><span class="main">⊨</span></span><span class="bound"><span class="bound">n</span></span>
<span class="main"><span class="main">{</span></span><span class="free"><span class="free">P</span></span><span class="main"><span class="main">}</span></span><span class="free"><span class="free">c</span></span><span class="main"><span class="main">{</span></span><span class="free"><span class="free">Q</span></span><span class="main"><span class="main">}</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is proved instead, from which the actual theorem follows
directly via lemma <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[source]exec_iff_execn<span class="antiquote"><span class="antiquote">}</span></span></span></span> in \S\ref{sec:proc1-lang}.
The generalization
is proved by induction on <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">c</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. The reason for the generalization
is that soundness of the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">CALL</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> rule is proved by induction on the
maximal call depth, i.e.\ <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">C</span> <span class="main">⊨</span><span class="bound">n</span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> valid_defs exec_iff_execn<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> hoare.induct<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> while_rule<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 3
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper">n</span></span></span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_use</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
The completeness proof employs the notion of a \emph{most general triple} (or
\emph{most general formula}):›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">MGT</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"com <span class="main">⇒</span> state assn <span class="main">×</span> com <span class="main">×</span> state assn"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">MGT</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">z</span> <span class="main">=</span> <span class="bound">s</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="main">λ</span><span class="bound">z</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">z</span> <span class="main">-</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">→</span> <span class="bound">t</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">declare</span></span> MGT_def<span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹\noindent Note that the type of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">z</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> has been identified with
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">state</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.  This means that for every state variable there is an auxiliary
variable, which is simply there to record the value of the program variables
before execution of a command. This is exactly what, for example, VDM offers
by allowing you to refer to the pre-value of a variable in a
postcondition. The intuition behind <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span><span class="quoted"><span class="quoted">"MGT <span class="free"><span class="free">c</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is
that it completely describes the operational behaviour of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">c</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.  It is
easy to see that, in the presence of the new consequence rule,
\mbox{<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">prop</span></span><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{}</span></span> <span class="main"><span class="main">⊢</span></span> MGT <span class="free"><span class="free">c</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>} implies completeness:›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> MGT_implies_complete<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">⊢</span> MGT <span class="free">c</span>  <span class="main">⟹</span>  <span class="main">{}</span> <span class="main">⊨</span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span>  <span class="main">⟹</span>  <span class="main">{}</span> <span class="main">⊢</span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">::</span>state assn<span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> MGT_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> hoare.Conseq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹In order to discharge <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">prop</span></span><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{}</span></span> <span class="main"><span class="main">⊢</span></span> MGT <span class="free"><span class="free">c</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> one proves›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> MGT_lemma<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">⊢</span> MGT CALL  <span class="main">⟹</span>  <span class="free">C</span> <span class="main">⊢</span> MGT <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">c</span></span></span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> strengthen_pre<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ hoare.Do<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>hoare.Semi hoare.Conseq<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hoare.If<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> hoare.Conseq<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> hoare.Conseq<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> b c<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hoare.Conseq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> P <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="bound">z</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span><span class="main">.</span> <span class="improper">b</span> <span class="bound">s</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">-</span><span class="improper">c</span><span class="main">→</span> <span class="bound">t</span><span class="main">}</span><span class="main">)</span><span class="main">^*</span>"</span></span>
        <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> hoare.While<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> hoare.Conseq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>rtrancl_into_rtrancl<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> s t<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">s</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> converse_rtrancl_induct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>exec.WhileTrue<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> hoare.Local <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> hoare.Conseq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹\noindent The proof is by induction on <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">c</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. In the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span>
<span class="quoted"><span class="quoted">While</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>-case it is easy to show that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">z</span></span> <span class="bound"><span class="bound">t</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">z</span></span><span class="main"><span class="main">,</span></span><span class="bound"><span class="bound">t</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">∈</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">{</span></span><span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">s</span></span><span class="main"><span class="main">,</span></span><span class="bound"><span class="bound">t</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">b</span></span>
<span class="bound"><span class="bound">s</span></span> <span class="main"><span class="main">∧</span></span> <span class="bound"><span class="bound">s</span></span> <span class="main"><span class="main">-</span></span><span class="free"><span class="free">c</span></span><span class="main"><span class="main">→</span></span> <span class="bound"><span class="bound">t</span></span><span class="main"><span class="main">}</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">^*</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is invariant. The precondition \mbox{<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span>[source]<span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">z</span></span> <span class="bound"><span class="bound">s</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">z</span></span><span class="main"><span class="main">=</span></span><span class="bound"><span class="bound">s</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>}
establishes the invariant and a reflexive transitive closure
induction shows that the invariant conjoined with <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">prop</span></span><span class="quoted"><span class="quoted">"<span class="main"><span class="main">¬</span></span><span class="free"><span class="free">b</span></span> <span class="free"><span class="free">t</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
implies the postcondition \mbox{<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">z</span></span> <span class="bound"><span class="bound">t</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">z</span></span> <span class="main"><span class="main">-</span></span><span class="keyword1"><span class="keyword1">WHILE</span></span> <span class="free"><span class="free">b</span></span> <span class="keyword1"><span class="keyword1">DO</span></span> <span class="free"><span class="free">c</span></span><span class="main"><span class="main">→</span></span> <span class="bound"><span class="bound">t</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>}. The
remaining cases are trivial.

Using the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[source]MGT_lemma<span class="antiquote"><span class="antiquote">}</span></span></span></span> (together with the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>CALL›</span></span></span></span> and the
assumption rule) one can easily derive›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> MGT_CALL<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">⊢</span> MGT CALL"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> MGT_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> hoare.Call<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> hoare.Conseq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> MGT_lemma<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> hoare.Asm<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>exec.intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹\noindent Using the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[source]MGT_lemma<span class="antiquote"><span class="antiquote">}</span></span></span></span> once more we obtain
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">prop</span></span><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{}</span></span> <span class="main"><span class="main">⊢</span></span> MGT <span class="free"><span class="free">c</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and thus by <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span>[source]MGT_implies_complete<span class="antiquote"><span class="antiquote">}</span></span></span></span>
completeness.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">⊨</span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span>  <span class="main">⟹</span>  <span class="main">{}</span> <span class="main">⊢</span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">::</span>state assn<span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> MGT_implies_complete<span class="main"><span class="main">[</span></span><span class="operator">OF</span> MGT_lemma<span class="main"><span class="main">[</span></span><span class="operator">OF</span> MGT_CALL<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="PTermi">
<div class="head">
<h1>Theory PTermi</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      Inductive definition of termination
    Author:      Tobias Nipkow, 2001/2006
    Maintainer:  Tobias Nipkow
*)</span>
<span class="keyword1"><span class="command">theory</span></span> PTermi <span class="keyword2"><span class="keyword">imports</span></span> <a href="PLang.html">PLang</a> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Termination›</span></span>

<span class="keyword1"><span class="command">inductive</span></span>
  <span class="entity">termi</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"com <span class="main">⇒</span> state <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">↓</span>"</span> 50<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  Do<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> Do <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>
<span class="main">|</span> Semi<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">s0</span></span></span><span class="main">;</span> <span class="main">⋀</span><span class="bound">s1</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">s0</span></span></span> <span class="main">-</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">→</span> <span class="bound">s1</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="bound">s1</span> <span class="main">⟧</span>
            <span class="main">⟹</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">s0</span></span></span>"</span></span>

<span class="main">|</span> IfTrue<span class="main">[</span><span class="operator">intro</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>
<span class="main">|</span> IfFalse<span class="main">[</span><span class="operator">intro</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">¬</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>

<span class="main">|</span> WhileFalse<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟹</span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>

<span class="main">|</span> WhileTrue<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">;</span> <span class="main">⋀</span><span class="bound">t</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">-</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">→</span> <span class="bound">t</span> <span class="main">⟹</span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="bound">t</span> <span class="main">⟧</span>
                <span class="main">⟹</span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"body <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟹</span> CALL <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>

<span class="main">|</span> Local<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟹</span> <span class="keyword1">LOCAL</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Do <span class="free">f</span> <span class="main">↓</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="free">s</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">best</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>termi.intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> termi.cases<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">c1</span><span class="main">;</span><span class="free">c2</span><span class="main">)</span> <span class="main">↓</span> <span class="free">s0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">c1</span> <span class="main">↓</span> <span class="free">s0</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s1</span><span class="main">.</span> <span class="free">s0</span> <span class="main">-</span><span class="free">c1</span><span class="main">→</span> <span class="bound">s1</span> <span class="main">⟶</span> <span class="free">c2</span> <span class="main">↓</span> <span class="bound">s1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">best</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>termi.intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> termi.cases<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> <span class="free">c1</span> <span class="keyword1">ELSE</span> <span class="free">c2</span> <span class="main">↓</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span>
              <span class="main">(</span><span class="main">(</span><span class="keyword1">if</span> <span class="free">b</span> <span class="free">s</span> <span class="keyword1">then</span> <span class="free">c1</span> <span class="keyword1">else</span> <span class="free">c2</span><span class="main">)</span> <span class="main">↓</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>termi.intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> termi.cases<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>termi.intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> termi.cases<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>CALL <span class="main">↓</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>body <span class="main">↓</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> termi.cases <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>termi.intros<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LOCAL</span> <span class="free">f</span><span class="main">;</span><span class="free">c</span><span class="main">;</span><span class="free">g</span> <span class="main">↓</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">c</span> <span class="main">↓</span> <span class="free">f</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> termi.cases <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>termi.intros<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> termi_while_lemma<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">w</span><span class="main">↓</span><span class="free">fk</span> <span class="main">⟹</span>
 <span class="main">(</span><span class="main">∀</span><span class="bound">k</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">.</span> <span class="free">fk</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">k</span> <span class="main">∧</span> <span class="free">w</span> <span class="main">=</span> <span class="keyword1">WHILE</span> <span class="bound">b</span> <span class="keyword1">DO</span> <span class="bound">c</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">-</span><span class="bound">c</span><span class="main">→</span> <span class="free">f</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span>
          <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span><span class="bound">b</span><span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> termi.induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> termi_while<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="main">↓</span> <span class="free">f</span> <span class="free">k</span><span class="main">;</span>  <span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">-</span><span class="free">c</span><span class="main">→</span> <span class="free">f</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span><span class="free">b</span><span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>termi_while_lemma<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> wf_termi<span class="main">:</span> <span class="quoted"><span class="quoted">"wf <span class="main">{</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span> <span class="main">↓</span> <span class="bound">s</span> <span class="main">∧</span> <span class="free">b</span> <span class="bound">s</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">-</span><span class="free">c</span><span class="main">→</span> <span class="bound">t</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> wf_iff_no_infinite_down_chain<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> termi_while<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="PHoareTotal">
<div class="head">
<h1>Theory PHoareTotal</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Inductive definition of Hoare logic for total correctness
    Author:      Tobias Nipkow, 2001/2006
    Maintainer:  Tobias Nipkow
*)</span>

<span class="keyword1"><span class="command">theory</span></span> PHoareTotal <span class="keyword2"><span class="keyword">imports</span></span> <a href="PHoare.html">PHoare</a> <a href="PTermi.html">PTermi</a> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Hoare logic for total correctness›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Validity is defined as expected:›</span></span> 

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">tvalid</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> assn <span class="main">⇒</span> com <span class="main">⇒</span> <span class="tfree">'a</span> assn <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⊨<span class="hidden">⇩</span><sub>t</sub></span> <span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span><span class="keyword3">/ </span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword3">/ </span><span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span> <span class="main">⟷</span>  <span class="main">⊨</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">}</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">{</span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">↓</span><span class="bound">s</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">ctvalid</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> cntxt <span class="main">⇒</span> <span class="tfree">'a</span> assn <span class="main">⇒</span> com <span class="main">⇒</span> <span class="tfree">'a</span> assn <span class="main">⇒</span> bool"</span></span>
            <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword3">/</span><span class="keyword1">⊨<span class="hidden">⇩</span><sub>t</sub></span> <span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span><span class="keyword3">/ </span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword3">/ </span><span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword3">)</span><span class="keyword1">}</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">P'</span><span class="main">,</span><span class="bound">c'</span><span class="main">,</span><span class="bound">Q'</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">.</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">{</span><span class="bound">P'</span><span class="main">}</span><span class="bound">c'</span><span class="main">{</span><span class="bound">Q'</span><span class="main">}</span><span class="main">)</span> <span class="main">⟶</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">}</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">{</span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">}</span>"</span></span>


<span class="keyword1"><span class="command">inductive</span></span>
  <span class="entity">thoare</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> cntxt <span class="main">⇒</span> <span class="tfree">'a</span> assn <span class="main">⇒</span> com <span class="main">⇒</span> <span class="tfree">'a</span> assn <span class="main">⇒</span> bool"</span></span>
   <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">⊢<span class="hidden">⇩</span><sub>t</sub></span><span class="keyword3">/ </span><span class="keyword3">(</span><span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span><span class="keyword3">/ </span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword3">/ </span><span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span><span class="keyword3">)</span><span class="keyword3">)</span>"</span> <span class="main">[</span>50<span class="main">,</span>0<span class="main">,</span>0<span class="main">,</span>0<span class="main">]</span> 50<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  Do<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">t</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">s</span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">z</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">s</span> <span class="main">≠</span> <span class="main">{}</span><span class="main"><span class="free">}</span></span> Do <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>
<span class="main">|</span> Semi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main"><span class="free">}</span></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>
<span class="main">|</span> If<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">~</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span>  <span class="main">⟧</span> <span class="main">⟹</span>
      <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span> <span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>
<span class="main">|</span> While<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>wf <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">;</span>  <span class="main">∀</span><span class="bound">s'</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">=</span> <span class="bound">s</span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main"><span class="free">}</span></span><span class="main">⟧</span>
   <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">¬</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span><span class="main"><span class="free">}</span></span>"</span></span>

<span class="main">|</span> Call<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>wf <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">;</span>  <span class="main">∀</span><span class="bound">s'</span><span class="main">.</span> <span class="main">{</span><span class="main">(</span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">,</span> CALL<span class="main">,</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span><span class="main">}</span>
                 <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">=</span> <span class="bound">s'</span><span class="main"><span class="free">}</span></span> body <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span><span class="main">⟧</span>
   <span class="main">⟹</span> <span class="main">{}</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span> CALL <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>

<span class="main">|</span> Asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">,</span>CALL<span class="main">,</span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span><span class="main">}</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span> CALL <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>

<span class="main">|</span> Conseq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P'</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q'</span></span></span><span class="main"><span class="free">}</span></span><span class="main">;</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P'</span></span></span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">Q'</span></span></span> <span class="bound">z</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">z</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">z</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P'</span></span></span> <span class="bound">z</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">⟧</span>
   <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>

<span class="main">|</span> Local<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound">s'</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">z</span> <span class="bound">s'</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">s'</span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">z</span> <span class="bound">t</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">z</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">s'</span> <span class="bound">t</span><span class="main">)</span><span class="main"><span class="free">}</span></span> <span class="main">⟧</span> <span class="main">⟹</span>
        <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span> <span class="keyword1">LOCAL</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">hoare1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> cntxt <span class="main">⇒</span> <span class="tfree">'a</span> assn <span class="main">×</span> com <span class="main">×</span> <span class="tfree">'a</span> assn <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">⊢<span class="hidden">⇩</span><sub>t</sub></span> _"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">{</span>fst <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">}</span>fst <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">{</span>snd <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">}</span>"</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The side condition in our rule of consequence looks quite different
from the one by Kleymann, but the two are in fact equivalent:›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">P'</span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">Q'</span> <span class="bound">z</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">P</span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="bound">z</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
            <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="free">P</span> <span class="bound">z</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="free">P'</span> <span class="bound">z</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
        <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">t</span><span class="main">.</span><span class="main">∃</span><span class="bound">z'</span><span class="main">.</span> <span class="free">P'</span> <span class="bound">z'</span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">(</span><span class="free">Q'</span> <span class="bound">z'</span> <span class="bound">t</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="bound">z</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The key difference to the work by Kleymann (and America and de
Boer) is that soundness and completeness are shown for arbitrary,
i.e.\ unbounded nondeterminism.  This is a significant extension and
appears to have been an open problem. The details are found below and
are explained in a separate paper~\cite{Nipkow-CSL02}.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> strengthen_pre<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="free">P'</span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">z</span> <span class="bound">s</span><span class="main">;</span> <span class="free">C</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span>  <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">C</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">{</span><span class="free">P'</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> thoare.Conseq<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> weaken_post<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">C</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span><span class="main">;</span> <span class="main">∀</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">Q'</span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">C</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q'</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">erule</span> thoare.Conseq<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>


<span class="keyword1"><span class="command">lemmas</span></span> tvalid_defs <span class="main">=</span> tvalid_def ctvalid_def valid_defs

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">⊨<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">{</span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="free">P</span> <span class="bound">n</span> <span class="bound">z</span> <span class="bound">s</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">{</span><span class="free">P</span> <span class="bound">n</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> tvalid_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">⊨<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">{</span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">∧</span> <span class="free">P'</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P'</span> <span class="main">⟶</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> tvalid_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">⊨<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span>CALL<span class="main">{</span><span class="free">Q</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">⊨<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span>body<span class="main">{</span><span class="free">Q</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> tvalid_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span>  <span class="main">⟹</span>  <span class="free">C</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> thoare.induct<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>tvalid_defs<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>tvalid_defs<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>tvalid_defs<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 3
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>tvalid_defs<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 3
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>tvalid_defs<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>tvalid_defs<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_induct<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> unfold_while<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> allI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_induct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">b</span> <span class="improper">x</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> termi.WhileFalse<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> termi.WhileTrue<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">t</span><span class="main">,</span><span class="improper">x</span><span class="main">)</span><span class="main">:</span><span class="improper">r</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_use</span><span class="main"><span class="main">)</span></span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>ctvalid_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">{</span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="improper">P</span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">∧</span> <span class="bound">s</span><span class="main">=</span><span class="bound">n</span><span class="main">}</span> body <span class="main">{</span><span class="improper">Q</span><span class="main">}</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_use</span><span class="main"><span class="main">)</span></span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>tvalid_defs<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_induct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> tvalid_defs<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">MGT<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"com <span class="main">⇒</span> state assn <span class="main">×</span> com <span class="main">×</span> state assn"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">MGT<span class="hidden">⇩</span><sub>t</sub></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">z</span> <span class="main">=</span> <span class="bound">s</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">↓</span><span class="bound">s</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="main">λ</span><span class="bound">z</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">z</span> <span class="main">-</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">→</span> <span class="bound">t</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> MGT_implies_complete<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>t</sub></span> MGT<span class="hidden">⇩</span><sub>t</sub> <span class="free">c</span> <span class="main">⟹</span> <span class="main">{}</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">{}</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">::</span>state assn<span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> MGT<span class="hidden">⇩</span><sub>t</sub>_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> thoare.Conseq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tvalid_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> while_termiE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span> <span class="main">↓</span> <span class="free">s</span><span class="main">;</span> <span class="free">b</span> <span class="free">s</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">c</span> <span class="main">↓</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">erule</span> termi.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> while_termiE2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span> <span class="main">↓</span> <span class="free">s</span><span class="main">;</span> <span class="free">b</span> <span class="free">s</span><span class="main">;</span> <span class="free">s</span> <span class="main">-</span><span class="free">c</span><span class="main">→</span> <span class="free">t</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span> <span class="main">↓</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">erule</span> termi.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> MGT_lemma<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>t</sub></span> MGT<span class="hidden">⇩</span><sub>t</sub> CALL <span class="main">⟹</span> <span class="free">C</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>t</sub></span> MGT<span class="hidden">⇩</span><sub>t</sub> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">c</span></span></span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> strengthen_pre<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ thoare.Do<span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> com1 com2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> Q <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">z</span> <span class="main">-</span><span class="improper">com1</span><span class="main">→</span><span class="bound">s</span> <span class="main">&amp;</span> <span class="improper">com2</span><span class="main">↓</span><span class="bound">s</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> thoare.Semi<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> thoare.Conseq<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> thoare.Conseq<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> thoare.If<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> thoare.Conseq<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> thoare.Conseq<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>thoare.Local <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> thoare.Conseq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> b c<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> P' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="bound">z</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span><span class="main">.</span> <span class="improper">b</span> <span class="bound">s</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">-</span><span class="improper">c</span><span class="main">→</span> <span class="bound">t</span><span class="main">}</span><span class="main">)</span><span class="main">^*</span> <span class="main">∧</span>
                           <span class="keyword1">WHILE</span> <span class="improper">b</span> <span class="keyword1">DO</span> <span class="improper">c</span> <span class="main">↓</span> <span class="bound">s</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> thoare.Conseq<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> thoare.While<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf_termi<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> thoare.Conseq<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>rtrancl_into_rtrancl <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>while_termiE while_termiE2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">s</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> converse_rtrancl_induct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>exec.WhileTrue<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rtrancl_refl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">inductive_set</span></span>
  <span class="entity">exec1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>com list <span class="main">×</span> state<span class="main">)</span> <span class="main">×</span> <span class="main">(</span>com list <span class="main">×</span> state<span class="main">)</span><span class="main">)</span>set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="entity"><span class="free">exec1'</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>com list <span class="main">×</span> state<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>com list <span class="main">×</span> state<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>  <span class="main">(</span><span class="quoted">"_ <span class="keyword1">→</span> _"</span> <span class="main">[</span>81<span class="main">,</span>81<span class="main">]</span> 100<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">cs0</span></span></span> <span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">cs1</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cs0</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">cs1</span></span></span><span class="main">)</span> <span class="main">:</span> <span class="free">exec1</span>"</span></span>

<span class="main">|</span> Do<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span>Do <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main"><span class="free">→</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span>"</span></span>

<span class="main">|</span> Semi<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main"><span class="free">→</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>

<span class="main">|</span> IfTrue<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main"><span class="free">→</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> IfFalse<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main"><span class="free">→</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>

<span class="main">|</span> WhileFalse<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main"><span class="free">→</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> WhileTrue<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main"><span class="free">→</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">#</span><span class="main">(</span><span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>

<span class="main">|</span> Call<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>CALL<span class="main">#</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main"><span class="free">→</span></span> <span class="main">(</span>body<span class="main">#</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>

<span class="main">|</span> Local<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="keyword1">LOCAL</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main"><span class="free">→</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">#</span> Do<span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">t</span><span class="main">}</span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span>
  <span class="entity">exectr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>com list <span class="main">×</span> state<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>com list <span class="main">×</span> state<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>   <span class="main">(</span><span class="quoted">"_ <span class="keyword1">→<span class="hidden">⇧</span><sup>*</sup></span> _"</span> <span class="main">[</span>81<span class="main">,</span>81<span class="main">]</span> 100<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">cs0</span></span></span> <span class="main"><span class="free">→<span class="hidden">⇧</span><sup>*</sup></span></span> <span class="free"><span class="bound"><span class="entity">cs1</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cs0</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">cs1</span></span></span><span class="main">)</span> <span class="main">:</span> exec1<span class="main">^*</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> exec1E<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="free">cs'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span>Do <span class="free">f</span><span class="main">#</span><span class="free">cs</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="free">cs'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">c1</span><span class="main">;</span><span class="free">c2</span><span class="main">)</span><span class="main">#</span><span class="free">cs</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="free">cs'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> <span class="free">c1</span> <span class="keyword1">ELSE</span> <span class="free">c2</span><span class="main">)</span><span class="main">#</span><span class="free">cs</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="free">cs'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span><span class="main">#</span><span class="free">cs</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="free">cs'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span>CALL<span class="main">#</span><span class="free">cs</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="free">cs'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="keyword1">LOCAL</span> <span class="free">f</span><span class="main">;</span><span class="free">c</span><span class="main">;</span><span class="free">g</span><span class="main">)</span><span class="main">#</span><span class="free">cs</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="free">cs'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→</span> <span class="free">u</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">u</span></span><span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> app_exec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">cs</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="free">cs'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">cs</span><span class="main">@</span><span class="free">cs2</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="free">cs'</span><span class="main">@</span><span class="free">cs2</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exec1.induct<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>fun_upd_apply<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>exec1.intros<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> app_execs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">cs</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span><span class="free">cs'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">cs</span><span class="main">@</span><span class="free">cs2</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span><span class="free">cs'</span><span class="main">@</span><span class="free">cs2</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> rtrancl_induct2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>app_exec rtrancl_trans<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> exec_impl_execs<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">-</span><span class="free">c</span><span class="main">→</span> <span class="free">s'</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">cs</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">#</span><span class="bound">cs</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span><span class="bound">cs</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exec.induct<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>rtrancl_trans<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>exec1.IfTrue rtrancl_trans<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>exec1.IfFalse rtrancl_trans<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>exec1.WhileFalse rtrancl_trans<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>exec1.WhileTrue rtrancl_trans<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rtrancl_trans<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rtrancl_trans<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">inductive</span></span>
  <span class="entity">execs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"state <span class="main">⇒</span> com list <span class="main">⇒</span> state <span class="main">⇒</span> bool"</span></span>   <span class="main">(</span><span class="quoted">"_<span class="keyword3">/ </span><span class="keyword1">=</span>_<span class="keyword1">⇒</span><span class="keyword3">/ </span>_"</span> <span class="main">[</span>50<span class="main">,</span>0<span class="main">,</span>50<span class="main">]</span> 50<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">=</span></span><span class="main">[]</span><span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">-</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">→</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main"><span class="free">=</span></span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">=</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span></span></span></span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span><span class="main">[]</span><span class="main">⇒</span> <span class="free">t</span>"</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span><span class="free">c</span><span class="main">#</span><span class="free">cs</span><span class="main">⇒</span> <span class="free">t</span>"</span></span>

<span class="keyword1"><span class="command">theorem</span></span> exec1s_impl_execs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">cs</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">=</span><span class="free">cs</span><span class="main">⇒</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> converse_rtrancl_induct2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> execs.intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exec1.cases<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>execs.intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>execs.intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>execs.intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>execs.intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>execs.intros exec.intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>execs.intros exec.intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>execs.intros exec.intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>execs.intros exec.intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">theorem</span></span> exec1s_impl_exec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="free">c</span><span class="main">]</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">-</span><span class="free">c</span><span class="main">→</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> exec1s_impl_execs<span class="main">)</span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">termis</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"com list <span class="main">⇒</span> state <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⇓</span>"</span> 60<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">[]</span><span class="main"><span class="free">⇓</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span> <span class="main"><span class="free">⇓</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">↓</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">-</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">→</span> <span class="bound">t</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main"><span class="free">⇓</span></span><span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> exec1_pres_termis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">cs</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="free">cs'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">cs</span><span class="main">⇓</span><span class="free">s</span> <span class="main">⟶</span> <span class="free">cs'</span><span class="main">⇓</span><span class="free">s'</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exec1.induct<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>while_termiE while_termiE2 exec.WhileTrue<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> execs_pres_termis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">cs</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span><span class="free">cs'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">cs</span><span class="main">⇓</span><span class="free">s</span> <span class="main">⟶</span> <span class="free">cs'</span><span class="main">⇓</span><span class="free">s'</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> rtrancl_induct2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>exec1_pres_termis<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> execs_pres_termi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="main">[</span><span class="free">c</span><span class="main">]</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span><span class="free">c'</span><span class="main">#</span><span class="free">cs'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span><span class="main">;</span> <span class="free">c</span><span class="main">↓</span><span class="free">s</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">c'</span><span class="main">↓</span><span class="free">s'</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> execs_pres_termis<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span><span class="free"><span class="free">c</span></span><span class="main"><span class="main">]</span></span>"</span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">c'</span></span><span class="main"><span class="main">#</span></span><span class="free"><span class="free">cs'</span></span>"</span></span></span><span class="main"><span class="main">,</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">termi_call_steps</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>state <span class="main">×</span> state<span class="main">)</span>set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">termi_call_steps</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span><span class="main">.</span> body<span class="main">↓</span><span class="bound">s</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">cs</span><span class="main">.</span> <span class="main">(</span><span class="main">[</span>body<span class="main">]</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>CALL <span class="main">#</span> <span class="bound">cs</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lem<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">∈</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⟶</span> <span class="free">P</span> <span class="free">a</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="free">b</span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">:</span><span class="free">r</span><span class="main">}</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">b</span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">∈</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> trancl_induct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>trancl_trans<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> trancl_induct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>trancl_trans<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">lemma</span></span> renumber_aux<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">:</span> <span class="free">r</span><span class="main">^*</span> <span class="main">∧</span> <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">,</span><span class="free">f</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">:</span> <span class="free">r</span><span class="main">;</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">:</span> <span class="free">r</span><span class="main">^*</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">=</span> <span class="free">f</span> <span class="main">0</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">0</span> <span class="main">=</span> <span class="free">a</span> <span class="main">&amp;</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">i</span><span class="main">,</span> <span class="bound">f</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">:</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> converse_rtrancl_induct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">i</span> <span class="keyword1">of</span> <span class="main">0</span> <span class="main">⇒</span> <span class="improper">y</span> <span class="main">|</span> Suc <span class="bound">i</span> <span class="main">⇒</span> <span class="improper">fa</span> <span class="bound">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">i</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> renumber<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">:</span> <span class="free">r</span><span class="main">^*</span> <span class="main">∧</span> <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">,</span><span class="free">f</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">:</span> <span class="free">r</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">0</span> <span class="main">=</span> <span class="free">a</span> <span class="main">&amp;</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">i</span><span class="main">,</span> <span class="bound">f</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">:</span> <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>renumber_aux<span class="main">)</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">inf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"com list <span class="main">⇒</span> state <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">inf</span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">i</span> <span class="main">→</span> <span class="bound">f</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> inf <span class="main">[]</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> inf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="main">0</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> inf <span class="main">[</span>Do <span class="free">f</span><span class="main">]</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> inf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="main">0</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="main">1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">fa</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inf <span class="main">(</span><span class="main">(</span><span class="free">c1</span><span class="main">;</span><span class="free">c2</span><span class="main">)</span><span class="main">#</span><span class="free">cs</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> inf <span class="main">(</span><span class="free">c1</span><span class="main">#</span><span class="free">c2</span><span class="main">#</span><span class="free">cs</span><span class="main">)</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> inf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="improper">f</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="main">0</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">f</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">i</span> <span class="keyword1">of</span> <span class="main">0</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="free">c1</span><span class="main">;</span><span class="free">c2</span><span class="main">)</span><span class="main">#</span><span class="free">cs</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">|</span> Suc <span class="bound">i</span> <span class="main">⇒</span> <span class="improper">f</span> <span class="bound">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>nat.split<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inf <span class="main">(</span><span class="main">(</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> <span class="free">c1</span> <span class="keyword1">ELSE</span> <span class="free">c2</span><span class="main">)</span><span class="main">#</span><span class="free">cs</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span>
              inf <span class="main">(</span><span class="main">(</span><span class="keyword1">if</span> <span class="free">b</span> <span class="free">s</span> <span class="keyword1">then</span> <span class="free">c1</span> <span class="keyword1">else</span> <span class="free">c2</span><span class="main">)</span><span class="main">#</span><span class="free">cs</span><span class="main">)</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> inf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="main">0</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">f</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="improper">f</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="improper">f</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">i</span> <span class="keyword1">of</span> <span class="main">0</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> <span class="free">c1</span> <span class="keyword1">ELSE</span> <span class="free">c2</span><span class="main">)</span><span class="main">#</span><span class="free">cs</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">|</span> Suc <span class="bound">i</span> <span class="main">⇒</span> <span class="improper">f</span> <span class="bound">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exec1.intros <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>nat.split<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"inf <span class="main">(</span><span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span><span class="main">#</span><span class="free">cs</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">if</span> <span class="free">b</span> <span class="free">s</span> <span class="keyword1">then</span> inf <span class="main">(</span><span class="free">c</span><span class="main">#</span><span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span><span class="main">#</span><span class="free">cs</span><span class="main">)</span> <span class="free">s</span> <span class="keyword1">else</span> inf <span class="free">cs</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> inf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="main">0</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">f</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="improper">f</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="improper">f</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">i</span> <span class="keyword1">of</span> <span class="main">0</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span><span class="main">#</span><span class="free">cs</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">|</span> Suc <span class="bound">i</span> <span class="main">⇒</span> <span class="improper">f</span> <span class="bound">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exec1.intros <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>nat.split<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">i</span> <span class="keyword1">of</span> <span class="main">0</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span><span class="main">#</span><span class="free">cs</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">|</span> Suc <span class="bound">i</span> <span class="main">⇒</span> <span class="improper">f</span> <span class="bound">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exec1.intros <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>nat.split<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inf <span class="main">(</span>CALL<span class="main">#</span><span class="free">cs</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span>  inf <span class="main">(</span>body<span class="main">#</span><span class="free">cs</span><span class="main">)</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> inf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="main">0</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">f</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="improper">f</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">i</span> <span class="keyword1">of</span> <span class="main">0</span> <span class="main">⇒</span> <span class="main">(</span>CALL<span class="main">#</span><span class="free">cs</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">|</span> Suc <span class="bound">i</span> <span class="main">⇒</span> <span class="improper">f</span> <span class="bound">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exec1.intros <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>nat.split<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inf <span class="main">(</span><span class="main">(</span><span class="keyword1">LOCAL</span> <span class="free">f</span><span class="main">;</span><span class="free">c</span><span class="main">;</span><span class="free">g</span><span class="main">)</span><span class="main">#</span><span class="free">cs</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span>
              inf <span class="main">(</span><span class="free">c</span><span class="main">#</span>Do<span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">{</span><span class="free">g</span> <span class="free">s</span> <span class="bound">t</span><span class="main">}</span><span class="main">)</span><span class="main">#</span><span class="free">cs</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> inf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> F<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="main">0</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">F</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="improper">F</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> F<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">i</span> <span class="keyword1">of</span> <span class="main">0</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">LOCAL</span> <span class="free">f</span><span class="main">;</span><span class="free">c</span><span class="main">;</span><span class="free">g</span><span class="main">)</span><span class="main">#</span><span class="free">cs</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">|</span> Suc <span class="bound">i</span> <span class="main">⇒</span> <span class="improper">F</span> <span class="bound">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exec1.intros <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>nat.split<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> exec1_only1_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ccs</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="free">cs'</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">⟹</span>
                    <span class="main">∀</span><span class="bound">c</span> <span class="bound">cs</span><span class="main">.</span> <span class="free">ccs</span> <span class="main">=</span> <span class="bound">c</span><span class="main">#</span><span class="bound">cs</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">cs1</span><span class="main">.</span> <span class="free">cs'</span> <span class="main">=</span> <span class="bound">cs1</span> <span class="main">@</span> <span class="bound">cs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exec1.induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> exec1_only1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">#</span><span class="free">cs</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="free">cs'</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">cs1</span><span class="main">.</span> <span class="free">cs'</span> <span class="main">=</span> <span class="bound">cs1</span> <span class="main">@</span> <span class="free">cs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>exec1_only1_aux<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> exec1_drop_suffix_aux<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">cs12</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="free">cs1'2</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">cs1</span> <span class="bound">cs2</span> <span class="bound">cs1'</span><span class="main">.</span>
 <span class="free">cs12</span> <span class="main">=</span> <span class="bound">cs1</span><span class="main">@</span><span class="bound">cs2</span> <span class="main">&amp;</span> <span class="free">cs1'2</span> <span class="main">=</span> <span class="bound">cs1'</span><span class="main">@</span><span class="bound">cs2</span> <span class="main">&amp;</span> <span class="bound">cs1</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">cs1</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="bound">cs1'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exec1.induct<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>exec1.intros <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> neq_Nil_conv<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> exec1_drop_suffix<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">cs1</span><span class="main">@</span><span class="free">cs2</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="free">cs1'</span><span class="main">@</span><span class="free">cs2</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">cs1</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">cs1</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="free">cs1'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>exec1_drop_suffix_aux<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> execs_drop_suffix<span class="main">[</span><span class="operator">rule_format</span><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">no_asm</span></span></span><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="free">c</span><span class="main">#</span><span class="free">cs</span><span class="main">,</span><span class="free">s</span><span class="main">)</span><span class="main">;</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span> <span class="main">→</span> <span class="free">f</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">p</span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">&amp;</span> fst<span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span> <span class="bound">i</span><span class="main">@</span><span class="free">cs</span><span class="main">)</span> <span class="main">⟶</span> fst<span class="main">(</span><span class="free">f</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span> <span class="free">k</span><span class="main">@</span><span class="free">cs</span>
   <span class="main">⟶</span> <span class="main">(</span><span class="main">[</span><span class="free">c</span><span class="main">]</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span><span class="free">p</span> <span class="free">k</span><span class="main">,</span>snd<span class="main">(</span><span class="free">f</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> rtrancl_into_rtrancl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="improper">n</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span>Suc <span class="improper">n</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>exec1_drop_suffix<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> execs_drop_suffix0<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="free">c</span><span class="main">#</span><span class="free">cs</span><span class="main">,</span><span class="free">s</span><span class="main">)</span><span class="main">;</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span> <span class="main">→</span> <span class="free">f</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">;</span> <span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">p</span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">&amp;</span> fst<span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span> <span class="bound">i</span><span class="main">@</span><span class="free">cs</span><span class="main">;</span>
     fst<span class="main">(</span><span class="free">f</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">cs</span><span class="main">;</span> <span class="free">p</span> <span class="free">k</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">[</span><span class="free">c</span><span class="main">]</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span>snd<span class="main">(</span><span class="free">f</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> execs_drop_suffix<span class="main"><span class="keyword3">,</span></span><span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span><span class="operator">assumption</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> skolemize1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">f</span><span class="main">.</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="bound">x</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">SOME</span> <span class="bound">y</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">x</span> <span class="bound">y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>someI2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> least_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="free">c</span> <span class="main">#</span> <span class="free">cs</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span><span class="main">;</span> <span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">→</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">;</span>
        fst<span class="main">(</span><span class="free">f</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">cs</span><span class="main">;</span> <span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> fst<span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≠</span> <span class="free">cs</span><span class="main">⟧</span>
       <span class="main">⟹</span> <span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">≤</span> <span class="free">k</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="bound">p</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">i</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">)</span> <span class="main">&amp;</span> fst<span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="bound">p</span> <span class="main">@</span> <span class="free">cs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper">i</span></span></span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> order_le_imp_less_or_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"Suc <span class="improper">n</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="improper">n</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span>Suc <span class="improper">n</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> sn csn1 sn1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> neq_Nil_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> exec1_only1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> neq_Nil_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">cs1</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> least_lem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="free">c</span><span class="main">#</span><span class="free">cs</span><span class="main">,</span><span class="free">s</span><span class="main">)</span><span class="main">;</span> <span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">→</span> <span class="free">f</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">;</span> <span class="main">∃</span><span class="bound">i</span><span class="main">.</span> fst<span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">cs</span> <span class="main">⟧</span>
       <span class="main">⟹</span> <span class="main">∃</span><span class="bound">k</span><span class="main">.</span> fst<span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">cs</span> <span class="main">&amp;</span> <span class="main">(</span><span class="main">[</span><span class="free">c</span><span class="main">]</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span>snd<span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> fst<span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">cs</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> LeastI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span>
 <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">≤</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> fst <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">cs</span><span class="main">.</span> <span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">p</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">i</span><span class="main">&lt;</span><span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> fst <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">cs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&amp;</span> fst<span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="bound">p</span><span class="main">@</span><span class="free">cs</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> skolemize1<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> p<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> p<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">p</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> execs_drop_suffix0<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>order_less_imp_le<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> LeastI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> thin_rl<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LEAST</span> <span class="bound">j</span><span class="main">.</span> fst <span class="main">(</span><span class="free">f</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span><span class="free">f</span> <span class="improper">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> least_aux<span class="main"><span class="keyword3">,</span></span><span class="operator">assumption</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> LeastI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> not_less_Least<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> skolemize2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span><span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">f</span><span class="main">.</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">SOME</span> <span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>someI2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> inf_cases<span class="main">:</span> <span class="quoted"><span class="quoted">"inf <span class="main">(</span><span class="free">c</span><span class="main">#</span><span class="free">cs</span><span class="main">)</span> <span class="free">s</span> <span class="main">⟹</span> inf <span class="main">[</span><span class="free">c</span><span class="main">]</span> <span class="free">s</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="free">s</span> <span class="main">-</span><span class="free">c</span><span class="main">→</span> <span class="bound">t</span> <span class="main">∧</span> inf <span class="free">cs</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> inf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> disjCI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span><span class="main">.</span> fst<span class="main">(</span><span class="improper">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">cs</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> least_lem<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> exec1s_impl_exec<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">f</span> <span class="improper">k</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="improper">f</span><span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="improper">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> disjI1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> fst<span class="main">(</span><span class="improper">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="bound">p</span><span class="main">@</span><span class="free">cs</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> skolemize2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> p<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="improper">p</span> <span class="bound">i</span><span class="main">,</span> snd<span class="main">(</span><span class="improper">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="main">0</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> conjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"Suc <span class="improper">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">f</span> <span class="improper">i</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">f</span><span class="main">(</span>Suc <span class="improper">i</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>exec1_drop_suffix<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper">i</span></span></span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">p</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="improper">n</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">f</span> <span class="improper">n</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">f</span><span class="main">(</span>Suc <span class="improper">n</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> exec1_only1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> termi_impl_not_inf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">↓</span> <span class="free">s</span> <span class="main">⟹</span> <span class="main">¬</span> inf <span class="main">[</span><span class="free">c</span><span class="main">]</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> termi.induct<span class="main">)</span>
        <span class="comment1">(*Do*)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
       <span class="comment1">(*Semi*)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>inf_cases<span class="main">)</span>
      <span class="comment1">(* Cond *)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
    <span class="comment1">(*While*)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>inf_cases<span class="main">)</span>
  <span class="comment1">(*Call*)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="comment1">(*Local*)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>inf_cases<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> termi_impl_no_inf_chain<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">↓</span><span class="free">s</span> <span class="main">⟹</span> <span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">[</span><span class="free">c</span><span class="main">]</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">i</span><span class="main">,</span> <span class="bound">f</span><span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">:</span> exec1<span class="main">^+</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"wf<span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">[</span><span class="free">c</span><span class="main">]</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="bound">x</span> <span class="main">&amp;</span> <span class="bound">x</span> <span class="main">→</span> <span class="bound">y</span><span class="main">}</span><span class="main">^+</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>wf_iff_no_infinite_down_chain<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> contrapos_nn<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="main">[</span><span class="free">c</span><span class="main">]</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="improper">f</span> <span class="bound">i</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper">i</span></span></span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> trancl_into_rtrancl rtrancl_trans<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">f</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> lem<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> trancl_into_rtrancl rtrancl_trans<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wf_trancl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>wf_iff_no_infinite_down_chain<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> renumber<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fold</span> inf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> termi_impl_not_inf<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">cseq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> state<span class="main">)</span> <span class="main">⇒</span> nat <span class="main">⇒</span> com list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cseq</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">cseq</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">cs</span><span class="main">.</span> <span class="main">(</span><span class="main">[</span>body<span class="main">]</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>CALL <span class="main">#</span> <span class="bound">cs</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="free">cseq</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> wf_termi_call_steps<span class="main">:</span> <span class="quoted"><span class="quoted">"wf termi_call_steps"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> termi_call_steps_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>wf_iff_no_infinite_down_chain<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> S<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Cs</span><span class="main">.</span> <span class="bound">Cs</span> <span class="main">0</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">&amp;</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span>body <span class="main">#</span> <span class="bound">Cs</span> <span class="bound">i</span><span class="main">,</span><span class="improper">S</span> <span class="bound">i</span><span class="main">)</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>CALL <span class="main">#</span> <span class="bound">Cs</span><span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="improper">S</span><span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"cseq <span class="improper">S</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> P <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">cs</span><span class="main">.</span><span class="main">(</span><span class="main">[</span>body<span class="main">]</span><span class="main">,</span><span class="improper">S</span> <span class="improper">i</span><span class="main">)</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>CALL <span class="main">#</span> <span class="bound">cs</span><span class="main">,</span> <span class="improper">S</span><span class="main">(</span>Suc <span class="improper">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> someI2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>app_execs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>body <span class="main">#</span> <span class="improper">Cs</span> <span class="bound">i</span><span class="main">,</span><span class="improper">S</span> <span class="bound">i</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>body <span class="main">#</span> <span class="improper">Cs</span><span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="improper">S</span><span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">:</span> exec1<span class="main">^+</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>rtrancl_into_trancl1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">[</span>body<span class="main">]</span><span class="main">,</span><span class="improper">S</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">i</span><span class="main">,</span> <span class="bound">f</span><span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">:</span> exec1<span class="main">^+</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span><span class="main">(</span>body<span class="main">#</span><span class="improper">Cs</span> <span class="bound">i</span><span class="main">,</span><span class="improper">S</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>termi_impl_no_inf_chain<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> CALL_lemma<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="bound">z</span><span class="main">=</span><span class="bound">s</span> <span class="main">∧</span> body<span class="main">↓</span><span class="bound">s</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">∈</span> termi_call_steps<span class="main">,</span> CALL<span class="main">,</span> <span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">z</span> <span class="main">-</span>body<span class="main">→</span> <span class="bound">s</span><span class="main">)</span><span class="main">}</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>t</sub></span>
 <span class="main">{</span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="bound">z</span><span class="main">=</span><span class="bound">s</span> <span class="main">∧</span> body<span class="main">↓</span><span class="free">t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">cs</span><span class="main">.</span> <span class="main">(</span><span class="main">[</span>body<span class="main">]</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span><span class="free">c</span><span class="main">#</span><span class="bound">cs</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">z</span> <span class="main">-</span><span class="free">c</span><span class="main">→</span> <span class="bound">s</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">c</span></span></span></span><span class="main">)</span>
<span class="comment1">(*Do*)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> strengthen_pre<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ thoare.Do<span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> execs_pres_termi<span class="main">)</span>
<span class="comment1">(*Semi*)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> c1 c2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> Q <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> body<span class="main">↓</span><span class="free">t</span> <span class="main">&amp;</span> <span class="main">(</span><span class="main">∃</span><span class="bound">cs</span><span class="main">.</span> <span class="main">(</span><span class="main">[</span>body<span class="main">]</span><span class="main">,</span> <span class="free">t</span><span class="main">)</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span><span class="improper">c2</span><span class="main">#</span><span class="bound">cs</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">&amp;</span> <span class="bound">z</span> <span class="main">-</span><span class="improper">c1</span><span class="main">→</span><span class="bound">s</span> <span class="main">&amp;</span> <span class="improper">c2</span><span class="main">↓</span><span class="bound">s</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> thoare.Semi<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> thoare.Conseq<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">s</span> <span class="main">-</span><span class="improper">c1</span><span class="main">→</span> <span class="improper">ta</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> exec1.Semi exec_impl_execs rtrancl_trans<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span>body<span class="main">]</span><span class="main">,</span> <span class="free">t</span><span class="main">)</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span><span class="improper">c2</span> <span class="main">#</span> <span class="improper">cs</span><span class="main">,</span> <span class="improper">ta</span><span class="main">)</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>exec1.Semi<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> r_into_rtrancl<span class="main"><span class="main">]</span></span> exec_impl_execs rtrancl_trans<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span>body<span class="main">]</span><span class="main">,</span> <span class="free">t</span><span class="main">)</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span><span class="improper">c2</span> <span class="main">#</span> <span class="improper">cs</span><span class="main">,</span> <span class="improper">ta</span><span class="main">)</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> exec_impl_execs rtrancl_trans<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>exec_impl_execs rtrancl_trans execs_pres_termi<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> exec1.Semi rtrancl_trans<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> thoare.Conseq<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="comment1">(*Call*)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 3
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>termi_call_steps_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> thoare.Conseq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> thoare.Asm<span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> execs_pres_termi<span class="main">)</span>
<span class="comment1">(*If*)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> thoare.If<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> thoare.Conseq<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> exec1.IfTrue rtrancl_trans<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> thoare.Conseq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> exec1.IfFalse rtrancl_trans<span class="main">)</span>
<span class="comment1">(*Var*)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> thoare.Local<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> thoare.Conseq<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> rtrancl_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ r_into_rtrancl<span class="main"><span class="main">[</span></span><span class="operator">OF</span> exec1.Local<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fast</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> rtrancl_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ r_into_rtrancl<span class="main"><span class="main">[</span></span><span class="operator">OF</span> exec1.Local<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> b c<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> P' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="bound">z</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span><span class="main">.</span> <span class="improper">b</span> <span class="bound">s</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">-</span><span class="improper">c</span><span class="main">→</span> <span class="bound">t</span><span class="main">}</span><span class="main">)</span><span class="main">^*</span> <span class="main">∧</span> body <span class="main">↓</span> <span class="free">t</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">∃</span><span class="bound">cs</span><span class="main">.</span> <span class="main">(</span><span class="main">[</span>body<span class="main">]</span><span class="main">,</span> <span class="free">t</span><span class="main">)</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span><span class="main">(</span><span class="keyword1">WHILE</span> <span class="improper">b</span> <span class="keyword1">DO</span> <span class="improper">c</span><span class="main">)</span> <span class="main">#</span> <span class="bound">cs</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> thoare.Conseq<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> thoare.While<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf_termi<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> thoare.Conseq<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rtrancl_trans exec1.WhileTrue<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> rtrancl_trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> exec1.WhileTrue exec_impl_execs rtrancl_trans<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>execs_pres_termi<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> exec1.WhileTrue exec_impl_execs rtrancl_trans<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> exec1.WhileTrue exec_impl_execs rtrancl_trans<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">s</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">s</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> converse_rtrancl_induct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>exec.WhileTrue<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rtrancl_refl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> CALL_cor<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="bound">z</span><span class="main">=</span><span class="bound">s</span> <span class="main">∧</span> body<span class="main">↓</span><span class="bound">s</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">∈</span> termi_call_steps<span class="main">,</span> CALL<span class="main">,</span> <span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">z</span> <span class="main">-</span>body<span class="main">→</span> <span class="bound">s</span><span class="main">)</span><span class="main">}</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>t</sub></span>
 <span class="main">{</span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="bound">z</span><span class="main">=</span><span class="bound">s</span> <span class="main">∧</span> body<span class="main">↓</span><span class="bound">s</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">=</span> <span class="free">t</span><span class="main">}</span> body <span class="main">{</span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">z</span> <span class="main">-</span>body<span class="main">→</span> <span class="bound">s</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> strengthen_pre<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ CALL_lemma<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> MGT_CALL<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>t</sub></span> MGT<span class="hidden">⇩</span><sub>t</sub> CALL"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> MGT<span class="hidden">⇩</span><sub>t</sub>_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>thoare.Call wf_termi_call_steps CALL_cor<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">theorem</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span>  <span class="main">⟹</span>  <span class="main">{}</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">::</span>state assn<span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> MGT_implies_complete<span class="main"><span class="main">[</span></span><span class="operator">OF</span> MGT_lemma<span class="main"><span class="main">[</span></span><span class="operator">OF</span> MGT_CALL<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="PsLang">
<div class="head">
<h1>Theory PsLang</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Mutually recursive procedures
    Author:      Tobias Nipkow, 2001/2006
    Maintainer:  Tobias Nipkow
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Hoare Logics for Mutually Recursive Procedure"</span></span>

<span class="keyword1"><span class="command">theory</span></span> PsLang <span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹The language›</span></span>

<span class="keyword1"><span class="command">typedecl</span></span> state
<span class="keyword1"><span class="command">typedecl</span></span> pname

<span class="keyword1"><span class="command">type_synonym</span></span> bexp <span class="main">=</span> <span class="quoted"><span class="quoted">"state <span class="main">⇒</span> bool"</span></span>

<span class="keyword1"><span class="command">datatype</span></span>
  com <span class="main">=</span> Do <span class="quoted"><span class="quoted">"state <span class="main">⇒</span> state set"</span></span>
      <span class="main">|</span> Semi  <span class="quoted">com</span> <span class="quoted">com</span>          <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span>  <span class="main">[</span>60<span class="main">,</span> 60<span class="main">]</span> 10<span class="main">)</span>
      <span class="main">|</span> Cond  <span class="quoted">bexp</span> <span class="quoted">com</span> <span class="quoted">com</span>     <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">IF</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">THEN</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">ELSE</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span>  60<span class="main">)</span>
      <span class="main">|</span> While <span class="quoted">bexp</span> <span class="quoted">com</span>         <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">WHILE</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">DO</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span>  60<span class="main">)</span>
      <span class="main">|</span> CALL <span class="quoted">pname</span>
      <span class="main">|</span> Local <span class="quoted"><span class="quoted">"<span class="main">(</span>state <span class="main">⇒</span> state<span class="main">)</span>"</span></span> <span class="quoted">com</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>state <span class="main">⇒</span> state <span class="main">⇒</span> state<span class="main">)</span>"</span></span>
               <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">LOCAL</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span> <span class="main">[</span>0<span class="main">,</span>0<span class="main">,</span>60<span class="main">]</span> 60<span class="main">)</span>

<span class="keyword1"><span class="command">consts</span></span> body <span class="main">::</span> <span class="quoted"><span class="quoted">"pname <span class="main">⇒</span> com"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We generalize from a single procedure to a whole set of
procedures following the ideas of von Oheimb~\cite{Oheimb-FSTTCS99}.
The basic setup is modified only in a few places:
\begin{itemize}
\item We introduce a new basic type <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">pname</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> of procedure names.
\item Constant <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">body</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is now of type <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span><span class="quoted"><span class="quoted">"pname <span class="main"><span class="main">⇒</span></span> com"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
\item The <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">CALL</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> command now has an argument of type <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">pname</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>,
the name of the procedure that is to be called.
\end{itemize}
›</span></span>

<span class="keyword1"><span class="command">inductive</span></span>
  <span class="entity">exec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"state <span class="main">⇒</span> com <span class="main">⇒</span> state <span class="main">⇒</span> bool"</span></span>   <span class="main">(</span><span class="quoted">"_<span class="keyword3">/ </span><span class="keyword1">-</span>_<span class="keyword1">→</span><span class="keyword3">/ </span>_"</span> <span class="main">[</span>50<span class="main">,</span>0<span class="main">,</span>50<span class="main">]</span> 50<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
    Do<span class="main">:</span>     <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span>Do <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span>

  <span class="main">|</span> Semi<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">s0</span></span></span> <span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">s0</span></span></span> <span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span>"</span></span>

  <span class="main">|</span> IfTrue<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">;</span>  <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span>
  <span class="main">|</span> IfFalse<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">¬</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span>

  <span class="main">|</span> WhileFalse<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span><span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>
  <span class="main">|</span> WhileTrue<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main"><span class="free">-</span></span><span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">⟧</span>
                <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span><span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span>"</span></span>

  <span class="main">|</span> Call<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span>body <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span>CALL <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span>

  <span class="main">|</span> Local<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span><span class="keyword1">LOCAL</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">-</span>Do <span class="free">f</span><span class="main">→</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">t</span> <span class="main">∈</span> <span class="free">f</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> exec.cases <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>exec.intros<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">-</span><span class="free">c</span><span class="main">;</span><span class="free">d</span><span class="main">→</span> <span class="free">u</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="free">s</span> <span class="main">-</span><span class="free">c</span><span class="main">→</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">-</span><span class="free">d</span><span class="main">→</span> <span class="free">u</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> exec.cases <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>exec.intros<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">-</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> <span class="free">c</span> <span class="keyword1">ELSE</span> <span class="free">d</span><span class="main">→</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span>
              <span class="main">(</span><span class="free">s</span> <span class="main">-</span><span class="keyword1">if</span> <span class="free">b</span> <span class="free">s</span> <span class="keyword1">then</span> <span class="free">c</span> <span class="keyword1">else</span> <span class="free">d</span><span class="main">→</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> exec.cases <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>exec.intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>exec.intros <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_split_asm<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">-</span>CALL <span class="free">p</span><span class="main">→</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span> <span class="main">-</span>body <span class="free">p</span><span class="main">→</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> exec.cases <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>exec.intros<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">-</span><span class="keyword1">LOCAL</span> <span class="free">f</span><span class="main">;</span> <span class="free">c</span><span class="main">;</span> <span class="free">g</span><span class="main">→</span> <span class="free">u</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="free">f</span> <span class="free">s</span> <span class="main">-</span><span class="free">c</span><span class="main">→</span> <span class="bound">t</span> <span class="main">∧</span> <span class="free">u</span> <span class="main">=</span> <span class="free">g</span> <span class="free">s</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> exec.cases <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>exec.intros<span class="main">)</span>

<span class="keyword1"><span class="command">inductive</span></span>
  <span class="entity">execn</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"state <span class="main">⇒</span> com <span class="main">⇒</span> nat <span class="main">⇒</span> state <span class="main">⇒</span> bool"</span></span>   <span class="main">(</span><span class="quoted">"_<span class="keyword3">/ </span><span class="keyword1">-</span>_<span class="keyword1">-</span>_<span class="keyword1">→</span><span class="keyword3">/ </span>_"</span> <span class="main">[</span>50<span class="main">,</span>0<span class="main">,</span>0<span class="main">,</span>50<span class="main">]</span> 50<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
    Do<span class="main">:</span>     <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span>Do <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span>

  <span class="main">|</span> Semi<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">s0</span></span></span> <span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">c0</span></span></span><span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">s0</span></span></span> <span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">c0</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span>"</span></span>

  <span class="main">|</span> IfTrue<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">c0</span></span></span><span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">c0</span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span>

  <span class="main">|</span> IfFalse<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">¬</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">c0</span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span>

  <span class="main">|</span> WhileFalse<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span><span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>

  <span class="main">|</span> WhileTrue<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main"><span class="free">-</span></span><span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">⟧</span>
                <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span><span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span>"</span></span>

  <span class="main">|</span> Call<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span>body <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span>CALL <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main"><span class="free">-</span></span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span>

  <span class="main">|</span> Local<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">-</span></span><span class="keyword1">LOCAL</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main"><span class="free">-</span></span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">-</span>Do <span class="free">f</span><span class="main">-</span><span class="free">n</span><span class="main">→</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">t</span> <span class="main">∈</span> <span class="free">f</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> execn.cases <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>execn.intros<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">-</span><span class="free">c1</span><span class="main">;</span><span class="free">c2</span><span class="main">-</span><span class="free">n</span><span class="main">→</span> <span class="free">u</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="free">s</span> <span class="main">-</span><span class="free">c1</span><span class="main">-</span><span class="free">n</span><span class="main">→</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">-</span><span class="free">c2</span><span class="main">-</span><span class="free">n</span><span class="main">→</span> <span class="free">u</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">best</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> execn.cases <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>execn.intros<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">-</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> <span class="free">c</span> <span class="keyword1">ELSE</span> <span class="free">d</span><span class="main">-</span><span class="free">n</span><span class="main">→</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span>
              <span class="main">(</span><span class="free">s</span> <span class="main">-</span><span class="keyword1">if</span> <span class="free">b</span> <span class="free">s</span> <span class="keyword1">then</span> <span class="free">c</span> <span class="keyword1">else</span> <span class="free">d</span><span class="main">-</span><span class="free">n</span><span class="main">→</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> execn.cases <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>execn.intros<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">-</span>CALL <span class="free">p</span><span class="main">-</span> <span class="main">0</span><span class="main">→</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> False"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> execn.cases <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>execn.intros<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">-</span>CALL <span class="free">p</span><span class="main">-</span>Suc <span class="free">n</span><span class="main">→</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span> <span class="main">-</span>body <span class="free">p</span><span class="main">-</span><span class="free">n</span><span class="main">→</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> execn.cases <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>execn.intros<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">-</span><span class="keyword1">LOCAL</span> <span class="free">f</span><span class="main">;</span> <span class="free">c</span><span class="main">;</span> <span class="free">g</span><span class="main">-</span><span class="free">n</span><span class="main">→</span> <span class="free">u</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="free">f</span> <span class="free">s</span> <span class="main">-</span><span class="free">c</span><span class="main">-</span><span class="free">n</span><span class="main">→</span> <span class="bound">t</span> <span class="main">∧</span> <span class="free">u</span> <span class="main">=</span> <span class="free">g</span> <span class="free">s</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> execn.cases <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>execn.intros<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> exec_mono<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">-</span><span class="free">c</span><span class="main">-</span><span class="free">m</span><span class="main">→</span> <span class="free">t</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">m</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">⟶</span> <span class="free">s</span> <span class="main">-</span><span class="free">c</span><span class="main">-</span><span class="bound">n</span><span class="main">→</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> execn.induct<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>execn.intros<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>execn.intros<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> m<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">m</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> exec_iff_execn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">-</span><span class="free">c</span><span class="main">→</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="free">s</span> <span class="main">-</span><span class="free">c</span><span class="main">-</span><span class="bound">n</span><span class="main">→</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exec.induct<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> m n<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"max <span class="improper">m</span> <span class="improper">n</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>exec.intros exec_mono <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>max_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>execn.intros<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> m n<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"max <span class="improper">m</span> <span class="improper">n</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>execn.WhileTrue exec_mono <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>max_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> execn.induct<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exec.WhileFalse<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> exec.intros<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> while_lemma<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">-</span><span class="free">w</span><span class="main">-</span><span class="free">n</span><span class="main">→</span> <span class="free">t</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">b</span> <span class="bound">c</span><span class="main">.</span> <span class="free">w</span> <span class="main">=</span> <span class="keyword1">WHILE</span> <span class="bound">b</span> <span class="keyword1">DO</span> <span class="bound">c</span> <span class="main">∧</span> <span class="free">P</span> <span class="free">s</span> <span class="main">∧</span>
                    <span class="main">(</span><span class="main">∀</span><span class="bound">s</span> <span class="bound">s'</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">∧</span> <span class="bound">b</span> <span class="bound">s</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">-</span><span class="bound">c</span><span class="main">-</span><span class="free">n</span><span class="main">→</span> <span class="bound">s'</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">P</span> <span class="free">t</span> <span class="main">∧</span> <span class="main">¬</span><span class="bound">b</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> execn.induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="improper">t</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> while_rule<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">s</span> <span class="main">-</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">-</span><span class="free">n</span><span class="main">→</span> <span class="free">t</span><span class="main">;</span> <span class="free">P</span> <span class="free">s</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">s</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">⟦</span><span class="free">P</span> <span class="bound">s</span><span class="main">;</span> <span class="free">b</span> <span class="bound">s</span><span class="main">;</span> <span class="bound">s</span> <span class="main">-</span><span class="free">c</span><span class="main">-</span><span class="free">n</span><span class="main">→</span> <span class="bound">s'</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">s'</span><span class="main">⟧</span>
  <span class="main">⟹</span> <span class="free">P</span> <span class="free">t</span> <span class="main">∧</span> <span class="main">¬</span><span class="free">b</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> while_lemma<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="PsHoare">
<div class="head">
<h1>Theory PsHoare</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Inductive definition of Hoare logic
    Author:      Tobias Nipkow, 2001/2006
    Maintainer:  Tobias Nipkow
*)</span>

<span class="keyword1"><span class="command">theory</span></span> PsHoare <span class="keyword2"><span class="keyword">imports</span></span> <a href="PsLang.html">PsLang</a> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Hoare logic for partial correctness›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> assn <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> state <span class="main">⇒</span> bool"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> cntxt <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> assn <span class="main">×</span> com <span class="main">×</span> <span class="tfree">'a</span> assn<span class="main">)</span>set"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">valid</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> assn <span class="main">⇒</span> com <span class="main">⇒</span> <span class="tfree">'a</span> assn <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⊨</span> <span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span><span class="keyword3">/ </span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword3">/ </span><span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⊨</span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span> <span class="bound">t</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">s</span> <span class="main">-</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">→</span> <span class="bound">t</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">z</span> <span class="bound">t</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">valids</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> cntxt <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">|⊨</span> _"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="main"><span class="free">|⊨</span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">P</span><span class="main">,</span><span class="bound">c</span><span class="main">,</span><span class="bound">Q</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">.</span> <span class="main">⊨</span> <span class="main">{</span><span class="bound">P</span><span class="main">}</span><span class="bound">c</span><span class="main">{</span><span class="bound">Q</span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">nvalid</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> assn <span class="main">⇒</span> com <span class="main">⇒</span> <span class="tfree">'a</span> assn <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⊨</span>_ <span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span><span class="keyword3">/ </span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword3">/ </span><span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⊨</span></span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span> <span class="bound">t</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">s</span> <span class="main">-</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">→</span> <span class="bound">t</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">z</span> <span class="bound">t</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">nvalids</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> cntxt <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">|⊨'_</span>_<span class="keyword3">/ </span>_"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="main"><span class="free">|⊨_</span></span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">P</span><span class="main">,</span><span class="bound">c</span><span class="main">,</span><span class="bound">Q</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">.</span> <span class="main">⊨</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">{</span><span class="bound">P</span><span class="main">}</span><span class="bound">c</span><span class="main">{</span><span class="bound">Q</span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We now need an additional notion of
validity \mbox{<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>C |⊨ D›</span></span></span></span>} where <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">D</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a set as well. The
reason is that we can now have mutually recursive procedures whose
correctness needs to be established by simultaneous induction. Instead
of sets of Hoare triples we may think of conjunctions. We define both
<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>C |⊨ D›</span></span></span></span> and its relativized version:›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">cvalids</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> cntxt <span class="main">⇒</span> <span class="tfree">'a</span> cntxt <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">|⊨</span><span class="keyword3">/ </span>_"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">|⊨</span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">⟷</span> <span class="main">|⊨</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">⟶</span> <span class="main">|⊨</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">cnvalids</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> cntxt <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> cntxt <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">|⊨'_</span>_<span class="keyword3">/ </span>_"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">|⊨_</span></span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">⟷</span> <span class="main">|⊨_</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">⟶</span> <span class="main">|⊨_</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Our Hoare logic now defines judgements of the form <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>C ⊩
D›</span></span></span></span> where both <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">C</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">D</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> are (potentially infinite) sets
of Hoare triples; <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>C ⊢ {P}c{Q}›</span></span></span></span> is simply an abbreviation for
<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>C ⊩ {(P,c,Q)}›</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">inductive</span></span>
  <span class="entity">hoare</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> cntxt <span class="main">⇒</span> <span class="tfree">'a</span> cntxt <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">⊩</span><span class="keyword3">/ </span>_"</span> 50<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="entity"><span class="free">hoare3</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> cntxt <span class="main">⇒</span> <span class="tfree">'a</span> assn <span class="main">⇒</span> com <span class="main">⇒</span> <span class="tfree">'a</span> assn <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">⊢</span><span class="keyword3">/ </span><span class="keyword3">(</span><span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span><span class="keyword3">/ </span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword3">/ </span><span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span><span class="keyword3">)</span>"</span> 50<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span>  <span class="main">≡</span>  <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">⊩</span></span> <span class="main">{</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="main">|</span> Do<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="main">∀</span><span class="bound">t</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">s</span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">z</span> <span class="bound">t</span><span class="main"><span class="free">}</span></span> Do <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>
<span class="main">|</span> Semi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main"><span class="free">}</span></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>
<span class="main">|</span> If<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">¬</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span>  <span class="main">⟧</span> <span class="main">⟹</span>
      <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span> <span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>
<span class="main">|</span> While<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span> <span class="main">⟹</span>
          <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">¬</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span><span class="main"><span class="free">}</span></span>"</span></span>

<span class="main">|</span> Conseq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P'</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q'</span></span></span><span class="main"><span class="free">}</span></span><span class="main">;</span>
             <span class="main">∀</span><span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P'</span></span></span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">Q'</span></span></span> <span class="bound">z</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">z</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
           <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>

<span class="main">|</span> Call<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="main">(</span><span class="bound">P</span><span class="main">,</span><span class="bound">c</span><span class="main">,</span><span class="bound">Q</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">.</span> <span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="bound">c</span> <span class="main">=</span> CALL <span class="bound">p</span><span class="main">;</span>
     <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">⊩</span></span> <span class="main">{</span><span class="main">(</span><span class="bound">P</span><span class="main">,</span><span class="bound">b</span><span class="main">,</span><span class="bound">Q</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="bound">P</span><span class="main">,</span>CALL <span class="bound">p</span><span class="main">,</span><span class="bound">Q</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">=</span> body <span class="bound">p</span><span class="main">}</span> <span class="main">⟧</span>
  <span class="main">⟹</span> <span class="main">{}</span> <span class="main"><span class="free">⊩</span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span>"</span></span>

<span class="main">|</span> Asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">,</span>CALL <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span> CALL <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>

<span class="main">|</span> ConjI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">P</span><span class="main">,</span><span class="bound">c</span><span class="main">,</span><span class="bound">Q</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main"><span class="free">{</span></span><span class="bound">P</span><span class="main"><span class="free">}</span></span><span class="bound">c</span><span class="main"><span class="free">{</span></span><span class="bound">Q</span><span class="main"><span class="free">}</span></span>  <span class="main">⟹</span>  <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">⊩</span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span>"</span></span>
<span class="main">|</span> ConjE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">⊩</span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">;</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>

<span class="main">|</span> Local<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound">s'</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">z</span> <span class="bound">s'</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">s'</span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">z</span> <span class="bound">t</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">z</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">s'</span> <span class="bound">t</span><span class="main">)</span><span class="main"><span class="free">}</span></span> <span class="main">⟧</span> <span class="main">⟹</span>
        <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span> <span class="keyword1">LOCAL</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>
<span class="keyword2"><span class="keyword">monos</span></span> split_beta


<span class="keyword1"><span class="command">lemmas</span></span> valid_defs <span class="main">=</span> valid_def valids_def cvalids_def
                    nvalid_def nvalids_def cnvalids_def

<span class="keyword1"><span class="command">theorem</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">⊩</span> <span class="free">D</span>  <span class="main">⟹</span>  <span class="free">C</span> <span class="main">|⊨</span> <span class="free">D</span>"</span></span>

<span class="keyword1"><span class="command">txt</span></span><span class="quoted"><span class="plain_text">‹\noindent As before, we prove a generalization of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">prop</span></span><span class="quoted"><span class="quoted">"<span class="free"><span class="free">C</span></span> <span class="main"><span class="main">|⊨</span></span> <span class="free"><span class="free">D</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>,
namely <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">prop</span></span><span class="quoted"><span class="quoted">"<span class="main"><span class="main">∀</span></span><span class="bound"><span class="bound">n</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">C</span></span> <span class="main"><span class="main">|⊨_</span></span><span class="bound"><span class="bound">n</span></span> <span class="free"><span class="free">D</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, by induction on <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">prop</span></span><span class="quoted"><span class="quoted">"<span class="free"><span class="free">C</span></span> <span class="main"><span class="main">⊩</span></span> <span class="free"><span class="free">D</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, with an
induction on <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> in the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">CALL</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> case.›</span></span>

<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">C</span> <span class="main">|⊨_</span><span class="bound">n</span> <span class="free">D</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> valid_defs exec_iff_execn<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> eq_reflection<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> hoare.induct<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> while_rule<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 3
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper">n</span></span></span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_use</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">MGT</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"com <span class="main">⇒</span> state assn <span class="main">×</span> com <span class="main">×</span> state assn"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">MGT</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">z</span> <span class="main">=</span> <span class="bound">s</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="main">λ</span><span class="bound">z</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">z</span> <span class="main">-</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">→</span> <span class="bound">t</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> strengthen_pre<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="free">P'</span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">z</span> <span class="bound">s</span><span class="main">;</span> <span class="free">C</span><span class="main">⊢</span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span>  <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">C</span><span class="main">⊢</span> <span class="main">{</span><span class="free">P'</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> hoare.Conseq<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> MGT_implies_complete<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">⊩</span> <span class="main">{</span>MGT <span class="free">c</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">⊨</span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">{}</span> <span class="main">⊢</span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">::</span>state assn<span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> MGT_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> hoare.Conseq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> MGT_lemma<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">.</span> <span class="free">C</span> <span class="main">⊩</span> <span class="main">{</span>MGT<span class="main">(</span>CALL <span class="bound">p</span><span class="main">)</span><span class="main">}</span>  <span class="main">⟹</span>  <span class="free">C</span> <span class="main">⊩</span> <span class="main">{</span>MGT <span class="free">c</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">c</span></span></span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> strengthen_pre<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ hoare.Do<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> hoare.Semi<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> hoare.Conseq<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hoare.If<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hoare.Conseq<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hoare.Conseq<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> b c<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hoare.Conseq<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> P <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="bound">z</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span><span class="main">.</span> <span class="improper">b</span> <span class="bound">s</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">-</span><span class="improper">c</span><span class="main">→</span> <span class="bound">t</span><span class="main">}</span><span class="main">)</span><span class="main">^*</span>"</span></span>
       <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> hoare.While<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> hoare.Conseq<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>rtrancl_into_rtrancl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> s t<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">s</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> converse_rtrancl_induct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>exec.intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>exec.WhileTrue<span class="main">)</span>

<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> hoare.Local <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> hoare.Conseq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> MGT_body<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span><span class="main">,</span> CALL <span class="free">p</span><span class="main">,</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> MGT <span class="main">(</span>CALL <span class="free">pa</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">C</span> <span class="main">⊩</span> <span class="main">{</span>MGT <span class="main">(</span>body <span class="free">p</span><span class="main">)</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">C</span> <span class="main">⊢</span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> body <span class="free">p</span> <span class="main">{</span><span class="free">Q</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">declare</span></span> MGT_def<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> MGT_CALL<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">⊩</span> <span class="main">{</span><span class="bound">mgt</span><span class="main">.</span> <span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="bound">mgt</span> <span class="main">=</span> MGT<span class="main">(</span>CALL <span class="bound">p</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> hoare.Call<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>MGT_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hoare.ConjI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> MGT_body<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> MGT_lemma<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> MGT_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> hoare.Asm<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">theorem</span></span> Complete<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span>  <span class="main">⟹</span>  <span class="main">{}</span> <span class="main">⊢</span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">::</span>state assn<span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> MGT_implies_complete<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> MGT_lemma<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> MGT_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hoare.ConjE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> MGT_CALL<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>MGT_def fun_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="PsTermi">
<div class="head">
<h1>Theory PsTermi</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      Inductive definition of termination
    Author:      Tobias Nipkow, 2001/2006
    Maintainer:  Tobias Nipkow
*)</span>
<span class="keyword1"><span class="command">theory</span></span> PsTermi <span class="keyword2"><span class="keyword">imports</span></span> <a href="PsLang.html">PsLang</a> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Termination›</span></span>

<span class="keyword1"><span class="command">inductive</span></span>
  <span class="entity">termi</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"com <span class="main">⇒</span> state <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">↓</span>"</span> 50<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
    Do<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> Do <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>
  <span class="main">|</span> Semi<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">s0</span></span></span><span class="main">;</span> <span class="main">⋀</span><span class="bound">s1</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">s0</span></span></span> <span class="main">-</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">→</span> <span class="bound">s1</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="bound">s1</span> <span class="main">⟧</span>
            <span class="main">⟹</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">s0</span></span></span>"</span></span>

  <span class="main">|</span> IfTrue<span class="main">[</span><span class="operator">intro</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>
  <span class="main">|</span> IfFalse<span class="main">[</span><span class="operator">intro</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">¬</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>

  <span class="main">|</span> WhileFalse<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟹</span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>

  <span class="main">|</span> WhileTrue<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">;</span> <span class="main">⋀</span><span class="bound">t</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">-</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">→</span> <span class="bound">t</span> <span class="main">⟹</span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="bound">t</span> <span class="main">⟧</span>
                <span class="main">⟹</span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>

  <span class="main">|</span> <span class="quoted"><span class="quoted">"body <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟹</span> CALL <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>

  <span class="main">|</span> Local<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟹</span> <span class="keyword1">LOCAL</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Do <span class="free">f</span> <span class="main">↓</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="free">s</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">best</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>termi.intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> termi.cases<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">c1</span><span class="main">;</span><span class="free">c2</span><span class="main">)</span> <span class="main">↓</span> <span class="free">s0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">c1</span> <span class="main">↓</span> <span class="free">s0</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s1</span><span class="main">.</span> <span class="free">s0</span> <span class="main">-</span><span class="free">c1</span><span class="main">→</span> <span class="bound">s1</span> <span class="main">⟶</span> <span class="free">c2</span> <span class="main">↓</span> <span class="bound">s1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">best</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>termi.intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> termi.cases<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> <span class="free">c1</span> <span class="keyword1">ELSE</span> <span class="free">c2</span> <span class="main">↓</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span>
              <span class="main">(</span><span class="main">(</span><span class="keyword1">if</span> <span class="free">b</span> <span class="free">s</span> <span class="keyword1">then</span> <span class="free">c1</span> <span class="keyword1">else</span> <span class="free">c2</span><span class="main">)</span> <span class="main">↓</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>termi.intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> termi.cases<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>termi.intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> termi.cases<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>CALL <span class="free">p</span> <span class="main">↓</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>body <span class="free">p</span> <span class="main">↓</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> termi.cases <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>termi.intros<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LOCAL</span> <span class="free">f</span><span class="main">;</span><span class="free">c</span><span class="main">;</span><span class="free">g</span> <span class="main">↓</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">c</span> <span class="main">↓</span> <span class="free">f</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> termi.cases <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>termi.intros<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> termi_while_lemma<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">w</span><span class="main">↓</span><span class="free">fk</span> <span class="main">⟹</span>
 <span class="main">(</span><span class="main">∀</span><span class="bound">k</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">.</span> <span class="free">fk</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">k</span> <span class="main">∧</span> <span class="free">w</span> <span class="main">=</span> <span class="keyword1">WHILE</span> <span class="bound">b</span> <span class="keyword1">DO</span> <span class="bound">c</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">-</span><span class="bound">c</span><span class="main">→</span> <span class="free">f</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span>
          <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span><span class="bound">b</span><span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> termi.induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> termi_while<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="main">↓</span> <span class="free">f</span> <span class="free">k</span><span class="main">;</span>  <span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">-</span><span class="free">c</span><span class="main">→</span> <span class="free">f</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span><span class="free">b</span><span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>termi_while_lemma<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> wf_termi<span class="main">:</span> <span class="quoted"><span class="quoted">"wf <span class="main">{</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span> <span class="main">↓</span> <span class="bound">s</span> <span class="main">∧</span> <span class="free">b</span> <span class="bound">s</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">-</span><span class="free">c</span><span class="main">→</span> <span class="bound">t</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> wf_iff_no_infinite_down_chain<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> termi_while<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="PsHoareTotal">
<div class="head">
<h1>Theory PsHoareTotal</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Inductive definition of Hoare logic for total correctness
    Author:      Tobias Nipkow, 2001/2006
    Maintainer:  Tobias Nipkow
*)</span>

<span class="keyword1"><span class="command">theory</span></span> PsHoareTotal <span class="keyword2"><span class="keyword">imports</span></span> <a href="PsHoare.html">PsHoare</a> <a href="PsTermi.html">PsTermi</a> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Hoare logic for total correctness›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">tvalid</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> assn <span class="main">⇒</span> com <span class="main">⇒</span> <span class="tfree">'a</span> assn <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⊨<span class="hidden">⇩</span><sub>t</sub></span> <span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span><span class="keyword3">/ </span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword3">/ </span><span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span> <span class="main">⟷</span> <span class="main">⊨</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">}</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">{</span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">↓</span><span class="bound">s</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">valids</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> cntxt <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">|⊨<span class="hidden">⇩</span><sub>t</sub></span> _"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">|⊨<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">P</span><span class="main">,</span><span class="bound">c</span><span class="main">,</span><span class="bound">Q</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">.</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">{</span><span class="bound">P</span><span class="main">}</span><span class="bound">c</span><span class="main">{</span><span class="bound">Q</span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">ctvalid</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> cntxt <span class="main">⇒</span> <span class="tfree">'a</span> assn <span class="main">⇒</span> com <span class="main">⇒</span> <span class="tfree">'a</span> assn <span class="main">⇒</span> bool"</span></span>
            <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword3">/</span><span class="keyword1">⊨<span class="hidden">⇩</span><sub>t</sub></span> <span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span><span class="keyword3">/ </span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword3">/ </span><span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword3">)</span><span class="keyword1">}</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span> <span class="main">⟷</span> <span class="keyword1">|⊨<span class="hidden">⇩</span><sub>t</sub></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">⟶</span>  <span class="keyword1">⊨<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">}</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">{</span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">cvalids</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> cntxt <span class="main">⇒</span> <span class="tfree">'a</span> cntxt <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">|⊨<span class="hidden">⇩</span><sub>t</sub></span><span class="keyword3">/ </span>_"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="keyword1"><span class="free">|⊨<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">⟷</span> <span class="keyword1">|⊨<span class="hidden">⇩</span><sub>t</sub></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">⟶</span> <span class="keyword1">|⊨<span class="hidden">⇩</span><sub>t</sub></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span>
  <span class="entity">thoare</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> cntxt <span class="main">⇒</span> <span class="tfree">'a</span> cntxt <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">|⊢<span class="hidden">⇩</span><sub>t</sub></span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> 50<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="entity"><span class="free">thoare'</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> cntxt <span class="main">⇒</span> <span class="tfree">'a</span> assn <span class="main">⇒</span> com <span class="main">⇒</span> <span class="tfree">'a</span> assn <span class="main">⇒</span> bool"</span></span>
    <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">⊢<span class="hidden">⇩</span><sub>t</sub></span><span class="keyword3">/ </span><span class="keyword3">(</span><span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span><span class="keyword3">/ </span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword3">/ </span><span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span><span class="keyword3">)</span><span class="keyword3">)</span>"</span> <span class="main">[</span>50<span class="main">,</span>0<span class="main">,</span>0<span class="main">,</span>0<span class="main">]</span> 50<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span>  <span class="main">≡</span>  <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="keyword1"><span class="free">|⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main">{</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="main">|</span> Do<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">t</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">s</span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">z</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">s</span> <span class="main">≠</span> <span class="main">{}</span><span class="main"><span class="free">}</span></span> Do <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>
<span class="main">|</span> Semi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main"><span class="free">}</span></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>
<span class="main">|</span> If<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">~</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span>  <span class="main">⟧</span> <span class="main">⟹</span>
      <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span> <span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>
<span class="main">|</span> While<span class="main">:</span><span class="comment1">(*&gt;*)</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>wf <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">;</span>  <span class="main">∀</span><span class="bound">s'</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">=</span> <span class="bound">s</span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main"><span class="free">}</span></span><span class="main">⟧</span>
   <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">¬</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span><span class="main"><span class="free">}</span></span>"</span></span>

<span class="main">|</span> Call<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> wf <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">;</span>
     <span class="main">∀</span><span class="bound">q</span> <span class="bound">pre</span><span class="main">.</span>
       <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span><span class="main">.</span> <span class="main">{</span><span class="main">(</span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">p</span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">pre</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">,</span>CALL <span class="bound">p</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">p</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>
       <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">q</span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">=</span> <span class="bound">pre</span><span class="main"><span class="free">}</span></span> body <span class="bound">q</span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">q</span><span class="main"><span class="free">}</span></span> <span class="main">⟧</span>
   <span class="main">⟹</span> <span class="main">{}</span> <span class="keyword1"><span class="free">|⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main">⋃</span><span class="bound">p</span><span class="main">.</span> <span class="main">{</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">p</span><span class="main">,</span> CALL <span class="bound">p</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">p</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="main">|</span> Asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">,</span>CALL <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span> CALL <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>

<span class="main">|</span> Conseq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P'</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q'</span></span></span><span class="main"><span class="free">}</span></span><span class="main">;</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P'</span></span></span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">Q'</span></span></span> <span class="bound">z</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">z</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
     <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">z</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P'</span></span></span> <span class="bound">z</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">⟧</span>
   <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>

<span class="main">|</span> ConjI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">P</span><span class="main">,</span><span class="bound">c</span><span class="main">,</span><span class="bound">Q</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="bound">P</span><span class="main"><span class="free">}</span></span><span class="bound">c</span><span class="main"><span class="free">{</span></span><span class="bound">Q</span><span class="main"><span class="free">}</span></span>  <span class="main">⟹</span>  <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="keyword1"><span class="free">|⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span>"</span></span>
<span class="main">|</span> ConjE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="keyword1"><span class="free">|⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">;</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>

<span class="main">|</span> Local<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound">s'</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">z</span> <span class="bound">s'</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">s'</span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">z</span> <span class="bound">t</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">z</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">s'</span> <span class="bound">t</span><span class="main">)</span><span class="main"><span class="free">}</span></span> <span class="main">⟧</span> <span class="main">⟹</span>
        <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span> <span class="keyword1">LOCAL</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>
<span class="keyword2"><span class="keyword">monos</span></span> split_beta

<span class="keyword1"><span class="command">lemma</span></span> strengthen_pre<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="free">P'</span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">z</span> <span class="bound">s</span><span class="main">;</span> <span class="free">C</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span>  <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">C</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">{</span><span class="free">P'</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> thoare.Conseq<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> weaken_post<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">C</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span><span class="main">;</span> <span class="main">∀</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">Q'</span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">C</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q'</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">erule</span> thoare.Conseq<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>


<span class="keyword1"><span class="command">lemmas</span></span> tvalid_defs <span class="main">=</span> tvalid_def ctvalid_def valids_def cvalids_def valid_defs

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">⊨<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">{</span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="free">P</span> <span class="bound">n</span> <span class="bound">z</span> <span class="bound">s</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">{</span><span class="free">P</span> <span class="bound">n</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> tvalid_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">⊨<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">{</span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">∧</span> <span class="free">P'</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P'</span> <span class="main">⟶</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> tvalid_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">⊨<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span>CALL <span class="free">p</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">⊨<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span>body <span class="free">p</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> tvalid_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> unfold_while<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">-</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">→</span> <span class="free">u</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="free">s</span> <span class="main">-</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> <span class="free">c</span><span class="main">;</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span> <span class="keyword1">ELSE</span> Do<span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">{</span><span class="bound">s</span><span class="main">}</span><span class="main">)</span><span class="main">→</span> <span class="free">u</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> exec.cases <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>exec.intros <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_split_asm<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="keyword1">|⊢<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">D</span>  <span class="main">⟹</span>  <span class="free">C</span> <span class="keyword1">|⊨<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">D</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> thoare.induct<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>tvalid_defs<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>tvalid_defs<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>tvalid_defs<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 3
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>tvalid_defs<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 3
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>tvalid_defs<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>tvalid_defs<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_induct<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> unfold_while<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> allI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> wf_induct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">b</span> <span class="improper">x</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> termi.WhileFalse<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> termi.WhileTrue<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">t</span><span class="main">,</span><span class="improper">x</span><span class="main">)</span><span class="main">:</span><span class="improper">r</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>

 <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>

<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>tvalid_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_use</span><span class="main"><span class="main">)</span></span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>tvalid_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>tvalid_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_use</span><span class="main"><span class="main">)</span></span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>valids_def ctvalid_def cvalids_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> q<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">pre</span><span class="main">.</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">{</span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="improper">P</span> <span class="main">(</span>fst<span class="main">(</span><span class="improper">q</span><span class="main">,</span><span class="bound">pre</span><span class="main">)</span><span class="main">)</span> <span class="bound">z</span> <span class="bound">s</span> <span class="main">&amp;</span> <span class="bound">s</span><span class="main">=</span><span class="main">(</span>snd<span class="main">(</span><span class="improper">q</span><span class="main">,</span><span class="bound">pre</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> body <span class="main">(</span>fst<span class="main">(</span><span class="improper">q</span><span class="main">,</span><span class="bound">pre</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="improper">Q</span> <span class="main">(</span>fst<span class="main">(</span><span class="improper">q</span><span class="main">,</span><span class="bound">pre</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_use</span><span class="main"><span class="main">)</span></span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>tvalid_defs<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> wf_induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>split_paired_all<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> q pre<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> impE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rotate_tac</span> 1<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> thin_rl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> tvalid_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">MGT<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"com <span class="main">⇒</span> state assn <span class="main">×</span> com <span class="main">×</span> state assn"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">MGT<span class="hidden">⇩</span><sub>t</sub></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">z</span> <span class="main">=</span> <span class="bound">s</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">↓</span><span class="bound">s</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="main">λ</span><span class="bound">z</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">z</span> <span class="main">-</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">→</span> <span class="bound">t</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> MGT_implies_complete<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="keyword1">|⊢<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">{</span>MGT<span class="hidden">⇩</span><sub>t</sub> <span class="free">c</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">{}</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">{}</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">::</span>state assn<span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> MGT<span class="hidden">⇩</span><sub>t</sub>_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> thoare.Conseq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tvalid_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> while_termiE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span> <span class="main">↓</span> <span class="free">s</span><span class="main">;</span> <span class="free">b</span> <span class="free">s</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">c</span> <span class="main">↓</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">erule</span> termi.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> while_termiE2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span> <span class="main">↓</span> <span class="free">s</span><span class="main">;</span> <span class="free">b</span> <span class="free">s</span><span class="main">;</span> <span class="free">s</span> <span class="main">-</span><span class="free">c</span><span class="main">→</span> <span class="free">t</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span> <span class="main">↓</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">erule</span> termi.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> MGT_lemma<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">.</span> <span class="main">{}</span> <span class="keyword1">|⊢<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">{</span>MGT<span class="hidden">⇩</span><sub>t</sub><span class="main">(</span>CALL <span class="bound">p</span><span class="main">)</span><span class="main">}</span>  <span class="main">⟹</span>  <span class="main">{}</span> <span class="keyword1">|⊢<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">{</span>MGT<span class="hidden">⇩</span><sub>t</sub> <span class="free">c</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">c</span></span></span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> strengthen_pre<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ thoare.Do<span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> com1 com2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> Q <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">z</span> <span class="main">-</span><span class="improper">com1</span><span class="main">→</span><span class="bound">s</span> <span class="main">&amp;</span> <span class="improper">com2</span><span class="main">↓</span><span class="bound">s</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> thoare.Semi<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> thoare.Conseq<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> thoare.Conseq<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> thoare.If<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> thoare.Conseq<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> thoare.Conseq<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>thoare.Local <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> thoare.Conseq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> b c<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> P' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="bound">z</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span><span class="main">.</span> <span class="improper">b</span> <span class="bound">s</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">-</span><span class="improper">c</span><span class="main">→</span> <span class="bound">t</span><span class="main">}</span><span class="main">)</span><span class="main">^*</span> <span class="main">∧</span>
                           <span class="keyword1">WHILE</span> <span class="improper">b</span> <span class="keyword1">DO</span> <span class="improper">c</span> <span class="main">↓</span> <span class="bound">s</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> thoare.Conseq<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> thoare.While<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf_termi<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> thoare.Conseq<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>rtrancl_into_rtrancl <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>while_termiE while_termiE2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">s</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> converse_rtrancl_induct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exec.WhileFalse<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>exec.WhileTrue<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rtrancl_refl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">inductive_set</span></span>
  <span class="entity">exec1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>com list <span class="main">×</span> state<span class="main">)</span> <span class="main">×</span> <span class="main">(</span>com list <span class="main">×</span> state<span class="main">)</span><span class="main">)</span>set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="entity"><span class="free">exec1'</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>com list <span class="main">×</span> state<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>com list <span class="main">×</span> state<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>  <span class="main">(</span><span class="quoted">"_ <span class="keyword1">→</span> _"</span> <span class="main">[</span>81<span class="main">,</span>81<span class="main">]</span> 100<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">cs0</span></span></span> <span class="main"><span class="free">→</span></span> <span class="free"><span class="bound"><span class="entity">cs1</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cs0</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">cs1</span></span></span><span class="main">)</span> <span class="main">:</span> <span class="free">exec1</span>"</span></span>

<span class="main">|</span> Do<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span>Do <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main"><span class="free">→</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span>"</span></span>

<span class="main">|</span> Semi<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main"><span class="free">→</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>

<span class="main">|</span> IfTrue<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main"><span class="free">→</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> IfFalse<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main"><span class="free">→</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>

<span class="main">|</span> WhileFalse<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main"><span class="free">→</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> WhileTrue<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main"><span class="free">→</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">#</span><span class="main">(</span><span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>

<span class="main">|</span> Call<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>CALL <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main"><span class="free">→</span></span> <span class="main">(</span>body <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>

<span class="main">|</span> Local<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="keyword1">LOCAL</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main"><span class="free">→</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">#</span> Do<span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">t</span><span class="main">}</span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span>
  <span class="entity">exectr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>com list <span class="main">×</span> state<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>com list <span class="main">×</span> state<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>  <span class="main">(</span><span class="quoted">"_ <span class="keyword1">→<span class="hidden">⇧</span><sup>*</sup></span> _"</span> <span class="main">[</span>81<span class="main">,</span>81<span class="main">]</span> 100<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">cs0</span></span></span> <span class="main"><span class="free">→<span class="hidden">⇧</span><sup>*</sup></span></span> <span class="free"><span class="bound"><span class="entity">cs1</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cs0</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">cs1</span></span></span><span class="main">)</span> <span class="main">:</span> exec1<span class="main">^*</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> exec1E<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="free">cs'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span>Do <span class="free">f</span><span class="main">#</span><span class="free">cs</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="free">cs'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">c1</span><span class="main">;</span><span class="free">c2</span><span class="main">)</span><span class="main">#</span><span class="free">cs</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="free">cs'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> <span class="free">c1</span> <span class="keyword1">ELSE</span> <span class="free">c2</span><span class="main">)</span><span class="main">#</span><span class="free">cs</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="free">cs'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span><span class="main">#</span><span class="free">cs</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="free">cs'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span>CALL <span class="free">p</span><span class="main">#</span><span class="free">cs</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="free">cs'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="keyword1">LOCAL</span> <span class="free">f</span><span class="main">;</span><span class="free">c</span><span class="main">;</span><span class="free">g</span><span class="main">)</span><span class="main">#</span><span class="free">cs</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="free">cs'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→</span> <span class="free">u</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">u</span></span><span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> app_exec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">cs</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="free">cs'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">cs</span><span class="main">@</span><span class="free">cs2</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="free">cs'</span><span class="main">@</span><span class="free">cs2</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exec1.induct<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>fun_upd_apply<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>exec1.intros<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> app_execs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">cs</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span><span class="free">cs'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">cs</span><span class="main">@</span><span class="free">cs2</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span><span class="free">cs'</span><span class="main">@</span><span class="free">cs2</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> rtrancl_induct2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>app_exec rtrancl_trans<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> exec_impl_execs<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">-</span><span class="free">c</span><span class="main">→</span> <span class="free">s'</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">cs</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">#</span><span class="bound">cs</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span><span class="bound">cs</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exec.induct<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>rtrancl_trans<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>exec1.IfTrue rtrancl_trans<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>exec1.IfFalse rtrancl_trans<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>exec1.WhileFalse rtrancl_trans<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>exec1.WhileTrue rtrancl_trans<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rtrancl_trans<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rtrancl_trans<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">inductive</span></span>
  <span class="entity">execs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"state <span class="main">⇒</span> com list <span class="main">⇒</span> state <span class="main">⇒</span> bool"</span></span>  <span class="main">(</span><span class="quoted">"_<span class="keyword3">/ </span><span class="keyword1">=</span>_<span class="keyword1">⇒</span><span class="keyword3">/ </span>_"</span> <span class="main">[</span>50<span class="main">,</span>0<span class="main">,</span>50<span class="main">]</span> 50<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">=</span></span><span class="main">[]</span><span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">-</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">→</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main"><span class="free">=</span></span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">=</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span></span></span></span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span><span class="main">[]</span><span class="main">⇒</span> <span class="free">t</span>"</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span><span class="free">c</span><span class="main">#</span><span class="free">cs</span><span class="main">⇒</span> <span class="free">t</span>"</span></span>

<span class="keyword1"><span class="command">theorem</span></span> exec1s_impl_execs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">cs</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">=</span><span class="free">cs</span><span class="main">⇒</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> converse_rtrancl_induct2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> execs.intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exec1.cases<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>execs.intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>execs.intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>execs.intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>execs.intros<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>execs.intros exec.intros<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>



<span class="keyword1"><span class="command">theorem</span></span> exec1s_impl_exec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="free">c</span><span class="main">]</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">-</span><span class="free">c</span><span class="main">→</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> exec1s_impl_execs<span class="main">)</span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">termis</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"com list <span class="main">⇒</span> state <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⇓</span>"</span> 60<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">[]</span><span class="main"><span class="free">⇓</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span> <span class="main"><span class="free">⇓</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">↓</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">-</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">→</span> <span class="bound">t</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main"><span class="free">⇓</span></span><span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> exec1_pres_termis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">cs</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="free">cs'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">cs</span><span class="main">⇓</span><span class="free">s</span> <span class="main">⟶</span> <span class="free">cs'</span><span class="main">⇓</span><span class="free">s'</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exec1.induct<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>fun_upd_apply<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>exec.WhileFalse<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>while_termiE while_termiE2 exec.WhileTrue<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> execs_pres_termis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">cs</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span><span class="free">cs'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">cs</span><span class="main">⇓</span><span class="free">s</span> <span class="main">⟶</span> <span class="free">cs'</span><span class="main">⇓</span><span class="free">s'</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> rtrancl_induct2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>exec1_pres_termis<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> execs_pres_termi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="main">[</span><span class="free">c</span><span class="main">]</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span><span class="free">c'</span><span class="main">#</span><span class="free">cs'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span><span class="main">;</span> <span class="free">c</span><span class="main">↓</span><span class="free">s</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">c'</span><span class="main">↓</span><span class="free">s'</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> execs_pres_termis<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span><span class="free"><span class="free">c</span></span><span class="main"><span class="main">]</span></span>"</span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">c'</span></span><span class="main"><span class="main">#</span></span><span class="free"><span class="free">cs'</span></span>"</span></span></span><span class="main"><span class="main">,</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span>  <span class="entity">termi_call_steps</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>pname <span class="main">×</span> state<span class="main">)</span> <span class="main">×</span> <span class="main">(</span>pname <span class="main">×</span> state<span class="main">)</span><span class="main">)</span>set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">termi_call_steps</span> <span class="main">=</span>
    <span class="main">{</span><span class="main">(</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> body <span class="bound">p</span><span class="main">↓</span><span class="bound">s</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">cs</span><span class="main">.</span> <span class="main">(</span><span class="main">[</span>body <span class="bound">p</span><span class="main">]</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>CALL <span class="bound">q</span><span class="main">#</span> <span class="bound">cs</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lem<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">∈</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⟶</span> <span class="free">P</span> <span class="free">a</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="free">b</span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">∈</span><span class="free">r</span><span class="main">}</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">b</span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">∈</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> trancl_induct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>trancl_trans<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> trancl_induct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>trancl_trans<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">lemma</span></span> renumber_aux<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">^*</span> <span class="main">∧</span> <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">,</span><span class="free">f</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">:</span> <span class="free">r</span><span class="main">;</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">:</span> <span class="free">r</span><span class="main">^*</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">=</span> <span class="free">f</span> <span class="main">0</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">0</span> <span class="main">=</span> <span class="free">a</span> <span class="main">&amp;</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">i</span><span class="main">,</span> <span class="bound">f</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">:</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> converse_rtrancl_induct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">i</span> <span class="keyword1">of</span> <span class="main">0</span> <span class="main">⇒</span> <span class="improper">y</span> <span class="main">|</span> Suc <span class="bound">i</span> <span class="main">⇒</span> <span class="improper">fa</span> <span class="bound">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">i</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> renumber<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">:</span> <span class="free">r</span><span class="main">^*</span> <span class="main">∧</span> <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">,</span><span class="free">f</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">:</span> <span class="free">r</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">0</span> <span class="main">=</span> <span class="free">a</span> <span class="main">&amp;</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">i</span><span class="main">,</span> <span class="bound">f</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">:</span> <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>renumber_aux<span class="main">)</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">inf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"com list <span class="main">⇒</span> state <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">inf</span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">i</span> <span class="main">→</span> <span class="bound">f</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> inf <span class="main">[]</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> inf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="main">0</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> inf <span class="main">[</span>Do <span class="free">f</span><span class="main">]</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> inf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="main">0</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="main">1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">fa</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inf <span class="main">(</span><span class="main">(</span><span class="free">c1</span><span class="main">;</span><span class="free">c2</span><span class="main">)</span><span class="main">#</span><span class="free">cs</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> inf <span class="main">(</span><span class="free">c1</span><span class="main">#</span><span class="free">c2</span><span class="main">#</span><span class="free">cs</span><span class="main">)</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> inf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="improper">f</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="main">0</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">f</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">i</span> <span class="keyword1">of</span> <span class="main">0</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="free">c1</span><span class="main">;</span><span class="free">c2</span><span class="main">)</span><span class="main">#</span><span class="free">cs</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">|</span> Suc <span class="bound">i</span> <span class="main">⇒</span> <span class="improper">f</span> <span class="bound">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>nat.split<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inf <span class="main">(</span><span class="main">(</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> <span class="free">c1</span> <span class="keyword1">ELSE</span> <span class="free">c2</span><span class="main">)</span><span class="main">#</span><span class="free">cs</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span>
              inf <span class="main">(</span><span class="main">(</span><span class="keyword1">if</span> <span class="free">b</span> <span class="free">s</span> <span class="keyword1">then</span> <span class="free">c1</span> <span class="keyword1">else</span> <span class="free">c2</span><span class="main">)</span><span class="main">#</span><span class="free">cs</span><span class="main">)</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> inf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="main">0</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">f</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="improper">f</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="improper">f</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">i</span> <span class="keyword1">of</span> <span class="main">0</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> <span class="free">c1</span> <span class="keyword1">ELSE</span> <span class="free">c2</span><span class="main">)</span><span class="main">#</span><span class="free">cs</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">|</span> Suc <span class="bound">i</span> <span class="main">⇒</span> <span class="improper">f</span> <span class="bound">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exec1.intros <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>nat.split<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"inf <span class="main">(</span><span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span><span class="main">#</span><span class="free">cs</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">if</span> <span class="free">b</span> <span class="free">s</span> <span class="keyword1">then</span> inf <span class="main">(</span><span class="free">c</span><span class="main">#</span><span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span><span class="main">#</span><span class="free">cs</span><span class="main">)</span> <span class="free">s</span> <span class="keyword1">else</span> inf <span class="free">cs</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> inf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="main">0</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">f</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="improper">f</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="improper">f</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">i</span> <span class="keyword1">of</span> <span class="main">0</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span><span class="main">#</span><span class="free">cs</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">|</span> Suc <span class="bound">i</span> <span class="main">⇒</span> <span class="improper">f</span> <span class="bound">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exec1.intros <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>nat.split<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">i</span> <span class="keyword1">of</span> <span class="main">0</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span><span class="main">#</span><span class="free">cs</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">|</span> Suc <span class="bound">i</span> <span class="main">⇒</span> <span class="improper">f</span> <span class="bound">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exec1.intros <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>nat.split<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inf <span class="main">(</span>CALL <span class="free">p</span><span class="main">#</span><span class="free">cs</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span>  inf <span class="main">(</span>body <span class="free">p</span><span class="main">#</span><span class="free">cs</span><span class="main">)</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> inf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="main">0</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">f</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="improper">f</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">i</span> <span class="keyword1">of</span> <span class="main">0</span> <span class="main">⇒</span> <span class="main">(</span>CALL <span class="free">p</span><span class="main">#</span><span class="free">cs</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">|</span> Suc <span class="bound">i</span> <span class="main">⇒</span> <span class="improper">f</span> <span class="bound">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exec1.intros <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>nat.split<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inf <span class="main">(</span><span class="main">(</span><span class="keyword1">LOCAL</span> <span class="free">f</span><span class="main">;</span><span class="free">c</span><span class="main">;</span><span class="free">g</span><span class="main">)</span><span class="main">#</span><span class="free">cs</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span>
              inf <span class="main">(</span><span class="free">c</span><span class="main">#</span>Do<span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">{</span><span class="free">g</span> <span class="free">s</span> <span class="bound">t</span><span class="main">}</span><span class="main">)</span><span class="main">#</span><span class="free">cs</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> inf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> F<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="main">0</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">F</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="improper">F</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> F<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">i</span> <span class="keyword1">of</span> <span class="main">0</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">LOCAL</span> <span class="free">f</span><span class="main">;</span><span class="free">c</span><span class="main">;</span><span class="free">g</span><span class="main">)</span><span class="main">#</span><span class="free">cs</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">|</span> Suc <span class="bound">i</span> <span class="main">⇒</span> <span class="improper">F</span> <span class="bound">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exec1.intros <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>nat.split<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> exec1_only1_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ccs</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="free">cs'</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">⟹</span>
                    <span class="main">∀</span><span class="bound">c</span> <span class="bound">cs</span><span class="main">.</span> <span class="free">ccs</span> <span class="main">=</span> <span class="bound">c</span><span class="main">#</span><span class="bound">cs</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">cs1</span><span class="main">.</span> <span class="free">cs'</span> <span class="main">=</span> <span class="bound">cs1</span> <span class="main">@</span> <span class="bound">cs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exec1.induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> exec1_only1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">#</span><span class="free">cs</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="free">cs'</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">cs1</span><span class="main">.</span> <span class="free">cs'</span> <span class="main">=</span> <span class="bound">cs1</span> <span class="main">@</span> <span class="free">cs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>exec1_only1_aux<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> exec1_drop_suffix_aux<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">cs12</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="free">cs1'2</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">cs1</span> <span class="bound">cs2</span> <span class="bound">cs1'</span><span class="main">.</span>
 <span class="free">cs12</span> <span class="main">=</span> <span class="bound">cs1</span><span class="main">@</span><span class="bound">cs2</span> <span class="main">&amp;</span> <span class="free">cs1'2</span> <span class="main">=</span> <span class="bound">cs1'</span><span class="main">@</span><span class="bound">cs2</span> <span class="main">&amp;</span> <span class="bound">cs1</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">cs1</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="bound">cs1'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exec1.induct<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>exec1.intros <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> neq_Nil_conv<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> exec1_drop_suffix<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">cs1</span><span class="main">@</span><span class="free">cs2</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="free">cs1'</span><span class="main">@</span><span class="free">cs2</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">cs1</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">cs1</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="free">cs1'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>exec1_drop_suffix_aux<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> execs_drop_suffix<span class="main">[</span><span class="operator">rule_format</span><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">no_asm</span></span></span><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="free">c</span><span class="main">#</span><span class="free">cs</span><span class="main">,</span><span class="free">s</span><span class="main">)</span><span class="main">;</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span> <span class="main">→</span> <span class="free">f</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">p</span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">&amp;</span> fst<span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span> <span class="bound">i</span><span class="main">@</span><span class="free">cs</span><span class="main">)</span> <span class="main">⟶</span> fst<span class="main">(</span><span class="free">f</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span> <span class="free">k</span><span class="main">@</span><span class="free">cs</span>
   <span class="main">⟶</span> <span class="main">(</span><span class="main">[</span><span class="free">c</span><span class="main">]</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span><span class="free">p</span> <span class="free">k</span><span class="main">,</span>snd<span class="main">(</span><span class="free">f</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> rtrancl_into_rtrancl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="improper">n</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span>Suc <span class="improper">n</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>exec1_drop_suffix<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> execs_drop_suffix0<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="free">c</span><span class="main">#</span><span class="free">cs</span><span class="main">,</span><span class="free">s</span><span class="main">)</span><span class="main">;</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span> <span class="main">→</span> <span class="free">f</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">;</span> <span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> <span class="free">p</span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">&amp;</span> fst<span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span> <span class="bound">i</span><span class="main">@</span><span class="free">cs</span><span class="main">;</span>
     fst<span class="main">(</span><span class="free">f</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">cs</span><span class="main">;</span> <span class="free">p</span> <span class="free">k</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">[</span><span class="free">c</span><span class="main">]</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span>snd<span class="main">(</span><span class="free">f</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> execs_drop_suffix<span class="main"><span class="keyword3">,</span></span><span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span><span class="operator">assumption</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> skolemize1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">f</span><span class="main">.</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="bound">x</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">SOME</span> <span class="bound">y</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">x</span> <span class="bound">y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>someI2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> least_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="free">c</span> <span class="main">#</span> <span class="free">cs</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span><span class="main">;</span> <span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">→</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">;</span>
        fst<span class="main">(</span><span class="free">f</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">cs</span><span class="main">;</span> <span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">k</span><span class="main">.</span> fst<span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≠</span> <span class="free">cs</span><span class="main">⟧</span>
       <span class="main">⟹</span> <span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">≤</span> <span class="free">k</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="bound">p</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">i</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">)</span> <span class="main">&amp;</span> fst<span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="bound">p</span> <span class="main">@</span> <span class="free">cs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper">i</span></span></span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> order_le_imp_less_or_eq<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"Suc <span class="improper">n</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="improper">n</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span>Suc <span class="improper">n</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> sn csn1 sn1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> neq_Nil_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> exec1_only1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> neq_Nil_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">cs1</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> least_lem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="free">c</span><span class="main">#</span><span class="free">cs</span><span class="main">,</span><span class="free">s</span><span class="main">)</span><span class="main">;</span> <span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">→</span> <span class="free">f</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">;</span> <span class="main">∃</span><span class="bound">i</span><span class="main">.</span> fst<span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">cs</span> <span class="main">⟧</span>
       <span class="main">⟹</span> <span class="main">∃</span><span class="bound">k</span><span class="main">.</span> fst<span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">cs</span> <span class="main">&amp;</span> <span class="main">(</span><span class="main">[</span><span class="free">c</span><span class="main">]</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span>snd<span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> fst<span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">cs</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> LeastI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span>
 <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">≤</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> fst <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">cs</span><span class="main">.</span> <span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">p</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">i</span><span class="main">&lt;</span><span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> fst <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">cs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&amp;</span> fst<span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="bound">p</span><span class="main">@</span><span class="free">cs</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> skolemize1<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> p<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> p<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">p</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> execs_drop_suffix0<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>order_less_imp_le<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> LeastI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> thin_rl<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LEAST</span> <span class="bound">j</span><span class="main">.</span> fst <span class="main">(</span><span class="free">f</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span><span class="free">f</span> <span class="improper">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> least_aux<span class="main"><span class="keyword3">,</span></span><span class="operator">assumption</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> LeastI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> not_less_Least<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> skolemize2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span><span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">f</span><span class="main">.</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">SOME</span> <span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>someI2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> inf_cases<span class="main">:</span> <span class="quoted"><span class="quoted">"inf <span class="main">(</span><span class="free">c</span><span class="main">#</span><span class="free">cs</span><span class="main">)</span> <span class="free">s</span> <span class="main">⟹</span> inf <span class="main">[</span><span class="free">c</span><span class="main">]</span> <span class="free">s</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="free">s</span> <span class="main">-</span><span class="free">c</span><span class="main">→</span> <span class="bound">t</span> <span class="main">∧</span> inf <span class="free">cs</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> inf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> disjCI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span><span class="main">.</span> fst<span class="main">(</span><span class="improper">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">cs</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> least_lem<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> exec1s_impl_exec<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">f</span> <span class="improper">k</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="improper">f</span><span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="improper">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> disjI1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> fst<span class="main">(</span><span class="improper">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="bound">p</span><span class="main">@</span><span class="free">cs</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> skolemize2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> p<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="improper">p</span> <span class="bound">i</span><span class="main">,</span> snd<span class="main">(</span><span class="improper">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="main">0</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> conjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"Suc <span class="improper">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">f</span> <span class="improper">i</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">f</span><span class="main">(</span>Suc <span class="improper">i</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>exec1_drop_suffix<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper">i</span></span></span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">p</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="improper">n</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">f</span> <span class="improper">n</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">f</span><span class="main">(</span>Suc <span class="improper">n</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> exec1_only1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> termi_impl_not_inf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">↓</span> <span class="free">s</span> <span class="main">⟹</span> <span class="main">¬</span> inf <span class="main">[</span><span class="free">c</span><span class="main">]</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> termi.induct<span class="main">)</span>
        <span class="comment1">(*Do*)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
       <span class="comment1">(*Semi*)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>inf_cases<span class="main">)</span>
      <span class="comment1">(* Cond *)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
    <span class="comment1">(*While*)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>inf_cases<span class="main">)</span>
  <span class="comment1">(*Call*)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
 <span class="comment1">(*Local*)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>inf_cases<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> termi_impl_no_inf_chain<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">↓</span><span class="free">s</span> <span class="main">⟹</span> <span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">[</span><span class="free">c</span><span class="main">]</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">i</span><span class="main">,</span> <span class="bound">f</span><span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">:</span> exec1<span class="main">^+</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"wf<span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">[</span><span class="free">c</span><span class="main">]</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="bound">x</span> <span class="main">&amp;</span> <span class="bound">x</span> <span class="main">→</span> <span class="bound">y</span><span class="main">}</span><span class="main">^+</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>wf_iff_no_infinite_down_chain<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> contrapos_nn<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="main">[</span><span class="free">c</span><span class="main">]</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="improper">f</span> <span class="bound">i</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper">i</span></span></span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> trancl_into_rtrancl rtrancl_trans<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">f</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> lem<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> trancl_into_rtrancl rtrancl_trans<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wf_trancl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>wf_iff_no_infinite_down_chain<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> renumber<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fold</span> inf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> termi_impl_not_inf<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">cseq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> pname <span class="main">×</span> state<span class="main">)</span> <span class="main">⇒</span> nat <span class="main">⇒</span> com list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cseq</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span>  <span class="quoted"><span class="quoted">"<span class="free">cseq</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">cs</span><span class="main">.</span> <span class="main">(</span><span class="main">[</span>body<span class="main">(</span>fst<span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main">,</span> snd<span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span>
                              <span class="main">(</span>CALL<span class="main">(</span>fst<span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">#</span> <span class="bound">cs</span><span class="main">,</span> snd<span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="free">cseq</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> wf_termi_call_steps<span class="main">:</span> <span class="quoted"><span class="quoted">"wf termi_call_steps"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> termi_call_steps_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>wf_iff_no_infinite_down_chain<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> S<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span>
 <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Cs</span><span class="main">.</span> <span class="bound">Cs</span> <span class="main">0</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">&amp;</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span>body<span class="main">(</span>fst<span class="main">(</span><span class="improper">S</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="bound">Cs</span> <span class="bound">i</span><span class="main">,</span>snd<span class="main">(</span><span class="improper">S</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span>
                        <span class="main">(</span>CALL<span class="main">(</span>fst<span class="main">(</span><span class="improper">S</span><span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">#</span> <span class="bound">Cs</span><span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">,</span> snd<span class="main">(</span><span class="improper">S</span><span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"cseq <span class="improper">S</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> q t p s cs<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> P <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">cs</span><span class="main">.</span><span class="main">(</span><span class="main">[</span>body <span class="improper">p</span><span class="main">]</span><span class="main">,</span><span class="improper">s</span><span class="main">)</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>CALL <span class="improper">q</span><span class="main">#</span> <span class="bound">cs</span><span class="main">,</span> <span class="improper">t</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> someI2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>app_execs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span>
 <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>body<span class="main">(</span>fst<span class="main">(</span><span class="improper">S</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">#</span> <span class="improper">Cs</span> <span class="bound">i</span><span class="main">,</span>snd<span class="main">(</span><span class="improper">S</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>body<span class="main">(</span>fst<span class="main">(</span><span class="improper">S</span><span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">#</span> <span class="improper">Cs</span><span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">,</span> snd<span class="main">(</span><span class="improper">S</span><span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">:</span> exec1<span class="main">^+</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>rtrancl_into_trancl1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">[</span>body<span class="main">(</span>fst<span class="main">(</span><span class="improper">S</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main">,</span>snd<span class="main">(</span><span class="improper">S</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">i</span><span class="main">,</span> <span class="bound">f</span><span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">:</span> exec1<span class="main">^+</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span><span class="main">(</span>body<span class="main">(</span>fst<span class="main">(</span><span class="improper">S</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">#</span><span class="improper">Cs</span> <span class="bound">i</span><span class="main">,</span>snd<span class="main">(</span><span class="improper">S</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="main">0</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>split_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> termi_impl_no_inf_chain<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> CALL_lemma<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">p</span><span class="main">.</span> <span class="main">{</span><span class="main">(</span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="bound">z</span><span class="main">=</span><span class="bound">s</span> <span class="main">∧</span> body <span class="bound">p</span><span class="main">↓</span><span class="bound">s</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">q</span><span class="main">,</span><span class="free">pre</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> termi_call_steps<span class="main">,</span> CALL <span class="bound">p</span><span class="main">,</span>
        <span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">z</span> <span class="main">-</span>body <span class="bound">p</span><span class="main">→</span> <span class="bound">s</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>t</sub></span>
 <span class="main">{</span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="bound">z</span><span class="main">=</span><span class="bound">s</span> <span class="main">∧</span> body <span class="free">q</span><span class="main">↓</span><span class="free">pre</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">cs</span><span class="main">.</span> <span class="main">(</span><span class="main">[</span>body <span class="free">q</span><span class="main">]</span><span class="main">,</span><span class="free">pre</span><span class="main">)</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span><span class="free">c</span><span class="main">#</span><span class="bound">cs</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="free">c</span>
 <span class="main">{</span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">z</span> <span class="main">-</span><span class="free">c</span><span class="main">→</span> <span class="bound">s</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">c</span></span></span></span><span class="main">)</span>
<span class="comment1">(*Do*)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> strengthen_pre<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ thoare.Do<span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> execs_pres_termi<span class="main">)</span>
<span class="comment1">(*Semi*)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> c1 c2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> Q <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> body <span class="free">q</span><span class="main">↓</span><span class="free">pre</span> <span class="main">&amp;</span> <span class="main">(</span><span class="main">∃</span><span class="bound">cs</span><span class="main">.</span> <span class="main">(</span><span class="main">[</span>body <span class="free">q</span><span class="main">]</span><span class="main">,</span> <span class="free">pre</span><span class="main">)</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span><span class="improper">c2</span><span class="main">#</span><span class="bound">cs</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">&amp;</span> <span class="bound">z</span> <span class="main">-</span><span class="improper">c1</span><span class="main">→</span><span class="bound">s</span> <span class="main">&amp;</span> <span class="improper">c2</span><span class="main">↓</span><span class="bound">s</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> thoare.Semi<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> thoare.Conseq<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">s</span> <span class="main">-</span><span class="improper">c1</span><span class="main">→</span> <span class="improper">t</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> exec1.Semi exec_impl_execs rtrancl_trans<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span>body <span class="free">q</span><span class="main">]</span><span class="main">,</span> <span class="free">pre</span><span class="main">)</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span><span class="improper">c2</span> <span class="main">#</span> <span class="improper">cs</span><span class="main">,</span> <span class="improper">t</span><span class="main">)</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>exec1.Semi<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> r_into_rtrancl<span class="main"><span class="main">]</span></span> exec_impl_execs rtrancl_trans<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span>body <span class="free">q</span><span class="main">]</span><span class="main">,</span> <span class="free">pre</span><span class="main">)</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span><span class="improper">c2</span> <span class="main">#</span> <span class="improper">cs</span><span class="main">,</span> <span class="improper">t</span><span class="main">)</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> exec_impl_execs rtrancl_trans<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>exec_impl_execs rtrancl_trans execs_pres_termi<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> exec1.Semi rtrancl_trans<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> thoare.Conseq<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="comment1">(*Call*)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 3
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>termi_call_steps_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> thoare.Conseq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> thoare.Asm<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> execs_pres_termi<span class="main">)</span>
<span class="comment1">(*If*)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> thoare.If<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> thoare.Conseq<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> exec1.IfTrue rtrancl_trans<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> thoare.Conseq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> exec1.IfFalse rtrancl_trans<span class="main">)</span>
<span class="comment1">(*Local*)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> thoare.Local<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> thoare.Conseq<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> rtrancl_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ r_into_rtrancl<span class="main"><span class="main">[</span></span><span class="operator">OF</span> exec1.Local<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fast</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> rtrancl_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ r_into_rtrancl<span class="main"><span class="main">[</span></span><span class="operator">OF</span> exec1.Local<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="comment1">(*While*)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> b c<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> P' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="bound">z</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span><span class="main">.</span> <span class="improper">b</span> <span class="bound">s</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">-</span><span class="improper">c</span><span class="main">→</span> <span class="bound">t</span><span class="main">}</span><span class="main">)</span><span class="main">^*</span> <span class="main">∧</span> body <span class="free">q</span><span class="main">↓</span><span class="free">pre</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">∃</span><span class="bound">cs</span><span class="main">.</span> <span class="main">(</span><span class="main">[</span>body <span class="free">q</span><span class="main">]</span><span class="main">,</span> <span class="free">pre</span><span class="main">)</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span><span class="main">(</span><span class="keyword1">WHILE</span> <span class="improper">b</span> <span class="keyword1">DO</span> <span class="improper">c</span><span class="main">)</span> <span class="main">#</span> <span class="bound">cs</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> thoare.Conseq<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> thoare.While<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf_termi<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> thoare.Conseq<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rtrancl_trans exec1.WhileTrue<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> rtrancl_trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> exec1.WhileTrue exec_impl_execs rtrancl_trans<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>execs_pres_termi<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> exec1.WhileTrue exec_impl_execs rtrancl_trans<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> exec1.WhileTrue exec_impl_execs rtrancl_trans<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">s</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">s</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> converse_rtrancl_induct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exec.WhileFalse<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>exec.WhileTrue<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rtrancl_refl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> CALL_cor<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">p</span><span class="main">.</span> <span class="main">{</span><span class="main">(</span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="bound">z</span><span class="main">=</span><span class="bound">s</span> <span class="main">∧</span> body <span class="bound">p</span><span class="main">↓</span><span class="bound">s</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">q</span><span class="main">,</span><span class="free">pre</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> termi_call_steps<span class="main">,</span> CALL <span class="bound">p</span><span class="main">,</span>
        <span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">z</span> <span class="main">-</span>body <span class="bound">p</span><span class="main">→</span> <span class="bound">s</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>t</sub></span>
 <span class="main">{</span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="bound">z</span><span class="main">=</span><span class="bound">s</span> <span class="main">∧</span> body <span class="free">q</span><span class="main">↓</span><span class="bound">s</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">=</span> <span class="free">pre</span><span class="main">}</span> body <span class="free">q</span> <span class="main">{</span><span class="main">λ</span><span class="bound">z</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">z</span> <span class="main">-</span>body <span class="free">q</span><span class="main">→</span> <span class="bound">s</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> strengthen_pre<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ CALL_lemma<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> MGT_CALL<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="keyword1">|⊢<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span><span class="main">.</span> <span class="main">{</span>MGT<span class="hidden">⇩</span><sub>t</sub><span class="main">(</span>CALL <span class="bound">p</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> MGT<span class="hidden">⇩</span><sub>t</sub>_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> thoare.Call<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wf_termi_call_steps<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> CALL_cor<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> MGT_CALL1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">.</span> <span class="main">{}</span> <span class="keyword1">|⊢<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">{</span>MGT<span class="hidden">⇩</span><sub>t</sub><span class="main">(</span>CALL <span class="bound">p</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>MGT_CALL<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> ConjE<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="keyword1">⊨<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span>  <span class="main">⟹</span>  <span class="main">{}</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">::</span>state assn<span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> MGT_implies_complete<span class="main"><span class="main">[</span></span><span class="operator">OF</span> MGT_lemma<span class="main"><span class="main">[</span></span><span class="operator">OF</span> MGT_CALL1<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>