<div id="Free_Boolean_Algebra">
<div class="head">
<h1>Theory Free_Boolean_Algebra</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      Free_Boolean_Algebra.thy
    Author:     Brian Huffman, Portland State University
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Free Boolean algebras›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Free_Boolean_Algebra
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">notation</span></span>
  bot <span class="main">(</span><span class="quoted">"<span class="keyword1">⊥</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  top <span class="main">(</span><span class="quoted">"<span class="keyword1">⊤</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  inf  <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊓</span>"</span> 70<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  sup  <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊔</span>"</span> 65<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sup_conv_inf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>boolean_algebra"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="main">-</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Free boolean algebra as a set›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We start by defining the free boolean algebra over type <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> as
  an inductive set.  Here <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>i :: 'a›</span></span></span></span> represents a variable;
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>A :: 'a set›</span></span></span></span> represents a valuation, assigning a truth
  value to each variable; and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>S :: 'a set set›</span></span></span></span> represents a
  formula, as the set of valuations that make the formula true.  The
  set <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>fba›</span></span></span></span> contains representatives of formulas built from
  finite combinations of variables with negation and conjunction.
›</span></span>

<span class="keyword1"><span class="command">inductive_set</span></span>
  <span class="entity">fba</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set set set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">A</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">∈</span> <span class="bound">A</span><span class="main">}</span> <span class="main">∈</span> <span class="free">fba</span>"</span></span>
<span class="main">|</span> Compl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∈</span> <span class="free">fba</span> <span class="main">⟹</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∈</span> <span class="free">fba</span>"</span></span>
<span class="main">|</span> inter<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∈</span> <span class="free">fba</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">∈</span> <span class="free">fba</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∩</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">∈</span> <span class="free">fba</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fba_Diff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> fba <span class="main">⟹</span> <span class="free">T</span> <span class="main">∈</span> fba <span class="main">⟹</span> <span class="free">S</span> <span class="main">-</span> <span class="free">T</span> <span class="main">∈</span> fba"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Diff_eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fba.inter fba.Compl<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fba_union<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> fba <span class="main">⟹</span> <span class="free">T</span> <span class="main">∈</span> fba <span class="main">⟹</span> <span class="free">S</span> <span class="main">∪</span> <span class="free">T</span> <span class="main">∈</span> fba"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> fba"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">∈</span> fba"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">(</span><span class="main">-</span> <span class="free">S</span> <span class="main">∩</span> <span class="main">-</span> <span class="free">T</span><span class="main">)</span> <span class="main">∈</span> fba"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fba.intros<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∪</span> <span class="free">T</span> <span class="main">∈</span> fba"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fba_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">{}</span> <span class="main">::</span> <span class="tfree">'a</span> set set<span class="main">)</span> <span class="main">∈</span> fba"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set set"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">∈</span> fba"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> fba.var<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">∩</span> <span class="main">-</span> <span class="skolem">S</span> <span class="main">∈</span> fba"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fba.intros<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fba_UNIV<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>UNIV <span class="main">::</span> <span class="tfree">'a</span> set set<span class="main">)</span> <span class="main">∈</span> fba"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">{}</span> <span class="main">∈</span> fba"</span></span> <span class="keyword1"><span class="command">using</span></span> fba_empty <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fba.Compl<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"UNIV <span class="main">∈</span> fba"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Free boolean algebra as a type›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The next step is to use <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>typedef›</span></span></span></span> to define a type isomorphic
  to the set <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> fba<span class="antiquote"><span class="antiquote">}</span></span></span></span>.  We also define a constructor <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>var›</span></span></span></span>
  that corresponds with the similarly-named introduction rule for
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> fba<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="tfree">'a</span> formula <span class="main">=</span> <span class="quoted"><span class="quoted">"fba <span class="main">::</span> <span class="tfree">'a</span> set set set"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> fba_empty<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">var</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> formula"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">var</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> Abs_formula <span class="main">{</span><span class="bound">A</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">∈</span> <span class="bound">A</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Rep_formula_var<span class="main">:</span> <span class="quoted"><span class="quoted">"Rep_formula <span class="main">(</span>var <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">A</span><span class="main">.</span> <span class="free">i</span> <span class="main">∈</span> <span class="bound">A</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> var_def <span class="keyword1"><span class="command">using</span></span> fba.var <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Abs_formula_inverse<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  \medskip
  Now we make type <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'a</span></span> formula"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> into a Boolean algebra.  This
  involves defining the various operations (ordering relations, binary
  infimum and supremum, complement, difference, top and bottom
  elements) and proving that they satisfy the appropriate laws.
›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> formula <span class="main">::</span> <span class="main">(</span><span class="quoted">type</span><span class="main">)</span> <span class="quoted">boolean_algebra</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊓</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> Abs_formula <span class="main">(</span>Rep_formula <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∩</span> Rep_formula <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> Abs_formula <span class="main">(</span>Rep_formula <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∪</span> Rep_formula <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⊤</span> <span class="main">=</span> Abs_formula UNIV"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⊥</span> <span class="main">=</span> Abs_formula <span class="main">{}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⟷</span> Rep_formula <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊆</span> Rep_formula <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⟷</span> Rep_formula <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊂</span> Rep_formula <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> Abs_formula <span class="main">(</span><span class="main">-</span> Rep_formula <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> Abs_formula <span class="main">(</span>Rep_formula <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">-</span> Rep_formula <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Rep_formula_inf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Rep_formula <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> Rep_formula <span class="free">x</span> <span class="main">∩</span> Rep_formula <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> inf_formula_def
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Abs_formula_inverse fba.inter Rep_formula<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Rep_formula_sup<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Rep_formula <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> Rep_formula <span class="free">x</span> <span class="main">∪</span> Rep_formula <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> sup_formula_def
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Abs_formula_inverse fba_union Rep_formula<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Rep_formula_top<span class="main">:</span> <span class="quoted"><span class="quoted">"Rep_formula <span class="main">⊤</span> <span class="main">=</span> UNIV"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> top_formula_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Abs_formula_inverse fba_UNIV<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Rep_formula_bot<span class="main">:</span> <span class="quoted"><span class="quoted">"Rep_formula <span class="main">⊥</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> bot_formula_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Abs_formula_inverse fba_empty<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Rep_formula_compl<span class="main">:</span> <span class="quoted"><span class="quoted">"Rep_formula <span class="main">(</span><span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> Rep_formula <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> uminus_formula_def
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Abs_formula_inverse fba.Compl Rep_formula<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Rep_formula_diff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Rep_formula <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> Rep_formula <span class="free">x</span> <span class="main">-</span> Rep_formula <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> minus_formula_def
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Abs_formula_inverse fba_Diff Rep_formula<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> eq_formula_iff <span class="main">=</span> Rep_formula_inject <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> Rep_formula_simps <span class="main">=</span>
  less_eq_formula_def less_formula_def eq_formula_iff
  Rep_formula_sup Rep_formula_inf Rep_formula_top Rep_formula_bot
  Rep_formula_compl Rep_formula_diff Rep_formula_var

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">proof</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">unfold</span> Rep_formula_simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  \medskip
  The laws of a Boolean algebra do not require the top and bottom
  elements to be distinct, so the following rules must be proved
  separately:
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bot_neq_top_formula <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⊥</span> <span class="main">::</span> <span class="tfree">'a</span> formula<span class="main">)</span> <span class="main">≠</span> <span class="main">⊤</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Rep_formula_simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> top_neq_bot_formula <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⊤</span> <span class="main">::</span> <span class="tfree">'a</span> formula<span class="main">)</span> <span class="main">≠</span> <span class="main">⊥</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Rep_formula_simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  \medskip
  Here we prove an essential property of a free Boolean algebra:
  all generators are independent.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> var_le_var_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"var <span class="free">i</span> <span class="main">≤</span> var <span class="free">j</span> <span class="main">⟷</span> <span class="free">i</span> <span class="main">=</span> <span class="free">j</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> var <span class="free">i</span> <span class="main">≤</span> <span class="main">-</span> var <span class="free">j</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">-</span> var <span class="free">i</span> <span class="main">≤</span> var <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Rep_formula_simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> var_eq_var_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"var <span class="free">i</span> <span class="main">=</span> var <span class="free">j</span> <span class="main">⟷</span> <span class="free">i</span> <span class="main">=</span> <span class="free">j</span>"</span></span>
  <span class="quoted"><span class="quoted">"var <span class="free">i</span> <span class="main">≠</span> <span class="main">-</span> var <span class="free">j</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">-</span> var <span class="free">i</span> <span class="main">≠</span> var <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Rep_formula_simps set_eq_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  \medskip
  We conclude this section by proving an induction principle for
  formulas.  It mirrors the definition of the inductive set <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>fba›</span></span></span></span>, with cases for variables, complements, and conjunction.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> formula_induct <span class="main">[</span><span class="operator">case_names</span> var compl inf<span class="main">,</span> <span class="operator">induct</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">type</span></span></span><span class="main"><span class="main"><span class="main"><span class="main">:</span></span></span></span> formula<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span>var <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="main">-</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⊓</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Abs_formula_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set set"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> fba"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>Abs_formula <span class="skolem">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> fba.induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>var <span class="skolem">i</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>var <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> var_def <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Compl <span class="skolem">S</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">P</span> <span class="main">(</span>Abs_formula <span class="skolem">S</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="main">-</span> Abs_formula <span class="skolem">S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 2<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∈</span> fba›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> uminus_formula_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_formula_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>inter <span class="skolem">S</span> <span class="skolem">T</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">P</span> <span class="main">(</span>Abs_formula <span class="skolem">S</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">P</span> <span class="main">(</span>Abs_formula <span class="skolem">T</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>Abs_formula <span class="skolem">S</span> <span class="main">⊓</span> Abs_formula <span class="skolem">T</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 3<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∈</span> fba›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">T</span> <span class="main">∈</span> fba›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> inf_formula_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_formula_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹If-then-else for Boolean algebras›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This is a generic if-then-else operator for arbitrary Boolean
  algebras.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">ifte</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>boolean_algebra <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ifte</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">⊓</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">⊓</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ifte_top <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ifte <span class="main">⊤</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> ifte_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> ifte_bot <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ifte <span class="main">⊥</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> ifte_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> ifte_same<span class="main">:</span> <span class="quoted"><span class="quoted">"ifte <span class="free">a</span> <span class="free">x</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> ifte_def
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_sup_distrib2 <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> sup_compl_top<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> compl_ifte<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> ifte <span class="free">a</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> ifte <span class="free">a</span> <span class="main">(</span><span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> ifte_def
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_antisym<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_sup_distrib1 inf_sup_distrib2 compl_inf_bot<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_inf_distrib1 sup_inf_distrib2 sup_compl_top<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_infI1 le_infI2 le_supI1 le_supI2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_infI1 le_infI2 le_supI1 le_supI2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> inf_ifte_distrib<span class="main">:</span>
  <span class="quoted"><span class="quoted">"ifte <span class="free">x</span> <span class="free">a</span> <span class="free">b</span> <span class="main">⊓</span> ifte <span class="free">x</span> <span class="free">c</span> <span class="free">d</span> <span class="main">=</span> ifte <span class="free">x</span> <span class="main">(</span><span class="free">a</span> <span class="main">⊓</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span><span class="free">b</span> <span class="main">⊓</span> <span class="free">d</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> ifte_def
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_sup_distrib1 inf_sup_distrib2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_sup_aci inf_compl_bot<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> ifte_ifte_distrib<span class="main">:</span>
  <span class="quoted"><span class="quoted">"ifte <span class="free">x</span> <span class="main">(</span>ifte <span class="free">y</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span>ifte <span class="free">y</span> <span class="free">c</span> <span class="free">d</span><span class="main">)</span> <span class="main">=</span> ifte <span class="free">y</span> <span class="main">(</span>ifte <span class="free">x</span> <span class="free">a</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span>ifte <span class="free">x</span> <span class="free">b</span> <span class="free">d</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> ifte_def <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> sup_conv_inf
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> compl_ifte <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> inf_ifte_distrib <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> ifte_same<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Formulas over a set of generators›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The set <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>formulas S›</span></span></span></span> consists of those formulas that only
  depend on variables in the set <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>S›</span></span></span></span>.  It is analogous to the
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> lists<span class="antiquote"><span class="antiquote">}</span></span></span></span> operator for the list datatype.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">formulas</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> formula set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">formulas</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span>
    <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">A</span> <span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="bound">A</span> <span class="main">⟷</span> <span class="bound">i</span> <span class="main">∈</span> <span class="bound">B</span><span class="main">)</span> <span class="main">⟶</span>
      <span class="bound">A</span> <span class="main">∈</span> Rep_formula <span class="bound">x</span> <span class="main">⟷</span> <span class="bound">B</span> <span class="main">∈</span> Rep_formula <span class="bound">x</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> formulasI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span> <span class="bound">B</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="bound">A</span> <span class="main">⟷</span> <span class="bound">i</span> <span class="main">∈</span> <span class="bound">B</span>
    <span class="main">⟹</span> <span class="bound">A</span> <span class="main">∈</span> Rep_formula <span class="free">x</span> <span class="main">⟷</span> <span class="bound">B</span> <span class="main">∈</span> Rep_formula <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> formulas <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> formulas_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> formulasD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> formulas <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟷</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> Rep_formula <span class="free">x</span> <span class="main">⟷</span> <span class="free">B</span> <span class="main">∈</span> Rep_formula <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> formulas_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> formulas_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> <span class="free">T</span> <span class="main">⟹</span> formulas <span class="free">S</span> <span class="main">⊆</span> formulas <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> formulasI <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> formulasD<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> formulas_insert<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> formulas <span class="free">S</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> formulas <span class="main">(</span>insert <span class="free">a</span> <span class="free">S</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> formulas_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> formulas_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> var <span class="free">i</span> <span class="main">∈</span> formulas <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> formulas_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_formula_simps<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> formulas_var_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"var <span class="free">i</span> <span class="main">∈</span> formulas <span class="free">S</span> <span class="main">⟷</span> <span class="free">i</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> formulas_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_formula_simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> formulas_bot<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span> <span class="main">∈</span> formulas <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> formulas_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_formula_simps<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> formulas_top<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊤</span> <span class="main">∈</span> formulas <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> formulas_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_formula_simps<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> formulas_compl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> formulas <span class="free">S</span> <span class="main">⟹</span> <span class="main">-</span> <span class="free">x</span> <span class="main">∈</span> formulas <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> formulas_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_formula_simps<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> formulas_inf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> formulas <span class="free">S</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> formulas <span class="free">S</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">∈</span> formulas <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> formulas_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_formula_simps<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> formulas_sup<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> formulas <span class="free">S</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> formulas <span class="free">S</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">∈</span> formulas <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> formulas_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_formula_simps<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> formulas_diff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> formulas <span class="free">S</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> formulas <span class="free">S</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">-</span> <span class="free">y</span> <span class="main">∈</span> formulas <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> formulas_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_formula_simps<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> formulas_ifte<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> formulas <span class="free">S</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> formulas <span class="free">S</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> formulas <span class="free">S</span> <span class="main">⟹</span>
    ifte <span class="free">a</span> <span class="free">x</span> <span class="free">y</span> <span class="main">∈</span> formulas <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> ifte_def
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> formulas_sup formulas_inf formulas_compl<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> formulas_intros <span class="main">=</span>
  formulas_var formulas_bot formulas_top formulas_compl
  formulas_inf formulas_sup formulas_diff formulas_ifte


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Injectivity of if-then-else›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The if-then-else operator is injective in some limited
  circumstances: when the scrutinee is a variable that is not
  mentioned in either branch.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ifte_inject<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ifte <span class="main">(</span>var <span class="free">i</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> ifte <span class="main">(</span>var <span class="free">i</span><span class="main">)</span> <span class="free">x'</span> <span class="free">y'</span>"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∉</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> formulas <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x'</span> <span class="main">∈</span> formulas <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> formulas <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y'</span> <span class="main">∈</span> formulas <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">x'</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> <span class="free">y'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span><span class="main">.</span> <span class="free">i</span> <span class="main">∈</span> <span class="bound">A</span> <span class="main">⟹</span> <span class="bound">A</span> <span class="main">∈</span> Rep_formula <span class="free">x</span> <span class="main">⟷</span> <span class="bound">A</span> <span class="main">∈</span> Rep_formula <span class="free">x'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_formula_simps ifte_def set_eq_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span><span class="main">.</span> <span class="free">i</span> <span class="main">∉</span> <span class="bound">A</span> <span class="main">⟹</span> <span class="bound">A</span> <span class="main">∈</span> Rep_formula <span class="free">y</span> <span class="main">⟷</span> <span class="bound">A</span> <span class="main">∈</span> Rep_formula <span class="free">y'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_formula_simps ifte_def set_eq_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">x'</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Rep_formula_simps
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∈</span> Rep_formula <span class="free">x</span> <span class="main">⟷</span> insert <span class="free">i</span> <span class="skolem">A</span> <span class="main">∈</span> Rep_formula <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> formulas <span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> formulasD<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="main">∉</span> <span class="free">S</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> insert <span class="free">i</span> <span class="skolem">A</span> <span class="main">∈</span> Rep_formula <span class="free">x'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="skolem">A</span> <span class="main">∈</span> Rep_formula <span class="free">x'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x'</span> <span class="main">∈</span> formulas <span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> formulasD<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="main">∉</span> <span class="free">S</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∈</span> Rep_formula <span class="free">x</span> <span class="main">⟷</span> <span class="skolem">A</span> <span class="main">∈</span> Rep_formula <span class="free">x'</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="free">y'</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Rep_formula_simps
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∈</span> Rep_formula <span class="free">y</span> <span class="main">⟷</span> <span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">∈</span> Rep_formula <span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">y</span> <span class="main">∈</span> formulas <span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> formulasD<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="main">∉</span> <span class="free">S</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">∈</span> Rep_formula <span class="free">y'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="skolem">A</span> <span class="main">∈</span> Rep_formula <span class="free">y'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">y'</span> <span class="main">∈</span> formulas <span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> formulasD<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="main">∉</span> <span class="free">S</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∈</span> Rep_formula <span class="free">y</span> <span class="main">⟷</span> <span class="skolem">A</span> <span class="main">∈</span> Rep_formula <span class="free">y'</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Specification of homomorphism operator›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Our goal is to define a homomorphism operator <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>hom›</span></span></span></span> such that
  for any function <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>f›</span></span></span></span>, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>hom f›</span></span></span></span> is the unique Boolean
  algebra homomorphism satisfying <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>hom f (var i) = f i›</span></span></span></span>
  for all <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>i›</span></span></span></span>.

  Instead of defining <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>hom›</span></span></span></span> directly, we will follow the
  approach used to define Isabelle's <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>fold›</span></span></span></span> operator for finite
  sets.  First we define the graph of the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>hom›</span></span></span></span> function as a
  relation; later we will define the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>hom›</span></span></span></span> function itself using
  definite choice.

  The <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>hom_graph›</span></span></span></span> relation is defined inductively, with
  introduction rules based on the if-then-else normal form of Boolean
  formulas.  The relation is also indexed by an extra set parameter
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>S›</span></span></span></span>, to ensure that branches of each if-then-else do not use
  the same variable again.
›</span></span>

<span class="keyword1"><span class="command">inductive</span></span>
  <span class="entity">hom_graph</span> <span class="main">::</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>boolean_algebra<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> formula <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>boolean_algebra"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  bot<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">hom_graph</span> <span class="free">f</span> <span class="main">{}</span> bot bot"</span></span>
<span class="main">|</span> top<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">hom_graph</span> <span class="free">f</span> <span class="main">{}</span> top top"</span></span>
<span class="main">|</span> ifte<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">⟹</span> <span class="free">hom_graph</span> <span class="free">f</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">⟹</span> <span class="free">hom_graph</span> <span class="free">f</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⟹</span>
  <span class="free">hom_graph</span> <span class="free">f</span> <span class="main">(</span>insert <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">(</span>ifte <span class="main">(</span>var <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">(</span>ifte <span class="main">(</span><span class="free">f</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  \medskip
  The next two lemmas establish a stronger elimination rule for
  assumptions of the form <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"hom_graph <span class="free"><span class="free">f</span></span> <span class="main"><span class="main">(</span></span>insert <span class="free"><span class="free">i</span></span> <span class="free"><span class="free">S</span></span><span class="main"><span class="main">)</span></span> <span class="free"><span class="free">x</span></span> <span class="free"><span class="free">a</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
  Essentially, they say that we can arrange the top-level if-then-else
  to use the variable of our choice.  The proof makes use of the
  distributive properties of if-then-else.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hom_graph_dest<span class="main">:</span>
  <span class="quoted"><span class="quoted">"hom_graph <span class="free">f</span> <span class="free">S</span> <span class="free">x</span> <span class="free">a</span> <span class="main">⟹</span> <span class="free">k</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">y</span> <span class="bound">z</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">.</span>
    <span class="free">x</span> <span class="main">=</span> ifte <span class="main">(</span>var <span class="free">k</span><span class="main">)</span> <span class="bound">y</span> <span class="bound">z</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">=</span> ifte <span class="main">(</span><span class="free">f</span> <span class="free">k</span><span class="main">)</span> <span class="bound">b</span> <span class="bound">c</span> <span class="main">∧</span>
    hom_graph <span class="free">f</span> <span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="main">{</span><span class="free">k</span><span class="main">}</span><span class="main">)</span> <span class="bound">y</span> <span class="bound">b</span> <span class="main">∧</span> hom_graph <span class="free">f</span> <span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="main">{</span><span class="free">k</span><span class="main">}</span><span class="main">)</span> <span class="bound">z</span> <span class="bound">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">set</span><span class="main"><span class="main">:</span></span> hom_graph<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ifte <span class="skolem">i</span> <span class="skolem">S</span> <span class="skolem">x</span> <span class="skolem">a</span> <span class="skolem">y</span> <span class="skolem">b</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="free">k</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">with</span></span> ifte<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>4<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">∈</span> insert <span class="skolem">i</span> <span class="skolem">S</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"insert <span class="skolem">i</span> <span class="skolem">S</span> <span class="main">-</span> <span class="main">{</span><span class="free">k</span><span class="main">}</span> <span class="main">=</span> insert <span class="skolem">i</span> <span class="main">(</span><span class="skolem">S</span> <span class="main">-</span> <span class="main">{</span><span class="free">k</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">≠</span> <span class="free">k</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_Diff_if<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∉</span> <span class="skolem">S</span> <span class="main">-</span> <span class="main">{</span><span class="free">k</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">∉</span> <span class="skolem">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> ifte<span class="main">(</span>1<span class="main">)</span> ifte<span class="main">(</span>3<span class="main">)</span> <span class="main">[</span><span class="operator">OF</span> k<span class="main">]</span> ifte<span class="main">(</span>5<span class="main">)</span> <span class="main">[</span><span class="operator">OF</span> k<span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> *
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ifte_ifte_distrib <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"var <span class="skolem">i</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ifte_ifte_distrib <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">i</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> hom_graph.ifte <span class="main"><span class="main">[</span></span><span class="operator">OF</span> **<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> hom_graph_insert_elim<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"hom_graph <span class="free">f</span> <span class="main">(</span>insert <span class="free">i</span> <span class="free">S</span><span class="main">)</span> <span class="free">x</span> <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∉</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">y</span> <span class="free">z</span> <span class="free">b</span> <span class="free">c</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> ifte <span class="main">(</span>var <span class="free">i</span><span class="main">)</span> <span class="free">y</span> <span class="free">z</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> ifte <span class="main">(</span><span class="free">f</span> <span class="free">i</span><span class="main">)</span> <span class="free">b</span> <span class="free">c</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hom_graph <span class="free">f</span> <span class="free">S</span> <span class="free">y</span> <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hom_graph <span class="free">f</span> <span class="free">S</span> <span class="free">z</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> hom_graph_dest <span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> insertI1<span class="main">]</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  \medskip
  Now we prove the first uniqueness property of the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> hom_graph<span class="antiquote"><span class="antiquote">}</span></span></span></span>
  relation.  This version of uniqueness says that for any particular
  value of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>S›</span></span></span></span>, the relation <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"hom_graph <span class="free"><span class="free">f</span></span> <span class="free"><span class="free">S</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> maps each
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>x›</span></span></span></span> to at most one <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>a›</span></span></span></span>.  The proof uses the
  injectiveness of if-then-else, which we proved earlier.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hom_graph_imp_formulas<span class="main">:</span>
  <span class="quoted"><span class="quoted">"hom_graph <span class="free">f</span> <span class="free">S</span> <span class="free">x</span> <span class="free">a</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> formulas <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">set</span><span class="main"><span class="main">:</span></span> hom_graph<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> formulas_intros formulas_insert<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> hom_graph_unique<span class="main">:</span>
  <span class="quoted"><span class="quoted">"hom_graph <span class="free">f</span> <span class="free">S</span> <span class="free">x</span> <span class="free">a</span> <span class="main">⟹</span> hom_graph <span class="free">f</span> <span class="free">S</span> <span class="free">x</span> <span class="free">a'</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">=</span> <span class="free">a'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">a'</span></span> <span class="quasi_keyword">set</span><span class="main"><span class="main">:</span></span> hom_graph<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ifte <span class="skolem">i</span> <span class="skolem">S</span> <span class="skolem">y</span> <span class="skolem">b</span> <span class="skolem">z</span> <span class="skolem">c</span> <span class="skolem">a'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> ifte<span class="main">(</span>6<span class="main">,</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y'</span></span> <span class="skolem"><span class="skolem">z'</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="skolem"><span class="skolem">c'</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"ifte <span class="main">(</span>var <span class="skolem">i</span><span class="main">)</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">=</span> ifte <span class="main">(</span>var <span class="skolem">i</span><span class="main">)</span> <span class="skolem">y'</span> <span class="skolem">z'</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">=</span> ifte <span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">b'</span> <span class="skolem">c'</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"hom_graph <span class="free">f</span> <span class="skolem">S</span> <span class="skolem">y'</span> <span class="skolem">b'</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"hom_graph <span class="free">f</span> <span class="skolem">S</span> <span class="skolem">z'</span> <span class="skolem">c'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hom_graph_insert_elim<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 1 3 4 ifte<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y'</span> <span class="main">∧</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">z'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ifte_inject hom_graph_imp_formulas<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> 2 3 4 ifte<span class="main">(</span>3<span class="main">,</span>5<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ifte <span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">a'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">erule</span> hom_graph.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  \medskip
  The next few lemmas will help to establish a stronger version of the
  uniqueness property of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> hom_graph<span class="antiquote"><span class="antiquote">}</span></span></span></span>.  They show that the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span>
  hom_graph<span class="antiquote"><span class="antiquote">}</span></span></span></span> relation is preserved if we replace <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>S›</span></span></span></span> with a
  larger finite set.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hom_graph_insert<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"hom_graph <span class="free">f</span> <span class="free">S</span> <span class="free">x</span> <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"hom_graph <span class="free">f</span> <span class="main">(</span>insert <span class="free">i</span> <span class="free">S</span><span class="main">)</span> <span class="free">x</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="free">S</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_absorb<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∉</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"hom_graph <span class="free">f</span> <span class="main">(</span>insert <span class="free">i</span> <span class="free">S</span><span class="main">)</span> <span class="main">(</span>ifte <span class="main">(</span>var <span class="free">i</span><span class="main">)</span> <span class="free">x</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span>ifte <span class="main">(</span><span class="free">f</span> <span class="free">i</span><span class="main">)</span> <span class="free">a</span> <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> hom_graph.ifte assms<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"hom_graph <span class="free">f</span> <span class="main">(</span>insert <span class="free">i</span> <span class="free">S</span><span class="main">)</span> <span class="free">x</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ifte_same<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hom_graph_finite_superset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"hom_graph <span class="free">f</span> <span class="free">S</span> <span class="free">x</span> <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">T</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> <span class="free">T</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"hom_graph <span class="free">f</span> <span class="free">T</span> <span class="free">x</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">T</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hom_graph <span class="free">f</span> <span class="main">(</span><span class="free">S</span> <span class="main">∪</span> <span class="free">T</span><span class="main">)</span> <span class="free">x</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">set</span><span class="main"><span class="main">:</span></span> finite<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hom_graph_insert<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">S</span> <span class="main">⊆</span> <span class="free">T</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"hom_graph <span class="free">f</span> <span class="free">T</span> <span class="free">x</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> subset_Un_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hom_graph_imp_finite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"hom_graph <span class="free">f</span> <span class="free">S</span> <span class="free">x</span> <span class="free">a</span> <span class="main">⟹</span> finite <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">set</span><span class="main"><span class="main">:</span></span> hom_graph<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  \medskip
  This stronger uniqueness property says that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"hom_graph <span class="free"><span class="free">f</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
  maps each <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>x›</span></span></span></span> to at most one <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>a›</span></span></span></span>, even for
  \emph{different} values of the set parameter.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hom_graph_unique'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"hom_graph <span class="free">f</span> <span class="free">S</span> <span class="free">x</span> <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hom_graph <span class="free">f</span> <span class="free">T</span> <span class="free">x</span> <span class="free">a'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">a'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> hom_graph_unique<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">S</span> <span class="main">∪</span> <span class="free">T</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finite_UnI hom_graph_imp_finite<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"hom_graph <span class="free">f</span> <span class="main">(</span><span class="free">S</span> <span class="main">∪</span> <span class="free">T</span><span class="main">)</span> <span class="free">x</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> fin Un_upper1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hom_graph_finite_superset<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"hom_graph <span class="free">f</span> <span class="main">(</span><span class="free">S</span> <span class="main">∪</span> <span class="free">T</span><span class="main">)</span> <span class="free">x</span> <span class="free">a'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> fin Un_upper2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hom_graph_finite_superset<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  \medskip
  Finally, these last few lemmas establish that the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"hom_graph
  <span class="free"><span class="free">f</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> relation is total: every <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>x›</span></span></span></span> is mapped to some <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>a›</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hom_graph_var<span class="main">:</span> <span class="quoted"><span class="quoted">"hom_graph <span class="free">f</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">(</span>var <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hom_graph <span class="free">f</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">(</span>ifte <span class="main">(</span>var <span class="free">i</span><span class="main">)</span> top bot<span class="main">)</span> <span class="main">(</span>ifte <span class="main">(</span><span class="free">f</span> <span class="free">i</span><span class="main">)</span> top bot<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hom_graph.intros<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"hom_graph <span class="free">f</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">(</span>var <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ifte_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hom_graph_compl<span class="main">:</span>
  <span class="quoted"><span class="quoted">"hom_graph <span class="free">f</span> <span class="free">S</span> <span class="free">x</span> <span class="free">a</span> <span class="main">⟹</span> hom_graph <span class="free">f</span> <span class="free">S</span> <span class="main">(</span><span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span> <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">set</span><span class="main"><span class="main">:</span></span> hom_graph<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hom_graph.intros compl_ifte<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> hom_graph_inf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"hom_graph <span class="free">f</span> <span class="free">S</span> <span class="free">x</span> <span class="free">a</span> <span class="main">⟹</span> hom_graph <span class="free">f</span> <span class="free">S</span> <span class="free">y</span> <span class="free">b</span> <span class="main">⟹</span>
   hom_graph <span class="free">f</span> <span class="free">S</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="free">a</span> <span class="main">⊓</span> <span class="free">b</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quasi_keyword">set</span><span class="main"><span class="main">:</span></span> hom_graph<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hom_graph.bot<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> <span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> hom_graph_insert_elim<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_ifte_distrib hom_graph.ifte<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> hom_graph_union_inf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"hom_graph <span class="free">f</span> <span class="free">S</span> <span class="free">x</span> <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hom_graph <span class="free">f</span> <span class="free">T</span> <span class="free">y</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"hom_graph <span class="free">f</span> <span class="main">(</span><span class="free">S</span> <span class="main">∪</span> <span class="free">T</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="free">a</span> <span class="main">⊓</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> hom_graph_inf<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">S</span> <span class="main">∪</span> <span class="free">T</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finite_UnI hom_graph_imp_finite<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"hom_graph <span class="free">f</span> <span class="main">(</span><span class="free">S</span> <span class="main">∪</span> <span class="free">T</span><span class="main">)</span> <span class="free">x</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> fin Un_upper1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hom_graph_finite_superset<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"hom_graph <span class="free">f</span> <span class="main">(</span><span class="free">S</span> <span class="main">∪</span> <span class="free">T</span><span class="main">)</span> <span class="free">y</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> fin Un_upper2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hom_graph_finite_superset<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hom_graph_exists<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span> <span class="bound">S</span><span class="main">.</span> hom_graph <span class="free">f</span> <span class="bound">S</span> <span class="free">x</span> <span class="bound">a</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
   <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> hom_graph_var hom_graph_compl hom_graph_union_inf<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Homomorphisms into other boolean algebras›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Now that we have proved the necessary existence and uniqueness
  properties of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> hom_graph<span class="antiquote"><span class="antiquote">}</span></span></span></span>, we can define the function <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>hom›</span></span></span></span> using definite choice.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">hom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>boolean_algebra<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> formula <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">a</span><span class="main">.</span> <span class="main">∃</span><span class="bound">S</span><span class="main">.</span> hom_graph <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">S</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">a</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hom_graph_hom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">S</span><span class="main">.</span> hom_graph <span class="free">f</span> <span class="bound">S</span> <span class="free">x</span> <span class="main">(</span>hom <span class="free">f</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> hom_def
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> theI'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ex_ex1I<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> hom_graph_exists<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> hom_graph_unique'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> hom_equality<span class="main">:</span>
  <span class="quoted"><span class="quoted">"hom_graph <span class="free">f</span> <span class="free">S</span> <span class="free">x</span> <span class="free">a</span> <span class="main">⟹</span> hom <span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> hom_def
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> the_equality<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> <span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> hom_graph_unique'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  \medskip
  The <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> hom<span class="antiquote"><span class="antiquote">}</span></span></span></span> function correctly implements its specification:
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hom_var <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"hom <span class="free">f</span> <span class="main">(</span>var <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hom_equality<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> hom_graph_var<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> hom_bot <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"hom <span class="free">f</span> <span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hom_equality<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> hom_graph.bot<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> hom_top <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"hom <span class="free">f</span> <span class="main">⊤</span> <span class="main">=</span> <span class="main">⊤</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hom_equality<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> hom_graph.top<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> hom_compl <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"hom <span class="free">f</span> <span class="main">(</span><span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> hom <span class="free">f</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"hom_graph <span class="free">f</span> <span class="skolem">S</span> <span class="free">x</span> <span class="main">(</span>hom <span class="free">f</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> hom_graph_hom <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"hom_graph <span class="free">f</span> <span class="skolem">S</span> <span class="main">(</span><span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span> hom <span class="free">f</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hom_graph_compl<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"hom <span class="free">f</span> <span class="main">(</span><span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> hom <span class="free">f</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hom_equality<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hom_inf <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"hom <span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> hom <span class="free">f</span> <span class="free">x</span> <span class="main">⊓</span> hom <span class="free">f</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"hom_graph <span class="free">f</span> <span class="skolem">S</span> <span class="free">x</span> <span class="main">(</span>hom <span class="free">f</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> hom_graph_hom <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="keyword2"><span class="keyword">where</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"hom_graph <span class="free">f</span> <span class="skolem">T</span> <span class="free">y</span> <span class="main">(</span>hom <span class="free">f</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> hom_graph_hom <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hom_graph <span class="free">f</span> <span class="main">(</span><span class="skolem">S</span> <span class="main">∪</span> <span class="skolem">T</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>hom <span class="free">f</span> <span class="free">x</span> <span class="main">⊓</span> hom <span class="free">f</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> S T <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hom_graph_union_inf<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hom_equality<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hom_sup <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"hom <span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> hom <span class="free">f</span> <span class="free">x</span> <span class="main">⊔</span> hom <span class="free">f</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> sup_conv_inf <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> hom_compl hom_inf<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> hom_diff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"hom <span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> hom <span class="free">f</span> <span class="free">x</span> <span class="main">-</span> hom <span class="free">f</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> diff_eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> hom_compl hom_inf<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> hom_ifte <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"hom <span class="free">f</span> <span class="main">(</span>ifte <span class="free">x</span> <span class="free">y</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> ifte <span class="main">(</span>hom <span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span>hom <span class="free">f</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>hom <span class="free">f</span> <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> ifte_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> hom_compl hom_inf hom_sup<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> hom_simps <span class="main">=</span>
  hom_var hom_bot hom_top hom_compl
  hom_inf hom_sup hom_diff hom_ifte

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  \medskip
  The type <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'a</span></span> formula"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> can be viewed as a monad, with <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span>
  var<span class="antiquote"><span class="antiquote">}</span></span></span></span> as the unit, and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> hom<span class="antiquote"><span class="antiquote">}</span></span></span></span> as the bind operator.  We can
  prove the standard monad laws with simple proofs by induction.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hom_var_eq_id<span class="main">:</span> <span class="quoted"><span class="quoted">"hom var <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> hom_hom<span class="main">:</span> <span class="quoted"><span class="quoted">"hom <span class="free">f</span> <span class="main">(</span>hom <span class="free">g</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> hom <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> hom <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="operator">simp_all</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Map operation on Boolean formulas›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We can define a map functional in terms of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> hom<span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span>
  var<span class="antiquote"><span class="antiquote">}</span></span></span></span>.  The properties of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>fmap›</span></span></span></span> follow directly from the
  lemmas we have already proved about <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> hom<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">fmap</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> formula <span class="main">⇒</span> <span class="tfree">'b</span> formula"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fmap</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> hom <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> var <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fmap_var <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fmap <span class="free">f</span> <span class="main">(</span>var <span class="free">i</span><span class="main">)</span> <span class="main">=</span> var <span class="main">(</span><span class="free">f</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> fmap_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> fmap_bot <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fmap <span class="free">f</span> <span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> fmap_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> fmap_top <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fmap <span class="free">f</span> <span class="main">⊤</span> <span class="main">=</span> <span class="main">⊤</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> fmap_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> fmap_compl <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fmap <span class="free">f</span> <span class="main">(</span><span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> fmap <span class="free">f</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> fmap_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> fmap_inf <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fmap <span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> fmap <span class="free">f</span> <span class="free">x</span> <span class="main">⊓</span> fmap <span class="free">f</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> fmap_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> fmap_sup <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fmap <span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> fmap <span class="free">f</span> <span class="free">x</span> <span class="main">⊔</span> fmap <span class="free">f</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> fmap_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> fmap_diff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fmap <span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> fmap <span class="free">f</span> <span class="free">x</span> <span class="main">-</span> fmap <span class="free">f</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> fmap_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> fmap_ifte <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"fmap <span class="free">f</span> <span class="main">(</span>ifte <span class="free">x</span> <span class="free">y</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> ifte <span class="main">(</span>fmap <span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span>fmap <span class="free">f</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>fmap <span class="free">f</span> <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> fmap_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemmas</span></span> fmap_simps <span class="main">=</span>
  fmap_var fmap_bot fmap_top fmap_compl
  fmap_inf fmap_sup fmap_diff fmap_ifte

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  \medskip
  The map functional satisfies the functor laws: it preserves identity
  and function composition.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fmap_ident<span class="main">:</span> <span class="quoted"><span class="quoted">"fmap <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> fmap_fmap<span class="main">:</span> <span class="quoted"><span class="quoted">"fmap <span class="free">f</span> <span class="main">(</span>fmap <span class="free">g</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> fmap <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="operator">simp_all</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Hiding lattice syntax›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following command hides the lattice syntax, to avoid potential
  conflicts with other theories that import this one.  To re-enable
  the syntax, users should import theory <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Lattice_Syntax›</span></span></span></span> from
  the Isabelle library.
›</span></span>

<span class="keyword1"><span class="command">no_notation</span></span>
  top <span class="main">(</span><span class="quoted">"<span class="keyword1">⊤</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  bot <span class="main">(</span><span class="quoted">"<span class="keyword1">⊥</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  inf  <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊓</span>"</span> 70<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  sup  <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊔</span>"</span> 65<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>